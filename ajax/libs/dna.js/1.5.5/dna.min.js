const dna={version:"[VERSION]",clone:(e,a,n)=>{const t=Object.assign({fade:!1,top:!1,container:null,empty:!1,clones:1,html:!1,transform:null,callback:null},n),d=dna.store.getTemplate(e);d.nested&&!t.container&&dna.core.berserk("Container missing for nested template: "+e),t.empty&&dna.empty(e);const s=[].concat(...Array(t.clones).fill(a));let l=$();return s.forEach((e,a)=>l=l.add(dna.core.replicate(d,e,a,t))),dna.placeholder.setup(),dna.panels.initialize(l.first().closest(".dna-panels")),l.first().parents(".dna-hide").removeClass("dna-hide").addClass("dna-unhide"),l},cloneSub:(e,a,n,t)=>{const d=dna.compile.subTemplateName(e,a),s=".dna-contains-"+d,l={container:e.find(s).addBack(s)};dna.clone(d,n,Object.assign(l,t));const o=dna.getModel(e)[a];return dna.array.wrap(n).forEach(e=>o.push(e)),e},createTemplate:(e,a,n)=>($(a).attr({id:e}).addClass("dna-template").appendTo(n),dna.store.getTemplate(e)),getModel:(e,a)=>{return(e instanceof $?e=>dna.getClone(e,a).data("dnaModel"):e=>{const a=[];return dna.getClones(e).each((e,n)=>a.push(dna.getModel($(n)))),a})(e)},empty:(e,a)=>{const n=Object.assign({fade:!1},a),t=dna.store.getTemplate(e),d=t.container.find(".dna-clone");return t.container.data().dnaCountsMap&&(t.container.data().dnaCountsMap[e]=0),n.fade?dna.ui.slideFadeDelete(d):dna.core.remove(d)},insert:(e,a,n)=>{const t=dna.getClones(e).first();return t.length?dna.refresh(t,{data:a,html:n&&n.html}):dna.clone(e,a,n)},refresh:(e,a)=>{const n=Object.assign({html:!1},a),t=dna.getClone(e,a),d=n.data?n.data:dna.getModel(t);return dna.core.inject(t,d,t.data().dnaCount,n)},refreshAll:e=>{return dna.getClones(e).each((e,a)=>dna.refresh($(a)))},destroy:(e,a)=>{const n=Object.assign({fade:!1},a);return(e=dna.getClone(e,a)).hasClass("dna-sub-clone")&&(a=>dna.getModel(e.parent())[a].splice(dna.getIndex(e),1))(e.data().dnaRules.array),n.fade?dna.ui.slideFadeDelete(e):dna.core.remove(e)},getClone:(e,a)=>{const n=Object.assign({main:!1},a).main?".dna-clone:not(.dna-sub-clone)":".dna-clone";return e instanceof $?e.closest(n):$()},getClones:e=>dna.store.getTemplate(e).container.children(".dna-clone."+e),getIndex:(e,a)=>{const n=dna.getClone(e,a);return n.parent().children(".dna-clone."+n.data().dnaRules.template).index(n)},up:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!0)},down:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!1)},bye:function(e){return dna.destroy(dna.ui.toElem(e,this),{fade:!0})},registerInitializer:(e,a)=>{const n=Object.assign({onDocumentLoad:!0},a);return n.onDocumentLoad&&dna.util.apply(e,[n.selector?$(n.selector).not(".dna-template "+n.selector).addClass("dna-initialized"):$(window.document)].concat(n.params)),dna.events.initializers.push({func:e,selector:n.selector,params:n.params})},clearInitializers:()=>{dna.events.initializers=[]},registerContext:(e,a)=>(dna.events.context[e]=a,dna.events.context),info:()=>{const e=Object.keys(dna.store.templates),a=$(".dna-menu.dna-panels-initialized");return{version:dna.version,templates:e.length,clones:$(".dna-clone:not(.dna-sub-clone)").length,subs:$(".dna-sub-clone").length,names:e,store:dna.store.templates,initializers:dna.events.initializers,panels:a.toArray().map(e=>$(e).attr("data-nav"))}}};dna.array={find:(e,a,n)=>{n=n||"code";const t=Array.isArray(e);let d=0;if(t)for(;d<e.length&&e[d][n]!==a;)d++;return t&&d<e.length?{item:e[d],index:d}:{item:void 0,index:-1}},last:e=>Array.isArray(e)&&e.length?e[e.length-1]:void 0,fromMap:(e,a)=>{const n=Object.assign({key:"code",kebabCodes:!1},a),t=[],d=e=>e instanceof Object?e:{value:e};for(let a in e)t[t.push(d(e[a]))-1][n.key]=n.kebabCodes?dna.util.toKebab(a):a;return t},toMap:(e,a)=>{const n=Object.assign({key:"code",camelKeys:!1},a),t={};return e.forEach(n.camelKeys?e=>t[dna.util.toCamel(e[n.key])]=e:e=>t[e[n.key]]=e),t},wrap:e=>e?e instanceof Array?e:[e]:[]},dna.browser={getUrlParams:()=>{const e={};return window.location.search.slice(1).split("&").forEach(a=>{a&&(e[a.split("=")[0]]=a.split("=")[1])}),e}},dna.pageToken={put:(e,a)=>(window.sessionStorage[e+window.location.pathname]=JSON.stringify(a),a),get:(e,a)=>{const n=window.sessionStorage[e+window.location.pathname];return void 0===n?a:JSON.parse(n)}},dna.ui={deleteElem:function(e){const a=dna.ui.toElem(e,this);return dna.core.remove(a),a},focus:e=>e.trigger("focus"),getAttrs:e=>e[0]?Object.values(e[0].attributes):[],getComponent:e=>e.closest("[data-component]"),pulse:(e,a)=>{const n=Object.assign({duration:400,interval:null,out:5e3},a),t={opacity:0},d={opacity:1};return e.stop(!0).slideDown().css(t).animate(d,n.duration),n.interval&&e.animate(d,n.interval).animate(t,n.out),e},slideFade:(e,a,n)=>{const t={opacity:1,transition:"opacity 0.4s"},d={transition:"opacity 0s"};return n&&window.setTimeout(()=>e.css(t),200)?e.css({opacity:0,transition:"opacity 0s"}).hide().delay(100).slideDown(a):e.css({opacity:0,transition:"opacity 0.4s"}).delay(100).slideUp(a),e.delay(200).promise().then(()=>e.css(d)),e},slideFadeIn:(e,a)=>dna.ui.slideFade(e,a,!0),slideFadeOut:(e,a)=>dna.ui.slideFade(e,a,!1),slideFadeToggle:(e,a)=>dna.ui.slideFade(e,a,e.is(":hidden")),slideFadeDelete:e=>dna.ui.slideFadeOut(e,dna.ui.deleteElem),smoothHeightSetBaseline:e=>{dna.ui.$container=e=e||$("body");const a=e.outerHeight();return e.css({minHeight:a,maxHeight:a,overflow:"hidden"})},smoothHeightAnimate:(e,a)=>{a=a||dna.ui.$container;window.setTimeout(()=>{a.css({minHeight:0,maxHeight:"100vh"});window.setTimeout(()=>a.css({transition:"none",maxHeight:"none"}),1e3)},e||50);return window.setTimeout(()=>a.css({transition:"all 1s"}),10),a},smoothMove:(e,a)=>{const n=a?e.prev():e.next();return n.length&&(()=>{const t=n.clone();a?e.after(n.hide()).before(t):e.before(n.hide()).after(t);window.setTimeout(()=>{dna.ui.slideFadeIn(n),dna.ui.slideFadeDelete(t)})})(),e},toElem:(e,a)=>e instanceof $?e:$(e?e.target:a)},dna.util={apply:(e,a)=>{const n=void 0===a?[]:[].concat(a),t=n[0];let d;const s=(a,l)=>{!a||1===l.length&&"function"!=typeof a[l[0]]?dna.core.berserk("Callback function not found: "+e):1===l.length?d=a[l[0]].apply(t,n):s(a[l[0]],l.slice(1))};return t instanceof $&&0===t.length?d=t:"function"==typeof e?d=e.apply(t,n):t&&t[e]?d=t[e](n[1],n[2],n[3]):""===e||{number:!0,boolean:!0}[typeof e]?dna.core.berserk("Invalid callback function: "+e):"string"==typeof e&&e.length>0&&(e=>{t instanceof $&&n.push(dna.ui.getComponent(t));const a=e[0],d=eval;/^[_$a-zA-Z][_$a-zA-Z0-9]*$/.test(a)&&(e=>void 0===window[e]&&!dna.events.context[e])(a)&&(e=>["object","function"].includes(d("typeof "+e)))(a)&&dna.registerContext(a,d(a)),s(dna.events.context[a]?dna.events.context:window,e)})(e.split(".")),d},assign:(e,a,n)=>{"string"==typeof a&&(a=a.split("."));const t=a[0];return $.isPlainObject(e)||(e={}),1===a.length?e[t]=n:dna.util.assign(void 0===e[t]?e[t]={}:e[t],a.slice(1),n),e},printf:(e,...a)=>a.reduce((e,a)=>e.replace(/%s/,a),e),realTruth:e=>{return!!e&&(!(()=>e instanceof Array&&0===e.length)()&&!(()=>/^(f|false|n|no|0)$/i.test(e))())},toCamel:e=>{return(""+e).replace(/\-(.)/g,(e,a)=>a.toUpperCase())},toKebab:e=>{return(""+e).replace(/([A-Z]+)/g,e=>"-"+e.toLowerCase()).replace(/\s|^-/g,"")},value:(e,a)=>("string"==typeof a&&(a=a.split(".")),null==e||void 0===a?null:1===a.length?e[a[0]]:dna.util.value(e[a[0]],a.slice(1)))},dna.placeholder={setup:()=>{$("option.dna-template").closest("select").addClass("dna-hide");$("[data-placeholder]").each((e,a)=>{const n=$(a).stop(!0);return dna.getClones(n.data().placeholder).length?n.fadeOut():n.fadeIn()})}},dna.panels={display:(e,a,n)=>{const t=e.data().dnaPanels,d=e.data().nav,s=e.find(".menu-item");void 0===a&&(a=dna.pageToken.get(d,0)),a=Math.max(0,Math.min(a,s.length-1)),e[0].selectedIndex=a,s.removeClass("selected").addClass("unselected"),s.eq(a).addClass("selected").removeClass("unselected"),t.hide().removeClass("displayed").addClass("hidden");const l=t.eq(a).fadeIn().addClass("displayed").removeClass("hidden"),o=l.data().hash;dna.pageToken.put(d,a),n&&o&&window.history.pushState(null,null,"#"+o),dna.util.apply(e.data().callback,[l,o])},clickRotate:e=>{const a=$(e.target).closest(".menu-item"),n=a.closest(".dna-menu");dna.panels.display(n,n.find(".menu-item").index(a),!0)},selectRotate:e=>{const a=$(e.target);dna.panels.display(a,a.find("option:selected").index(),!0)},nextNav:1,initialize:e=>{const a="dna-panels-initialized";!e.length||e.hasClass(a)||e.children().hasClass("dna-template")||(()=>{!e.data().nav&&/-panels$/.test(e.attr("id"))&&(a=>{e.attr("data-nav",a).addClass("dna-legacy-id"),$("#"+a+"-menu").attr("data-nav",a).addClass("dna-legacy-id"),e.data().nav=a})(e.attr("id").replace(/-panels$/,""));const n=e.data().nav||(()=>{const a="dna-panels-"+dna.panels.nextNav++;return e.attr("data-nav",a).prev(".dna-menu").attr("data-nav",a),a})(),t=$(".dna-menu[data-nav="+n+"]").addClass(a),d=e.addClass(a).children().addClass("panel"),s=window.location.hash.slice(1),l=s&&d.first().data().hash?(()=>d.filter("[data-hash="+s+"]").index())():(()=>dna.pageToken.get(n,0))();t.length||dna.core.berserk("Menu not found for panels: "+n),t.data().dnaPanels=d,t.find(".menu-item").length||t.children().addClass("menu-item"),dna.panels.display(t,l)})()},setup:()=>{$(".dna-panels").each((e,a)=>dna.panels.initialize($(a))),$(window.document).on({click:dna.panels.clickRotate},".dna-menu .menu-item"),$(window.document).on({change:dna.panels.selectRotate},".dna-menu")}},dna.compile={regexDnaField:/^[\s]*(~~|\{\{).*(~~|\}\})[\s]*$/,regexDnaBasePair:/~~|{{|}}/,regexDnaBasePairs:/~~|\{\{|\}\}/g,setupNucleotide:e=>(void 0===e.data().dnaRules&&(e.data().dnaRules={}),e.addClass("dna-nucleotide")),isDnaField:(e,a)=>{const n=a.childNodes[0];return n&&n.nodeValue&&n.nodeValue.match(dna.compile.regexDnaField)},field:(e,a)=>((a=dna.compile.setupNucleotide($(a))).data().dnaField=a.text().replace(dna.compile.regexDnaBasePairs,"").trim(),a.is("textarea")?a.addClass("dna-update-model").data().dnaRules.val=!0:a.data().dnaRules.text=!0,a.empty()),propsAndAttrs:(e,a)=>{a=$(a);const n=[],t=[],d=[];return dna.ui.getAttrs(a).forEach(e=>{/^data-prop-/.test(e.name)?((e,t)=>{d.push(e),e=e.replace(/^data-prop-/,"").toLowerCase(),t=t.replace(dna.compile.regexDnaBasePairs,""),n.push(e,t),"checked"===e&&a.is("input")&&(a.addClass("dna-update-model").data().dnaField=t)})(e.name,e.value):3===e.value.split(dna.compile.regexDnaBasePair).length&&((e,n)=>{const s=n.split(dna.compile.regexDnaBasePair);"[count]"===s[1]?s[1]=1:"[value]"===s[1]&&(s[1]=2),t.push(e.replace(/^data-attr-/,""),s),d.push(e),(a.is("input:not(:checkbox, :radio)")&&"value"===e&&""===s[0]&&""===s[2]||a.is("select")&&"data-option"===e)&&(dna.compile.setupNucleotide(a).addClass("dna-update-model"),a.data().dnaField=s[1],a.data().dnaRules.val=!0)})(e.name,e.value)}),n.length>0&&(dna.compile.setupNucleotide(a).data().dnaRules.props=n),t.length>0&&(dna.compile.setupNucleotide(a).data().dnaRules.attrs=t),a.data().transform&&(dna.compile.setupNucleotide(a).data().dnaRules.transform=a.data().transform),a.data().callback&&(dna.compile.setupNucleotide(a).data().dnaRules.callback=a.data().callback),a.removeAttr(d.join(" "))},getDataField:(e,a)=>$.trim(e.data(a).replace(dna.compile.regexDnaBasePairs,"")),subTemplateName:(e,a)=>{return(e instanceof $?dna.getClone(e).data().dnaRules.template:e)+"-"+a+"-instance"},rules:(e,a,n)=>{return e.filter("[data-"+a+"]").each((e,t)=>{t=dna.compile.setupNucleotide($(t));const d=dna.compile.getDataField(t,a);t.data().dnaRules[a]=n?d.split(","):d}).removeAttr("data-"+a)},separators:e=>{const a=(e,a)=>3===a.nodeType&&!/\S/.test(a.nodeValue),n=(e,n,t)=>{n&&(e.contents().last().filter(a).remove(),e.append($("<span>").addClass(t).html(n)))};e.find(".dna-template, .dna-sub-clone").addBack().each((e,a)=>{const t=$(a);n(t,t.data().separator,"dna-separator"),n(t,t.data().lastSeparator,"dna-last-separator")})},template:e=>{const a=$("#"+e);a.length||dna.core.berserk("Template not found: "+e);a.find(".dna-template").addBack().each((e,a)=>$(a).data().dnaRules={template:$(a).attr("id")}).removeAttr("id");const n=a.find("*").addBack();n.filter(dna.compile.isDnaField).each(dna.compile.field),dna.compile.rules(n,"array").addClass("dna-sub-clone"),dna.compile.rules(n,"class",!0),dna.compile.rules(n,"require"),dna.compile.rules(n,"missing"),dna.compile.rules(n,"true"),dna.compile.rules(n,"false"),n.each(dna.compile.propsAndAttrs),dna.compile.separators(a);return $("input[data-attr-type]").each((e,a)=>$(a).attr({type:$(a).data().attrType})),dna.store.stash(a)}},dna.store={templates:{},stash:e=>{const a=e.data().dnaRules.template,n=(e,a)=>{const n=(a=$(a)).data().dnaRules.template,t=a.parent(),d=1===t.children().length&&!t.hasClass("dna-container");d||t.data().dnaContents||(()=>{t.data().dnaContents=!0;t.data().dnaContents=t.children().toArray().map(e=>(e=$(e)).hasClass("dna-template")?(e=>e?dna.compile.template(e).name:n)(e.attr("id")):!!e.hasClass("dna-sub-clone")&&e.data().dnaRules.template)})();const s={name:n,elem:a,container:t.addClass("dna-container").addClass("dna-contains-"+n),nested:0!==t.closest(".dna-clone").length,separators:a.find(".dna-separator, .dna-last-separator").length,wrapped:d};dna.store.templates[n]=s,a.removeClass("dna-template").addClass("dna-clone").addClass(n).detach()};return e.find(".dna-template").addBack().each(n),e.find(".dna-sub-clone").each((e,n)=>{const t=(n=$(n)).data().dnaRules.array,d=dna.compile.subTemplateName(a,t);dna.compile.setupNucleotide(n.parent().addClass("dna-array")).data().dnaRules.loop={name:d,field:t},n.data().dnaRules.template=d}).each(n),dna.store.templates[a]},getTemplate:e=>dna.store.templates[e]||dna.compile.template(e)},dna.events={context:{},initializers:[],runOnLoads:()=>{return $("[data-on-load]").not(".dna-loaded").each((e,a)=>dna.util.apply($(a).data().onLoad,$(a))).addClass("dna-loaded")},runInitializers:e=>{return dna.events.initializers.forEach(a=>{const n=a.selector?e.find(a.selector).addBack(a.selector):e;dna.util.apply(a.func,[n.addClass("dna-initialized")].concat(a.params))}),e},setup:()=>{const e=(e,a,n)=>{const t=(e=e.closest("[data-"+a+"]")).data(a);return"click"===a&&"A"===e.prop("tagName")&&t&&t.match(/^dna[.]/)&&n.preventDefault(),dna.util.apply(t,[e,n])},a=a=>{const n=$(a.target),t=(e,a)=>dna.util.assign(dna.getModel(e),e.data().dnaField,a(e)),d=e=>e.val(),s=e=>e.is(":checked"),l=(e,a)=>t($(a),s);return n.hasClass("dna-update-model")&&(()=>{const e=dna.getClone(n,{main:!0});0!==e.length&&(n.is("input:checkbox")?t(n,s):n.is("input:radio")?$("input:radio[name="+n.attr("name")+"]").each(l):n.data().dnaRules.val&&t(n,d),dna.refresh(e))})(),e(n,a.type.replace("key","key-"),a)},n=a=>{const n=$(a.target),t=n.data(),d=()=>{t.dnaLastUpdated=Date.now(),t.dnaLastValue=n.val(),t.dnaTimeoutId=null,e(n,"smart-update",a)},s=()=>{n.val()===t.dnaLastValue||t.dnaTimeoutId||(()=>{const e=t.smartThrottle?+t.smartThrottle:1e3;Date.now()<t.dnaLastUpdated+e?t.dnaTimeoutId=window.setTimeout(d,e):d()})()};t.smartUpdate&&("keydown"===a.type&&void 0===t.dnaLastValue&&(t.dnaLastValue=n.val()),window.setTimeout(s))};$(window.document).on({click:a,change:a,keydown:a,keypress:a,keyup:a,input:a}).on({keydown:n,keyup:n,change:n,cut:n,paste:n}).on({keyup:a=>{13===a.which&&e($(a.target),"enter-key",a)}}).on({click:e=>{const a=$(e.target),n=!(/iPad|iPhone|iPod/.test(window.navigator.userAgent)&&/Apple/.test(window.navigator.vendor))&&a.closest(".external-site").length;window.open(a.closest("[data-href]").data().href,n?"_blank":"_self")}},"[data-href]"),dna.events.runOnLoads()}},dna.core={inject:(e,a,n,t)=>{const d=e=>{const n=dna.util.value(a,e);return null!=n},s=(e,s)=>{const l=(s=$(s)).data().dnaRules;l.transform&&dna.util.apply(l.transform,a),l.loop&&((e,n)=>{const d=dna.util.value(a,n.field),s=e.children("."+n.name.replace(/[.]/g,"\\."));d?d.length===s.length?s.each((e,a)=>{(a=$(a)).is("option")||dna.core.inject(a,d[e],e+1,t)}):(s.remove(),dna.clone(n.name,d,{container:e,html:t.html})):a[n.field]=[]})(s,l.loop),l.text&&((e,d)=>{const s="[count]"===d?n:"[value]"===d?a:dna.util.value(a,d);({string:!0,number:!0,boolean:!0})[typeof s]&&(e=t.html?e.html(s):e.text(s))})(s,s.data().dnaField),l.val&&((e,t)=>{const d="[count]"===t?n:"[value]"===t?a:dna.util.value(a,t);null!==d&&d!==e.val()&&e.val(d)})(s,s.data().dnaField),l.props&&((e,n)=>{for(let t=0;t<n.length/2;t++)e.prop(n[2*t],dna.util.realTruth(dna.util.value(a,n[2*t+1])))})(s,l.props),l.attrs&&((e,t)=>{for(let d=0;d<t.length/2;d++){const s=t[2*d],l=t[2*d+1],o=l[1],i=1===o?n:2===o?a:dna.util.value(a,o),r=[l[0],i,l[2]].join("");e.attr(s,r),/^data-./.test(s)&&e.data(s.substring(5),r),"value"===s&&r!==e.val()&&e.val(r)}})(s,l.attrs),l.class&&((e,n)=>{const t=dna.util.value(a,n[0]),d=dna.util.realTruth(t);1===n.length?e.addClass(t):n.length>1&&(e.toggleClass(n[1],d),n[2]&&e.toggleClass(n[2],!d))})(s,l.class),l.require&&s.toggle(d(l.require)),l.missing&&s.toggle(!d(l.missing)),l.true&&s.toggle(dna.util.realTruth(dna.util.value(a,l.true))),l.false&&s.toggle(!dna.util.realTruth(dna.util.value(a,l.false))),l.callback&&dna.util.apply(l.callback,s)},l=e=>{e.filter(".dna-nucleotide").each(s),e.length&&l(e.children().not(".dna-sub-clone"))};return t.transform&&t.transform(a),l(e),e.data().dnaModel=a,e.data().dnaCount=n,e},replicate:(e,a,n,t)=>{const d=".dna-contains-"+e.name.replace(/[.]/g,"\\."),s=t.container?t.container.find(d).addBack(d):e.container,l=e.elem.clone(!0,!0);let o=s.data().dnaCountsMap;o||(o=s.data().dnaCountsMap={});const i=l.data().dnaRules.template,r=o[i]?++o[i]:o[i]=1;dna.core.inject(l,a,r,t);return e.wrapped?t.top?s.prepend(l):s.append(l):(()=>{const a=s.children(".dna-clone"),n=a.filter("."+e.name);n.length?t.top?n.first().before(l):n.last().after(l):(()=>{const n=s.data().dnaContents,t=n.indexOf(e.name),d=s.children().eq(t+n.reduce((e,d)=>e+(d&&n.indexOf(d)<t?a.filter("."+d).length-1:0),0));d.length?d.before(l):s.append(l)})()})(),e.separators&&(()=>{const a=s.children("."+e.name);a.find(".dna-separator").show().end().last().find(".dna-separator").hide(),a.find(".dna-last-separator").hide().end().eq(-2).find(".dna-last-separator").show().closest(".dna-clone").find(".dna-separator").hide()})(),dna.events.runInitializers(l,a),t.callback&&t.callback(l,a),t.fade&&dna.ui.slideFadeIn(l),l},remove:e=>(e.remove(),dna.placeholder.setup(),e),berserk:e=>{throw Error("dna.js -> "+e)},plugin:()=>{$.fn.dna=function(e){const a=[arguments[1],arguments[2],arguments[3]],n=dna[dna.util.toCamel(e)];n||dna.core.berserk("Unknown plugin action: "+e);return this.each((e,t)=>n($(t),a[0],a[1],a[2]))}},initModule:(e,a)=>(window=e,$=a,window.dna=dna,dna.core.setup(),dna),setup:()=>{dna.core.plugin(),$(dna.placeholder.setup),$(dna.panels.setup),$(dna.events.setup)}},"object"==typeof window&&(window.dna=dna),"object"==typeof module?module.exports=dna.core.initModule:dna.core.setup();