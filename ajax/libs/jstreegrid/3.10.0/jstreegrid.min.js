!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(Z){function ee(e,t){return"jstree_"+e+"_grid_"+function(e){return(e||"").replace(i,"\\$&")}(t)+"_col"}function u(e){return Z.makeArray(e.map(function(){return this.id}))}function te(r,e,t,i){if(null==i&&(i=Z()),null==e||0===e.length)return i;var s,n=Z(),d=[].concat(t);return n="string"==typeof e?(s=ee(r,e),d.map(function(e){return"#"+s+e}).join(", ")):(n=[],e.forEach(function(e,t){var i=ee(r,e);n=n.concat(d.map(function(e){return"#"+i+e}))}),n.join(", ")),1==d.length?i.find(n):Z(n)}function ie(e,t){return null!=e?"function"==typeof e?e(t):null!==t.data&&void 0!==t.data&&void 0!==t.data[e]?t.data[e]:"":""}var re=/^\s*$/g,i=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,se="data-jstreegrid",b="data-jstreegrid-column",ne="jstree-search",p=!1,S=!1,W=null,M=0,k=0,de=/<\/?[^>]+>/gi,o=function(e,t,i,r,s){var n,d;if(r.data=Z.extend(!0,{},t.data),t&&t.children_d&&s)for(n=0,d=t.children_d.length;n<d;n++)o(e,e.get_node(t.children_d[n]),i,i.get_node(r.children_d[n]),s)},ae=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:ae(e,r[r.length-1])};Z.jstree.defaults.grid={width:"auto"},Z.jstree.plugins.grid=function(e,a){function g(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}this._initialize=function(){if(!this._initialized){var e=this.settings.grid||{},d=this.element,h=this._gridSettings={columns:e.columns||[],treeClass:"jstree-grid-col-0",context:e.contextmenu||!1,columnWidth:e.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:e.resizable,draggable:e.draggable,stateful:e.stateful,headerAsTitle:e.headerAsTitle||!1,indent:0,sortOrder:"text",sortAsc:!0,caseInsensitive:e.caseInsensitive,fixedHeader:!1!==e.fixedHeader,width:e.width,height:e.height,gridcontextmenu:e.gridcontextmenu,treecol:0,gridcols:[]},a=h.columns,o=0,l=!1;!0===h.gridcontextmenu?h.gridcontextmenu=function(i,e,r,t,s,n,d){return{edit:{label:"Edit",action:function(e){var t=n.get_node(r);i._edit(t,s,d)}}}}:!1===h.gridcontextmenu&&(h.gridcontextmenu=!1);for(var t=0,i=e.columns.length;t<i;t++)e.columns[t].tree?(o=t,h.treecol=o):h.gridcols.push(t);if(this.uniq=Math.ceil(1e3*Math.random()),this.rootid=d.attr("id"),/msie/.test(navigator.userAgent.toLowerCase()))parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(h.defaultConf.display="inline",h.defaultConf.zoom="1");p||(p=!0,Z('<style type="text/css">'+[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}",".jstree-grid-hidden {display: none;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}",".jstree-grid-midwrapper {display: table-row;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-ellipsis {text-overflow: ellipsis;}",".jstree-grid-col-0 {width: 100%;}"].join("\n")+"</style>").appendTo("head")),this.gridWrapper=Z("<div></div>").addClass("jstree-grid-wrapper").insertAfter(d),this.midWrapper=Z("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),e.width&&this.gridWrapper.width(e.width),e.height&&this.gridWrapper.height(e.height);for(t=0,i=a.length;t<i;t++)Z("<div></div>").addClass("jstree-default jstree-grid-column jstree-grid-column-"+t+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+o+")").append(d),d.addClass("jstree-grid-cell"),h.fixedHeader&&this.gridWrapper.scroll(function(){Z(this).find(".jstree-grid-header").css("top",Z(this).scrollTop())});var r,s,c=Z.proxy(this.settings.sort,this);if(this.settings.sort=function(e,t){var i,r=this.colrefs;if("text"===h.sortOrder){var s=this.get_text(e).toLowerCase().localeCompare(this.get_text(t).toLowerCase());i=h.caseInsensitive?1===s:1===c(e,t)}else{var n=this.get_node(e),d=this.get_node(t),a=r[h.sortOrder].value,o="function"==typeof a?a(n):n.data[a],l="function"==typeof a?a(d):d.data[a];void 0!==l&&(i=h.caseInsensitive?o.toLowerCase()>l.toLowerCase():l<o)}return h.sortAsc||(i=!i),i?1:-1},h.draggable)if(Z.ui&&Z.ui.sortable)Z(this.midWrapper).sortable({axis:"x",handle:".jstree-grid-header",cancel:".jstree-grid-separator",start:function(e,t){r=t.item.index()},stop:function(e,t){s=t.item.index(),h.columns.splice(s,0,h.columns.splice(r,1)[0])}});else console.warn("[jstree-grid] draggable option requires jQuery UI");this.searchColumn=function(e){var t={};if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&i%1==0&&i<a.length&&0<=i&&(t[i]=e[i]);l=t,0!==Object.keys(t).length?this.search("someValue"):this.search(""),l=!1};for(t=0,i=a.length;t<i;t++){var n=a[t];"function"!=typeof n.search_callback&&(n.search_callback=function(e,t,i,r){return new Z.vakata.search(e,!0,{caseSensitive:g.case_sensitive,fuzzy:g.fuzzy}).search(t).isMatch})}var g=this.settings.search,u=g.search_callback;u=u||function(e,t){var i,r=new Z.vakata.search(e,!0,{caseSensitive:g.case_sensitive,fuzzy:g.fuzzy}),s=r.search(t.text).isMatch;if(!s)for(var n=0,d=a.length;n<d&&!(o!==n&&(i=a[n],s=r.search(ie(i.value,t)).isMatch));n++);return s},g.search_callback=function(e,t){var i=!1;if(l){for(var r in l)if(l.hasOwnProperty(r)){var s=l[r];if(""==s)continue;var n=a[r];if(!(i=o==r?n.search_callback(s,t.text,t,n):n.search_callback(s,ie(n.value,t),t,n)))break}d.trigger("columnSearch_grid.jstree")}else i=u(e,t),d.trigger("omniSearch_grid.jstree");return i},this._initialized=!0}},this.init=function(e,t){a.init.call(this,e,t),this._initialize()},this.bind=function(){a.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",Z.proxy(function(e,t){var i=this.get_node(t||"#",!0),r=g();this._detachColumns(r),this._prepare_grid(i),this._reattachColumns(r)},this)).on("delete_node.jstree",Z.proxy(function(e,t){if(void 0!==t.node.id){this.gridWrapper;var i=[t.node.id];t.node&&t.node.children_d&&(i=i.concat(t.node.children_d)),te(this.uniq,i,this._gridSettings.gridcols).remove()}},this)).on("show_node.jstree",Z.proxy(function(e,t){this._hideOrShowTree(t.node,!1)},this)).on("hide_node.jstree",Z.proxy(function(e,t){this._hideOrShowTree(t.node,!0)},this)).on("close_node.jstree",Z.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",Z.proxy(function(e,t){},this)).on("load_node.jstree",Z.proxy(function(e,t){},this)).on("loaded.jstree",Z.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",Z.proxy(function(e,t){var i,r=this.element.find("[class~='jstree-anchor']:first").outerHeight(),s=this.element.attr("class")||"";Z('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px; height: "+r+"px;}</style>").appendTo("head"),i=s.split(/\s+/).map(function(e){return e.match(/^jstree(-|$)/)?"":e}),this.gridWrapper.addClass(i.join(" "))},this)).on("move_node.jstree",Z.proxy(function(e,t){t.new_instance.element.find("li > a").each(Z.proxy(function(e,t){},this))},this)).on("hover_node.jstree",Z.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&te(this.uniq,this._hover_node,this._gridSettings.gridcols).removeClass("jstree-hovered"),this._hover_node=r,te(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-hovered")},this)).on("dehover_node.jstree",Z.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,te(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-hovered")},this)).on("select_node.jstree",Z.proxy(function(e,t,i){var r=t.node.id;te(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",Z.proxy(function(e,t,i){var r=t.node.id;te(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",Z.proxy(function(e,t,i){var r=t.node||[];te(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("search.jstree",Z.proxy(function(e,t){var i,r,s=this.gridWrapper,n=this,d=(new Date).getTime(),a=u(t.nodes.filter(".jstree-node"));if(this.holdingCells={},t.nodes.length){var o=g(),l=s.find("div.jstree-grid-cell-regular");this._detachColumns(o),this._data.search.som&&(this._data.search.smc&&(i=t.nodes.add(t.nodes.find(".jstree-node"))),i=(i||t.nodes).add(t.nodes.parentsUntil(".jstree")),l.hide(),i.filter(".jstree-node").each(function(e,t){var i=t.id;if(i){n._prepare_grid(t);e=0;for(var r=n._gridSettings.gridcols.length;e<r;e++)e!==n._gridSettings.treecol&&te(n.uniq,i,n._gridSettings.gridcols[e],Z(n._domManipulation.columns[e])).show()}}));for(var h=0,c=this._gridSettings.gridcols.length;h<c;h++)h!==this._gridSettings.treecol&&te(n.uniq,a,this._gridSettings.gridcols[h],Z(this._domManipulation.columns[h])).addClass(ne);this._reattachColumns(o),r=(new Date).getTime(),this.element.trigger("search-complete.jstree-grid",[{time:r-d}])}return!0},this)).on("clear_search.jstree",Z.proxy(function(e,t){var i=this.gridWrapper,r=u(t.nodes.filter(".jstree-node"));return i.find("div.jstree-grid-cell").show(),te(this.uniq,r,this._gridSettings.gridcols).removeClass(ne),!0},this)).on("copy_node.jstree",function(e,t){var i=t.new_instance,r=t.old_instance,s=i.get_node(t.node,!0);return o(r,t.original,i,t.node,!0),i._detachColumns(s.id),i._prepare_grid(s),i._reattachColumns(s.id),!0}).on("show_ellipsis.jstree",Z.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).addClass("jstree-grid-ellipsis"),!0},this)).on("hide_ellipsis.jstree",Z.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).removeClass("jstree-grid-ellipsis"),!0},this)).on("enable_node.jstree",Z.proxy(function(e,t){var i=t.node.id;te(this.uniq,i,this._gridSettings.gridcols).removeClass("jstree-disabled"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").removeClass("jstree-disabled")},this)).on("disable_node.jstree",Z.proxy(function(e,t){var i=t.node.id;te(this.uniq,i,this._gridSettings.gridcols).addClass("jstree-disabled"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-disabled")},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",Z.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",Z.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",Z.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",Z.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",Z.proxy(function(e,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),a.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?te(this.uniq,t,this._gridSettings.gridcols).remove():i.find("div.jstree-grid-cell-regular").remove()},this._prepare_headers=function(){var e,t,i,r,s,n,d,a,o=this,l=this._gridSettings,h=l.columns||[],c=l.columnWidth,g=l.resizable||!1,u=l.isThemeroller,p=u?"themeroller":"regular",f=!1,m=this.gridparent,v=this.rootid,_=l.defaultConf;this.parent=m,this.colrefs={};for(var j=0,w=h.length;j<w;j++){for(i=h[j].headerClass||"",r=h[j].columnClass||"",s=h[j].header||"",headerTitle=h[j].headerTitle||"";a=String(Math.floor(1e4*Math.random())),void 0!==this.colrefs[a];);n=h[j].value?a:"text",this.colrefs[n]=h[j],s&&(f=!0),t=l.stateful&&localStorage["jstree-root-"+v+"-column-"+j]?localStorage["jstree-root-"+v+"-column-"+j]:h[j].width||c;var x=h[j].minWidth||t,C=h[j].maxWidth||t;"auto"!==t&&"string"!=typeof t&&(t-=u?7:10),e=this.midWrapper.children("div.jstree-grid-column-"+j),(d=Z("<div></div>").css(_).addClass("jstree-grid-div-"+this.uniq+"-"+j+" "+(u?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+p+" "+i+" "+r).html(s)).addClass((u?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+p),!0===this.settings.core.themes.ellipsis&&d.addClass("jstree-grid-ellipsis");var y=l.headerAsTitle&&!headerTitle?s:headerTitle||"";(y=y.replace(de,""))&&d.attr("title",y),d.prependTo(e),d.attr(b,n),d.outerWidth(),Z("<div class='jstree-grid-separator jstree-grid-separator-"+p+(u?" ui-widget-header":"")+(g?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),e.width(t),e.css("min-width",x),e.css("max-width",C)}d.addClass((u?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+p),void 0===h[h.length-1].width&&(e.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),f?l.header=void 0:Z("div.jstree-grid-header").hide(),!this.bound&&g&&(this.bound=!0,Z(document).mouseup(function(){var e,t,i,r;S&&(r=W.prevAll(".jstree-grid-column").length,i=W.closest(".jstree-grid-wrapper").find(".jstree"),(e=Z.jstree.reference(i)).settings.grid.columns,W.parent().children("div.jstree-grid-column"),(isNaN(r)||r<0)&&(e._gridSettings.treeWidthDiff=i.find("ins:eq(0)").width()+i.find("[class~='jstree-anchor']:eq(0)").width()-e._gridSettings.columns[0].width),t=e._gridSettings.columns[r].width=parseFloat(W.css("width")),S=!1,W=null,i.trigger("resize_column.jstree-grid",[r,t]))}).mousemove(function(e){if(S){var t,i,r=(k=e.pageX)-M;0!==r&&(t=W.width(),i=(parseFloat(W.css("width"))||W.innerWidth())+(r=r<0?Math.max(r,-t):r),(0<r||0<t)&&10<i&&(W.width(i+"px"),W.css("min-width",i+"px"),W.css("max-width",i+"px"),M=k))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(e){return S=!0,M=e.pageX,W=Z(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(e){var t,i,r=Z(this).closest("div.jstree-grid-column"),s=parseFloat(r.css("width")),n=0,d=r.prevAll(".jstree-grid-column").length,a=r.width();r.find(".jstree-grid-cell").each(function(){var e,t=Z(this);t.css("position","absolute"),t.css("width","auto"),e=t.outerWidth(),t.css("position","relative"),n<e&&(n=e)}),i=s+(t=(t=n-s)<0?Math.max(t,-a):t)+"px",r.width(i),r.css("min-width",i),r.css("max-width",i),Z(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[d,i])}).on("click",".jstree-grid-separator",function(e){e.stopPropagation()})),this.gridWrapper.on("click",".jstree-grid-header-cell",function(e){if(o.sort){var t,i=Z(this).attr(b);t=l.sortOrder===i&&!0===l.sortAsc?(l.sortAsc=!1,"&darr;"):(l.sortOrder=i,l.sortAsc=!0,"&uarr;"),Z(this.closest(".jstree-grid-wrapper")).find(".jstree-grid-sort-icon").remove(),Z("<span></span>").addClass("jstree-grid-sort-icon").appendTo(Z(this)).html(t);var r=o.get_node("#");o.sort(r,!0),o.redraw_node(r,!0)}})},this._domManipulation=null,this._detachColumns=function(e){if(null==this._domManipulation){var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper);this._domManipulation={id:e,oldActiveElement:document.activeElement,columns:{}};for(var r=0,s=t.length;r<s;r++)this._domManipulation.columns[r]=i.children(".jstree-grid-column-"+r)[0],this._domManipulation.columns[r].parentNode.removeChild(this._domManipulation.columns[r])}return this._domManipulation},this._reattachColumns=function(e){if(null==this._domManipulation)return!1;if(this._domManipulation.id===e){for(var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper),r=0,s=t.length;r<s;r++)i[0].appendChild(this._domManipulation.columns[r]);this._domManipulation.oldActiveElement!==document.activeElement&&Z(this._domManipulation.oldActiveElement).focus(),this._domManipulation=null}return!0},this.open_node=function(e,t,i){var r=Z.isArray(e),s=null;if(r||"#"!==(s=this.get_node(e)).id){var n=r?g():s.id;this._detachColumns(n);var d=a.open_node.call(this,e,t,i);return this._reattachColumns(n),d}},this.redraw_node=function(e,t,i,r){var s=Z.isArray(e)?g():this.get_node(e).id;return this._detachColumns(s),(e=a.redraw_node.call(this,e,t,i,r))&&this._prepare_grid(e),this._reattachColumns(s),e},this.refresh=function(){return this._clean_grid(),a.refresh.apply(this,arguments)},this.set_id=function(i,e){var t,r=this.uniq;i&&(t=i.id);var s=a.set_id.apply(this,arguments);if(s&&void 0!==t){this.gridWrapper;var n=[t];i&&i.children_d&&(n=n.concat(i.children_d)),te(r,n,this._gridSettings.gridcols).attr(se,i.id).removeClass(ee(r,t)).addClass(ee(r,i.id)).each(function(e,t){Z(t).attr("id",ee(r,i.id)+(e+1))})}return s},this._hideOrShowTree=function(e,t){this._detachColumns(e.id),this._hideOrShowNode(e,t,this._gridSettings.columns||[],this._gridSettings.treecol),this._reattachColumns(e.id)},this._hideOrShowNode=function(e,t,i,r){for(var s=0,n=i.length;s<n;s++)if(s!==r){var d=te(this.uniq,e.id,s,Z(this._domManipulation.columns[s]));t?d.addClass("jstree-grid-hidden"):d.removeClass("jstree-grid-hidden")}if(e.state.opened&&e.children)for(s=0,n=e.children.length;s<n;s++)this._hideOrShowNode(this.get_node(e.children[s]),t,i,r)},this._hide_grid=function(e){if(!e)return!0;this._detachColumns(e.id);for(var t=e.children?e.children:[],i=this._gridSettings.columns||[],r=this._gridSettings.treecol,s=0,n=t.length;s<n;s++){for(var d=this.get_node(t[s]),a=0,o=i.length;a<o;a++)a!==r&&te(this.uniq,d.id,a,Z(this._domManipulation.columns[a])).remove();d.state.opened&&this._hide_grid(d)}this._reattachColumns(e.id)},this.holdingCells={},this.getHoldingCells=function(e,t,i){if(e.state.hidden||!e.state.opened)return Z();var r,s,n=Z(),d=e.children||[],a=this.uniq;for(s=0;s<d.length;s++)i[r=ee(a,d[s])+t]&&(n=n.add(i[r]).add(this.getHoldingCells(this.get_node(d[s]),t,i)));return n},this._edit=function(i,r,s){if(!i)return!1;if(i.data||(i.data={}),!s)return!1;"div"===(s=Z(s)).prop("tagName").toLowerCase()&&(s=s.children("span:first"));var e=this._data.core.rtl,t=this.element.width(),n=i.data[r.value],d=Z("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),a=Z("<input />",{value:n,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:Z.proxy(function(){var e=a.val();if(""===e||e===n)e=n;else{i.data[r.value]=e,this.element.trigger("update_cell.jstree-grid",{node:i,col:r.value,value:e,old:n});var t=g();this._detachColumns(t),this._prepare_grid(this.get_node(i,!0)),this._reattachColumns(t)}a.remove(),s.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=n),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){a.width(Math.min(d.text("pW"+this.value).width(),t))},keypress:function(e){if(13===e.which)return!1}}),o={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""};s.hide(),s.parent().append(a),a.css(o).width(Math.min(d.text("pW"+a[0].value).width(),t))[0].select()},this.grid_hide_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).hide()},this.grid_show_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).show()},this._prepare_grid=function(e){function t(i,r,s,n,e){return function(e){var t=jQuery.Event("select_cell.jstree-grid");i.trigger(t,[{value:s,column:n.header,node:r,grid:Z(this),sourceName:n.value}]),t.isDefaultPrevented()||r.children(".jstree-anchor").trigger("click.jstree",e)}}function i(t,i,r,s,n){return function(e){T.gridcontextmenu&&(e.preventDefault(),Z.vakata.context.show(this,{x:e.pageX,y:e.pageY},T.gridcontextmenu(O,t,i,r,s,n,e.target)))}}function r(e,t){return function(){t.hover_node(e)}}function s(e,t){return function(){t.dehover_node(e)}}var n,d,a,o,l,h,c,g,u,p,f,m,v,_,j,w,x,C,y,b,S,W,M,k,z,A,T=this._gridSettings,q=T.treeClass,O=this,P=T.columns||[],N=T.isThemeroller,E=this.uniq,L=T.treecol,D=this.element,I=this.rootid,V=N?"themeroller":"regular",F=this.get_node(e),H=T.columnWidth,B=T.defaultConf,U=this.midWrapper,$=F.id,Q=this.get_node(F.parent).children,X=Z.inArray($,Q),Y=this.holdingCells,G=!1;if(z=(c=(n=Z(e)).children("[class~='jstree-anchor']")).hasClass(ne),A=c.hasClass("jstree-clicked"),1===c.length){!F.state.opened,v=ee(E,$),_="#"===F.parent?null:F.parent,c.addClass(q),function(e,t,i){var r,s=e.hasClass("jstree-anchor")?e:e.children("[class~='jstree-anchor']"),n=i.settings.grid.columns[0];r="",n.title&&("_DATA_"===n.title?r=i.get_text(t):t.attr(n.title)&&(r=t.attr(n.title))),(r=r.replace(de,""))&&s.attr("title",r)}(c,n,O),g=c,x=X<=0?F.parent:ae(this,Q[X-1]),y=X>=Q.length-1?"NULL":Q[X+1],S=F.children&&0<F.children.length?F.children[0]:"NULL";this.settings.grid;for(var J=0,K=P.length;J<K;J++)if(L!==J){if(W=P[J],k=null==this._domManipulation?U.children("div:eq("+J+")"):Z(this._domManipulation.columns[J]),o=W.cellClass||"",l=W.wideCellClass||"",h=W.columnClass||"",k.addClass(h),a=ie(W.value,F),"function"==typeof W.format&&(a=W.format(a)),W.images?(d=W.images[a]||W.images.default)&&(M="*"===d[0]?'<span class="'+d.substr(1)+'"></span>':'<img src="'+d+'">'):M=a,null!=M&&!re.test(M)||(M="&nbsp;"),(u=W.valueClass&&null!==F.data&&void 0!==F.data&&F.data[W.valueClass]||"")&&W.valueClassPrefix&&""!==W.valueClassPrefix&&(u=W.valueClassPrefix+u),(p=W.wideValueClass&&null!==F.data&&void 0!==F.data&&F.data[W.wideValueClass]||"")&&W.wideValueClassPrefix&&""!==W.wideValueClassPrefix&&(p=W.wideValueClassPrefix+p),m=(m=W.title&&null!==F.data&&void 0!==F.data&&F.data[W.title]||"").replace(de,""),7,"auto"!==(W.width||H)&&7,(!(g=te(E,$,J,k))||g.length<1)&&(g=Z("<div></div>"),Z("<span></span>").appendTo(g),g.attr("id",v+J),g.addClass(v),g.attr(se,$),z?g.addClass(ne):g.removeClass(ne),A?g.addClass("jstree-clicked"):g.removeClass("jstree-clicked"),!0===this.settings.core.themes.ellipsis&&J!==L&&g.addClass("jstree-grid-ellipsis")),F.state.hidden?g.addClass("jstree-grid-hidden"):g.removeClass("jstree-grid-hidden"),F.state.disabled?g.addClass("jstree-disabled"):g.removeClass("jstree-disabled"),w=te(E,x,J,k),C=te(E,y,J,k),b=te(E,S,J,k),j=te(E,_,J,k),_?(G=!!(j&&0<j.length)&&(w&&0<w.length?g.insertAfter(w):b&&0<b.length?g.insertBefore(b):C&&0<C.length?g.insertBefore(C):g.insertAfter(j),!0),Y[v+J]=g):(w&&0<w.length?g.insertAfter(w):b&&0<b.length?g.insertBefore(b):C&&0<C.length?g.insertBefore(C):g.appendTo(k),G=!0),G){var R=this.getHoldingCells(F,J,Y);g.after(R)}(f=g.children("span")).addClass(o+" "+u).html(M),(g=g.css(B).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+I+" jstree-grid-cell-"+V+" "+l+" "+p+(N?" ui-state-default":"")).addClass("jstree-grid-col-"+J).addClass("jstree-animated")).click(t(D,n,a,W)),g.on("contextmenu",i(D,n,a,W,this)),g.hover(r(n,this),s(n,this)),m&&f.attr("title",m),D.trigger("render_cell.jstree-grid",[{value:a,column:W.header,node:n,sourceName:W.value}])}g.addClass("jstree-grid-cell-last"+(N?" ui-state-default":"")),void 0===P[P.length-1].width&&g.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});