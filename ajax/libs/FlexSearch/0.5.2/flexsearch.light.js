/*
 FlexSearch v0.5.2
 Copyright 2019 Nextapps GmbH
 Author: Thomas Wilkerling
 Released under the Apache 2.0 Licence
 https://github.com/nextapps-de/flexsearch
*/
'use strict';(function(e,u,r){let l;(l=r.define)&&l.amd?l([],function(){return u}):(l=r.modules)?l[e.toLowerCase()]=u:"object"===typeof exports?module.exports=u:r[e]=u})("FlexSearch",function(){function e(a,c){const b=c?c.id:a&&a.id;this.id=b||0===b?b:I++;this.init(a,c);r(this,"index",function(){return this.b});r(this,"length",function(){return Object.keys(this.b).length})}function u(a,c){const b=a.length,f=x(c),d=[];for(let n=0,g=0;n<b;n++){const b=a[n];if(f&&c(b)||!f&&!c[b])d[g++]=b}return d}function r(a,
c,b){Object.defineProperty(a,c,{get:b})}function l(a,c){for(let b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);return a}function y(a,c,b,f,d,n,g,h){if(c[b])return c[b];d=d?(h-(g||h/1.5))*n+(g||h/1.5)*d:n;c[b]=d;d>=g&&(a=a[h-(d+.5>>0)],a=a[b]||(a[b]=[]),a[a.length]=f);return d}function C(a,c){if(a){const b=Object.keys(a);for(let f=0,d=b.length;f<d;f++){const d=b[f],g=a[d];if(g)for(let b=0,f=g.length;b<f;b++)if(g[b]===c){1===f?delete a[d]:g.splice(b,1);break}else"object"===typeof g[b]&&C(g[b],c)}}}function J(a,
c){a=a.length-c.length;return 0>a?1:a?-1:0}function z(a){return"string"===typeof a}function x(a){return"function"===typeof a}function A(a){return"undefined"===typeof a}function E(a){const c=Array(a);for(let b=0;b<a;b++)c[b]=t();return c}function t(){return Object.create(null)}const p={encode:"icase",c:"forward",o:!1,cache:!1,async:!1,s:!1,i:!1,m:!1,l:!1,a:9,threshold:0,depth:0},D=[];let I=0;const F=/\W+/,G={},H={};e.create=function(a){return new e(a)};e.registerMatcher=function(a){for(const c in a)a.hasOwnProperty(c)&&
D.push(new RegExp(c,"g"),a[c]);return this};e.registerEncoder=function(a,c){w[a]=c.bind(w);return this};e.registerLanguage=function(a,c){G[a]=c.filter;H[a]=c.stemmer;return this};e.encode=function(a,c){return w[a](c)};e.prototype.init=function(a,c){this.j=[];if(c){var b=c.preset;a=c}else a||(a=p),b=a.preset;c={};this.c=a.tokenize||c.c||this.c||p.c;this.i=a.rtl||this.i||p.i;this.threshold=A(b=a.threshold)?c.threshold||this.threshold||p.threshold:b;this.a=A(b=a.resolution)?b=c.a||this.a||p.a:b;b<=this.threshold&&
(this.a=this.threshold+1);this.depth=A(b=a.depth)?c.depth||this.depth||p.depth:b;this.l=A(b=a.paging)?this.l||p.l:b;this.g=(b=A(b=a.encode)?c.encode||p.encode:b)&&w[b]&&w[b].bind(w)||(x(b)?b:this.g||!1);(b=a.matcher)&&this.addMatcher(b);if(b=a.filter){z(b)&&(b=G[b]);if(b.constructor===Array){c=this.g;var f=t();for(let a=0;a<b.length;a++){const d=c?c(b[a]):b[a];f[d]=1}b=f}this.filter=b}if(b=a.stemmer){var d;a=z(b)?H[b]:b;b=this.g;c=[];for(d in a)a.hasOwnProperty(d)&&(f=b?b(d):d,c.push(new RegExp(f+
"($|\\W)","g"),b?b(a[d]):a[d]));this.stemmer=d=c}this.h=E(this.a-(this.threshold||0));this.f=t();this.b=t();return this};e.prototype.encode=function(a){a&&D.length&&(a=l(a,D));a&&this.j.length&&(a=l(a,this.j));a&&this.g&&(a=this.g(a));a&&this.stemmer&&(a=l(a,this.stemmer));return a};e.prototype.addMatcher=function(a){const c=this.j;for(const b in a)a.hasOwnProperty(b)&&c.push(new RegExp(b,"g"),a[b]);return this};e.prototype.add=function(a,c,b,f,d){if(c&&z(c)&&(a||0===a)){const e="@"+a;if(this.b[e]&&
!f)return this.update(a,c);if(!d&&b)return this.add(a,c,null,f,!0),b(),this;c=this.encode(c);if(!c.length)return this;b=this.c;c=x(b)?b(c):c.split(F);this.filter&&(c=u(c,this.filter));f=t();f._ctx=t();d=c.length;const v=this.threshold,l=this.depth,q=this.a,B=this.h,p=this.i;for(let e=0;e<d;e++){var n=c[e];if(n){var g=n.length,h=(p?e+1:d-e)/d,m="";switch(b){case "reverse":case "both":for(var k=g;--k;)m=n[k]+m,y(B,f,m,a,p?1:(g-k)/g,h,v,q-1);m="";case "forward":for(k=0;k<g;k++)m+=n[k],y(B,f,m,a,p?(k+
1)/g:1,h,v,q-1);break;case "full":for(k=0;k<g;k++){const b=(p?k+1:g-k)/g;for(let c=g;c>k;c--)m=n.substring(k,c),y(B,f,m,a,b,h,v,q-1)}break;default:if(g=y(B,f,n,a,1,h,v,q-1),l&&1<d&&g>=v)for(g=f._ctx[n]||(f._ctx[n]=t()),n=this.f[n]||(this.f[n]=E(q-(v||0))),h=e-l,m=e+l+1,0>h&&(h=0),m>d&&(m=d);h<m;h++)h!==e&&y(n,g,c[h],a,0,q-(h<e?e-h:h-e),v,q-1)}}}this.b[e]=1}return this};e.prototype.update=function(a,c,b){this.b["@"+a]&&z(c)&&(this.remove(a),this.add(a,c,b,!0));return this};e.prototype.remove=function(a,
c,b){const f="@"+a;if(this.b[f]){if(!b&&c)return this.remove(a,null,!0),c(),this;for(c=0;c<this.a-(this.threshold||0);c++)C(this.h[c],a);this.depth&&C(this.f,a);delete this.b[f]}return this};e.prototype.search=function(a,c,b,f){var d=a,e=[];if("object"===typeof a){c=a.limit;var g=a.threshold;a=a.query}g||(g=this.threshold||0);x(c)?(b=c,c=1E3):c||0===c||(c=1E3);if(!f&&b)return b(this.search(d,c,null,!0)),this;if(!a||!z(a))return e;d=this.encode(a);if(!d.length)return e;a=this.c;a=x(a)?a(d):d.split(F);
this.filter&&(a=u(a,this.filter));b=a.length;f=!0;d=[];var h=t();if(1<b)if(this.depth){var m=!0;var k=a[0];h[k]=1}else a.sort(J);var l;if(!m||(l=this.f)[k]){var p=this.a;for(var r=m?1:0;r<b;r++){var q=a[r];if(q){if(!h[q]){const a=[];let b=!1,c=0;if(k=m?l[k]:this.h){let d;for(let e=0;e<p-g;e++)if(d=k[e][q])a[c++]=d,b=!0}if(b)d[d.length]=1<c?a.concat.apply([],a):a[0];else{f=!1;break}h[q]=1}k=q}}}else f=!1;if(f)a:{g=[];e=d.length;if(1<e){m=t();l=d[0];k=l.length;for(a=0;a<k;)m["@"+l[a++]]=1;for(h=f=0;++h<
e;){p=!1;r=h===e-1;l=d[h];k=l.length;for(a=0;a<k;)if(b=l[a++],q="@"+b,m[q]&&m[q]===h){if(r){if(g[f++]=b,c&&f===c){e=g;break a}}else m[q]=h+1;p=!0}if(!p)break}}else e&&(g=d[0],c&&g.length>c&&(g=g.slice(0,c)));e=g}return e};e.prototype.clear=function(){return this.destroy().init()};e.prototype.destroy=function(){this.h=this.f=this.b=null;return this};const w={icase:function(a){return a.toLowerCase()}};return e}(!1),this);
