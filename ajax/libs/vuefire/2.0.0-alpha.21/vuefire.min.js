/*!
 * vuefire v2.0.0-alpha.21
 * (c) 2019 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Vuefire={})}(this,function(e){"use strict";function $(e){return Object.defineProperty(e.data(),"id",{value:e.id})}function f(e){return e&&"object"==typeof e}function h(i,o,s,e){void 0===o&&(o={}),void 0===s&&(s=""),void 0===e&&(e=[{},{}]),o=o||{};var t=Object.getOwnPropertyDescriptor(i,"id");return t&&!t.enumerable&&Object.defineProperty(e[0],"id",t),Object.keys(i).reduce(function(e,t){var n,r=i[t];return(n=r)&&n.onSnapshot?(e[0][t]=o[t]||r.path,e[1][s+t]=r):Array.isArray(r)?(e[0][t]=Array(r.length).fill(null),h(r,o[t],s+t+".",[e[0][t],e[1]])):null==r||r instanceof Date||r.toDate||r.longitude&&r.latitude?e[0][t]=r:f(r)?(e[0][t]={},h(r,o[t],s+t+".",[e[0][t],e[1]])):e[0][t]=r,e},e)}function r(e,t,n){var r=(""+t).split("."),i=r.pop(),o=r.reduce(function(e,t){return e[t]},e);return o.splice?o.splice(i,1,n):o[i]=n}function p(e){var t,n=e.val();return f(n)?t=n:(t={},Object.defineProperty(t,".value",{value:n})),Object.defineProperty(t,".key",{value:e.key}),t}function b(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}function x(e){for(var t in e)e[t].unsub()}function y(e,p){var h=e.subs,b=e.refs,y=e.target,m=e.path,g=e.depth,j=e.ops,_=e.resolve,t=Object.keys(b);if(Object.keys(h).filter(function(e){return t.indexOf(e)<0}).forEach(function(e){h[e].unsub(),delete h[e]}),!t.length||++g>p.maxRefDepth)return _(m);var O=0,k=t.length,U=Object.create(null);t.forEach(function(e){var t,n,r,i,o,s,f,c,u,a,d=h[e],l=b[e],v=m+"."+e;if(U[v]=!0,d){if(d.path===l.path)return;d.unsub()}h[e]={unsub:(t={ref:l,target:y,path:v,depth:g,ops:j,resolve:function(e){e in U&&++O>=k&&_(m)}.bind(null,v)},n=p,r=t.ref,i=t.target,o=t.path,s=t.depth,f=t.resolve,c=t.ops,u=Object.create(null),a=r.onSnapshot(function(e){e.exists?R({snapshot:$(e),target:i,path:o,ops:c,subs:u,depth:s,resolve:f},n):(c.set(i,o,null),f(o))}),function(){a(),x(u)}),path:l.path}})}function R(e,t){var n=e.snapshot,r=e.target,i=e.path,o=e.subs,s=e.ops,f=e.depth;void 0===f&&(f=0);var c=e.resolve;void 0===t&&(t={maxRefDepth:2});var u,a=h(n,(u=r,i.split(".").reduce(function(e,t){return e[t]},u))),d=a[0],l=a[1];s.set(r,i,d),y({data:d,subs:o,refs:l,target:r,path:i,ops:s,depth:f,resolve:c},t)}function i(e){return"object"==typeof e.ref&&(e=e.ref),e}var m={set:function(e,t,n){return r(e,t,n)},add:function(e,t,n){return e.splice(t,0,n)},remove:function(e,t){return e.splice(t,1)}};function o(d,l,v){return new Promise(function(e,t){var n,r,i,o,s,f,c,u,a;n=Array.isArray(d[l])?function(e){var t=e.vm,n=e.key,r=e.collection,i=e.resolve,o=e.reject,s=e.ops,f=[];s.set(t,n,f);var c=r.on("child_added",function(e,t){var n=t?b(f,t)+1:0;s.add(f,n,p(e))},o),u=r.on("child_removed",function(e){s.remove(f,b(f,e.key))},o),a=r.on("child_changed",function(e){s.set(f,b(f,e.key),p(e))},o),d=r.on("child_moved",function(e,t){var n=b(f,e.key),r=s.remove(f,n)[0],i=t?b(f,t)+1:0;s.add(f,i,r)},o);return r.once("value",i),function(){r.off("child_added",c),r.off("child_changed",a),r.off("child_removed",u),r.off("child_moved",d)}}({vm:d,key:l,collection:v,resolve:e,reject:t,ops:m}):(i=(r={vm:d,key:l,document:v,resolve:e,reject:t,ops:m}).vm,o=r.key,s=r.document,f=r.resolve,c=r.reject,u=r.ops,a=s.on("value",function(e){u.set(i,o,p(e))},c),s.once("value",f),function(){s.off("value",a)}),d._firebaseUnbinds[l]=n})}var s={set:function(e,t,n){return r(e,t,n)},add:function(e,t,n){return e.splice(t,0,n)},remove:function(e,t){return e.splice(t,1)}};function c(e,r){var i=e.vm,o=e.key,s=e.ref,f=e.ops;return void 0===r&&(r={maxRefDepth:2}),new Promise(function(e,t){var n;n=s.where?function(e,u){var o=e.vm,s=e.key,t=e.collection,a=e.ops,d=e.resolve,n=e.reject;void 0===u&&(u={maxRefDepth:2});var f,l=a.set(o,s,[]),c=d,v=[],p={added:function(e){var t=e.newIndex,n=e.doc;v.splice(t,0,Object.create(null));var r=v[t],i=h($(n)),o=i[0],s=i[1];a.add(l,t,o),y({refs:s,subs:r,target:l,path:t,depth:0,ops:a,resolve:d.bind(null,n)},u)},modified:function(e){var t=e.oldIndex,n=e.newIndex,r=e.doc,i=v.splice(t,1)[0];v.splice(n,0,i);var o=a.remove(l,t)[0],s=h($(r),o),f=s[0],c=s[1];a.add(l,n,f),y({data:f,refs:c,subs:i,ops:a,target:l,path:n,depth:0,resolve:d},u)},removed:function(e){var t=e.oldIndex;a.remove(l,t),x(v.splice(t,1)[0])}},r=t.onSnapshot(function(e){var t="function"==typeof e.docChanges?e.docChanges():e.docChanges;if(!f&&t.length){f=!0;var n=0,r=t.length,i=t.reduce(function(e,t){return e[t.doc.id]=!1,e},Object.create(null));d=function(e){e.id in i&&++n>=r&&(c(o[s]),d=function(e){})}}t.forEach(function(e){p[e.type](e)}),t.length||d()},n);return function(){r(),v.forEach(x)}}({vm:i,key:o,ops:f,collection:s,resolve:e,reject:t},r):function(e,t){var n,r,i,o=e.vm,s=e.key,f=e.document,c=e.resolve,u=e.reject,a=e.ops,d=Object.create(null);n=c,r=function(){return o[s]},c=function(){if(!i)return i=!0,n(r())};var l=f.onSnapshot(function(e){e.exists?R({snapshot:$(e),target:o,path:s,subs:d,ops:a,resolve:c},t):c()},u);return function(){l(),x(d)}}({vm:i,key:o,ops:f,document:s,resolve:e,reject:t},r),i._firestoreUnbinds[o]=n})}e.firestorePlugin=function(e){var t=e.config.optionMergeStrategies;t.firestore=t.provide,e.mixin({created:function(){var t=this,e=this.$options.firestore;this._firestoreUnbinds=Object.create(null),this.$firestoreRefs=Object.create(null);var n="function"==typeof e?e.call(this):e;n&&Object.keys(n).forEach(function(e){t.$bind(e,n[e])})},beforeDestroy:function(){for(var e in this._firestoreUnbinds)this._firestoreUnbinds[e]();this._firestoreUnbinds=null,this.$firestoreRefs=null}}),e.prototype.$bind=function(e,t,n){this._firestoreUnbinds[e]&&this.$unbind(e);var r=c({vm:this,key:e,ref:t,ops:s},n);return this.$firestoreRefs[e]=t,r},e.prototype.$unbind=function(e){this._firestoreUnbinds[e](),delete this._firestoreUnbinds[e],delete this.$firestoreRefs[e]}},e.getRef=i,e.rtdbPlugin=function(e){var t=e.config.optionMergeStrategies;t.firebase=t.provide,e.mixin({created:function(){var e;(e=this).$firebaseRefs||(e.$firebaseRefs=Object.create(null),e._firebaseSources=Object.create(null),e._firebaseUnbinds=Object.create(null));var t=this.$options.firebase;if("function"==typeof t&&(t=t.call(this)),t)for(var n in t)this.$rtdbBind(n,t[n])},beforeDestroy:function(){for(var e in this._firebaseUnbinds)this._firebaseUnbinds[e]();this._firebaseSources=null,this._firebaseUnbinds=null,this.$firebaseRefs=null}}),e.prototype.$rtdbBind=function(e,t){this._firebaseUnbinds[e]&&this.$rtdbUnbind(e);var n=o(this,e,t);return this._firebaseSources[e]=t,this.$firebaseRefs[e]=i(t),n},e.prototype.$rtdbUnbind=function(e){var t,n;n=e,(t=this)._firebaseUnbinds[n](),delete t._firebaseSources[n],delete t._firebaseUnbinds[n]}},Object.defineProperty(e,"__esModule",{value:!0})});