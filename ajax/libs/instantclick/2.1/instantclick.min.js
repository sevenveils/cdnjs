var InstantClick=function(f,u){var c,i,r,g,n,a={},s={},h=!0,o={change:[]};function m(t){var e=t.indexOf("#");return-1==e?t:t.substr(0,e)}function l(t){for(;"A"!=t.nodeName;)t=t.parentNode;return t}function p(t){for(var e=0;e<o[t].length;e++)o[t][e]()}function d(t,e){var i=f.implementation.createHTMLDocument("");i.documentElement.innerHTML=e,f.documentElement.replaceChild(i.body,f.body);var n=f.createElement("i");n.innerHTML=t,f.title=n.textContent}function y(t){L(l(t.target).href)}function b(t){var e=l(t.target);e.addEventListener("mouseout",x),n?(i=e.href,r=setTimeout(L,n)):L(e.href)}function v(t){1<t.which||t.metaKey||t.ctrlKey||(t.preventDefault(),E(l(t.target).href))}function x(){if(r)return clearTimeout(r),void(r=!1);!s.isPreloading||s.isPreloading&&s.isWaitingForCompletion||(s.xhr.abort(),s.isPreloading=!1,s.isWaitingForCompletion=!1)}function T(t){if(!(s.xhr.readyState<4)&&0!=s.xhr.status){s.timing.ready=+new Date-s.timing.start;var e=s.xhr.responseText,i=e.indexOf("<title");-1<i&&(s.title=e.substr(e.indexOf(">",i)+1),s.title=s.title.substr(0,s.title.indexOf("</title")));var n=e.indexOf("<body");if(-1<n){s.body=e.substr(n);var r=s.body.indexOf("</body");-1<r&&(s.body=s.body.substr(0,r));var o=m(s.url);a[o]={body:s.body,title:s.title,scrollY:o in a?a[o].scrollY:0}}else s.hasBody=!1;s.isWaitingForCompletion&&(s.isWaitingForCompletion=!1,E(s.url))}}function C(t){for(var e,i=f.getElementsByTagName("a"),n=u.protocol+"//"+u.host,r=i.length-1;0<=r;r--)(e=i[r]).target||e.hasAttribute("download")||0!=e.href.indexOf(n+"/")||-1<e.href.indexOf("#")&&m(e.href)==c||(h?e.hasAttribute("data-no-instant"):!e.hasAttribute("data-instant"))||(g?e.addEventListener("mousedown",y):e.addEventListener("mouseover",b),e.addEventListener("click",v));if(!t){var o,a,s,l,d=f.getElementsByTagName("script");for(r=0,j=d.length;r<j;r++)(o=d[r]).hasAttribute("data-no-instant")||(a=f.createElement("script"),o.src&&(a.src=o.src),o.innerHTML&&(a.innerHTML=o.innerHTML),s=o.parentNode,l=o.nextSibling,s.removeChild(o),s.insertBefore(a,l))}p("change")}function L(t){!g&&"display"in s.timing&&+new Date-(s.timing.start+s.timing.display)<100||(r&&(clearTimeout(r),r=!1),t||(t=i),s.isPreloading&&t==s.url||s.isPreloading&&s.isWaitingForCompletion||(s.isPreloading=!0,s.isWaitingForCompletion=!1,s.url=t,s.body=!1,s.hasBody=!0,s.timing={},s.timing.start=+new Date,s.xhr.open("GET",t),s.xhr.send()))}function E(t){if("display"in s.timing||(s.timing.display=+new Date-s.timing.start),r)return s.url&&s.url!=t?void(u.href=t):(L(t),void(s.isWaitingForCompletion=!0));if(!s.isPreloading||s.isPreloading&&s.isWaitingForCompletion)u.href=t;else if(s.hasBody)if(s.body){a[c].scrollY=pageYOffset,s.isPreloading=!1,s.isWaitingForCompletion=!1,d(s.title,s.body);var e=s.url.indexOf("#"),i=-1<e&&f.getElementById(s.url.substr(e+1)),n=0;if(s.url!=u.href&&i)for(;i.offsetParent;i=i.offsetParent)n+=i.offsetTop;scrollTo(0,n),history.pushState(null,null,s.url),c=m(u.href),C()}else s.isWaitingForCompletion=!0;else u.href=s.url}var O="pushState"in history;return{supported:O,init:function(){if(O){if(!c){for(var t=0;t<arguments.length;t++){var e=arguments[t];!0===e?h=!1:"mousedown"==e?g=!0:"number"==typeof e&&(n=e)}c=m(u.href),a[c]={body:f.body.outerHTML,title:f.title,scrollY:pageYOffset},s.xhr=new XMLHttpRequest,s.xhr.addEventListener("readystatechange",T),s.url=!1,s.body=!1,s.hasBody=!0,s.title=!1,s.isPreloading=!1,s.isWaitingForCompletion=!1,s.timing={},C(!0),addEventListener("popstate",function(){var t=m(u.href);t!=c&&(t in a?(a[c].scrollY=pageYOffset,d(a[c=t].title,a[t].body),scrollTo(0,a[t].scrollY),C()):u.href=u.href)})}}else p("change")},on:function(t,e){o[t].push(e)},debug:function(){return{currentLocationWithoutHash:c,p:s,pHistory:a,supported:O,useBlacklist:h}}}}(document,location);