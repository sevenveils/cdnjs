(function(m){function n(c,b,f){var g,p=0,e=[];f=jQuery.makeArray(f||c.querySelectorAll(b.itemSelector));var q=f.length,h=c.getBoundingClientRect();c=Math.floor(h.right-h.left)-parseFloat(m(c).css("padding-left"))-parseFloat(m(c).css("padding-right"));h=[];for(var d,k,a=0;a<q;++a)(g=f[a].getElementsByTagName("img")[0])?((d=parseInt(g.getAttribute("width")))||g.setAttribute("width",d=g.offsetWidth),(k=parseInt(g.getAttribute("height")))||g.setAttribute("height",k=g.offsetHeight),h[a]={width:d,height:k}):
(f.splice(a,1),--a,--q);q=f.length;for(d=0;d<q;++d){f[d].classList?(f[d].classList.remove(b.firstItemClass),f[d].classList.remove(b.lastRowClass)):f[d].className=f[d].className.replace(new RegExp("(^|\\b)"+b.firstItemClass+"|"+b.lastRowClass+"(\\b|$)","gi")," ");p+=h[d].width;e.push(f[d]);if(d===q-1)for(a=0;a<e.length;a++)0===a&&(e[a].className+=" "+b.lastRowClass),e[a].style.cssText="width: "+h[d+parseInt(a)-e.length+1].width+"px;height: "+h[d+parseInt(a)-e.length+1].height+"px;margin-right:"+(a<
e.length-1?b.minMargin+"px":0);if(p+b.maxMargin*(e.length-1)>c){k=p+b.maxMargin*(e.length-1)-c;a=e.length;(b.maxMargin-b.minMargin)*(a-1)<k?(g=b.minMargin,k-=(b.maxMargin-b.minMargin)*(a-1)):(g=b.maxMargin-k/(a-1),k=0);var n=0;for(a=0;a<e.length;a++){var t=e[a];var r=h[d+parseInt(a)-e.length+1].width,l=r-r/p*k;r=Math.round(h[d+parseInt(a)-e.length+1].height*(l/r));.5<=n+1-l%1?(n-=l%1,l=Math.floor(l)):(n+=1-l%1,l=Math.ceil(l));t.style.cssText="width: "+l+"px;height: "+r+"px;margin-right: "+(a<e.length-
1?g:0)+"px";0===a&&(t.className+=" "+b.firstItemClass)}e=[];p=0}}}m.fn.rowGrid=function(c){return this.each(function(){var b=m(this);if("appended"===c)c=b.data("grid-options"),b=b.children("."+c.lastRowClass),b=b.nextAll(c.itemSelector).add(b),n(this,c,b);else if(c=m.extend({},m.fn.rowGrid.defaults,c),b.data("grid-options",c),n(this,c),c.resize)m(window).on("resize.rowGrid",{container:this},function(b){n(b.data.container,c)})})};m.fn.rowGrid.defaults={minMargin:null,maxMargin:null,resize:!0,lastRowClass:"last-row",
firstItemClass:null}})(jQuery);