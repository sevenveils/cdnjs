"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _messageformatFormatters=_interopRequireDefault(require("messageformat-formatters")),_compiler=_interopRequireDefault(require("./compiler")),_utils=require("./utils"),_plurals=require("./plurals"),_runtime=_interopRequireDefault(require("./runtime"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class MessageFormat{static escape(e,t){const r=t?/[#{}]/g:/[{}]/g;return String(e).replace(r,"'$&'")}constructor(e){if(this.pluralFuncs={},"string"==typeof e)this.pluralFuncs[e]=(0,_plurals.getPlural)(e),this.defaultLocale=e;else if(Array.isArray(e))e.forEach(e=>{this.pluralFuncs[e]=(0,_plurals.getPlural)(e)}),this.defaultLocale=e[0];else{for(const t in e)if(e.hasOwnProperty(t)){if("function"!=typeof e[t])throw new Error("Expected function value for locale "+JSON.stringify(t));this.pluralFuncs[t]=e[t],this.defaultLocale||(this.defaultLocale=t)}this.defaultLocale?this.hasCustomPluralFuncs=!0:this.defaultLocale=MessageFormat.defaultLocale}this.fmt={},this.runtime=new _runtime.default(this)}addFormatters(e){for(const t in e)e.hasOwnProperty(t)&&(this.fmt[t]=e[t]);return this}disablePluralKeyChecks(){this.noPluralKeyChecks=!0;for(const e in this.pluralFuncs){const t=this.pluralFuncs[e];t&&(t.cardinal=[],t.ordinal=[])}return this}setBiDiSupport(e){return this.bidiSupport=!!e||void 0===e,this}setStrictNumberSign(e){return this.strictNumberSign=!!e||void 0===e,this.runtime.setStrictNumber(this.strictNumberSign),this}compile(e,t){let r={};if(0===Object.keys(this.pluralFuncs).length)if(t){const e=(0,_plurals.getPlural)(t,this.noPluralKeyChecks);if(!e){const e=JSON.stringify(t);throw new Error(`Locale ${e} not found!`)}r[t]=e}else t=this.defaultLocale,r=(0,_plurals.getAllPlurals)(this.noPluralKeyChecks);else if(t){const e=this.pluralFuncs[t];if(!e){const e=JSON.stringify(t),r=JSON.stringify(this.pluralFuncs);throw new Error(`Locale ${e} not found in ${r}!`)}r[t]=e}else t=this.defaultLocale,r=this.pluralFuncs;const s=new _compiler.default(this),i=s.compile(e,t,r);if("object"!=typeof e){const e=new Function("number, plural, select, fmt",(0,_utils.funcname)(t),"return "+i),s=this.runtime;return e(s.number,s.plural,s.select,this.fmt,r[t])}const l=this.runtime.toString(r,s)+"\n",n=function e(t,r){if(r||(r=0),"object"!=typeof t)return t;let s="";for(let e=0;e<r;++e)s+="  ";const i=[];for(const l in t){const n=e(t[l],r+1);i.push(`\n${s}  ${(0,_utils.propname)(l)}: ${n}`)}return`{${i.join(",")}\n${s}}`}(i),o=new Function(l+"return "+n)();if(o.hasOwnProperty("toString"))throw new Error("The top-level message key `toString` is reserved");return o.toString=function(e){return e&&"export default"!==e?e.indexOf(".")>-1?l+e+" = "+n:l+["(function (root, G) {",'  if (typeof define === "function" && define.amd) { define(G); }','  else if (typeof exports === "object") { module.exports = G; }',"  else { "+(0,_utils.propname)(e,"root")+" = G; }","})(this, "+n+");"].join("\n"):l+"export default "+n},o}}exports.default=MessageFormat,MessageFormat.defaultLocale="en",MessageFormat.formatters=_messageformatFormatters.default;