!function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],t):"object"==typeof module&&module.exports?t(require("./load-image")):t(window.loadImage)}(function(W){"use strict";var n=W.transform;W.transform=function(t,e,i,o,a){n.call(W,W.scale(t,e,a),e,i,o,a)},W.transformCoordinates=function(){},W.getTransformedOptions=function(t,e){var i,o,a,n,r=e.aspectRatio;if(!r)return e;for(o in i={},e)e.hasOwnProperty(o)&&(i[o]=e[o]);return i.crop=!0,r<(a=t.naturalWidth||t.width)/(n=t.naturalHeight||t.height)?(i.maxWidth=n*r,i.maxHeight=n):(i.maxWidth=a,i.maxHeight=a/r),i},W.renderImageToCanvas=function(t,e,i,o,a,n,r,h,d,s){return t.getContext("2d").drawImage(e,i,o,a,n,r,h,d,s),t},W.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},W.scale=function(t,e,i){e=e||{};var o,a,n,r,h,d,s,c,g,m,u,f=document.createElement("canvas"),v=t.getContext||W.hasCanvasOption(e)&&f.getContext,l=t.naturalWidth||t.width,p=t.naturalHeight||t.height,x=l,w=p;function C(){var t=Math.max((n||x)/x,(r||w)/w);1<t&&(x*=t,w*=t)}function H(){var t=Math.min((o||x)/x,(a||w)/w);t<1&&(x*=t,w*=t)}if(v&&(s=(e=W.getTransformedOptions(t,e,i)).left||0,c=e.top||0,e.sourceWidth?(h=e.sourceWidth,void 0!==e.right&&void 0===e.left&&(s=l-h-e.right)):h=l-s-(e.right||0),e.sourceHeight?(d=e.sourceHeight,void 0!==e.bottom&&void 0===e.top&&(c=p-d-e.bottom)):d=p-c-(e.bottom||0),x=h,w=d),o=e.maxWidth,a=e.maxHeight,n=e.minWidth,r=e.minHeight,v&&o&&a&&e.crop?(u=h/d-(x=o)/(w=a))<0?(d=a*h/o,void 0===e.top&&void 0===e.bottom&&(c=(p-d)/2)):0<u&&(h=o*d/a,void 0===e.left&&void 0===e.right&&(s=(l-h)/2)):((e.contain||e.cover)&&(n=o=o||n,r=a=a||r),e.cover?(H(),C()):(C(),H())),v){if(1<(g=e.pixelRatio)&&(f.style.width=x+"px",f.style.height=w+"px",x*=g,w*=g,f.getContext("2d").scale(g,g)),0<(m=e.downsamplingRatio)&&m<1&&x<h&&w<d)for(;x<h*m;)f.width=h*m,f.height=d*m,W.renderImageToCanvas(f,t,s,c,h,d,0,0,f.width,f.height),c=s=0,h=f.width,d=f.height,(t=document.createElement("canvas")).width=h,t.height=d,W.renderImageToCanvas(t,f,0,0,h,d,0,0,h,d);return f.width=x,f.height=w,W.transformCoordinates(f,e),W.renderImageToCanvas(f,t,s,c,h,d,0,0,x,w)}return t.width=x,t.height=w,t}});