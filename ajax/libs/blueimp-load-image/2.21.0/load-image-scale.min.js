!function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],t):"object"==typeof module&&module.exports?t(require("./load-image")):t(window.loadImage)}(function(H){"use strict";var a=H.transform;H.transform=function(t,e,i,o,n){a.call(H,H.scale(t,e,n),e,i,o,n)},H.transformCoordinates=function(){},H.getTransformedOptions=function(t,e){var i,o,n,a,r=e.aspectRatio;if(!r)return e;for(o in i={},e)e.hasOwnProperty(o)&&(i[o]=e[o]);return i.crop=!0,n=t.naturalWidth||t.width,a=t.naturalHeight||t.height,i.maxHeight=r<n/a?(i.maxWidth=a*r,a):(i.maxWidth=n)/r,i},H.renderImageToCanvas=function(t,e,i,o,n,a,r,h,d,s){return t.getContext("2d").drawImage(e,i,o,n,a,r,h,d,s),t},H.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},H.scale=function(t,e,i){e=e||{};var o,n,a,r,h,d,s,c,g,m,u,f=document.createElement("canvas"),v=t.getContext||H.hasCanvasOption(e)&&f.getContext,l=t.naturalWidth||t.width,p=t.naturalHeight||t.height,w=l,x=p;function C(){var t=Math.max((a||w)/w,(r||x)/x);1<t&&(w*=t,x*=t)}function W(){var t=Math.min((o||w)/w,(n||x)/x);t<1&&(w*=t,x*=t)}if(v&&(s=(e=H.getTransformedOptions(t,e,i)).left||0,c=e.top||0,e.sourceWidth?(h=e.sourceWidth,void 0!==e.right&&void 0===e.left&&(s=l-h-e.right)):h=l-s-(e.right||0),e.sourceHeight?(d=e.sourceHeight,void 0!==e.bottom&&void 0===e.top&&(c=p-d-e.bottom)):d=p-c-(e.bottom||0),w=h,x=d),o=e.maxWidth,n=e.maxHeight,a=e.minWidth,r=e.minHeight,v&&o&&n&&e.crop?(u=h/d-(w=o)/(x=n))<0?(d=n*h/o,void 0===e.top&&void 0===e.bottom&&(c=(p-d)/2)):0<u&&(h=o*d/n,void 0===e.left&&void 0===e.right&&(s=(l-h)/2)):((e.contain||e.cover)&&(a=o=o||a,r=n=n||r),e.cover?(W(),C()):(C(),W())),v){if(1<(g=e.pixelRatio)&&(f.style.width=w+"px",f.style.height=x+"px",w*=g,x*=g,f.getContext("2d").scale(g,g)),0<(m=e.downsamplingRatio)&&m<1&&w<h&&x<d)for(;w<h*m;)f.width=h*m,f.height=d*m,H.renderImageToCanvas(f,t,s,c,h,d,0,0,f.width,f.height),c=s=0,h=f.width,d=f.height,(t=document.createElement("canvas")).width=h,t.height=d,H.renderImageToCanvas(t,f,0,0,h,d,0,0,h,d);return f.width=w,f.height=x,H.transformCoordinates(f,e),H.renderImageToCanvas(f,t,s,c,h,d,0,0,w,x)}return t.width=w,t.height=x,t}});