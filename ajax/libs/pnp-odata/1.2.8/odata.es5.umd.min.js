/**
 * @license
 * v1.2.8
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2019 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https://github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pnp/common"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","@pnp/common","@pnp/logging"],t):t((e.pnp=e.pnp||{},e.pnp.odata={}),e.pnp.common,e.pnp.logging)}(this,function(e,u,s){"use strict";var o=function(){function e(e){this.key=e,this.expiration=u.dateAdd(new Date,"second",u.RuntimeConfig.defaultCachingTimeoutSeconds),this.storeName=u.RuntimeConfig.defaultCachingStore}return Object.defineProperty(e.prototype,"store",{get:function(){return"local"===this.storeName?e.storage.local:e.storage.session},enumerable:!0,configurable:!0}),e.storage=new u.PnPClientStorage,e}(),i=function(){function e(e,t){this.parser=e,this.cacheOptions=t}return e.prototype.parse=function(e){var t=this;return this.parser.parse(e).then(function(e){return t.cacheData(e)})},e.prototype.cacheData=function(e){return null!==this.cacheOptions.store&&this.cacheOptions.store.put(this.cacheOptions.key,e,this.cacheOptions.expiration),e},e}(),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function t(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(u=(i<3?o(u):3<i?o(t,n,u):o(t,n))||u);return 3<i&&u&&Object.defineProperty(t,n,u),u}var n=function(i){function n(e,t,n,r){void 0===n&&(n=t.status),void 0===r&&(r=t.statusText);var o=i.call(this,e)||this;return o.response=t,o.status=n,o.statusText=r,o.isHttpRequestError=!0,o}return c(n,i),n.init=function(t){return t.clone().text().then(function(e){return new n("Error making HttpClient request in queryable ["+t.status+"] "+t.statusText+" ::> "+e,t.clone())})},n}(Error),a=function(){function e(){}return e.prototype.parse=function(n){var r=this;return new Promise(function(e,t){r.handleError(n,t)&&r.parseImpl(n,e,t)})},e.prototype.parseImpl=function(e,t,n){var r=this;e.headers.has("Content-Length")&&0===parseFloat(e.headers.get("Content-Length"))||204===e.status?t({}):e.text().then(function(e){return 0<e.replace(/\s/gi,"").length?JSON.parse(e):{}}).then(function(e){return t(r.parseODataJSON(e))}).catch(function(e){return n(e)})},e.prototype.handleError=function(e,t){return e.ok||n.init(e).then(t),e.ok},e.prototype.parseODataJSON=function(e){var t=e;return u.hOP(e,"d")?t=u.hOP(e.d,"results")?e.d.results:e.d:u.hOP(e,"value")&&(t=e.value),t},e}(),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(a),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.parseImpl=function(e,t){e.text().then(t)},t}(a),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.parseImpl=function(e,t){e.blob().then(t)},t}(a),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.parseImpl=function(e,t){e.json().then(t)},t}(a),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.parseImpl=function(e,t){u.isFunc(e.arrayBuffer)?e.arrayBuffer().then(t):e.buffer().then(t)},t}(a),d=function(n){function e(e){var t=n.call(this)||this;return t.parser=e,t}return c(e,n),e.prototype.parseImpl=function(e,t){this.parser(e).then(t)},e}(a);function y(t,n){return new Promise(function(e){t.result=n,t.hasResult=!0,e(t)})}function v(e){return 0<e.pipeline.length?e.pipeline.shift()(e):Promise.resolve(e)}function m(e){e.pipeline.length<1&&s.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Request pipeline contains no methods!",2);var t=v(e).then(function(e){return t=e,s.Logger.log({data:0===s.Logger.activeLogLevel?t.result:{},level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Returning result from pipeline. Set logging to verbose to see data."}),Promise.resolve(t.result);var t}).catch(function(e){throw s.Logger.error(e),e});return e.isBatched&&e.batch.addResolveBatchDependency(t),t}function b(i){return void 0===i&&(i=!1),function(n,r,e){var o=e.value;e.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!i&&0<e.length&&u.hOP(e[0],"hasResult")&&e[0].hasResult?(s.Logger.write("["+e[0].requestId+"] ("+(new Date).getTime()+") Skipping request pipeline method "+r+", existing result in pipeline.",0),Promise.resolve(e[0])):(s.Logger.write("["+e[0].requestId+"] ("+(new Date).getTime()+") Calling request pipeline method "+r+".",0),o.apply(n,e).then(function(e){return v(e)}))}}}var _=function(){function e(){}return e.logStart=function(t){return new Promise(function(e){s.Logger.log({data:1===s.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Beginning "+t.verb+" request ("+t.requestAbsoluteUrl+")"}),e(t)})},e.caching=function(r){return new Promise(function(t){if(r.isCached){s.Logger.write("["+r.requestId+"] ("+(new Date).getTime()+") Caching is enabled for request, checking cache...",1);var e=new o(r.requestAbsoluteUrl.toLowerCase());if(void 0!==r.cachingOptions&&(e=u.extend(e,r.cachingOptions)),null!==e.store){var n=e.store.get(e.key);if(null!==n)return s.Logger.log({data:1===s.Logger.activeLogLevel?{}:n,level:1,message:"["+r.requestId+"] ("+(new Date).getTime()+") Value returned from cache."}),u.isFunc(r.batchDependency)&&r.batchDependency(),u.hOP(r.parser,"hydrate")&&(n=r.parser.hydrate(n)),y(r,n).then(function(e){return t(e)})}s.Logger.write("["+r.requestId+"] ("+(new Date).getTime()+") Value not found in cache.",1),r.parser=new i(r.parser,e)}return t(r)})},e.send=function(i){return new Promise(function(t,n){if(i.isBatched){var e=i.batch.add(i.requestAbsoluteUrl,i.verb,i.options,i.parser,i.requestId);u.isFunc(i.batchDependency)&&i.batchDependency(),s.Logger.write("["+i.requestId+"] ("+(new Date).getTime()+") Batching request in batch "+i.batch.batchId+".",1),t(y(i,e))}else{s.Logger.write("["+i.requestId+"] ("+(new Date).getTime()+") Sending request.",1);var r=i.clientFactory(),o=u.extend(i.options||{},{method:i.verb});r.fetch(i.requestAbsoluteUrl,o).then(function(e){return i.parser.parse(e)}).then(function(e){return y(i,e)}).then(function(e){return t(e)}).catch(function(e){return n(e)})}})},e.logEnd=function(t){return new Promise(function(e){t.isBatched?s.Logger.log({data:1===s.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") "+t.verb+" request will complete in batch "+t.batch.batchId+"."}):s.Logger.log({data:1===s.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Completing "+t.verb+" request."}),e(t)})},t([b(!0)],e,"logStart",null),t([b()],e,"caching",null),t([b()],e,"send",null),t([b(!0)],e,"logEnd",null),e}();function P(){return[_.logStart,_.caching,_.send,_.logEnd].slice(0)}var q=function(){function e(){this._query=new Map,this._options={},this._url="",this._parentUrl="",this._useCaching=!1,this._cachingOptions=null,this._cloneParentWasCaching=!1,this._cloneParentCacheOptions=null,this._requestPipeline=null}return e.prototype.toUrl=function(){return this._url},e.prototype.concat=function(e){return this._url+=e,this},Object.defineProperty(e.prototype,"query",{get:function(){return this._query},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return u.mergeOptions(this._options,e),this},e.prototype.configureFrom=function(e){return u.mergeOptions(this._options,e._options),this},e.prototype.usingCaching=function(e){return u.RuntimeConfig.globalCacheDisable||(this._useCaching=!0,void 0!==e&&(this._cachingOptions=e)),this},e.prototype.withPipeline=function(e){return this._requestPipeline=e.slice(0),this},e.prototype.getCore=function(e,t){return void 0===e&&(e=new f),void 0===t&&(t={}),this._cloneParentWasCaching&&this.usingCaching(this._cloneParentCacheOptions),this.reqImpl("GET",t,e)},e.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new f),this.reqImpl("POST",e,t)},e.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new f),this.reqImpl("PATCH",e,t)},e.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new f),this.reqImpl("DELETE",e,t)},e.prototype.putCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new f),this.reqImpl("PUT",e,t)},e.prototype.reqImpl=function(t,n,r){var o=this;return void 0===n&&(n={}),this.getRequestPipeline(t,n,r).then(function(e){return o.toRequestContext(t,n,r,e)}).then(function(e){return m(e)})},e.prototype.append=function(e){this._url=u.combine(this._url,e)},Object.defineProperty(e.prototype,"parentUrl",{get:function(){return this._parentUrl},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this._parentUrl=e._url,this._url=u.combine(this._parentUrl,t||""),this.configureFrom(e)},e.prototype._clone=function(e,t){return e.configureFrom(this),this._useCaching&&(e._cloneParentWasCaching=!0,e._cloneParentCacheOptions=this._cachingOptions),e},e.prototype.getRequestPipeline=function(e,t,n){var r=this;return void 0===t&&(t={}),new Promise(function(e){u.objectDefinedNotNull(r._requestPipeline)&&u.isArray(r._requestPipeline)?e(r._requestPipeline):e(P())})},e}(),w=function(n){function e(){var e=n.call(this)||this;return e._batch=null,e._batchDependency=null,e}return c(e,n),e.prototype.inBatch=function(e){if(null!==this.batch)throw Error("This query is already part of a batch.");return u.objectDefinedNotNull(e)&&(this._batch=e,this._batchDependency=e.addDependency()),this},e.prototype.toUrl=function(){return this._url},e.prototype.get=function(e,t){return void 0===e&&(e=new p),void 0===t&&(t={}),this.getCore(e,t)},e.prototype.getCore=function(e,t){return void 0===e&&(e=new p),void 0===t&&(t={}),n.prototype.getCore.call(this,e,t)},e.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new p),n.prototype.postCore.call(this,e,t)},e.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new p),n.prototype.patchCore.call(this,e,t)},e.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new p),n.prototype.deleteCore.call(this,e,t)},e.prototype.putCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new p),n.prototype.putCore.call(this,e,t)},e.prototype.addBatchDependency=function(){return null!==this._batch?this._batch.addDependency():function(){return null}},Object.defineProperty(e.prototype,"hasBatch",{get:function(){return u.objectDefinedNotNull(this._batch)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batch",{get:function(){return this.hasBatch?this._batch:null},enumerable:!0,configurable:!0}),e.prototype._clone=function(e,t){return e=n.prototype._clone.call(this,e,t),t.includeBatch&&(e=e.inBatch(this._batch)),e},e}(q),C=function(){function e(e){void 0===e&&(e=u.getGUID()),this._batchId=e,this._reqs=[],this._deps=[],this._rDeps=[]}return Object.defineProperty(e.prototype,"batchId",{get:function(){return this._batchId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requests",{get:function(){return this._reqs},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t,n,r,o){var i={id:o,method:t.toUpperCase(),options:n,parser:r,reject:null,resolve:null,url:e},u=new Promise(function(e,t){i.resolve=e,i.reject=t});return this._reqs.push(i),u},e.prototype.addDependency=function(){var t=function(){};return this._deps.push(new Promise(function(e){t=e})),t},e.prototype.addResolveBatchDependency=function(e){this._rDeps.push(e)},e.prototype.execute=function(){var e=this;return Promise.all(this._deps).then(function(){return e.executeImpl()}).then(function(){return Promise.all(e._rDeps)}).then(function(){})},e}();e.CachingOptions=o,e.CachingParserWrapper=i,e.HttpRequestError=n,e.ODataParserBase=a,e.ODataDefaultParser=p,e.TextParser=l,e.BlobParser=h,e.JSONParser=f,e.BufferParser=g,e.LambdaParser=d,e.setResult=y,e.pipe=m,e.requestPipelineMethod=b,e.PipelineMethods=_,e.getDefaultPipeline=P,e.Queryable=q,e.ODataQueryable=w,e.ODataBatch=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=odata.es5.umd.min.js.map
