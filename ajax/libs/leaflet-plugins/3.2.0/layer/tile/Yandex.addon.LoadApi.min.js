L.Yandex.include({_initLoader:function(i){if(!this._loader){var r=(i=i||this.options).apiLoader;if(r)r.then&&(r={loading:r});else{var a=this._makeUrl(i);r=a&&this._loadScript.bind(this,a)}r&&(L.Yandex.prototype._loader=r)}},loadApi:function(i){if("undefined"!=typeof ymaps)return this;this._initLoader(i);var r=this._loader;if(!r)throw new Error("api params expected in options");return r.loading||(r.loading=r()),this},_initApi:function(i){var r=this._loader;if("undefined"!=typeof ymaps)return ymaps.ready(this._initMapObject,this);if(i||!r)throw new Error("API is not available");var a=r.loading;a||(a=r(),r.loading=a),a.then(this._initApi.bind(this,"afterload"))},_apiDefaults:{url:"https://api-maps.yandex.ru/{version}/",version:"2.1",params:{lang:"ru_RU",onerror:"console.error"}},_makeUrl:function(i){var r=i.apiUrl,a=i.apiParams,e=this._apiDefaults;return!(!r&&!a)&&(a&&("string"==typeof a&&(a={apikey:a}),a=L.extend({},e.params,a),r=(r||e.url)+L.Util.getParamString(a,r)),L.Util.template(r,{version:i.apiVersion||e.version}))},_loadScript:function(e){return new Promise(function(i,r){var a=document.createElement("script");a.onload=i,a.onerror=function(){r("API loading failed")},a.src=e,document.body.appendChild(a)})}}),L.Yandex.addInitHook(L.Yandex.prototype._initLoader);