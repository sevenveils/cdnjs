L.Yandex=L.Layer.extend({options:{type:"yandex#map",mapOptions:{balloonAutoPan:!1,suppressMapOpenBlock:!0},overlayOpacity:.8,minZoom:0,maxZoom:19},initialize:function(t,e){"object"==typeof t&&(e=t,t=!1),e=L.Util.setOptions(this,e),t&&(e.type=t),this._isOverlay=-1!==e.type.indexOf("overlay")||-1!==e.type.indexOf("skeleton")},_setStyle:function(t,e){for(var n in e)t.style[n]=e[n]},_initContainer:function(t){var e=this._isOverlay?"leaflet-overlay-pane":"leaflet-tile-pane",n=L.DomUtil.create("div","leaflet-yandex-container leaflet-pane "+e),i=this.options.opacity||this._isOverlay&&this.options.overlayOpacity;i&&L.DomUtil.setOpacity(n,i);var a={width:"100%",height:"100%"};return this._setStyle(t,a),this._setStyle(n,a),n},onAdd:function(t){var e=t.getPane("mapPane");this._container||(this._container=this._initContainer(e),t.once("unload",this._destroy,this),this._initApi()),e.appendChild(this._container),this._yandex&&(this._setEvents(t),this._update())},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){t._removeZoomLimit(this)},_destroy:function(t){this._map&&this._map!==t.target||(this._yandex&&(this._yandex.destroy(),delete this._yandex),delete this._container)},_setEvents:function(t){var e={move:this._update};this._zoomAnimated&&(e.zoomanim=this._animateZoom),t.on(e,this),this.once("remove",function(){t.off(e,this),this._container.remove()},this)},_update:function(){var t=this._map,e=t.getCenter();this._yandex.setCenter([e.lat,e.lng],t.getZoom());var n=L.point(0,0).subtract(L.DomUtil.getPosition(t.getPane("mapPane")));L.DomUtil.setPosition(this._container,n)},_resyncView:function(){if(this._map){var t=this._yandex;this._map.setView(t.getCenter(),t.getZoom(),{animate:!1})}},_animateZoom:function(t){var e=this._map,n=e.getSize()._divideBy(2),i=e.project(t.center,t.zoom)._subtract(n)._round(),a=e.project(e.getBounds().getNorthWest(),t.zoom)._subtract(i),o=e.getZoomScale(t.zoom);this._yandex.panes._array.forEach(function(t){if(t.pane instanceof ymaps.pane.MovablePane){var e=t.pane.getElement();L.DomUtil.addClass(e,"leaflet-zoom-animated"),L.DomUtil.setTransform(e,a,o)}})},_initApi:function(){ymaps.ready(this._initMapObject,this)},_mapType:function(){var t=this.options.type;return t&&-1===t.indexOf("#")?"yandex#"+t:t},_initMapObject:function(){ymaps.mapType.storage.add("yandex#overlay",new ymaps.MapType("overlay",[])),ymaps.mapType.storage.add("yandex#skeleton",new ymaps.MapType("skeleton",["yandex#skeleton"])),ymaps.mapType.storage.add("yandex#map~vector",new ymaps.MapType("map~vector",["yandex#map~vector"]));var t=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[],controls:[],type:this._mapType()},this.options.mapOptions);this._isOverlay&&(t.container.getElement().style.background="transparent"),this._container.remove(),this._yandex=t,this._map&&this.onAdd(this._map),this.fire("load")}}),L.yandex=function(t,e){return new L.Yandex(t,e)};