(function(f){"use strict";var i,o=".",n="function",r="string",s="__global__",h="Provider",a=0,c=Array.prototype.slice,e=function(t,e){var r=t[e];if(r===f&&i.config.strict)throw new Error("Bottle was unable to resolve a service.  `"+e+"` is undefined.");return r},l=function(t){var e;return this.nested[t]||(e=i.pop(),this.nested[t]=e,this.factory(t,function(){return e.container})),this.nested[t]},u=function(t){return t.split(o).reduce(e,this)},p=function(t,e){return e(t)},v=function(t,e){return(t[e]||[]).concat(t.__global__||[])},d=function(a,e){var c,t,l,u,d;return this.id,l=this.container,u=this.decorators,d=this.middlewares,c=a+h,(t=Object.create(null))[c]={configurable:!0,enumerable:!0,get:function(){var t=new e;return delete l[c],l[c]=t}},t[a]={configurable:!0,enumerable:!0,get:function(){var t,i,e,n,r,o,s=l[c];return s&&(t=v(u,a).reduce(p,s.$get(l)),delete l[c],delete l[a]),t===f?t:(i=v(d,a),e=a,n=t,r=l,o={configurable:!0,enumerable:!0},i.length?o.get=function(){var e=0,r=function(t){if(t)throw t;i[e]&&i[e++](n,r)};return r(),n}:(o.value=n,o.writable=!0),Object.defineProperty(r,e,o),r[e])}},Object.defineProperties(l,t),this},b=function(t,e){var r,i;return r=t.split(o),this.providerMap[t]&&1===r.length&&!this.container[t+h]?console.error(t+" provider already instantiated."):(this.originalProviders[t]=e,this.providerMap[t]=!0,i=r.shift(),r.length?(l.call(this,i).provider(r.join(o),e),this):d.call(this,i,e))},g=function(t,e){return b.call(this,t,function(){this.$get=e})},y=function(t,r,i){var n=3<arguments.length?c.call(arguments,3):[],o=this;return g.call(this,t,function(){var t=r,e=n.map(u,o.container);return i?new(r.bind.apply(r,[null].concat(e))):t.apply(null,e)})},w=function(t,e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})},m=function(t,e){var r=t[e];return r||w.call(t,e,r={}),r},j=function(t,e){var r,i;return typeof t===n&&(e=t,t=s),i=(r=t.split(o)).shift(),r.length?l.call(this,i).decorator(r.join(o),e):(this.decorators[i]||(this.decorators[i]=[]),this.decorators[i].push(e)),this},$=function(t){return!/^\$(?:decorator|register|list)$|Provider$/.test(t)},P=function(t){return Object.keys(t||this.container||{}).filter($)},O={},_=function(t){var e=t.$value===f?t:t.$value;return this[t.$type||"service"].apply(this,[t.$name,e].concat(t.$inject||[]))},x=function(t){delete this.providerMap[t],delete this.container[t],delete this.container[t+h]};(i=function t(e){if(!(this instanceof t))return t.pop(e);this.id=a++,this.decorators={},this.middlewares={},this.nested={},this.providerMap={},this.originalProviders={},this.deferred=[],this.container={$decorator:j.bind(this),$register:_.bind(this),$list:P.bind(this)}}).prototype={constant:function(t,e){var r=t.split(o);return t=r.pop(),function(t,e){Object.defineProperty(this,t,{configurable:!1,enumerable:!0,value:e,writable:!1})}.call(r.reduce(m,this.container),t,e),this},decorator:j,defer:function(t){return this.deferred.push(t),this},digest:function(t){return(t||[]).map(u,this.container)},factory:g,instanceFactory:function(t,e){return g.call(this,t,function(t){return{instance:e.bind(e,t)}})},list:P,middleware:function(t,e){var r,i;return typeof t===n&&(e=t,t=s),i=(r=t.split(o)).shift(),r.length?l.call(this,i).middleware(r.join(o),e):(this.middlewares[i]||(this.middlewares[i]=[]),this.middlewares[i].push(e)),this},provider:b,resetProviders:function(r){var i=this.originalProviders,n=Array.isArray(r);Object.keys(this.originalProviders).forEach(function(t){if(!n||-1!==r.indexOf(t)){var e=t.split(o);1<e.length&&e.forEach(x,l.call(this,e[0])),x.call(this,t),this.provider(t,i[t])}},this)},register:_,resolve:function(e){return this.deferred.forEach(function(t){t(e)}),this},service:function(t,e){return y.apply(this,[t,e,!0].concat(c.call(arguments,2)))},serviceFactory:function(t,e){return y.apply(this,[t,e,!1].concat(c.call(arguments,2)))},value:function(t,e){var r;return t=(r=t.split(o)).pop(),w.call(r.reduce(m,this.container),t,e),this}},i.pop=function(t){var e;return typeof t===r?((e=O[t])||(O[t]=e=new i,e.constant("BOTTLE_NAME",t)),e):new i},i.clear=function(t){typeof t===r?delete O[t]:O={}},i.list=P,i.config={strict:!1};var t,B,E,M,A,T={function:!0,object:!0};t=T[typeof window]&&window||this,B=T[typeof exports]&&exports&&!exports.nodeType&&exports,E=T[typeof module]&&module&&!module.nodeType&&module,M=E&&E.exports===B&&B,!(A=T[typeof global]&&global)||A.global!==A&&A.window!==A||(t=A),typeof define===n&&"object"==typeof define.amd&&define.amd?(t.Bottle=i,define(function(){return i})):B&&E?M?(E.exports=i).Bottle=i:B.Bottle=i:t.Bottle=i}).call(this);