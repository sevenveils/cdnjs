{"version":3,"sources":["dist/hyperapp.js"],"names":["global","factory","exports","module","define","amd","self","hyperapp","this","EMPTY_OBJ","EMPTY_ARR","map","isArray","Array","defer","requestAnimationFrame","setTimeout","createClass","obj","out","length","tmp","k","i","merge","a","b","batch","list","reduce","item","concat","isSameAction","shouldRestart","patchProperty","node","key","oldValue","newValue","listener","isSvg","setProperty","actions","slice","addEventListener","passive","removeEventListener","removeAttribute","setAttribute","createNode","vnode","type","document","createTextNode","name","createElementNS","createElement","props","len","children","appendChild","getVNode","getKey","patch","parent","oldVNode","newVNode","nodeValue","insertBefore","removeChild","tmpVKid","oldVKid","oldKey","newKey","oldVProps","newVProps","oldVKids","newVKids","oldHead","newHead","oldTail","newTail","keyed","newKeyed","propsChanged","lazy","view","createVNode","createTextVNode","value","recycleNode","nodeType","nodeName","toLowerCase","call","childNodes","Lazy","h","rest","arguments","push","pop","app","enhance","state","lock","vdom","subscriptions","subs","event","action","preventDefault","stopPropagation","dispatch","setState","newState","render","fx","oldSubs","newSubs","oldSub","newSub","patchSubs","parentNode","init"],"mappings":"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","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.hyperapp = {}));\n}(this, function (exports) { 'use strict';\n\n  var RECYCLED_NODE = 1;\n  var LAZY_NODE = 2;\n  var TEXT_NODE = 3;\n  var EMPTY_OBJ = {};\n  var EMPTY_ARR = [];\n\n  var map = EMPTY_ARR.map;\n  var isArray = Array.isArray;\n  var defer = requestAnimationFrame || setTimeout;\n\n  var createClass = function(obj) {\n    var out = \"\";\n\n    if (typeof obj === \"string\") return obj\n\n    if (isArray(obj) && obj.length > 0) {\n      for (var k = 0, tmp; k < obj.length; k++) {\n        if ((tmp = createClass(obj[k])) !== \"\") {\n          out += (out && \" \") + tmp;\n        }\n      }\n    } else {\n      for (var k in obj) {\n        if (obj[k]) {\n          out += (out && \" \") + i;\n        }\n      }\n    }\n\n    return out\n  };\n\n  var merge = function(a, b) {\n    var out = {};\n\n    for (var k in a) out[k] = a[k];\n    for (var k in b) out[k] = b[k];\n\n    return out\n  };\n\n  var batch = function(list) {\n    return list.reduce(function(out, item) {\n      return out.concat(\n        !item || item === true\n          ? false\n          : typeof item[0] === \"function\"\n          ? [item]\n          : batch(item)\n      )\n    }, EMPTY_ARR)\n  };\n\n  var isSameAction = function(a, b) {\n    return isArray(a) && isArray(b) && a[0] === b[0] && typeof a[0] === \"function\"\n  };\n\n  var shouldRestart = function(a, b) {\n    for (var k in merge(a, b)) {\n      if (a[k] !== b[k] && !isSameAction(a[k], b[k])) return true\n      b[k] = a[k];\n    }\n  };\n\n  var patchSubs = function(oldSubs, newSubs, dispatch) {\n    for (\n      var i = 0, oldSub, newSub, subs = [];\n      i < oldSubs.length || i < newSubs.length;\n      i++\n    ) {\n      oldSub = oldSubs[i];\n      newSub = newSubs[i];\n      subs.push(\n        newSub\n          ? !oldSub ||\n            newSub[0] !== oldSub[0] ||\n            shouldRestart(newSub[1], oldSub[1])\n            ? [\n                newSub[0],\n                newSub[1],\n                newSub[0](newSub[1], dispatch),\n                oldSub && oldSub[2]()\n              ]\n            : oldSub\n          : oldSub && oldSub[2]()\n      );\n    }\n    return subs\n  };\n\n  var patchProperty = function(node, key, oldValue, newValue, listener, isSvg) {\n    if (key === \"key\") ; else if (key === \"style\") {\n      for (var k in merge(oldValue, newValue)) {\n        oldValue = newValue == null || newValue[k] == null ? \"\" : newValue[k];\n        if (k[0] === \"-\") {\n          node[key].setProperty(k, oldValue);\n        } else {\n          node[key][k] = oldValue;\n        }\n      }\n    } else if (key[0] === \"o\" && key[1] === \"n\") {\n      if (\n        !((node.actions || (node.actions = {}))[(key = key.slice(2))] = newValue)\n      ) {\n        node.removeEventListener(key, listener);\n      } else if (!oldValue) {\n        node.addEventListener(key, listener, newValue.passive ? newValue : false);\n      }\n    } else if (!isSvg && key !== \"list\" && key in node) {\n      node[key] = newValue == null ? \"\" : newValue;\n    } else if (\n      newValue == null ||\n      newValue === false ||\n      (key === \"class\" && !(newValue = createClass(newValue)))\n    ) {\n      node.removeAttribute(key);\n    } else {\n      node.setAttribute(key, newValue);\n    }\n  };\n\n  var createNode = function(vnode, listener, isSvg) {\n    var node =\n      vnode.type === TEXT_NODE\n        ? document.createTextNode(vnode.name)\n        : (isSvg = isSvg || vnode.name === \"svg\")\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", vnode.name)\n        : document.createElement(vnode.name);\n    var props = vnode.props;\n\n    for (var k in props) {\n      patchProperty(node, k, null, props[k], listener, isSvg);\n    }\n\n    for (var i = 0, len = vnode.children.length; i < len; i++) {\n      node.appendChild(\n        createNode(\n          (vnode.children[i] = getVNode(vnode.children[i])),\n          listener,\n          isSvg\n        )\n      );\n    }\n\n    return (vnode.node = node)\n  };\n\n  var getKey = function(vnode) {\n    return vnode == null ? null : vnode.key\n  };\n\n  var patch = function(parent, node, oldVNode, newVNode, listener, isSvg) {\n    if (oldVNode === newVNode) ; else if (\n      oldVNode != null &&\n      oldVNode.type === TEXT_NODE &&\n      newVNode.type === TEXT_NODE\n    ) {\n      if (oldVNode.name !== newVNode.name) node.nodeValue = newVNode.name;\n    } else if (oldVNode == null || oldVNode.name !== newVNode.name) {\n      node = parent.insertBefore(\n        createNode((newVNode = getVNode(newVNode)), listener, isSvg),\n        node\n      );\n      if (oldVNode != null) parent.removeChild(oldVNode.node);\n    } else {\n      var tmpVKid;\n      var oldVKid;\n\n      var oldKey;\n      var newKey;\n\n      var oldVProps = oldVNode.props;\n      var newVProps = newVNode.props;\n\n      var oldVKids = oldVNode.children;\n      var newVKids = newVNode.children;\n\n      var oldHead = 0;\n      var newHead = 0;\n      var oldTail = oldVKids.length - 1;\n      var newTail = newVKids.length - 1;\n\n      isSvg = isSvg || newVNode.name === \"svg\";\n\n      for (var i in merge(oldVProps, newVProps)) {\n        if (\n          (i === \"value\" || i === \"selected\" || i === \"checked\"\n            ? node[i]\n            : oldVProps[i]) !== newVProps[i]\n        ) {\n          patchProperty(node, i, oldVProps[i], newVProps[i], listener, isSvg);\n        }\n      }\n\n      while (newHead <= newTail && oldHead <= oldTail) {\n        if (\n          (oldKey = getKey(oldVKids[oldHead])) == null ||\n          oldKey !== getKey(newVKids[newHead])\n        ) {\n          break\n        }\n\n        patch(\n          node,\n          oldVKids[oldHead].node,\n          oldVKids[oldHead],\n          (newVKids[newHead] = getVNode(\n            newVKids[newHead++],\n            oldVKids[oldHead++]\n          )),\n          listener,\n          isSvg\n        );\n      }\n\n      while (newHead <= newTail && oldHead <= oldTail) {\n        if (\n          (oldKey = getKey(oldVKids[oldTail])) == null ||\n          oldKey !== getKey(newVKids[newTail])\n        ) {\n          break\n        }\n\n        patch(\n          node,\n          oldVKids[oldTail].node,\n          oldVKids[oldTail],\n          (newVKids[newTail] = getVNode(\n            newVKids[newTail--],\n            oldVKids[oldTail--]\n          )),\n          listener,\n          isSvg\n        );\n      }\n\n      if (oldHead > oldTail) {\n        while (newHead <= newTail) {\n          node.insertBefore(\n            createNode(\n              (newVKids[newHead] = getVNode(newVKids[newHead++])),\n              listener,\n              isSvg\n            ),\n            (oldVKid = oldVKids[oldHead]) && oldVKid.node\n          );\n        }\n      } else if (newHead > newTail) {\n        while (oldHead <= oldTail) {\n          node.removeChild(oldVKids[oldHead++].node);\n        }\n      } else {\n        for (var i = oldHead, keyed = {}, newKeyed = {}; i <= oldTail; i++) {\n          if ((oldKey = oldVKids[i].key) != null) {\n            keyed[oldKey] = oldVKids[i];\n          }\n        }\n\n        while (newHead <= newTail) {\n          oldKey = getKey((oldVKid = oldVKids[oldHead]));\n          newKey = getKey(\n            (newVKids[newHead] = getVNode(newVKids[newHead], oldVKid))\n          );\n\n          if (\n            newKeyed[oldKey] ||\n            (newKey != null && newKey === getKey(oldVKids[oldHead + 1]))\n          ) {\n            if (oldKey == null) {\n              node.removeChild(oldVKid.node);\n            }\n            oldHead++;\n            continue\n          }\n\n          if (newKey == null || oldVNode.type === RECYCLED_NODE) {\n            if (oldKey == null) {\n              patch(\n                node,\n                oldVKid && oldVKid.node,\n                oldVKid,\n                newVKids[newHead],\n                listener,\n                isSvg\n              );\n              newHead++;\n            }\n            oldHead++;\n          } else {\n            if (oldKey === newKey) {\n              patch(\n                node,\n                oldVKid.node,\n                oldVKid,\n                newVKids[newHead],\n                listener,\n                isSvg\n              );\n              newKeyed[newKey] = true;\n              oldHead++;\n            } else {\n              if ((tmpVKid = keyed[newKey]) != null) {\n                patch(\n                  node,\n                  node.insertBefore(tmpVKid.node, oldVKid && oldVKid.node),\n                  tmpVKid,\n                  newVKids[newHead],\n                  listener,\n                  isSvg\n                );\n                newKeyed[newKey] = true;\n              } else {\n                patch(\n                  node,\n                  oldVKid && oldVKid.node,\n                  null,\n                  newVKids[newHead],\n                  listener,\n                  isSvg\n                );\n              }\n            }\n            newHead++;\n          }\n        }\n\n        while (oldHead <= oldTail) {\n          if (getKey((oldVKid = oldVKids[oldHead++])) == null) {\n            node.removeChild(oldVKid.node);\n          }\n        }\n\n        for (var i in keyed) {\n          if (newKeyed[i] == null) {\n            node.removeChild(keyed[i].node);\n          }\n        }\n      }\n    }\n\n    return (newVNode.node = node)\n  };\n\n  var propsChanged = function(a, b) {\n    for (var k in a) if (a[k] !== b[k]) return true\n    for (var k in b) if (a[k] !== b[k]) return true\n  };\n\n  var getVNode = function(newVNode, oldVNode) {\n    return newVNode.type === LAZY_NODE\n      ? ((!oldVNode || propsChanged(oldVNode.lazy, newVNode.lazy)) &&\n          ((oldVNode = newVNode.lazy.view(newVNode.lazy)).lazy = newVNode.lazy),\n        oldVNode)\n      : newVNode\n  };\n\n  var createVNode = function(name, props, children, node, key, type) {\n    return {\n      name: name,\n      props: props,\n      children: children,\n      node: node,\n      type: type,\n      key: key\n    }\n  };\n\n  var createTextVNode = function(value, node) {\n    return createVNode(value, EMPTY_OBJ, EMPTY_ARR, node, null, TEXT_NODE)\n  };\n\n  var recycleNode = function(node) {\n    return node.nodeType === TEXT_NODE\n      ? createTextVNode(node.nodeValue, node)\n      : createVNode(\n          node.nodeName.toLowerCase(),\n          EMPTY_OBJ,\n          map.call(node.childNodes, recycleNode),\n          node,\n          null,\n          RECYCLED_NODE\n        )\n  };\n\n  var Lazy = function(props) {\n    return {\n      lazy: props,\n      type: LAZY_NODE\n    }\n  };\n\n  var h = function(name, props) {\n    for (var vnode, rest = [], children = [], i = arguments.length; i-- > 2; ) {\n      rest.push(arguments[i]);\n    }\n\n    while (rest.length > 0) {\n      if (isArray((vnode = rest.pop()))) {\n        for (var i = vnode.length; i-- > 0; ) {\n          rest.push(vnode[i]);\n        }\n      } else if (vnode === false || vnode === true || vnode == null) ; else {\n        children.push(typeof vnode === \"object\" ? vnode : createTextVNode(vnode));\n      }\n    }\n\n    props = props || EMPTY_OBJ;\n\n    return typeof name === \"function\"\n      ? name(props, children)\n      : createVNode(name, props, children, null, props.key)\n  };\n\n  var app = function(props, enhance) {\n    var state = {};\n    var lock = false;\n    var view = props.view;\n    var node = props.node;\n    var vdom = node && recycleNode(node);\n    var subscriptions = props.subscriptions;\n    var subs = [];\n\n    var listener = function(event) {\n      var action = this.actions[event.type];\n      if (action.preventDefault) event.preventDefault();\n      if (action.stopPropagation) event.stopPropagation();\n      dispatch(action.action || action, event);\n    };\n\n    var setState = function(newState) {\n      return (\n        state === newState || lock || defer(render, (lock = true)),\n        (state = newState)\n      )\n    };\n\n    var dispatch = (enhance ||\n      function(a) {\n        return a\n      })(function(action, props) {\n      return typeof action === \"function\"\n        ? dispatch(action(state, props))\n        : isArray(action)\n        ? typeof action[0] === \"function\"\n          ? dispatch(\n              action[0],\n              typeof action[1] === \"function\" ? action[1](props) : action[1]\n            )\n          : (batch(action.slice(1)).map(function(fx) {\n              fx && fx[0](fx[1], dispatch);\n            }, setState(action[0])),\n            state)\n        : setState(action)\n    });\n\n    var render = function() {\n      lock = false;\n      if (subscriptions) {\n        subs = patchSubs(subs, batch(subscriptions(state)), dispatch);\n      }\n      if (view) {\n        node = patch(\n          node.parentNode,\n          node,\n          vdom,\n          typeof (vdom = view(state)) === \"string\" ? createTextVNode(vdom) : vdom,\n          listener\n        );\n      }\n    };\n\n    dispatch(props.init);\n  };\n\n  exports.Lazy = Lazy;\n  exports.h = h;\n  exports.app = app;\n\n}));\n//# sourceMappingURL=hyperapp.js.map\n"]}