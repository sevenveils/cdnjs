{"version":3,"sources":["dist/hyperapp.js"],"names":["global","factory","exports","module","define","amd","self","hyperapp","this","XLINK_NS","EMPTY_OBJECT","EMPTY_ARRAY","map","isArray","Array","merge","a","b","target","i","resolved","Promise","resolve","defer","cb","then","setTimeout","updateProperty","element","name","lastValue","nextValue","eventProxy","isSvg","style","setProperty","slice","toLowerCase","events","removeEventListener","addEventListener","nullOrFalse","removeAttribute","replace","removeAttributeNS","setAttributeNS","setAttribute","createElement","node","lifecycle","type","document","createTextNode","createElementNS","props","onCreate","push","length","children","appendChild","removeChildren","onDestroy","removeElement","parent","remove","removeChild","onRemove","getKey","key","patchElement","lastNode","nextNode","nodeValue","newElement","insertBefore","savedNode","childNode","lastKey","lastProps","nextProps","isRecycled","onUpdate","updateElement","nextKey","lastChildren","lastChStart","lastChEnd","nextChildren","nextChStart","nextChEnd","lastKeyed","start","end","out","createKeyMap","nextKeyed","createVNode","createTextVNode","text","recycleChild","nodeType","recycleElement","nodeName","call","childNodes","patch","container","pop","cancel","sub","isSameAction","k","isSameValue","restart","oldSub","dispatch","refresh","current","concat","previous","cSub","pSub","h","rest","arguments","app","state","view","subs","subscriptions","lastSub","updateInProgress","setState","newState","render","obj","data","event","currentTarget","init"],"mappings":"CAAC,SAAUA,EAAQC,GACE,iBAAZC,SAA0C,oBAAXC,OAAyBF,EAAQC,SACrD,mBAAXE,QAAyBA,OAAOC,IAAMD,OAAO,CAAC,WAAYH,GACvCA,GAAzBD,EAASA,GAAUM,MAAqBC,SAAW,IAHtD,CAIEC,KAAM,SAAUN,GAAW,aAE3B,IAIIO,EAAW,+BAGXC,EAAe,GACfC,EAAc,GAEdC,EAAMD,EAAYC,IAClBC,EAAUC,MAAMD,QAEhBE,EAAQ,SAASC,EAAGC,GACtB,IAAIC,EAAS,GAEb,IAAK,IAAIC,KAAKH,EAAGE,EAAOC,GAAKH,EAAEG,GAC/B,IAAK,IAAIA,KAAKF,EAAGC,EAAOC,GAAKF,EAAEE,GAE/B,OAAOD,GAGLE,EAA8B,mBAAZC,SAA0BA,QAAQC,UAEpDC,EAASH,EAET,SAASI,GACP,OAAOJ,EAASK,KAAKD,IAFvBE,WAKAC,EAAiB,SACnBC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,GAAa,QAATJ,QAAuB,GAAa,UAATA,EAC7B,IAAK,IAAIV,KAAKJ,EAAMe,EAAWC,GAAY,CACzC,IAAIG,EAAqB,MAAbH,GAAqC,MAAhBA,EAAUZ,GAAa,GAAKY,EAAUZ,GAC1D,MAATA,EAAE,GACJS,EAAQC,GAAMM,YAAYhB,EAAGe,GAE7BN,EAAQC,GAAMV,GAAKe,OAIvB,GAAgB,MAAZL,EAAK,IAA0B,MAAZA,EAAK,GAC1BA,EAAOA,EAAKO,MAAM,GAAGC,cAEhBT,EAAQU,SAAQV,EAAQU,OAAS,IAEtCV,EAAQU,OAAOT,GAAQE,EAEN,MAAbA,EACFH,EAAQW,oBAAoBV,EAAMG,GACZ,MAAbF,GACTF,EAAQY,iBAAiBX,EAAMG,OAE5B,CACL,IAAIS,EAA2B,MAAbV,IAAmC,IAAdA,EAEvC,GACEF,KAAQD,GACC,SAATC,GACS,cAATA,GACS,eAATA,GACS,cAATA,IACCI,EAEDL,EAAQC,GAAqB,MAAbE,EAAoB,GAAKA,EACrCU,GACFb,EAAQc,gBAAgBb,QAGjBI,GAASJ,KAAUA,EAAOA,EAAKc,QAAQ,WAAY,KAEtDF,EACFb,EAAQgB,kBAAkBnC,EAAUoB,GAEpCD,EAAQiB,eAAepC,EAAUoB,EAAME,GAGrCU,EACFb,EAAQc,gBAAgBb,GAExBD,EAAQkB,aAAajB,EAAME,KAQnCgB,EAAgB,SAASC,EAAMC,EAAWjB,EAAYC,GACxD,IAAIL,EA9FU,IA+FZoB,EAAKE,KACDC,SAASC,eAAeJ,EAAKnB,OAC5BI,EAAQA,GAAuB,QAAde,EAAKnB,MACrBsB,SAASE,gBA/FN,6BA+F8BL,EAAKnB,MACtCsB,SAASJ,cAAcC,EAAKnB,MAEhCyB,EAAQN,EAAKM,MACbA,EAAMC,UACRN,EAAUO,KAAK,WACbF,EAAMC,SAAS3B,KAInB,IAAK,IAAIT,EAAI,EAAGsC,EAAST,EAAKU,SAASD,OAAQtC,EAAIsC,EAAQtC,IACzDS,EAAQ+B,YACNZ,EAAcC,EAAKU,SAASvC,GAAI8B,EAAWjB,EAAYC,IAI3D,IAAK,IAAIJ,KAAQyB,EACf3B,EAAeC,EAASC,EAAM,KAAMyB,EAAMzB,GAAOG,EAAYC,GAG/D,OAAQe,EAAKpB,QAAUA,GAqCrBgC,EAAiB,SAASZ,GAC5B,IAAK,IAAI7B,EAAI,EAAGsC,EAAST,EAAKU,SAASD,OAAQtC,EAAIsC,EAAQtC,IACzDyC,EAAeZ,EAAKU,SAASvC,IAG/B,IAAIK,EAAKwB,EAAKM,MAAMO,UAKpB,OAJU,MAANrC,GACFA,EAAGwB,EAAKpB,SAGHoB,EAAKpB,SAGVkC,EAAgB,SAASC,EAAQf,GACnC,IAAIgB,EAAS,WACXD,EAAOE,YAAYL,EAAeZ,KAGhCxB,EAAKwB,EAAKM,OAASN,EAAKM,MAAMY,SACxB,MAAN1C,EACFA,EAAGwB,EAAKpB,QAASoC,GAEjBA,KAIAG,EAAS,SAASnB,GACpB,OAAe,MAARA,EAAe,KAAOA,EAAKoB,KAiBhCC,EAAe,SACjBN,EACAnC,EACA0C,EACAC,EACAtB,EACAjB,EACAC,GAEA,GAAIsC,IAAaD,QAAiB,GACpB,MAAZA,GAjNY,IAkNZA,EAASpB,MAlNG,IAmNZqB,EAASrB,KAELoB,EAASzC,OAAS0C,EAAS1C,OAC7BD,EAAQ4C,UAAYD,EAAS1C,WAE1B,GAAgB,MAAZyC,GAAoBA,EAASzC,OAAS0C,EAAS1C,KAAM,CAC9D,IAAI4C,EAAaV,EAAOW,aACtB3B,EAAcwB,EAAUtB,EAAWjB,EAAYC,GAC/CL,GAGc,MAAZ0C,GAAkBR,EAAcC,EAAQO,GAE5C1C,EAAU6C,MACL,CAWL,IAAIE,EACAC,EAEAC,GAtHY,SAClBjD,EACAkD,EACAC,EACA9B,EACAjB,EACAC,EACA+C,GAEA,IAAK,IAAInD,KAAQd,EAAM+D,EAAWC,IAEpB,UAATlD,GAA6B,YAATA,EACjBD,EAAQC,GACRiD,EAAUjD,MAAWkD,EAAUlD,IAEnCF,EACEC,EACAC,EACAiD,EAAUjD,GACVkD,EAAUlD,GACVG,EACAC,GAKN,IAAIT,EAAKwD,EAAaD,EAAUxB,SAAWwB,EAAUE,SAC3C,MAANzD,GACFyB,EAAUO,KAAK,WACbhC,EAAGI,EAASkD,KA4EdI,CACEtD,EACA0C,EAAShB,MACTiB,EAASjB,MACTL,EACAjB,EACCC,EAAQA,GAA2B,QAAlBsC,EAAS1C,KAzOb,IA0OdyC,EAASpB,MAgBX,IATA,IAIIiC,EAJAC,EAAed,EAASZ,SACxB2B,EAAc,EACdC,EAAYF,EAAa3B,OAAS,EAGlC8B,EAAehB,EAASb,SACxB8B,EAAc,EACdC,EAAYF,EAAa9B,OAAS,EAE/B+B,GAAeC,GAAaJ,GAAeC,IAChDT,EAAUV,EAAOiB,EAAaC,IAC9BF,EAAUhB,EAAOoB,EAAaC,IAEf,MAAXX,GAAmBA,IAAYM,IAEnCd,EACEzC,EACAwD,EAAaC,GAAazD,QAC1BwD,EAAaC,GACbE,EAAaC,GACbvC,EACAjB,EACAC,GAGFoD,IACAG,IAGF,KAAOA,GAAeC,GAAaJ,GAAeC,IAChDT,EAAUV,EAAOiB,EAAaE,IAC9BH,EAAUhB,EAAOoB,EAAaE,IAEf,MAAXZ,GAAmBA,IAAYM,IAEnCd,EACEzC,EACAwD,EAAaE,GAAW1D,QACxBwD,EAAaE,GACbC,EAAaE,GACbxC,EACAjB,EACAC,GAGFqD,IACAG,IAGF,GAAIJ,EAAcC,EAChB,KAAOE,GAAeC,GACpB7D,EAAQ8C,aACN3B,EACEwC,EAAaC,KACbvC,EACAjB,EACAC,IAED2C,EAAYQ,EAAaC,KAAiBT,EAAUhD,cAGpD,GAAI4D,EAAcC,EACvB,KAAOJ,GAAeC,GACpBxB,EAAclC,EAASwD,EAAaC,UAEjC,CAIL,IAHA,IAAIK,EAzHS,SAAShC,EAAUiC,EAAOC,GAK3C,IAJA,IACIxB,EACApB,EAFA6C,EAAM,GAIHF,GAASC,EAAKD,IACyB,OAAvCvB,GAAOpB,EAAOU,EAASiC,IAAQvB,OAClCyB,EAAIzB,GAAOpB,GAIf,OAAO6C,EA8GaC,CAAaV,EAAcC,EAAaC,GACpDS,EAAY,GAETP,GAAeC,GACpBZ,EAAUV,EAAQS,EAAYQ,EAAaC,IAC3CF,EAAUhB,EAAOoB,EAAaC,IAG5BO,EAAUlB,IACE,MAAXM,GAAmBA,IAAYhB,EAAOiB,EAAaC,EAAc,KAEnD,MAAXR,GACFf,EAAclC,EAASgD,GAEzBS,KAIa,MAAXF,GArUQ,IAqUWb,EAASpB,MACf,MAAX2B,IACFR,EACEzC,EACAgD,GAAaA,EAAUhD,QACvBgD,EACAW,EAAaC,GACbvC,EACAjB,EACAC,GAEFuD,KAEFH,MAEIR,IAAYM,GACdd,EACEzC,EACAgD,EAAUhD,QACVgD,EACAW,EAAaC,GACbvC,EACAjB,EACAC,GAEF8D,EAAUZ,IAAW,EACrBE,KAEwC,OAAnCV,EAAYe,EAAUP,KACzBd,EACEzC,EACAA,EAAQ8C,aACNC,EAAU/C,QACVgD,GAAaA,EAAUhD,SAEzB+C,EACAY,EAAaC,GACbvC,EACAjB,EACAC,GAEF8D,EAAUZ,IAAW,GAErBd,EACEzC,EACAgD,GAAaA,EAAUhD,QACvB,KACA2D,EAAaC,GACbvC,EACAjB,EACAC,GAINuD,KAIJ,KAAOH,GAAeC,GACqC,MAArDnB,EAAQS,EAAYQ,EAAaC,OACnCvB,EAAclC,EAASgD,GAI3B,IAAK,IAAIR,KAAOsB,EACQ,MAAlBK,EAAU3B,IACZN,EAAclC,EAAS8D,EAAUtB,KAMzC,OAAQG,EAAS3C,QAAUA,GAGzBoE,EAAc,SAASnE,EAAMyB,EAAOI,EAAU9B,EAASwC,EAAKlB,GAC9D,MAAO,CACLrB,KAAMA,EACNyB,MAAOA,EACPI,SAAUA,EACV9B,QAASA,EACTwC,IAAKA,EACLlB,KAAMA,IAIN+C,EAAkB,SAASC,EAAMtE,GACnC,OAAOoE,EAAYE,EAAMxF,EAAcC,EAAaiB,EAAS,KA3Z/C,IA8ZZuE,EAAe,SAASvE,GAC1B,OA/Zc,IA+ZPA,EAAQwE,SACXH,EAAgBrE,EAAQ4C,UAAW5C,GACnCyE,EAAezE,IAGjByE,EAAiB,SAASzE,GAC5B,OAAOoE,EACLpE,EAAQ0E,SAASjE,cACjB3B,EACAE,EAAI2F,KAAK3E,EAAQ4E,WAAYL,GAC7BvE,EACA,KA3agB,IAgbhB6E,EAAQ,SAASC,EAAW9E,EAAS0C,EAAUC,EAAUvC,GAC3D,IAAIiB,EAAY,GAWhB,IATArB,EAAUyC,EACRqC,EACA9E,EACA0C,EACAC,EACAtB,EACAjB,GAGKiB,EAAUQ,OAAS,GAAGR,EAAU0D,KAAV1D,GAE7B,OAAOrB,GAiCLgF,EAAS,SAASC,GACpBA,EAAI,GAAG,MAYLC,EAAe,SAAS9F,EAAGC,GAC7B,cACSD,UAAaC,GACnBJ,EAAQG,IAAMA,EAAE,KAAOC,EAAE,IAZZ,SAASD,EAAGC,GAC5B,GAAID,IAAMC,EACR,IAAK,IAAI8F,KAAKhG,EAAMC,EAAGC,GACrB,GAAID,EAAE+F,KAAO9F,EAAE8F,GAAI,OAAO,EAG9B,OAAO,EAM2BC,CAAYhG,EAAE,GAAIC,EAAE,KAIpDgG,EAAU,SAASJ,EAAKK,EAAQC,GAClC,IAAK,IAAIJ,KAAKhG,EAAM8F,EAAKK,GACvB,GAAIL,EAAIE,KAAOG,EAAOH,KAAMD,EAAaD,EAAIE,GAAIG,EAAOH,IAEtD,OADAH,EAAOM,GACAvB,EAAMkB,EAAKM,GAGtB,OAAOD,GAGLvB,EAAQ,SAASkB,EAAKM,GACxB,MAAO,CAACN,EAAI,GAAIA,EAAI,GAAIA,EAAI,GAAGA,EAAI,GAAIM,KAGrCC,EAAU,SAASP,EAAKK,EAAQC,GAKlC,IAJA,IAAIE,EAAU,GAAGC,OAAOT,GACpBU,EAAW,GAAGD,OAAOJ,GACrBrB,EAAM,GAED1E,EAAI,EAAGA,EAAIkG,EAAQ5D,QAAUtC,EAAIoG,EAAS9D,OAAQtC,IAAK,CAC9D,IAAIqG,EAAOH,EAAQlG,GACfsG,EAAOF,EAASpG,GACpB0E,EAAIrC,KACFgE,EACIC,EACER,EAAQO,EAAMC,EAAMN,GACpBxB,EAAM6B,EAAML,GACdM,EACEb,EAAOa,GACPA,GAIV,OAAO5B,GA+DT3F,EAAQwH,EAlJA,SAAS7F,EAAMyB,GAMrB,IALA,IAAIN,EACA2E,EAAO,GACPjE,EAAW,GACXD,EAASmE,UAAUnE,OAEhBA,KAAW,GAAGkE,EAAKnE,KAAKoE,UAAUnE,IASzC,IAPqD,OAAhDH,EAAiB,MAATA,EAAgB,GAAKA,GAAOI,WACnCiE,EAAKlE,QAAU,GACjBkE,EAAKnE,KAAKF,EAAMI,iBAEXJ,EAAMI,UAGRiE,EAAKlE,OAAS,GACnB,GAAI5C,EAASmC,EAAO2E,EAAKhB,OACvB,IAAKlD,EAAST,EAAKS,OAAQA,KAAW,GACpCkE,EAAKnE,KAAKR,EAAKS,SAEC,IAATT,IAA2B,IAATA,GAAyB,MAARA,GAC5CU,EAASF,KAAqB,iBAATR,EAAoBA,EAAOiD,EAAgBjD,IAIpE,MAAuB,mBAATnB,EACVA,EAAKyB,EAAQA,EAAMI,SAAWA,GAC9BsC,EAAYnE,EAAMyB,EAAOI,EAAU,KAAMJ,EAAMc,IA7dvC,IAqlBdlE,EAAQ2H,IA7DR,SAAavE,GACX,IAAIwE,EACAC,EAAOzE,EAAMyE,KACbC,EAAO1E,EAAM2E,cACbvB,EAAYpD,EAAMoD,UAClB9E,EAAU8E,GAAaA,EAAUhD,UAAYgD,EAAUhD,SAAS,GAChEY,EAAW1C,GAAWyE,EAAezE,GACrCsG,EAAU,GACVC,GAAmB,EAEnBC,EAAW,SAASC,GAClBP,IAAUO,IACZP,EAAQO,EAEHF,IACHA,GAAmB,EACnB5G,EAAM+G,MAKRnB,EAAW,SAASoB,EAAKC,GAChB,MAAPD,IAAuC,mBAARA,EACjCpB,EAASoB,EAAIT,EAAOU,IACX3H,EAAQ0H,GACK,mBAAXA,EAAI,GACbpB,EAASoB,EAAI,GAAGT,EAAOS,EAAI,GAAIC,IAE/BD,EAAI,GAAG,GAAGA,EAAI,GAAG,GAAIpB,EAAUiB,EAASG,EAAI,KAG9CH,EAASG,KAITvG,EAAa,SAASyG,GACxBtB,EAASsB,EAAMC,cAAcpG,OAAOmG,EAAMvF,MAAOuF,IAG/CH,EAAS,WACXH,GAAmB,EAEfH,IACFE,EAAUd,EAAQY,EAAKF,GAAQI,EAASf,IAGtCY,IACFnG,EAAU6E,EACRC,EACA9E,EACA0C,EACCA,EAAWyD,EAAKD,GACjB9F,KAKNmF,EAAS7D,EAAMqF","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.hyperapp = {}));\n}(this, function (exports) { 'use strict';\n\n  var DEFAULT = 0;\n  var RECYCLED_NODE = 1;\n  var TEXT_NODE = 3; // Node.TEXT_NODE\n\n  var XLINK_NS = \"http://www.w3.org/1999/xlink\";\n  var SVG_NS = \"http://www.w3.org/2000/svg\";\n\n  var EMPTY_OBJECT = {};\n  var EMPTY_ARRAY = [];\n\n  var map = EMPTY_ARRAY.map;\n  var isArray = Array.isArray;\n\n  var merge = function(a, b) {\n    var target = {};\n\n    for (var i in a) target[i] = a[i];\n    for (var i in b) target[i] = b[i];\n\n    return target\n  };\n\n  var resolved = typeof Promise === \"function\" && Promise.resolve();\n\n  var defer = !resolved\n    ? setTimeout\n    : function(cb) {\n        return resolved.then(cb)\n      };\n\n  var updateProperty = function(\n    element,\n    name,\n    lastValue,\n    nextValue,\n    eventProxy,\n    isSvg\n  ) {\n    if (name === \"key\") ; else if (name === \"style\") {\n      for (var i in merge(lastValue, nextValue)) {\n        var style = nextValue == null || nextValue[i] == null ? \"\" : nextValue[i];\n        if (i[0] === \"-\") {\n          element[name].setProperty(i, style);\n        } else {\n          element[name][i] = style;\n        }\n      }\n    } else {\n      if (name[0] === \"o\" && name[1] === \"n\") {\n        name = name.slice(2).toLowerCase();\n\n        if (!element.events) element.events = {};\n\n        element.events[name] = nextValue;\n\n        if (nextValue == null) {\n          element.removeEventListener(name, eventProxy);\n        } else if (lastValue == null) {\n          element.addEventListener(name, eventProxy);\n        }\n      } else {\n        var nullOrFalse = nextValue == null || nextValue === false;\n\n        if (\n          name in element &&\n          name !== \"list\" &&\n          name !== \"draggable\" &&\n          name !== \"spellcheck\" &&\n          name !== \"translate\" &&\n          !isSvg\n        ) {\n          element[name] = nextValue == null ? \"\" : nextValue;\n          if (nullOrFalse) {\n            element.removeAttribute(name);\n          }\n        } else {\n          var ns = isSvg && name !== (name = name.replace(/^xlink:?/, \"\"));\n          if (ns) {\n            if (nullOrFalse) {\n              element.removeAttributeNS(XLINK_NS, name);\n            } else {\n              element.setAttributeNS(XLINK_NS, name, nextValue);\n            }\n          } else {\n            if (nullOrFalse) {\n              element.removeAttribute(name);\n            } else {\n              element.setAttribute(name, nextValue);\n            }\n          }\n        }\n      }\n    }\n  };\n\n  var createElement = function(node, lifecycle, eventProxy, isSvg) {\n    var element =\n      node.type === TEXT_NODE\n        ? document.createTextNode(node.name)\n        : (isSvg = isSvg || node.name === \"svg\")\n          ? document.createElementNS(SVG_NS, node.name)\n          : document.createElement(node.name);\n\n    var props = node.props;\n    if (props.onCreate) {\n      lifecycle.push(function() {\n        props.onCreate(element);\n      });\n    }\n\n    for (var i = 0, length = node.children.length; i < length; i++) {\n      element.appendChild(\n        createElement(node.children[i], lifecycle, eventProxy, isSvg)\n      );\n    }\n\n    for (var name in props) {\n      updateProperty(element, name, null, props[name], eventProxy, isSvg);\n    }\n\n    return (node.element = element)\n  };\n\n  var updateElement = function(\n    element,\n    lastProps,\n    nextProps,\n    lifecycle,\n    eventProxy,\n    isSvg,\n    isRecycled\n  ) {\n    for (var name in merge(lastProps, nextProps)) {\n      if (\n        (name === \"value\" || name === \"checked\"\n          ? element[name]\n          : lastProps[name]) !== nextProps[name]\n      ) {\n        updateProperty(\n          element,\n          name,\n          lastProps[name],\n          nextProps[name],\n          eventProxy,\n          isSvg\n        );\n      }\n    }\n\n    var cb = isRecycled ? nextProps.onCreate : nextProps.onUpdate;\n    if (cb != null) {\n      lifecycle.push(function() {\n        cb(element, lastProps);\n      });\n    }\n  };\n\n  var removeChildren = function(node) {\n    for (var i = 0, length = node.children.length; i < length; i++) {\n      removeChildren(node.children[i]);\n    }\n\n    var cb = node.props.onDestroy;\n    if (cb != null) {\n      cb(node.element);\n    }\n\n    return node.element\n  };\n\n  var removeElement = function(parent, node) {\n    var remove = function() {\n      parent.removeChild(removeChildren(node));\n    };\n\n    var cb = node.props && node.props.onRemove;\n    if (cb != null) {\n      cb(node.element, remove);\n    } else {\n      remove();\n    }\n  };\n\n  var getKey = function(node) {\n    return node == null ? null : node.key\n  };\n\n  var createKeyMap = function(children, start, end) {\n    var out = {};\n    var key;\n    var node;\n\n    for (; start <= end; start++) {\n      if ((key = (node = children[start]).key) != null) {\n        out[key] = node;\n      }\n    }\n\n    return out\n  };\n\n  var patchElement = function(\n    parent,\n    element,\n    lastNode,\n    nextNode,\n    lifecycle,\n    eventProxy,\n    isSvg\n  ) {\n    if (nextNode === lastNode) ; else if (\n      lastNode != null &&\n      lastNode.type === TEXT_NODE &&\n      nextNode.type === TEXT_NODE\n    ) {\n      if (lastNode.name !== nextNode.name) {\n        element.nodeValue = nextNode.name;\n      }\n    } else if (lastNode == null || lastNode.name !== nextNode.name) {\n      var newElement = parent.insertBefore(\n        createElement(nextNode, lifecycle, eventProxy, isSvg),\n        element\n      );\n\n      if (lastNode != null) removeElement(parent, lastNode);\n\n      element = newElement;\n    } else {\n      updateElement(\n        element,\n        lastNode.props,\n        nextNode.props,\n        lifecycle,\n        eventProxy,\n        (isSvg = isSvg || nextNode.name === \"svg\"),\n        lastNode.type === RECYCLED_NODE\n      );\n\n      var savedNode;\n      var childNode;\n\n      var lastKey;\n      var lastChildren = lastNode.children;\n      var lastChStart = 0;\n      var lastChEnd = lastChildren.length - 1;\n\n      var nextKey;\n      var nextChildren = nextNode.children;\n      var nextChStart = 0;\n      var nextChEnd = nextChildren.length - 1;\n\n      while (nextChStart <= nextChEnd && lastChStart <= lastChEnd) {\n        lastKey = getKey(lastChildren[lastChStart]);\n        nextKey = getKey(nextChildren[nextChStart]);\n\n        if (lastKey == null || lastKey !== nextKey) break\n\n        patchElement(\n          element,\n          lastChildren[lastChStart].element,\n          lastChildren[lastChStart],\n          nextChildren[nextChStart],\n          lifecycle,\n          eventProxy,\n          isSvg\n        );\n\n        lastChStart++;\n        nextChStart++;\n      }\n\n      while (nextChStart <= nextChEnd && lastChStart <= lastChEnd) {\n        lastKey = getKey(lastChildren[lastChEnd]);\n        nextKey = getKey(nextChildren[nextChEnd]);\n\n        if (lastKey == null || lastKey !== nextKey) break\n\n        patchElement(\n          element,\n          lastChildren[lastChEnd].element,\n          lastChildren[lastChEnd],\n          nextChildren[nextChEnd],\n          lifecycle,\n          eventProxy,\n          isSvg\n        );\n\n        lastChEnd--;\n        nextChEnd--;\n      }\n\n      if (lastChStart > lastChEnd) {\n        while (nextChStart <= nextChEnd) {\n          element.insertBefore(\n            createElement(\n              nextChildren[nextChStart++],\n              lifecycle,\n              eventProxy,\n              isSvg\n            ),\n            (childNode = lastChildren[lastChStart]) && childNode.element\n          );\n        }\n      } else if (nextChStart > nextChEnd) {\n        while (lastChStart <= lastChEnd) {\n          removeElement(element, lastChildren[lastChStart++]);\n        }\n      } else {\n        var lastKeyed = createKeyMap(lastChildren, lastChStart, lastChEnd);\n        var nextKeyed = {};\n\n        while (nextChStart <= nextChEnd) {\n          lastKey = getKey((childNode = lastChildren[lastChStart]));\n          nextKey = getKey(nextChildren[nextChStart]);\n\n          if (\n            nextKeyed[lastKey] ||\n            (nextKey != null && nextKey === getKey(lastChildren[lastChStart + 1]))\n          ) {\n            if (lastKey == null) {\n              removeElement(element, childNode);\n            }\n            lastChStart++;\n            continue\n          }\n\n          if (nextKey == null || lastNode.type === RECYCLED_NODE) {\n            if (lastKey == null) {\n              patchElement(\n                element,\n                childNode && childNode.element,\n                childNode,\n                nextChildren[nextChStart],\n                lifecycle,\n                eventProxy,\n                isSvg\n              );\n              nextChStart++;\n            }\n            lastChStart++;\n          } else {\n            if (lastKey === nextKey) {\n              patchElement(\n                element,\n                childNode.element,\n                childNode,\n                nextChildren[nextChStart],\n                lifecycle,\n                eventProxy,\n                isSvg\n              );\n              nextKeyed[nextKey] = true;\n              lastChStart++;\n            } else {\n              if ((savedNode = lastKeyed[nextKey]) != null) {\n                patchElement(\n                  element,\n                  element.insertBefore(\n                    savedNode.element,\n                    childNode && childNode.element\n                  ),\n                  savedNode,\n                  nextChildren[nextChStart],\n                  lifecycle,\n                  eventProxy,\n                  isSvg\n                );\n                nextKeyed[nextKey] = true;\n              } else {\n                patchElement(\n                  element,\n                  childNode && childNode.element,\n                  null,\n                  nextChildren[nextChStart],\n                  lifecycle,\n                  eventProxy,\n                  isSvg\n                );\n              }\n            }\n            nextChStart++;\n          }\n        }\n\n        while (lastChStart <= lastChEnd) {\n          if (getKey((childNode = lastChildren[lastChStart++])) == null) {\n            removeElement(element, childNode);\n          }\n        }\n\n        for (var key in lastKeyed) {\n          if (nextKeyed[key] == null) {\n            removeElement(element, lastKeyed[key]);\n          }\n        }\n      }\n    }\n\n    return (nextNode.element = element)\n  };\n\n  var createVNode = function(name, props, children, element, key, type) {\n    return {\n      name: name,\n      props: props,\n      children: children,\n      element: element,\n      key: key,\n      type: type\n    }\n  };\n\n  var createTextVNode = function(text, element) {\n    return createVNode(text, EMPTY_OBJECT, EMPTY_ARRAY, element, null, TEXT_NODE)\n  };\n\n  var recycleChild = function(element) {\n    return element.nodeType === TEXT_NODE\n      ? createTextVNode(element.nodeValue, element)\n      : recycleElement(element)\n  };\n\n  var recycleElement = function(element) {\n    return createVNode(\n      element.nodeName.toLowerCase(),\n      EMPTY_OBJECT,\n      map.call(element.childNodes, recycleChild),\n      element,\n      null,\n      RECYCLED_NODE\n    )\n  };\n\n  var patch = function(container, element, lastNode, nextNode, eventProxy) {\n    var lifecycle = [];\n\n    element = patchElement(\n      container,\n      element,\n      lastNode,\n      nextNode,\n      lifecycle,\n      eventProxy\n    );\n\n    while (lifecycle.length > 0) lifecycle.pop()();\n\n    return element\n  };\n\n  var h = function(name, props) {\n    var node;\n    var rest = [];\n    var children = [];\n    var length = arguments.length;\n\n    while (length-- > 2) rest.push(arguments[length]);\n\n    if ((props = props == null ? {} : props).children != null) {\n      if (rest.length <= 0) {\n        rest.push(props.children);\n      }\n      delete props.children;\n    }\n\n    while (rest.length > 0) {\n      if (isArray((node = rest.pop()))) {\n        for (length = node.length; length-- > 0; ) {\n          rest.push(node[length]);\n        }\n      } else if (node === false || node === true || node == null) ; else {\n        children.push(typeof node === \"object\" ? node : createTextVNode(node));\n      }\n    }\n\n    return typeof name === \"function\"\n      ? name(props, (props.children = children))\n      : createVNode(name, props, children, null, props.key, DEFAULT)\n  };\n\n  var cancel = function(sub) {\n    sub[1][2]();\n  };\n\n  var isSameValue = function(a, b) {\n    if (a !== b) {\n      for (var k in merge(a, b)) {\n        if (a[k] !== b[k]) return false\n      }\n    }\n    return true\n  };\n\n  var isSameAction = function(a, b) {\n    return (\n      typeof a === typeof b &&\n      (isArray(a) && a[0] === b[0] && isSameValue(a[1], b[1]))\n    )\n  };\n\n  var restart = function(sub, oldSub, dispatch) {\n    for (var k in merge(sub, oldSub)) {\n      if (sub[k] === oldSub[k] || isSameAction(sub[k], oldSub[k])) ; else {\n        cancel(oldSub);\n        return start(sub, dispatch)\n      }\n    }\n    return oldSub\n  };\n\n  var start = function(sub, dispatch) {\n    return [sub[0], sub[1], sub[0](sub[1], dispatch)]\n  };\n\n  var refresh = function(sub, oldSub, dispatch) {\n    var current = [].concat(sub);\n    var previous = [].concat(oldSub);\n    var out = [];\n\n    for (var i = 0; i < current.length || i < previous.length; i++) {\n      var cSub = current[i];\n      var pSub = previous[i];\n      out.push(\n        cSub\n          ? pSub\n            ? restart(cSub, pSub, dispatch)\n            : start(cSub, dispatch)\n          : pSub\n            ? cancel(pSub)\n            : pSub\n      );\n    }\n\n    return out\n  };\n\n  function app(props) {\n    var state;\n    var view = props.view;\n    var subs = props.subscriptions;\n    var container = props.container;\n    var element = container && container.children && container.children[0];\n    var lastNode = element && recycleElement(element);\n    var lastSub = [];\n    var updateInProgress = false;\n\n    var setState = function(newState) {\n      if (state !== newState) {\n        state = newState;\n\n        if (!updateInProgress) {\n          updateInProgress = true;\n          defer(render);\n        }\n      }\n    };\n\n    var dispatch = function(obj, data) {\n      if (obj == null) ; else if (typeof obj === \"function\") {\n        dispatch(obj(state, data));\n      } else if (isArray(obj)) {\n        if (typeof obj[0] === \"function\") {\n          dispatch(obj[0](state, obj[1], data));\n        } else {\n          obj[1][0](obj[1][1], dispatch, setState(obj[0]));\n        }\n      } else {\n        setState(obj);\n      }\n    };\n\n    var eventProxy = function(event) {\n      dispatch(event.currentTarget.events[event.type], event);\n    };\n\n    var render = function() {\n      updateInProgress = false;\n\n      if (subs) {\n        lastSub = refresh(subs(state), lastSub, dispatch);\n      }\n\n      if (view) {\n        element = patch(\n          container,\n          element,\n          lastNode,\n          (lastNode = view(state)),\n          eventProxy\n        );\n      }\n    };\n\n    dispatch(props.init);\n  }\n\n  exports.h = h;\n  exports.app = app;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n//# sourceMappingURL=hyperapp.js.map\n"]}