/*! OOUI v0.30.3 | http://oojs.mit-license.org */
!function(l){"use strict";l.ui.ActionWidget=function(t){t=$.extend({framed:!1},t),l.ui.ActionWidget.parent.call(this,t),l.ui.mixin.PendingElement.call(this,t),this.action=t.action||"",this.modes=t.modes||[],this.width=0,this.height=0,this.$element.addClass("oo-ui-actionWidget")},l.inheritClass(l.ui.ActionWidget,l.ui.ButtonWidget),l.mixinClass(l.ui.ActionWidget,l.ui.mixin.PendingElement),l.ui.ActionWidget.prototype.hasMode=function(t){return-1!==this.modes.indexOf(t)},l.ui.ActionWidget.prototype.getAction=function(){return this.action},l.ui.ActionWidget.prototype.getModes=function(){return this.modes.slice()},l.ui.ActionSet=function(t){t=t||{},l.EventEmitter.call(this),this.list=[],this.categories={actions:"getAction",flags:"getFlags",modes:"getModes"},this.categorized={},this.special={},this.others=[],this.organized=!1,this.changing=!1,this.changed=!1},l.mixinClass(l.ui.ActionSet,l.EventEmitter),l.ui.ActionSet.static.specialFlags=["safe","primary"],l.ui.ActionSet.prototype.onActionChange=function(){this.organized=!1,this.changing?this.changed=!0:this.emit("change")},l.ui.ActionSet.prototype.isSpecial=function(t){var e;for(e in this.special)if(t===this.special[e])return!0;return!1},l.ui.ActionSet.prototype.get=function(t){var e,i,o,n,s,r,a,c;if(t){for(n in this.organize(),c=[],this.categorized)if(o=t[n])for(Array.isArray(o)||(o=[o]),e=0,i=o.length;e<i;e++)s=this.categorized[n][o[e]],Array.isArray(s)&&c.push.apply(c,s);for(e=0,i=c.length;e<i;e++)a=c[e],(void 0!==t.visible&&a.isVisible()!==t.visible||void 0!==t.disabled&&a.isDisabled()!==t.disabled)&&(c.splice(e,1),i--,e--);for(e=0,i=c.length;e<i;e++)for(a=c[e],r=c.lastIndexOf(a);r!==e;)c.splice(r,1),i--,r=c.lastIndexOf(a);return c}return this.list.slice()},l.ui.ActionSet.prototype.getSpecial=function(){return this.organize(),$.extend({},this.special)},l.ui.ActionSet.prototype.getOthers=function(){return this.organize(),this.others.slice()},l.ui.ActionSet.prototype.setMode=function(t){var e,i,o;for(this.changing=!0,e=0,i=this.list.length;e<i;e++)(o=this.list[e]).toggle(o.hasMode(t));return this.organized=!1,this.changing=!1,this.emit("change"),this},l.ui.ActionSet.prototype.setAbilities=function(t){var e,i,o,n;for(e=0,i=this.list.length;e<i;e++)void 0!==t[o=(n=this.list[e]).getAction()]&&n.setDisabled(!t[o]);return this},l.ui.ActionSet.prototype.forEach=function(t,e){return this.changed=!1,this.changing=!0,this.get(t).forEach(e),this.changing=!1,this.changed&&this.emit("change"),this},l.ui.ActionSet.prototype.add=function(t){var e,i,o;for(this.changing=!0,e=0,i=t.length;e<i;e++)(o=t[e]).connect(this,{click:["emit","click",o],toggle:["onActionChange"]}),this.list.push(o);return this.organized=!1,this.emit("add",t),this.changing=!1,this.emit("change"),this},l.ui.ActionSet.prototype.remove=function(t){var e,i,o,n;for(this.changing=!0,e=0,i=t.length;e<i;e++)n=t[e],-1!==(o=this.list.indexOf(n))&&(n.disconnect(this),this.list.splice(o,1));return this.organized=!1,this.emit("remove",t),this.changing=!1,this.emit("change"),this},l.ui.ActionSet.prototype.clear=function(){var t,e,i=this.list.slice();for(this.changing=!0,t=0,e=this.list.length;t<e;t++)this.list[t].disconnect(this);return this.list=[],this.organized=!1,this.emit("remove",i),this.changing=!1,this.emit("change"),this},l.ui.ActionSet.prototype.organize=function(){var t,e,i,o,n,s,r,a,c,l,h=this.constructor.static.specialFlags;if(!this.organized){for(this.categorized={},this.special={},this.others=[],t=0,e=this.list.length;t<e;t++)if((s=this.list[t]).isVisible()){for(r in this.categories)for(this.categorized[r]||(this.categorized[r]={}),a=s[this.categories[r]](),Array.isArray(a)||(a=[a]),i=0,o=a.length;i<o;i++)c=a[i],this.categorized[r][c]||(this.categorized[r][c]=[]),this.categorized[r][c].push(s);for(l=!1,i=0,o=h.length;i<o;i++)if(n=h[i],!this.special[n]&&s.hasFlag(n)){this.special[n]=s,l=!0;break}l||this.others.push(s)}this.organized=!0}return this},l.ui.Error=function(t,e){l.isPlainObject(t)&&void 0===e&&(t=(e=t).message),e=e||{},this.message=t instanceof $?t:String(t),this.recoverable=void 0===e.recoverable||!!e.recoverable,this.warning=!!e.warning},l.initClass(l.ui.Error),l.ui.Error.prototype.isRecoverable=function(){return this.recoverable},l.ui.Error.prototype.isWarning=function(){return this.warning},l.ui.Error.prototype.getMessage=function(){return this.message instanceof $?this.message.clone():$("<div>").text(this.message).contents()},l.ui.Error.prototype.getMessageText=function(){return this.message instanceof $?this.message.text():this.message},l.ui.Process=function(t,e){this.steps=[],void 0!==t&&this.next(t,e)},l.initClass(l.ui.Process),l.ui.Process.prototype.execute=function(){var t,e,i;function o(i){return function(){var t,e=i.callback.call(i.context);if(!1===e)return $.Deferred().reject([]).promise();if("number"!=typeof e)return e instanceof l.ui.Error?$.Deferred().reject([e]).promise():Array.isArray(e)&&e.length&&e[0]instanceof l.ui.Error?$.Deferred().reject(e).promise():e&&"function"==typeof e.promise?e.promise():$.Deferred().resolve().promise();if(e<0)throw new Error("Cannot go back in time: flux capacitor is out of service");return t=$.Deferred(),setTimeout(t.resolve,e),t.promise()}}if(this.steps.length)for(i=o(this.steps[0])(),t=1,e=this.steps.length;t<e;t++)i=i.then(o(this.steps[t]));else i=$.Deferred().resolve().promise();return i},l.ui.Process.prototype.createStep=function(t,e){if("number"==typeof t||"function"==typeof t.promise)return{callback:function(){return t},context:null};if("function"==typeof t)return{callback:t,context:e};throw new Error("Cannot create process step: number, promise or function expected")},l.ui.Process.prototype.first=function(t,e){return this.steps.unshift(this.createStep(t,e)),this},l.ui.Process.prototype.next=function(t,e){return this.steps.push(this.createStep(t,e)),this},l.ui.WindowInstance=function(){var t={opening:$.Deferred(),opened:$.Deferred(),closing:$.Deferred(),closed:$.Deferred()};this.deferreds=t,this.opening=t.opening.promise(),this.opened=this.opening.then(function(){return t.opened}),this.closing=this.opened.then(function(){return t.closing}),this.closed=this.closing.then(function(){return t.closed})},l.initClass(l.ui.WindowInstance),l.ui.WindowInstance.prototype.isOpening=function(){return"pending"===this.deferreds.opened.state()},l.ui.WindowInstance.prototype.isOpened=function(){return"resolved"===this.deferreds.opened.state()&&"pending"===this.deferreds.closing.state()},l.ui.WindowInstance.prototype.isClosing=function(){return"resolved"===this.deferreds.closing.state()&&"pending"===this.deferreds.closed.state()},l.ui.WindowInstance.prototype.isClosed=function(){return"resolved"===this.deferreds.closed.state()},l.ui.WindowManager=function(t){t=t||{},l.ui.WindowManager.parent.call(this,t),l.EventEmitter.call(this),this.factory=t.factory,this.modal=void 0===t.modal||!!t.modal,this.windows={},this.compatOpened=null,this.preparingToOpen=null,this.preparingToClose=null,this.currentWindow=null,this.globalEvents=!1,this.$returnFocusTo=null,this.$ariaHidden=null,this.onWindowResizeTimeout=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.afterWindowResizeHandler=this.afterWindowResize.bind(this),this.$element.addClass("oo-ui-windowManager").toggleClass("oo-ui-windowManager-modal",this.modal),this.modal&&this.$element.attr("aria-hidden",!0)},l.inheritClass(l.ui.WindowManager,l.ui.Element),l.mixinClass(l.ui.WindowManager,l.EventEmitter),l.ui.WindowManager.static.sizes={small:{width:300},medium:{width:500},large:{width:700},larger:{width:900},full:{width:"100%",height:"100%"}},l.ui.WindowManager.static.defaultSize="medium",l.ui.WindowManager.prototype.onWindowResize=function(){clearTimeout(this.onWindowResizeTimeout),this.onWindowResizeTimeout=setTimeout(this.afterWindowResizeHandler,200)},l.ui.WindowManager.prototype.afterWindowResize=function(){var t=document.activeElement;this.currentWindow&&(this.updateWindowSize(this.currentWindow),t!==document.activeElement&&t.focus())},l.ui.WindowManager.prototype.isOpening=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpening()},l.ui.WindowManager.prototype.isClosing=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isClosing()},l.ui.WindowManager.prototype.isOpened=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpened()},l.ui.WindowManager.prototype.hasWindow=function(t){var e;for(e in this.windows)if(this.windows[e]===t)return!0;return!1},l.ui.WindowManager.prototype.getSetupDelay=function(){return 0},l.ui.WindowManager.prototype.getReadyDelay=function(){return this.modal?l.ui.theme.getDialogTransitionDuration():0},l.ui.WindowManager.prototype.getHoldDelay=function(){return 0},l.ui.WindowManager.prototype.getTeardownDelay=function(){return this.modal?l.ui.theme.getDialogTransitionDuration():0},l.ui.WindowManager.prototype.getWindow=function(t){var e=$.Deferred(),i=this.windows[t];return i instanceof l.ui.Window?e.resolve(i):this.factory?this.factory.lookup(t)?(i=this.factory.create(t),this.addWindows([i]),e.resolve(i)):e.reject(new l.ui.Error("Cannot auto-instantiate window: symbolic name is unrecognized by the factory")):e.reject(new l.ui.Error("Cannot get unmanaged window: symbolic name unrecognized as a managed window")),e.promise()},l.ui.WindowManager.prototype.getCurrentWindow=function(){return this.currentWindow},l.ui.WindowManager.prototype.openWindow=function(t,e,i,o){var n,s=this;return e=e||{},i=i||new l.ui.WindowInstance,o=o||$.Deferred(),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(function(t){i[t]=function(){return l.ui.warnDeprecation("Using the return value of openWindow as a promise is deprecated. Use .openWindow( ... ).opening."+t+"( ... ) instead."),o[t].apply(this,arguments)}}),"string"==typeof t?(this.getWindow(t).then(function(t){s.openWindow(t,e,i,o)},function(t){i.deferreds.opening.reject(t)}),i):(this.hasWindow(t)?this.lifecycle&&this.lifecycle.isOpened()?n="Cannot open window: another window is open":(this.preparingToOpen||this.lifecycle&&this.lifecycle.isOpening())&&(n="Cannot open window: another window is opening"):n="Cannot open window: window is not attached to manager",n?(o.reject(new l.ui.Error(n)),i.deferreds.opening.reject(new l.ui.Error(n))):(this.preparingToOpen=$.when(this.lifecycle&&this.lifecycle.closed),this.preparingToOpen.done(function(){s.modal&&(s.toggleGlobalEvents(!0),s.toggleAriaIsolation(!0)),s.$returnFocusTo=void 0!==e.$returnFocusTo?e.$returnFocusTo:$(document.activeElement),s.currentWindow=t,s.lifecycle=i,s.preparingToOpen=null,s.emit("opening",t,o,e),i.deferreds.opening.resolve(e),setTimeout(function(){s.compatOpened=$.Deferred(),t.setup(e).then(function(){o.notify({state:"setup"}),setTimeout(function(){t.ready(e).then(function(){o.notify({state:"ready"}),i.deferreds.opened.resolve(e),o.resolve(s.compatOpened.promise(),e)},function(){i.deferreds.opened.reject(),o.reject(),s.closeWindow(t)})},s.getReadyDelay())},function(){i.deferreds.opened.reject(),o.reject(),s.closeWindow(t)})},s.getSetupDelay())})),i)},l.ui.WindowManager.prototype.closeWindow=function(t,e){var i,o,n=this,s=$.Deferred(),r=this.lifecycle;return"string"==typeof t?t=this.windows[t]:this.hasWindow(t)||(t=null),r?t?t!==this.currentWindow||this.lifecycle.isClosed()?i="Cannot close window: window already closed with different data":(this.preparingToClose||this.lifecycle.isClosing())&&(i="Cannot close window: window already closing with different data"):i="Cannot close window: window is not attached to manager":i="Cannot close window: no window is currently open",i&&((r=new l.ui.WindowInstance).deferreds.opening.resolve({}),r.deferreds.opened.resolve({})),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(function(t){r[t]=function(){return l.ui.warnDeprecation("Using the return value of closeWindow as a promise is deprecated. Use .closeWindow( ... ).closed."+t+"( ... ) instead."),s[t].apply(this,arguments)}}),i?(s.reject(new l.ui.Error(i)),r.deferreds.closing.reject(new l.ui.Error(i))):(this.preparingToClose=$.when(this.lifecycle.opened),this.preparingToClose.always(function(){n.preparingToClose=null,n.emit("closing",t,s,e),r.deferreds.closing.resolve(e),o=n.compatOpened,n.compatOpened=null,o.resolve(s.promise(),e),setTimeout(function(){t.hold(e).then(function(){s.notify({state:"hold"}),setTimeout(function(){t.teardown(e).then(function(){s.notify({state:"teardown"}),n.modal&&(n.toggleGlobalEvents(!1),n.toggleAriaIsolation(!1)),n.$returnFocusTo&&n.$returnFocusTo.length&&n.$returnFocusTo[0].focus(),n.currentWindow=null,n.lifecycle=null,r.deferreds.closed.resolve(e),s.resolve(e)})},n.getTeardownDelay())})},n.getHoldDelay())})),r},l.ui.WindowManager.prototype.addWindows=function(t){var e,i,o,n,s;if(Array.isArray(t))for(s={},e=0,i=t.length;e<i;e++){if(!(n=t[e].constructor.static.name))throw new Error("Windows must have a `name` static property defined.");s[n]=t[e]}else l.isPlainObject(t)&&(s=t);for(n in s)o=s[n],this.windows[n]=o.toggle(!1),this.$element.append(o.$element),o.setManager(this)},l.ui.WindowManager.prototype.removeWindows=function(t){var e,i,o,n,s,r=this,a=[],c=function(t,e){delete r.windows[t],e.$element.detach()};for(e=0,i=t.length;e<i;e++){if(n=t[e],!(o=this.windows[n]))throw new Error("Cannot remove window");s=c.bind(null,n,o),a.push(this.closeWindow(n).closed.then(s,s))}return $.when.apply($,a)},l.ui.WindowManager.prototype.clearWindows=function(){return this.removeWindows(Object.keys(this.windows))},l.ui.WindowManager.prototype.updateWindowSize=function(t){var e;if(t===this.currentWindow)return e="full"===t.getSize(),this.$element.toggleClass("oo-ui-windowManager-fullscreen",e),this.$element.toggleClass("oo-ui-windowManager-floating",!e),t.setDimensions(t.getSizeProperties()),this.emit("resize",t),this},l.ui.WindowManager.prototype.toggleGlobalEvents=function(t){var e,i,o=$(this.getElementDocument().body),n=o.data("windowManagerGlobalEvents")||0;return(t=void 0===t?!!this.globalEvents:!!t)?this.globalEvents||($(this.getElementWindow()).on({"orientationchange resize":this.onWindowResizeHandler}),0===n&&(e=window.innerWidth-document.documentElement.clientWidth,i=parseFloat(o.css("margin-right"))||0,o.addClass("oo-ui-windowManager-modal-active"),o.css("margin-right",i+e)),n++,this.globalEvents=!0):this.globalEvents&&($(this.getElementWindow()).off({"orientationchange resize":this.onWindowResizeHandler}),0===--n&&(o.removeClass("oo-ui-windowManager-modal-active"),o.css("margin-right","")),this.globalEvents=!1),o.data("windowManagerGlobalEvents",n),this},l.ui.WindowManager.prototype.toggleAriaIsolation=function(t){var e;return(t=void 0===t?!this.$ariaHidden:!!t)?this.$ariaHidden||(e=0===(e=this.$element.parentsUntil("body").last()).length?this.$element:e,this.$element.removeAttr("aria-hidden"),this.$ariaHidden=$(document.body).children().not("script").not(e).attr("aria-hidden",!0)):this.$ariaHidden&&(this.$ariaHidden.removeAttr("aria-hidden"),this.$ariaHidden=null,this.$element.attr("aria-hidden",!0)),this},l.ui.WindowManager.prototype.destroy=function(){this.toggleGlobalEvents(!1),this.toggleAriaIsolation(!1),this.clearWindows(),this.$element.remove()},l.ui.Window=function(t){t=t||{},l.ui.Window.parent.call(this,t),l.EventEmitter.call(this),this.manager=null,this.size=t.size||this.constructor.static.size,this.$frame=$("<div>"),this.$overlay=$("<div>"),this.$content=$("<div>"),this.$focusTrapBefore=$("<div>").prop("tabIndex",0),this.$focusTrapAfter=$("<div>").prop("tabIndex",0),this.$focusTraps=this.$focusTrapBefore.add(this.$focusTrapAfter),this.$overlay.addClass("oo-ui-window-overlay"),this.$content.addClass("oo-ui-window-content").attr("tabindex",0),this.$frame.addClass("oo-ui-window-frame").append(this.$focusTrapBefore,this.$content,this.$focusTrapAfter),this.$element.addClass("oo-ui-window").append(this.$frame,this.$overlay),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},l.inheritClass(l.ui.Window,l.ui.Element),l.mixinClass(l.ui.Window,l.EventEmitter),l.ui.Window.static.size="medium",l.ui.Window.prototype.onMouseDown=function(t){if(t.target===this.$element[0])return!1},l.ui.Window.prototype.isInitialized=function(){return!!this.manager},l.ui.Window.prototype.isVisible=function(){return this.visible},l.ui.Window.prototype.isOpening=function(){return this.manager.isOpening(this)},l.ui.Window.prototype.isClosing=function(){return this.manager.isClosing(this)},l.ui.Window.prototype.isOpened=function(){return this.manager.isOpened(this)},l.ui.Window.prototype.getManager=function(){return this.manager},l.ui.Window.prototype.getSize=function(){var t=l.ui.Element.static.getDimensions(this.getElementWindow()),e=this.manager.constructor.static.sizes,i=this.size;return e[i]||(i=this.manager.constructor.static.defaultSize),"full"!==i&&t.rect.right-t.rect.left<e[i].width&&(i="full"),i},l.ui.Window.prototype.getSizeProperties=function(){return this.manager.constructor.static.sizes[this.getSize()]},l.ui.Window.prototype.withoutSizeTransitions=function(t){var e=this.$frame.css("transition-property")+" "+this.$frame.css("transition-duration")+" "+this.$frame.css("transition-timing-function")+" "+this.$frame.css("transition-delay");this.$frame.css("transition","none"),t(),this.$frame.height(),this.$frame.css("transition",e)},l.ui.Window.prototype.getContentHeight=function(){var i,o=this,n=this.$body[0].style,s=this.$frame[0].style;return this.withoutSizeTransitions(function(){var t=s.height,e=n.position;s.height="1px",n.position="relative",i=o.getBodyHeight(),s.height=t,n.position=e}),this.$frame.outerHeight()-this.$frame.innerHeight()+(this.$head.outerHeight(!0)+i+this.$foot.outerHeight(!0))},l.ui.Window.prototype.getBodyHeight=function(){return this.$body[0].scrollHeight},l.ui.Window.prototype.getDir=function(){return l.ui.Element.static.getDir(this.$content)||"ltr"},l.ui.Window.prototype.getSetupProcess=function(){return new l.ui.Process},l.ui.Window.prototype.getReadyProcess=function(){return new l.ui.Process},l.ui.Window.prototype.getHoldProcess=function(){return new l.ui.Process},l.ui.Window.prototype.getTeardownProcess=function(){return new l.ui.Process},l.ui.Window.prototype.setManager=function(t){if(this.manager)throw new Error("Cannot set window manager, window already has a manager");return this.manager=t,this.initialize(),this},l.ui.Window.prototype.setSize=function(t){return this.size=t,this.updateSize(),this},l.ui.Window.prototype.updateSize=function(){if(!this.manager)throw new Error("Cannot update window size, must be attached to a manager");return this.manager.updateWindowSize(this),this},l.ui.Window.prototype.setDimensions=function(e){var i,o=this,n=this.$frame[0].style;return void 0===e.height?this.withoutSizeTransitions(function(){var t=n.width;o.$frame.css("width",e.width||""),i=o.getContentHeight(),n.width=t}):i=e.height,this.$frame.css({width:e.width||"",minWidth:e.minWidth||"",maxWidth:e.maxWidth||"",height:i||"",minHeight:e.minHeight||"",maxHeight:e.maxHeight||""}),this},l.ui.Window.prototype.initialize=function(){if(!this.manager)throw new Error("Cannot initialize window, must be attached to a manager");return this.$head=$("<div>"),this.$body=$("<div>"),this.$foot=$("<div>"),this.$document=$(this.getElementDocument()),this.$element.on("mousedown",this.onMouseDown.bind(this)),this.$head.addClass("oo-ui-window-head"),this.$body.addClass("oo-ui-window-body"),this.$foot.addClass("oo-ui-window-foot"),this.$content.append(this.$head,this.$body,this.$foot),this},l.ui.Window.prototype.onFocusTrapFocused=function(t){var e=this.$focusTrapBefore.is(t.target),i=l.ui.findFocusable(this.$content,e);i?i.focus():this.$content.trigger("focus")},l.ui.Window.prototype.open=function(t){if(!this.manager)throw new Error("Cannot open window, must be attached to a manager");return this.manager.openWindow(this,t)},l.ui.Window.prototype.close=function(t){if(!this.manager)throw new Error("Cannot close window, must be attached to a manager");return this.manager.closeWindow(this,t)},l.ui.Window.prototype.setup=function(t){var e=this;return this.toggle(!0),this.focusTrapHandler=l.ui.bind(this.onFocusTrapFocused,this),this.$focusTraps.on("focus",this.focusTrapHandler),this.getSetupProcess(t).execute().then(function(){e.updateSize(),e.$element.addClass("oo-ui-window-active oo-ui-window-setup").width(),e.$content.addClass("oo-ui-window-content-setup").width()})},l.ui.Window.prototype.ready=function(t){var e=this;return this.$content.trigger("focus"),this.getReadyProcess(t).execute().then(function(){e.$element.addClass("oo-ui-window-ready").width(),e.$content.addClass("oo-ui-window-content-ready").width()})},l.ui.Window.prototype.hold=function(t){var e=this;return this.getHoldProcess(t).execute().then(function(){var t=e.$content.find(l.ui.Element.static.getDocument(e.$content).activeElement);t.length&&t[0].blur(),e.$element.removeClass("oo-ui-window-ready oo-ui-window-setup").width(),e.$content.removeClass("oo-ui-window-content-ready oo-ui-window-content-setup").width()})},l.ui.Window.prototype.teardown=function(t){var e=this;return this.getTeardownProcess(t).execute().then(function(){e.$element.removeClass("oo-ui-window-active").width(),e.$focusTraps.off("focus",e.focusTrapHandler),e.toggle(!1)})},l.ui.Dialog=function(t){l.ui.Dialog.parent.call(this,t),l.ui.mixin.PendingElement.call(this),this.actions=new l.ui.ActionSet,this.attachedActions=[],this.currentAction=null,this.onDialogKeyDownHandler=this.onDialogKeyDown.bind(this),this.actions.connect(this,{click:"onActionClick",change:"onActionsChange"}),this.$element.addClass("oo-ui-dialog").attr("role","dialog")},l.inheritClass(l.ui.Dialog,l.ui.Window),l.mixinClass(l.ui.Dialog,l.ui.mixin.PendingElement),l.ui.Dialog.static.name="",l.ui.Dialog.static.title="",l.ui.Dialog.static.actions=[],l.ui.Dialog.static.escapable=!0,l.ui.Dialog.prototype.onDialogKeyDown=function(t){var e;t.which===l.ui.Keys.ESCAPE&&this.constructor.static.escapable?(this.executeAction(""),t.preventDefault(),t.stopPropagation()):t.which===l.ui.Keys.ENTER&&(t.ctrlKey||t.metaKey)&&0<(e=this.actions.get({flags:"primary",visible:!0,disabled:!1})).length&&(this.executeAction(e[0].getAction()),t.preventDefault(),t.stopPropagation())},l.ui.Dialog.prototype.onActionClick=function(t){this.isPending()||this.executeAction(t.getAction())},l.ui.Dialog.prototype.onActionsChange=function(){this.detachActions(),this.isClosing()||(this.attachActions(),this.isOpening()||this.updateSize())},l.ui.Dialog.prototype.getActions=function(){return this.actions},l.ui.Dialog.prototype.getActionProcess=function(t){return(new l.ui.Process).next(function(){t||this.close()},this)},l.ui.Dialog.prototype.getSetupProcess=function(o){return o=o||{},l.ui.Dialog.parent.prototype.getSetupProcess.call(this,o).next(function(){var t=this.constructor.static,e=void 0!==o.actions?o.actions:t.actions,i=void 0!==o.title?o.title:t.title;this.title.setLabel(i).setTitle(i),this.actions.add(this.getActionWidgets(e)),this.$element.on("keydown",this.onDialogKeyDownHandler)},this)},l.ui.Dialog.prototype.getTeardownProcess=function(t){return l.ui.Dialog.parent.prototype.getTeardownProcess.call(this,t).first(function(){this.$element.off("keydown",this.onDialogKeyDownHandler),this.actions.clear(),this.currentAction=null},this)},l.ui.Dialog.prototype.initialize=function(){l.ui.Dialog.parent.prototype.initialize.call(this),this.title=new l.ui.LabelWidget,this.$content.addClass("oo-ui-dialog-content"),this.$element.attr("aria-labelledby",this.title.getElementId()),this.setPendingElement(this.$head)},l.ui.Dialog.prototype.getActionWidgets=function(t){var e,i,o=[];for(e=0,i=t.length;e<i;e++)o.push(this.getActionWidget(t[e]));return o},l.ui.Dialog.prototype.getActionWidget=function(t){return new l.ui.ActionWidget(this.getActionWidgetConfig(t))},l.ui.Dialog.prototype.getActionWidgetConfig=function(t){return t},l.ui.Dialog.prototype.attachActions=function(){this.attachedActions=this.actions.get()},l.ui.Dialog.prototype.detachActions=function(){var t,e;for(t=0,e=this.attachedActions.length;t<e;t++)this.attachedActions[t].$element.detach();return this.attachedActions=[],this},l.ui.Dialog.prototype.executeAction=function(t){return this.pushPending(),this.currentAction=t,this.getActionProcess(t).execute().always(this.popPending.bind(this))},l.ui.MessageDialog=function(t){l.ui.MessageDialog.parent.call(this,t),this.verticalActionLayout=null,this.$element.addClass("oo-ui-messageDialog")},l.inheritClass(l.ui.MessageDialog,l.ui.Dialog),l.ui.MessageDialog.static.name="message",l.ui.MessageDialog.static.size="small",l.ui.MessageDialog.static.title=null,l.ui.MessageDialog.static.message=null,l.ui.MessageDialog.static.actions=[{action:"accept",label:l.ui.deferMsg("ooui-dialog-message-accept"),flags:"primary"},{action:"reject",label:l.ui.deferMsg("ooui-dialog-message-reject"),flags:"safe"}],l.ui.MessageDialog.prototype.toggleVerticalActionLayout=function(t){return(t=void 0===t?!this.verticalActionLayout:!!t)!==this.verticalActionLayout&&(this.verticalActionLayout=t,this.$actions.toggleClass("oo-ui-messageDialog-actions-vertical",t).toggleClass("oo-ui-messageDialog-actions-horizontal",!t)),this},l.ui.MessageDialog.prototype.getActionProcess=function(t){return t?new l.ui.Process(function(){this.close({action:t})},this):l.ui.MessageDialog.parent.prototype.getActionProcess.call(this,t)},l.ui.MessageDialog.prototype.getSetupProcess=function(t){return t=t||{},l.ui.MessageDialog.parent.prototype.getSetupProcess.call(this,t).next(function(){this.title.setLabel(void 0!==t.title?t.title:this.constructor.static.title),this.message.setLabel(void 0!==t.message?t.message:this.constructor.static.message),this.size=void 0!==t.size?t.size:this.constructor.static.size},this)},l.ui.MessageDialog.prototype.getReadyProcess=function(t){return t=t||{},l.ui.MessageDialog.parent.prototype.getReadyProcess.call(this,t).next(function(){var t=this.actions.get();0<(t=t.filter(function(t){return-1<t.getFlags().indexOf("primary")})).length&&t[0].focus()},this)},l.ui.MessageDialog.prototype.getBodyHeight=function(){var t,e,i=this.container.$element;return e=i[0].style.overflow,i[0].style.overflow="hidden",l.ui.Element.static.reconsiderScrollbars(i[0]),t=this.text.$element.outerHeight(!0),i[0].style.overflow=e,t},l.ui.MessageDialog.prototype.setDimensions=function(t){var e=this,i=this.container.$element;return l.ui.MessageDialog.parent.prototype.setDimensions.call(this,t),setTimeout(function(){var t=i[0].style.overflow,e=document.activeElement;i[0].style.overflow="hidden",l.ui.Element.static.reconsiderScrollbars(i[0]),e&&e!==document.activeElement&&e.focus&&e.focus(),i[0].style.overflow=t},300),e.fitActions(),setTimeout(function(){e.fitActions()},300),this},l.ui.MessageDialog.prototype.initialize=function(){l.ui.MessageDialog.parent.prototype.initialize.call(this),this.$actions=$("<div>"),this.container=new l.ui.PanelLayout({scrollable:!0,classes:["oo-ui-messageDialog-container"]}),this.text=new l.ui.PanelLayout({padded:!0,expanded:!1,classes:["oo-ui-messageDialog-text"]}),this.message=new l.ui.LabelWidget({classes:["oo-ui-messageDialog-message"]}),this.title.$element.addClass("oo-ui-messageDialog-title"),this.$content.addClass("oo-ui-messageDialog-content"),this.container.$element.append(this.text.$element),this.text.$element.append(this.title.$element,this.message.$element),this.$body.append(this.container.$element),this.$actions.addClass("oo-ui-messageDialog-actions"),this.$foot.append(this.$actions)},l.ui.MessageDialog.prototype.getActionWidgetConfig=function(t){return $.extend({},t,{framed:!1})},l.ui.MessageDialog.prototype.attachActions=function(){var t,e,i,o;for(l.ui.MessageDialog.parent.prototype.attachActions.call(this),i=this.actions.getSpecial(),o=this.actions.getOthers(),i.safe&&(this.$actions.append(i.safe.$element),i.safe.toggleFramed(!0)),t=0,e=o.length;t<e;t++)this.$actions.append(o[t].$element),o[t].toggleFramed(!0);i.primary&&(this.$actions.append(i.primary.$element),i.primary.toggleFramed(!0))},l.ui.MessageDialog.prototype.fitActions=function(){var t,e,i,o=this.verticalActionLayout,n=this.actions.get();for(this.toggleVerticalActionLayout(!1),t=0,e=n.length;t<e;t++)if((i=n[t]).$element[0].scrollWidth>i.$element[0].clientWidth){this.toggleVerticalActionLayout(!0);break}this.$body.css("bottom",this.$foot.outerHeight(!0)),this.verticalActionLayout!==o&&this.updateSize()},l.ui.ProcessDialog=function(t){l.ui.ProcessDialog.parent.call(this,t),this.fitOnOpen=!1,this.$element.addClass("oo-ui-processDialog")},l.inheritClass(l.ui.ProcessDialog,l.ui.Dialog),l.ui.ProcessDialog.prototype.onDismissErrorButtonClick=function(){this.hideErrors()},l.ui.ProcessDialog.prototype.onRetryButtonClick=function(){this.hideErrors(),this.executeAction(this.currentAction)},l.ui.ProcessDialog.prototype.initialize=function(){l.ui.ProcessDialog.parent.prototype.initialize.call(this),this.$navigation=$("<div>"),this.$location=$("<div>"),this.$safeActions=$("<div>"),this.$primaryActions=$("<div>"),this.$otherActions=$("<div>"),this.dismissButton=new l.ui.ButtonWidget({label:l.ui.msg("ooui-dialog-process-dismiss")}),this.retryButton=new l.ui.ButtonWidget,this.$errors=$("<div>"),this.$errorsTitle=$("<div>"),this.dismissButton.connect(this,{click:"onDismissErrorButtonClick"}),this.retryButton.connect(this,{click:"onRetryButtonClick"}),this.title.connect(this,{labelChange:"fitLabel"}),this.title.$element.addClass("oo-ui-processDialog-title"),this.$location.append(this.title.$element).addClass("oo-ui-processDialog-location"),this.$safeActions.addClass("oo-ui-processDialog-actions-safe"),this.$primaryActions.addClass("oo-ui-processDialog-actions-primary"),this.$otherActions.addClass("oo-ui-processDialog-actions-other"),this.$errorsTitle.addClass("oo-ui-processDialog-errors-title").text(l.ui.msg("ooui-dialog-process-error")),this.$errors.addClass("oo-ui-processDialog-errors oo-ui-element-hidden").append(this.$errorsTitle,this.dismissButton.$element,this.retryButton.$element),this.$content.addClass("oo-ui-processDialog-content").append(this.$errors),this.$navigation.addClass("oo-ui-processDialog-navigation").append(this.$primaryActions,this.$location,this.$safeActions),this.$head.append(this.$navigation),this.$foot.append(this.$otherActions)},l.ui.ProcessDialog.prototype.getActionWidgetConfig=function(t){var e=l.ui.isMobile();return t=$.extend({framed:!e},t),e&&("back"===t.flags||Array.isArray(t.flags)&&-1!==t.flags.indexOf("back"))&&$.extend(t,{icon:"previous",label:""}),t},l.ui.ProcessDialog.prototype.attachActions=function(){var t,e,i,o,n;for(l.ui.ProcessDialog.parent.prototype.attachActions.call(this),o=this.actions.getSpecial(),n=this.actions.getOthers(),o.primary&&this.$primaryActions.append(o.primary.$element),t=0,e=n.length;t<e;t++)i=n[t],this.$otherActions.append(i.$element);o.safe&&this.$safeActions.append(o.safe.$element)},l.ui.ProcessDialog.prototype.executeAction=function(t){var e=this;return l.ui.ProcessDialog.parent.prototype.executeAction.call(this,t).fail(function(t){e.showErrors(t||[])})},l.ui.ProcessDialog.prototype.setDimensions=function(){var t=this;l.ui.ProcessDialog.parent.prototype.setDimensions.apply(this,arguments),this.fitLabel(),t.$body.css("bottom",t.$foot.outerHeight(!0)),setTimeout(function(){t.$body.css("bottom",t.$foot.outerHeight(!0))},300)},l.ui.ProcessDialog.prototype.fitLabel=function(){var t,e,i,o,n,s,r=this.getSizeProperties();if("number"!=typeof r.width){if(!this.isOpened())return this.isOpening()?void(this.fitOnOpen||(this.manager.lifecycle.opened.done(this.fitLabel.bind(this)),this.fitOnOpen=!0)):void 0;o=this.$head.width()-20}else o=r.width-20;return t=this.$safeActions.is(":visible")?this.$safeActions.width():0,e=this.$primaryActions.is(":visible")?this.$primaryActions.width():0,2*(i=Math.max(t,e))+this.title.$element.width()<o?n=s=i:s="ltr"===this.getDir()?(n=t,e):(n=e,t),this.$location.css({paddingLeft:n,paddingRight:s}),this},l.ui.ProcessDialog.prototype.showErrors=function(t){var e,i,o,n,s=[],r={},a=!0,c=!1;for(t instanceof l.ui.Error&&(t=[t]),e=0,i=t.length;e<i;e++)t[e].isRecoverable()||(a=!1),t[e].isWarning()&&(c=!0),o=$("<div>").addClass("oo-ui-processDialog-error").append(t[e].getMessage()),s.push(o[0]);this.$errorItems=$(s),a?(r[this.currentAction]=!0,(n=this.actions.get({actions:this.currentAction})).length&&this.retryButton.clearFlags().setFlags(n[0].getFlags())):(r[this.currentAction]=!1,this.actions.setAbilities(r)),c?this.retryButton.setLabel(l.ui.msg("ooui-dialog-process-continue")):this.retryButton.setLabel(l.ui.msg("ooui-dialog-process-retry")),this.retryButton.toggle(a),this.$errorsTitle.after(this.$errorItems),this.$errors.removeClass("oo-ui-element-hidden").scrollTop(0)},l.ui.ProcessDialog.prototype.hideErrors=function(){this.$errors.addClass("oo-ui-element-hidden"),this.$errorItems&&(this.$errorItems.remove(),this.$errorItems=null)},l.ui.ProcessDialog.prototype.getTeardownProcess=function(t){return l.ui.ProcessDialog.parent.prototype.getTeardownProcess.call(this,t).first(function(){this.hideErrors(),this.fitOnOpen=!1},this)},l.ui.getWindowManager=function(){return l.ui.windowManager||(l.ui.windowManager=new l.ui.WindowManager,$(document.body).append(l.ui.windowManager.$element),l.ui.windowManager.addWindows([new l.ui.MessageDialog])),l.ui.windowManager},l.ui.alert=function(t,e){return l.ui.getWindowManager().openWindow("message",$.extend({message:t,actions:[l.ui.MessageDialog.static.actions[0]]},e)).closed.then(function(){})},l.ui.confirm=function(t,e){return l.ui.getWindowManager().openWindow("message",$.extend({message:t},e)).closed.then(function(t){return!(!t||"accept"!==t.action)})},l.ui.prompt=function(t,e){var i,o=l.ui.getWindowManager(),n=new l.ui.TextInputWidget(e&&e.textInput||{}),s=new l.ui.FieldLayout(n,{align:"top",label:t});return(i=o.openWindow("message",$.extend({message:s.$element},e))).opened.then(function(){n.on("enter",function(){o.getCurrentWindow().close({action:"accept"})}),n.focus()}),i.closed.then(function(t){return t&&"accept"===t.action?n.getValue():null})}}(OO);
//# sourceMappingURL=oojs-ui-windows.min.js.map