/*!
 * pts.js (minified es6) - Copyright Â© 2017-2018 William Ngan and contributors.
 * Licensed under Apache 2.0 License.
 * See https://github.com/williamngan/pts for details.
 */
(function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports.Pts=t():e.Pts=t()})(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=0)}([function(e,t){(function(t,n){e.exports=n()})(this,function(){var e=Math.pow,n=Math.sqrt,o=Math.PI,t=Number.MIN_VALUE,i=Number.MAX_VALUE,l=Math.floor,r=Math.atan2,u=Math.max,a=Math.sin,s=Math.cos,_=Math.min,d=Math.abs;return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=15)}([function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(1),c=n(3),i=n(4);t.PtBaseArray=Float32Array;class h extends t.PtBaseArray{constructor(...e){1===e.length&&'number'==typeof e[0]?super(e[0]):super(0<e.length?o.Util.getArgs(e):[0,0])}static make(e,n=0,o=!1){let r=new t.PtBaseArray(e);if(n&&r.fill(n),o)for(let e=0,t=r.length;e<t;e++)r[e]*=Math.random();return new h(r)}get id(){return this._id}set id(e){this._id=e}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set w(e){this[3]=e}clone(){return new h(this)}equals(e,t=1e-6){for(let n=0,o=this.length;n<o;n++)if(d(this[n]-e[n])>t)return!1;return!0}to(...e){let t=o.Util.getArgs(e);for(let n=0,o=_(this.length,t.length);n<o;n++)this[n]=t[n];return this}$to(...e){return this.clone().to(...e)}toAngle(e,t,n=!1){let o=t==void 0?this.magnitude():t,i=[s(e)*o,a(e)*o];return n?this.add(i):this.to(i)}op(e){let t=this;return(...n)=>e(t,...n)}ops(e){let t=[];for(let n=0,o=e.length;n<o;n++)t.push(this.op(e[n]));return t}$take(e){let t=[];for(let n=0,o=e.length;n<o;n++)t.push(this[e[n]]||0);return new h(t)}$concat(...e){return new h(this.toArray().concat(o.Util.getArgs(e)))}add(...e){return 1===e.length&&'number'==typeof e[0]?i.Vec.add(this,e[0]):i.Vec.add(this,o.Util.getArgs(e)),this}$add(...e){return this.clone().add(...e)}subtract(...e){return 1===e.length&&'number'==typeof e[0]?i.Vec.subtract(this,e[0]):i.Vec.subtract(this,o.Util.getArgs(e)),this}$subtract(...e){return this.clone().subtract(...e)}multiply(...e){return 1===e.length&&'number'==typeof e[0]?i.Vec.multiply(this,e[0]):i.Vec.multiply(this,o.Util.getArgs(e)),this}$multiply(...e){return this.clone().multiply(...e)}divide(...e){return 1===e.length&&'number'==typeof e[0]?i.Vec.divide(this,e[0]):i.Vec.divide(this,o.Util.getArgs(e)),this}$divide(...e){return this.clone().divide(...e)}magnitudeSq(){return i.Vec.dot(this,this)}magnitude(){return i.Vec.magnitude(this)}unit(e=void 0){return i.Vec.unit(this,e),this}$unit(e=void 0){return this.clone().unit(e)}dot(...e){return i.Vec.dot(this,o.Util.getArgs(e))}cross2D(...e){return i.Vec.cross2D(this,o.Util.getArgs(e))}$cross(...e){return i.Vec.cross(this,o.Util.getArgs(e))}$project(e){let t=e.magnitude(),n=this.$unit(),o=e.$divide(t),i=n.dot(o);return n.multiply(t*i)}abs(){return i.Vec.abs(this),this}$abs(){return this.clone().abs()}floor(){return i.Vec.floor(this),this}$floor(){return this.clone().floor()}ceil(){return i.Vec.ceil(this),this}$ceil(){return this.clone().ceil()}round(){return i.Vec.round(this),this}$round(){return this.clone().round()}minValue(){return i.Vec.min(this)}maxValue(){return i.Vec.max(this)}$min(...e){let t=o.Util.getArgs(e),n=this.clone();for(let o=0,i=_(this.length,t.length);o<i;o++)n[o]=_(this[o],t[o]);return n}$max(...e){let t=o.Util.getArgs(e),n=this.clone();for(let o=0,i=_(this.length,t.length);o<i;o++)n[o]=u(this[o],t[o]);return n}angle(e=o.Const.xy){return r(this[e[1]],this[e[0]])}angleBetween(e,t=o.Const.xy){return c.Geom.boundRadian(this.angle(t))-c.Geom.boundRadian(e.angle(t))}scale(e,t){return c.Geom.scale(this,e,t||h.make(this.length,0)),this}rotate2D(e,t,n){return c.Geom.rotate2D(this,e,t||h.make(this.length,0),n),this}shear2D(e,t,n){return c.Geom.shear2D(this,e,t||h.make(this.length,0),n),this}reflect2D(e,t){return c.Geom.reflect2D(this,e,t),this}toString(){return`Pt(${this.join(', ')})`}toArray(){return[].slice.call(this)}}t.Pt=h;class p extends Array{constructor(...e){super(...e)}get id(){return this._id}set id(e){this._id=e}get p1(){return this[0]}get p2(){return this[1]}get p3(){return this[2]}get p4(){return this[3]}get q1(){return this[this.length-1]}get q2(){return this[this.length-2]}get q3(){return this[this.length-3]}get q4(){return this[this.length-4]}clone(){let e=new p;for(let t=0,n=this.length;t<n;t++)e.push(this[t].clone());return e}static fromArray(e){let t=new p;for(let n,o=0,i=e.length;o<i;o++)n=e[o]instanceof h?e[o]:new h(e[o]),t.push(n);return t}static fromPtArray(e){return p.from(e)}split(e,t,n=!1){let i=o.Util.split(this,e,t,n);return i}insert(e,t=0){return p.prototype.splice.apply(this,[t,0,...e]),this}remove(e=0,t=1){let n=0>e?[-1*e-1,t]:[e,t];return p.prototype.splice.apply(this,n)}segments(e=2,t=1,n=!1){return this.split(e,t,n)}lines(){return this.segments(2,1)}centroid(){return c.Geom.centroid(this)}boundingBox(){return c.Geom.boundingBox(this)}anchorTo(e=0){c.Geom.anchor(this,e,'to')}anchorFrom(e=0){c.Geom.anchor(this,e,'from')}op(e){let t=this;return(...n)=>e(t,...n)}ops(e){let t=[];for(let n=0,o=e.length;n<o;n++)t.push(this.op(e[n]));return t}interpolate(e){e=c.Num.clamp(e,0,1);let t=this.length-1,n=1/(this.length-1),o=l(e/n);return c.Geom.interpolate(this[o],this[_(this.length-1,o+1)],(e-o*n)*t)}moveBy(...e){return this.add(...e)}moveTo(...e){let t=new h(o.Util.getArgs(e)).subtract(this[0]);return this.moveBy(t),this}scale(e,t){for(let n=0,o=this.length;n<o;n++)c.Geom.scale(this[n],e,t||this[0]);return this}rotate2D(e,t,n){for(let o=0,i=this.length;o<i;o++)c.Geom.rotate2D(this[o],e,t||this[0],n);return this}shear2D(e,t,n){for(let o=0,i=this.length;o<i;o++)c.Geom.shear2D(this[o],e,t||this[0],n);return this}reflect2D(e,t){for(let n=0,o=this.length;n<o;n++)c.Geom.reflect2D(this[n],e,t);return this}sortByDimension(e,t=!1){return this.sort((n,o)=>t?o[e]-n[e]:n[e]-o[e])}forEachPt(e,...t){if(!this[0][e])return o.Util.warn(`${e} is not a function of Pt`),this;for(let n=0,o=this.length;n<o;n++)this[n]=this[n][e](...t);return this}add(...e){return this.forEachPt('add',...e)}subtract(...e){return this.forEachPt('subtract',...e)}multiply(...e){return this.forEachPt('multiply',...e)}divide(...e){return this.forEachPt('divide',...e)}$matrixAdd(e){return i.Mat.add(this,e)}$matrixMultiply(e,t=!1,n=!1){return i.Mat.multiply(this,e,t,n)}zipSlice(e,t=!1){return i.Mat.zipSlice(this,e,t)}$zip(e=void 0,t=!1){return i.Mat.zip(this,e,t)}toString(){return'Group[ '+this.reduce((e,t)=>e+t.toString()+' ','')+' ]'}}t.Group=p},function(e,n,r){'use strict';Object.defineProperty(n,'__esModule',{value:!0});const a=r(0);n.Const={xy:'xy',yz:'yz',xz:'xz',xyz:'xyz',horizontal:0,vertical:1,identical:0,right:4,bottom_right:5,bottom:6,bottom_left:7,left:8,top_left:1,top:2,top_right:3,epsilon:1e-4,max:i,min:t,pi:o,two_pi:6.283185307179586,half_pi:1.5707963267948966,quarter_pi:.7853981633974483,one_degree:.017453292519943295,rad_to_deg:57.29577951308232,deg_to_rad:.017453292519943295,gravity:9.81,newton:.10197,gaussian:.3989422804014327};class s{static getArgs(e){if(1>e.length)return[];let t=[],n=Array.isArray(e[0])||ArrayBuffer.isView(e[0]);if('number'==typeof e[0])t=Array.prototype.slice.call(e);else if('object'==typeof e[0]&&!n){let n=['x','y','z','w'],o=e[0];for(let e=0;e<n.length&&!(o.length&&e>=o.length||!(n[e]in o));e++)t.push(o[n[e]])}else n&&(t=[].slice.call(e[0]));return t}static warn(e='error',t=void 0){if('error'==s.warnLevel)throw new Error(e);else'warn'==s.warnLevel&&console.warn(e);return t}static randomInt(e,t=0){return l(Math.random()*e)+t}static split(e,t,n,o=!1){let r=n||t,l=[];for(let a=0;a<e.length;a++)if(!(a*r+t>e.length))l.push(e.slice(a*r,a*r+t));else if(o){let n=e.slice(a*r);n=n.concat(e.slice(0,(a*r+t)%t)),l.push(n)}else break;return l}static flatten(e,t=!0){let n=t?new a.Group:[];return n.concat.apply(n,e)}static combine(e,t,n){let o=[];for(let r=0,i=e.length;r<i;r++)for(let i=0,l=t.length;i<l;i++)o.push(n(e[r],t[i]));return o}static zip(...e){let t=[];for(let n,o=0,i=e[0].length;o<i;o++){n=[];for(let t=0;t<e.length;t++)n.push(e[t][o]);t.push(n)}return t}static stepper(e,t=0,n=1,o){let i=t;return function(){return i+=n,i>=e&&(i=t+(i-e)),o&&o(i),i}}static forRange(e,t,n=0,o=1){let r=[];for(let l=n;l<t;l+=o)r[l]=e(l);return r}}s.warnLevel='default',n.Util=s},function(e,t,r){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const l=r(1),c=r(3),s=r(0),a=r(4);let h=(e,t='expected')=>l.Util.warn('Group\'s length is less than '+t,e),p=(e,t='')=>l.Util.warn(`Index ${t} is out of bound in Group`,e);class f{static fromAngle(e,t,n){let o=new s.Group(new s.Pt(e),new s.Pt(e));return o[1].toAngle(t,n,!0),o}static slope(e,t){return 0==t[0]-e[0]?void 0:(t[1]-e[1])/(t[0]-e[0])}static intercept(e,t){if(0==t[0]-e[0])return;else{let n=(t[1]-e[1])/(t[0]-e[0]),o=e[1]-n*e[0];return{slope:n,yi:o,xi:0==n?void 0:-o/n}}}static sideOfPt2D(e,t){return(e[1][0]-e[0][0])*(t[1]-e[0][1])-(t[0]-e[0][0])*(e[1][1]-e[0][1])}static collinear(e,t,n,o=.01){let i=new s.Pt(0,0,0).to(e).$subtract(t),r=new s.Pt(0,0,0).to(e).$subtract(n);return i.$cross(r).divide(1e3).equals(new s.Pt(0,0,0),o)}static magnitude(e){return 2<=e.length?e[1].$subtract(e[0]).magnitude():0}static magnitudeSq(e){return 2<=e.length?e[1].$subtract(e[0]).magnitudeSq():0}static perpendicularFromPt(e,t,n=!1){if(!e[0].equals(e[1])){let o=e[0].$subtract(e[1]),i=e[1].$subtract(t),r=i.$subtract(o.$project(i));return n?r:r.$add(t)}}static distanceFromPt(e,t){return f.perpendicularFromPt(e,t,!0).magnitude()}static intersectRay2D(e,t){let n=f.intercept(e[0],e[1]),o=f.intercept(t[0],t[1]),i=e[0],r=t[0];if(n==void 0){if(o==void 0)return;let e=-o.slope*(r[0]-i[0])+r[1];return new s.Pt(i[0],e)}if(void 0==o){let e=-n.slope*(i[0]-r[0])+i[1];return new s.Pt(r[0],e)}if(o.slope!=n.slope){let e=(n.slope*i[0]-o.slope*r[0]+r[1]-i[1])/(n.slope-o.slope),t=n.slope*(e-i[0])+i[1];return new s.Pt(e,t)}return n.yi==o.yi?new s.Pt(i[0],i[1]):void 0}static intersectLine2D(e,t){let n=f.intersectRay2D(e,t);return n&&c.Geom.withinBound(n,e[0],e[1])&&c.Geom.withinBound(n,t[0],t[1])?n:void 0}static intersectLineWithRay2D(e,t){let n=f.intersectRay2D(e,t);return n&&c.Geom.withinBound(n,e[0],e[1])?n:void 0}static intersectPolygon2D(e,t,n=!1){let o=n?f.intersectLineWithRay2D:f.intersectLine2D,r=new s.Group;for(let l,a=0,i=t.length;a<i;a++)l=o(t[a],e),l&&r.push(l);return 0<r.length?r:void 0}static intersectGridWithRay2D(e,n){let o=f.intercept(new s.Pt(e[0]).subtract(n),new s.Pt(e[1]).subtract(n)),t=new s.Group;return o&&o.xi&&t.push(new s.Pt(n[0]+o.xi,n[1])),o&&o.yi&&t.push(new s.Pt(n[0],n[1]+o.yi)),t}static intersectGridWithLine2D(e,t){let n=f.intersectGridWithRay2D(e,t),o=new s.Group;for(let r=0,i=n.length;r<i;r++)c.Geom.withinBound(n[r],e[0],e[1])&&o.push(n[r]);return o}static intersectRect2D(e,t){return y.intersectRect2D(f.toRect(e),t)}static subpoints(e,t){let n=new s.Group;for(let o=1;o<=t;o++)n.push(c.Geom.interpolate(e[0],e[1],o/(t+1)));return n}static crop(e,t,n=0,o=!0){let i=0===n?1:0,r=e[i].$subtract(e[n]);if(0===r[0]||0===t[0])return e[n];if(o){let o=r.unit().multiply(t[1]);return e[n].$add(o)}else{let o=y.fromCenter(e[n],t),i=y.sides(o),l=0;return l=d(r[1]/r[0])>d(t[1]/t[0])?0>r[1]?0:2:0>r[0]?3:1,f.intersectRay2D(i[l],e)}}static marker(e,n,o='arrow',i=!0){let r=i?0:1,l=i?1:0,t=e[r].$subtract(e[l]);if(0===t.magnitudeSq())return new s.Group;t.unit();let a=c.Geom.perpendicular(t).multiply(n[0]).add(e[l]);return'arrow'==o?(a.add(t.$multiply(n[1])),new s.Group(e[l],a[0],a[1])):new s.Group(a[0],a[1])}static toRect(e){return new s.Group(e[0].$min(e[1]),e[0].$max(e[1]))}}t.Line=f;class y{static from(e,t,n){return y.fromTopLeft(e,t,n)}static fromTopLeft(e,t,n){let o='number'==typeof t?[t,n||t]:t;return new s.Group(new s.Pt(e),new s.Pt(e).add(o))}static fromCenter(e,t,n){let o='number'==typeof t?[t/2,(n||t)/2]:new s.Pt(t).divide(2);return new s.Group(new s.Pt(e).subtract(o),new s.Pt(e).add(o))}static toCircle(e){return m.fromRect(e)}static toSquare(e,t=!1){let n=y.size(e),o=t?n.maxValue().value:n.minValue().value;return y.fromCenter(y.center(e),o,o)}static size(e){return e[0].$max(e[1]).subtract(e[0].$min(e[1]))}static center(e){let t=e[0].$min(e[1]),n=e[0].$max(e[1]);return t.add(n.$subtract(t).divide(2))}static corners(e){let t=e[0].$min(e[1]),n=e[0].$max(e[1]);return new s.Group(t,new s.Pt(n.x,t.y),n,new s.Pt(t.x,n.y))}static sides(e){let[t,n,o,i]=y.corners(e);return[new s.Group(t,n),new s.Group(n,o),new s.Group(o,i),new s.Group(i,t)]}static lines(e){return y.sides(e)}static boundingBox(e){let t=l.Util.flatten(e,!1),n=s.Pt.make(2,Number.MAX_VALUE),o=s.Pt.make(2,Number.MIN_VALUE);for(let r=0,i=t.length;r<i;r++)for(let e=0;2>e;e++)n[e]=_(n[e],t[r][e]),o[e]=u(o[e],t[r][e]);return new s.Group(n,o)}static polygon(e){return y.corners(e)}static quadrants(e,t){let n=y.corners(e),o=t==void 0?y.center(e):new s.Pt(t);return n.map((e)=>new s.Group(e,o).boundingBox())}static halves(e,t=.5,n=!1){let o=e[0].$min(e[1]),i=e[0].$max(e[1]),r=n?c.Num.lerp(o[1],i[1],t):c.Num.lerp(o[0],i[0],t);return n?[new s.Group(o,new s.Pt(i[0],r)),new s.Group(new s.Pt(o[0],r),i)]:[new s.Group(o,new s.Pt(r,i[1])),new s.Group(new s.Pt(r,o[1]),i)]}static withinBound(e,t){return c.Geom.withinBound(t,e[0],e[1])}static hasIntersectRect2D(e,t){let n=y.corners(e);for(let o=0,i=n.length;o<i;o++)if(c.Geom.withinBound(n[o],t[0],t[1]))return!0;return!1}static intersectRect2D(e,t){return l.Util.flatten(x.intersect2D(y.sides(e),y.sides(t)))}}t.Rectangle=y;class m{static fromRect(e,t=!1){let o=0,i=o=y.size(e).minValue().value/2;if(t){let t=y.size(e).maxValue().value/2;o=n(i*i+t*t)}else o=i;return new s.Group(y.center(e),new s.Pt(o,o))}static fromCenter(e,t){return new s.Group(new s.Pt(e),new s.Pt(t,t))}static withinBound(e,t,n=0){let o=e[0].$subtract(t);return o.dot(o)+n<e[1].x*e[1].x}static intersectRay2D(e,t){let o=t[0].$subtract(t[1]),i=e[0].$subtract(t[0]),r=o.dot(o),l=i.dot(o),a=i.dot(i)-e[1].x*e[1].x,d=l/r,c=d*d-a/r;if(0>c)return new s.Group;else{let e=n(c),i=t[0].$subtract(o.$multiply(-d+e));if(0==c)return new s.Group(i);let r=t[0].$subtract(o.$multiply(-d-e));return new s.Group(i,r)}}static intersectLine2D(e,t){let n=m.intersectRay2D(e,t),o=new s.Group;if(0<n.length)for(let e=0,i=n.length;e<i;e++)y.withinBound(t,n[e])&&o.push(n[e]);return o}static intersectCircle2D(e,t){let o=t[0].$subtract(e[0]),i=o.magnitudeSq(),r=n(i),l=e[1].x,c=t[1].x,u=l*l;if(r>l+c)return new s.Group;if(r<d(l-c))return new s.Group(e[0].clone());else{let t=(u-c*c+i)/(2*r),l=n(u-t*t),a=o.$multiply(t/r).add(e[0]);return new s.Group(new s.Pt(a.x+l*o.y/r,a.y-l*o.x/r),new s.Pt(a.x-l*o.y/r,a.y+l*o.x/r))}}static intersectRect2D(e,t){let n=y.sides(t),o=[];for(let r,l=0,i=n.length;l<i;l++)r=m.intersectLine2D(e,n[l]),0<r.length&&o.push(r);return l.Util.flatten(o)}static toRect(e){let t=e[1][0];return new s.Group(e[0].$subtract(t),e[0].$add(t))}static toInnerRect(e){let t=e[1][0],o=n(t*t)/2;return new s.Group(e[0].$subtract(o),e[0].$add(o))}static toInnerTriangle(e){let t=-o/2,n=new s.Group;for(let r=0;3>r;r++)n.push(e[0].clone().toAngle(t,e[1][0],!0)),t+=2*o/3;return n}}t.Circle=m;class g{static fromRect(e){let t=e[0].$add(e[1]).divide(2);t.y=e[0][1];let n=e[1].clone();return n.x=e[0][0],new s.Group(t,e[1].clone(),n)}static fromCircle(e){return m.toInnerTriangle(e)}static fromCenter(e,t){return g.fromCircle(m.fromCenter(e,t))}static medial(e){return 3>e.length?h(new s.Group,3):x.midpoints(e,!0)}static oppositeSide(e,t){return 3>e.length?h(new s.Group,3):0===t?s.Group.fromPtArray([e[1],e[2]]):1===t?s.Group.fromPtArray([e[0],e[2]]):s.Group.fromPtArray([e[0],e[1]])}static altitude(e,t){let n=g.oppositeSide(e,t);return 1<n.length?new s.Group(e[t],f.perpendicularFromPt(n,e[t])):new s.Group}static orthocenter(e){if(3>e.length)return h(void 0,3);let t=g.altitude(e,0),n=g.altitude(e,1);return f.intersectRay2D(t,n)}static incenter(e){if(3>e.length)return h(void 0,3);let t=x.bisector(e,0).add(e[0]),n=x.bisector(e,1).add(e[1]);return f.intersectRay2D(new s.Group(e[0],t),new s.Group(e[1],n))}static incircle(e,t){let n=t?t:g.incenter(e),o=x.area(e),i=x.perimeter(e,!0),l=2*o/i.total;return m.fromCenter(n,l)}static circumcenter(e){let t=g.medial(e),n=[t[0],c.Geom.perpendicular(e[0].$subtract(t[0])).p1.$add(t[0])],o=[t[1],c.Geom.perpendicular(e[1].$subtract(t[1])).p1.$add(t[1])];return f.intersectRay2D(n,o)}static circumcircle(e,t){let n=t?t:g.circumcenter(e),o=e[0].$subtract(n).magnitude();return m.fromCenter(n,o)}}t.Triangle=g;class x{static centroid(e){return c.Geom.centroid(e)}static lines(e,t=!1){if(2>e.length)return h(new s.Group,2);let n=l.Util.split(e,2,1);return t&&n.push(new s.Group(e[e.length-1],e[0])),n.map((e)=>e)}static midpoints(e,n=!1,o=.5){if(2>e.length)return h(new s.Group,2);let t=x.lines(e,n),i=t.map((e)=>c.Geom.interpolate(e[0],e[1],o));return i}static adjacentSides(e,t,n=!1){if(2>e.length)return h(new s.Group,2);if(0>t||t>=e.length)return p(new s.Group,t);let o=[],i=t-1;n&&0>i&&(i=e.length-1),0<=i&&o.push(new s.Group(e[t],e[i]));let r=t+1;return n&&r>e.length-1&&(r=0),r<=e.length-1&&o.push(new s.Group(e[t],e[r])),o}static bisector(e,t){let n=x.adjacentSides(e,t,!0);if(2<=n.length){let e=n[0][1].$subtract(n[0][0]).unit(),t=n[1][1].$subtract(n[1][0]).unit();return e.add(t).divide(2)}}static perimeter(e,t=!1){if(2>e.length)return h(new s.Group,2);let n=x.lines(e,t),o=0,r=s.Pt.make(n.length,0);for(let l,a=0,i=n.length;a<i;a++)l=f.magnitude(n[a]),o+=l,r[a]=l;return{total:o,segments:r}}static area(e){if(3>e.length)return h(new s.Group,3);let t=(e,t)=>e[0]*t[1]-e[1]*t[0],n=0;for(let o=0,i=e.length;o<i;o++)n+=o<e.length-1?t(e[o],e[o+1]):t(e[o],e[0]);return d(n/2)}static convexHull(e,t=!1){if(3>e.length)return h(new s.Group,3);t||(e=e.slice(),e.sort((e,t)=>e[0]-t[0]));let n=(e,t,n)=>0<(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]),o=[],r=e.length-2,l=r+3;o[r]=e[2],o[l]=e[2],n(e[0],e[1],e[2])?(o[r+1]=e[0],o[r+2]=e[1]):(o[r+1]=e[1],o[r+2]=e[0]);for(let a,s=3,i=e.length;s<i;s++)if(a=e[s],!(n(o[r],o[r+1],a)&&n(o[l-1],o[l],a))){for(;!n(o[r],o[r+1],a);)r+=1;for(r-=1,o[r]=a;!n(o[l-1],o[l],a);)l-=1;l+=1,o[l]=a}let i=new s.Group;for(let n=0;n<l-r;n++)i.push(o[r+n]);return i}static intersect2D(e,t,n=!1){let o=[];for(let r,l=0,i=t.length;l<i;l++)r=f.intersectPolygon2D(t[l],e,n),r&&o.push(r);return o}static network(e,t=0){let n=[];for(let o=0,i=e.length;o<i;o++)o!=t&&n.push(new s.Group(e[t],e[o]));return n}static nearestPt(e,t){let n=i,o=-1;for(let r,l=0,i=e.length;l<i;l++)r=e[l].$subtract(t).magnitudeSq(),r<n&&(n=r,o=l);return o}static toRects(e){let t=e.map((e)=>c.Geom.boundingBox(e)),n=l.Util.flatten(t,!1);return t.unshift(c.Geom.boundingBox(n)),t}}t.Polygon=x;class b{static getSteps(e){let n=new s.Group;for(let o,t=0;t<=e;t++)o=t/e,n.push(new s.Pt(o*o*o,o*o,o,1));return n}static controlPoints(e,t=0,n=!1){if(t>e.length-1)return new s.Group;let o=(t)=>t<e.length-1?t:e.length-1,i=e[t];return t=n?t:t+1,new s.Group(i,e[o(t++)],e[o(t++)],e[o(t++)])}static _calcPt(e,t){let n=e.reduce((e,n,o)=>e+n.x*t[o],0),o=e.reduce((e,n,o)=>e+n.y*t[o],0);if(2<e[0].length){let i=e.reduce((e,n,o)=>e+n.z*t[o],0);return new s.Pt(n,o,i)}return new s.Pt(n,o)}static catmullRom(e,t=10){if(2>e.length)return new s.Group;let n=new s.Group,o=b.getSteps(t),r=b.controlPoints(e,0,!0);for(let l=0;l<=t;l++)n.push(b.catmullRomStep(o[l],r));for(let i=0;i<e.length-2;){let r=b.controlPoints(e,i);if(0<r.length){for(let e=0;e<=t;e++)n.push(b.catmullRomStep(o[e],r));i++}}return n}static catmullRomStep(e,t){let n=new s.Group(new s.Pt(-.5,1,-.5,0),new s.Pt(1.5,-2.5,0,1),new s.Pt(-1.5,2,.5,0),new s.Pt(.5,-.5,0,0));return b._calcPt(t,a.Mat.multiply([e],n,!0)[0])}static cardinal(e,t=10,n=.5){if(2>e.length)return new s.Group;let o=new s.Group,r=b.getSteps(t),l=b.controlPoints(e,0,!0);for(let a=0;a<=t;a++)o.push(b.cardinalStep(r[a],l,n));for(let i=0;i<e.length-2;){let l=b.controlPoints(e,i);if(0<l.length){for(let e=0;e<=t;e++)o.push(b.cardinalStep(r[e],l,n));i++}}return o}static cardinalStep(e,t,n=.5){let o=new s.Group(new s.Pt(-1,2,-1,0),new s.Pt(-1,1,0,0),new s.Pt(1,-2,1,0),new s.Pt(1,-1,0,0)),i=a.Mat.multiply([e],o,!0)[0].multiply(n),r=2*e[0]-3*e[1]+1,l=-2*e[0]+3*e[1],d=b._calcPt(t,i);return d.x+=r*t[1].x+l*t[2].x,d.y+=r*t[1].y+l*t[2].y,2<d.length&&(d.z+=r*t[1].z+l*t[2].z),d}static bezier(e,t=10){if(4>e.length)return new s.Group;let n=new s.Group,o=b.getSteps(t),i=0;for(;i<e.length-3;){let r=b.controlPoints(e,i);if(0<r.length){for(let e=0;e<=t;e++)n.push(b.bezierStep(o[e],r));i+=3}}return n}static bezierStep(e,t){let n=new s.Group(new s.Pt(-1,3,-3,1),new s.Pt(3,-6,3,0),new s.Pt(-3,3,0,0),new s.Pt(1,0,0,0));return b._calcPt(t,a.Mat.multiply([e],n,!0)[0])}static bspline(e,t=10,n=1){if(2>e.length)return new s.Group;let o=new s.Group,r=b.getSteps(t),i=0;for(;i<e.length-3;){let l=b.controlPoints(e,i);if(0<l.length){if(1!==n)for(let e=0;e<=t;e++)o.push(b.bsplineTensionStep(r[e],l,n));else for(let e=0;e<=t;e++)o.push(b.bsplineStep(r[e],l));i++}}return o}static bsplineStep(e,t){let n=new s.Group(new s.Pt(-.16666666666666666,.5,-.5,.16666666666666666),new s.Pt(.5,-1,0,.6666666666666666),new s.Pt(-.5,.5,.5,.16666666666666666),new s.Pt(.16666666666666666,0,0,0));return b._calcPt(t,a.Mat.multiply([e],n,!0)[0])}static bsplineTensionStep(e,t,n=1){let o=new s.Group(new s.Pt(-.16666666666666666,.5,-.5,.16666666666666666),new s.Pt(-1.5,2,0,-.3333333333333333),new s.Pt(1.5,-2.5,.5,.16666666666666666),new s.Pt(.16666666666666666,0,0,0)),i=a.Mat.multiply([e],o,!0)[0].multiply(n),r=2*e[0]-3*e[1]+1,l=-2*e[0]+3*e[1],d=b._calcPt(t,i);return d.x+=r*t[1].x+l*t[2].x,d.y+=r*t[1].y+l*t[2].y,2<d.length&&(d.z+=r*t[1].z+l*t[2].z),d}}t.Curve=b},function(t,i,r){'use strict';var h=Math.exp;Object.defineProperty(i,'__esModule',{value:!0});const g=r(1),p=r(2),m=r(0),f=r(4);class c{static equals(e,t,n=1e-5){return d(e-t)<n}static lerp(e,n,o){return(1-o)*e+o*n}static clamp(e,t,n){return u(t,_(n,e))}static boundValue(e,t,n){let o=d(n-t),i=e%o;return i>n?i-=o:i<t&&(i+=o),i}static within(e,t,n){return e>=_(t,n)&&e<=u(t,n)}static randomRange(e,t=0){let n=e>t?e-t:t-e;return e+Math.random()*n}static normalizeValue(e,t,n){let o=_(t,n),i=u(t,n);return(e-o)/(i-o)}static sum(e){let t=new m.Pt(e[0]);for(let n=1,o=e.length;n<o;n++)f.Vec.add(t,e[n]);return t}static average(e){return c.sum(e).divide(e.length)}static cycle(e){return(a(2*o*e)+1)/2}static mapToRange(e,t,n,o,i){if(t==n)throw new Error('[currMin, currMax] must define a range that is not zero');let r=_(o,i),l=u(o,i);return c.normalizeValue(e,t,n)*(l-r)+r}}i.Num=c;class y{static boundAngle(e){return c.boundValue(e,0,360)}static boundRadian(e){return c.boundValue(e,0,g.Const.two_pi)}static toRadian(e){return e*g.Const.deg_to_rad}static toDegree(e){return e*g.Const.rad_to_deg}static boundingBox(e){let t=e.reduce((e,t)=>e.$min(t)),n=e.reduce((e,t)=>e.$max(t));return new m.Group(t,n)}static centroid(e){return c.average(e)}static anchor(e,t=0,n='to'){let o='to'==n?'subtract':'add';for(let r=0,i=e.length;r<i;r++)'number'==typeof t?t!==r&&e[r][o](e[t]):e[r][o](t)}static interpolate(e,n,o=.5){let t=_(e.length,n.length),r=m.Pt.make(t);for(let l=0;l<t;l++)r[l]=e[l]*(1-o)+n[l]*o;return r}static perpendicular(e,t=g.Const.xy){let n=t[1],o=t[0],i=new m.Pt(e),r=new m.Pt(i);r[o]=-i[n],r[n]=i[o];let l=new m.Pt(i);return l[o]=i[n],l[n]=-i[o],new m.Group(r,l)}static isPerpendicular(e,t){return 0===new m.Pt(e).dot(t)}static withinBound(e,t,n){for(let o=0,i=_(e.length,t.length,n.length);o<i;o++)if(!c.within(e[o],t[o],n[o]))return!1;return!0}static sortEdges(e){let t=y.boundingBox(e),n=t[1].add(t[0]).divide(2);return e.sort((e,t)=>{if(2>e.length||2>t.length)throw new Error('Pt dimension cannot be less than 2');let o=e.$subtract(n),i=t.$subtract(n);if(0<=o[0]&&0>i[0])return 1;if(0>o[0]&&0<=i[0])return-1;if(0==o[0]&&0==i[0])return 0<=o[1]||0<=i[1]?o[1]>i[1]?1:-1:i[1]>o[1]?1:-1;let r=o.cross2D(i);return 0>r?1:0<r?-1:o[0]*o[0]+o[1]*o[1]>i[0]*i[0]+i[1]*i[1]?1:-1})}static scale(e,t,n){let o=Array.isArray(e)?e:[e],i='number'==typeof t?m.Pt.make(o[0].length,t):t;n||(n=m.Pt.make(o[0].length,0));for(let r,l=0,a=o.length;l<a;l++){r=o[l];for(let e=0,t=r.length;e<t;e++)r[e]=n&&n[e]?n[e]+(r[e]-n[e])*i[e]:r[e]*i[e]}return y}static rotate2D(e,t,n,o){let r=Array.isArray(e)?e:[e],l=n?f.Mat.rotateAt2DMatrix:f.Mat.rotate2DMatrix;n||(n=m.Pt.make(r[0].length,0));let d=s(t),c=a(t);for(let a,s=0,i=r.length;s<i;s++)a=o?r[s].$take(o):r[s],a.to(f.Mat.transform2D(a,l(d,c,n)));return y}static shear2D(e,t,n,o){var i=Math.tan;let r=Array.isArray(e)?e:[e],l='number'==typeof t?[t,t]:t;n||(n=m.Pt.make(r[0].length,0));let a=n?f.Mat.shearAt2DMatrix:f.Mat.shear2DMatrix,s=i(l[0]),d=i(l[1]);for(let l,c=0,i=r.length;c<i;c++)l=o?r[c].$take(o):r[c],l.to(f.Mat.transform2D(l,a(s,d,n)));return y}static reflect2D(e,t,n){let o=Array.isArray(e)?e:[e];for(let r,l=0,i=o.length;l<i;l++)r=n?o[l].$take(n):o[l],r.to(f.Mat.transform2D(r,f.Mat.reflectAt2DMatrix(t[0],t[1])));return y}static cosTable(){let e=new Float64Array(360);for(let t=0;360>t;t++)e[t]=s(t*o/180);return{table:e,cos:(t)=>e[l(y.boundAngle(y.toDegree(t)))]}}static sinTable(){let e=new Float64Array(360);for(let t=0;360>t;t++)e[t]=a(t*o/180);return{table:e,sin:(t)=>e[l(y.boundAngle(y.toDegree(t)))]}}}i.Geom=y;class x{static linear(e,t=1){return t*e}static quadraticIn(e,t=1){return t*e*e}static quadraticOut(e,t=1){return-t*e*(e-2)}static quadraticInOut(e,t=1){let n=2*e;return .5>e?4*(t/2*e*e):-t/2*((n-1)*(n-3)-1)}static cubicIn(e,t=1){return t*e*e*e}static cubicOut(e,t=1){let n=e-1;return t*(n*n*n+1)}static cubicInOut(e,t=1){let n=2*e;return .5>e?t/2*n*n*n:t/2*((n-2)*(n-2)*(n-2)+2)}static exponentialIn(n,t=1,o=.25){return t*e(n,1/o)}static exponentialOut(n,t=1,o=.25){return t*e(n,o)}static sineIn(e,t=1){return-t*s(e*g.Const.half_pi)+t}static sineOut(e,t=1){return t*a(e*g.Const.half_pi)}static sineInOut(e,t=1){return-t/2*(s(o*e)-1)}static cosineApprox(e,t=1){let n=e*e,o=n*n;return t*(4*(o*n)/9-17*o/9+22*n/9)}static circularIn(e,t=1){return-t*(n(1-e*e)-1)}static circularOut(e,t=1){let o=e-1;return t*n(1-o*o)}static circularInOut(e,t=1){let o=2*e;return .5>e?-t/2*(n(1-o*o)-1):t/2*(n(1-(o-2)*(o-2))+1)}static elasticIn(n,t=1,o=.7){let i=n-1,r=1.5707963267948966*(o/g.Const.two_pi);return t*(-e(2,10*i)*a((i-r)*g.Const.two_pi/o))}static elasticOut(n,t=1,o=.7){let i=1.5707963267948966*(o/g.Const.two_pi);return t*(e(2,-10*n)*a((n-i)*g.Const.two_pi/o))+t}static elasticInOut(n,t=1,o=.6){let i=2*n,r=1.5707963267948966*(o/g.Const.two_pi);return .5>n?(i-=1,t*(-.5*(e(2,10*i)*a((i-r)*g.Const.two_pi/o)))):(i-=1,t*(.5*(e(2,-10*i)*a((i-r)*g.Const.two_pi/o)))+t)}static bounceIn(e,t=1){return t-x.bounceOut(1-e,t)}static bounceOut(e,t=1){return e<1/2.75?t*(7.5625*e*e):e<2/2.75?(e-=1.5/2.75,t*(7.5625*e*e+.75)):e<2.5/2.75?(e-=2.25/2.75,t*(7.5625*e*e+.9375)):(e-=2.625/2.75,t*(7.5625*e*e+.984375))}static bounceInOut(e,t=1){return .5>e?x.bounceIn(2*e,t)/2:x.bounceOut(2*e-1,t)/2+t/2}static sigmoid(e,t=1,n=10){return t/(1+h(-(n*(e-.5))))}static logSigmoid(e,t=1,n=.7){n=u(g.Const.epsilon,_(1-g.Const.epsilon,n)),n=1/(1-n);let o=1/(1+h(-2*((e-.5)*n))),i=1/(1+h(n)),r=1/(1+h(-n));return t*(o-i)/(r-i)}static seat(n,t=1,o=.5){return .5>n?t*e(2*n,1-o)/2:t*(1-e(2*(1-n),1-o)/2)}static quadraticBezier(e,t=1,o=[.05,.95]){let i='number'==typeof o?o:o[0],r='number'==typeof o?.5:o[1],l=1-2*i;0===l&&(l=g.Const.epsilon);let a=(n(i*i+l*e)-i)/l;return t*((1-2*r)*(a*a)+2*r*a)}static cubicBezier(e,t=1,n=[.1,.7],o=[.9,.2]){let i=new m.Group(new m.Pt(0,0),new m.Pt(n),new m.Pt(o),new m.Pt(1,1));return t*p.Curve.bezierStep(new m.Pt(e*e*e,e*e,e,1),p.Curve.controlPoints(i)).y}static quadraticTarget(e,t=1,n=[.2,.35]){let o=_(1-g.Const.epsilon,u(g.Const.epsilon,n[0])),i=_(1,u(0,n[1])),r=(1-i)/(1-o)-i/o;return t*_(1,u(0,r*(e*e)-(r*(o*o)-i)/o*e))}static cliff(e,t=1,n=.5){return e>n?t:0}static step(e,n,o,t,...i){let r=1/n,a=l(o/r)*r;return e(a,t,...i)}}i.Shaping=x;class b{constructor(e){this._dims=0,this._source=m.Group.fromPtArray(e),this.calc()}get max(){return this._max.clone()}get min(){return this._min.clone()}get magnitude(){return this._mag.clone()}calc(){if(this._source){let e=this._source[0].length;this._dims=e;let t=new m.Pt(e),n=new m.Pt(e),o=new m.Pt(e);for(let r=0;r<e;r++){t[r]=g.Const.min,n[r]=g.Const.max,o[r]=0;let e=this._source.zipSlice(r);for(let i=0,l=e.length;i<l;i++)t[r]=u(t[r],e[i]),n[r]=_(n[r],e[i]),o[r]=t[r]-n[r]}return this._max=t,this._min=n,this._mag=o,this}}mapTo(e,t,o){let r=new m.Group;for(let l=0,n=this._source.length;l<n;l++){let i=this._source[l],a=new m.Pt(this._dims);for(let n=0;n<this._dims;n++)a[n]=o&&o[n]?i[n]:c.mapToRange(i[n],this._min[n],this._max[n],e,t);r.push(a)}return r}append(e,t=!0){if(e[0].length!==this._dims)throw new Error(`Dimensions don't match. ${this._dims} dimensions in Range and ${e[0].length} provided in parameter. `);return this._source=this._source.concat(e),t&&this.calc(),this}ticks(e){let t=new m.Group;for(let n,o=0;o<=e;o++){n=new m.Pt(this._dims);for(let t=0,i=this._max.length;t<i;t++)n[t]=c.lerp(this._min[t],this._max[t],o/e);t.push(n)}return t}}i.Range=b},function(e,o,r){'use strict';Object.defineProperty(o,'__esModule',{value:!0});const l=r(0),d=r(2);class c{static add(e,t){if('number'==typeof t)for(let n=0,o=e.length;n<o;n++)e[n]+=t;else for(let n=0,o=e.length;n<o;n++)e[n]+=t[n]||0;return e}static subtract(e,t){if('number'==typeof t)for(let n=0,o=e.length;n<o;n++)e[n]-=t;else for(let n=0,o=e.length;n<o;n++)e[n]-=t[n]||0;return e}static multiply(e,t){if('number'==typeof t)for(let n=0,o=e.length;n<o;n++)e[n]*=t;else{if(e.length!=t.length)throw new Error(`Cannot do element-wise multiply since the array lengths don't match: ${e.toString()} multiply-with ${t.toString()}`);for(let n=0,o=e.length;n<o;n++)e[n]*=t[n]}return e}static divide(e,t){if('number'==typeof t){if(0===t)throw new Error('Cannot divide by zero');for(let n=0,o=e.length;n<o;n++)e[n]/=t}else{if(e.length!=t.length)throw new Error(`Cannot do element-wise divide since the array lengths don't match. ${e.toString()} divide-by ${t.toString()}`);for(let n=0,o=e.length;n<o;n++)e[n]/=t[n]}return e}static dot(e,t){if(e.length!=t.length)throw new Error('Array lengths don\'t match');let n=0;for(let o=0,i=e.length;o<i;o++)n+=e[o]*t[o];return n}static cross2D(e,t){return e[0]*t[1]-e[1]*t[0]}static cross(e,t){return new l.Pt(e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0])}static magnitude(e){return n(c.dot(e,e))}static unit(e,t=void 0){let n=t===void 0?c.magnitude(e):t;if(0===n)throw new Error('Cannot calculate unit vector because magnitude is 0');return c.divide(e,n)}static abs(e){return c.map(e,Math.abs)}static floor(e){return c.map(e,Math.floor)}static ceil(e){return c.map(e,Math.ceil)}static round(e){return c.map(e,Math.round)}static max(e){let n=t,o=0;for(let t=0,i=e.length;t<i;t++)n=u(n,e[t]),n===e[t]&&(o=t);return{value:n,index:o}}static min(e){let t=i,n=0;for(let o=0,i=e.length;o<i;o++)t=_(t,e[o]),t===e[o]&&(n=o);return{value:t,index:n}}static sum(e){let t=0;for(let n=0,o=e.length;n<o;n++)t+=e[n];return t}static map(e,t){for(let n=0,o=e.length;n<o;n++)e[n]=t(e[n],n,e);return e}}o.Vec=c;class p{static add(e,t){if('number'!=typeof t){if(e[0].length!=t[0].length)throw new Error('Cannot add matrix if rows\' and columns\' size don\'t match.');if(e.length!=t.length)throw new Error('Cannot add matrix if rows\' and columns\' size don\'t match.')}let n=new l.Group;for(let o=0,i=e.length;o<i;o++)n.push(e[o].$add('number'==typeof t?t:t[o]));return n}static multiply(e,t,n=!1,o=!1){let i=new l.Group;if(!('number'!=typeof t))for(let n=0,o=e.length;n<o;n++)i.push(e[n].$multiply(t));else if(o){if(e.length!=t.length)throw new Error('Cannot multiply matrix element-wise because the matrices\' sizes don\'t match.');for(let n=0,o=e.length;n<o;n++)i.push(e[n].$multiply(t[n]))}else{if(!n&&e[0].length!=t.length)throw new Error('Cannot multiply matrix if rows in matrix-a don\'t match columns in matrix-b.');if(n&&e[0].length!=t[0].length)throw new Error('Cannot multiply matrix if transposed and the columns in both matrices don\'t match.');n||(t=p.transpose(t));for(let n,o=0,r=e.length;o<r;o++){n=l.Pt.make(t.length,0);for(let i=0,r=t.length;i<r;i++)n[i]=c.dot(e[o],t[i]);i.push(n)}}return i}static zipSlice(e,t,n=!1){let o=[];for(let r=0,i=e.length;r<i;r++){if(e[r].length-1<t&&!1===n)throw`Index ${t} is out of bounds`;o.push(e[r][t]||n)}return new l.Pt(o)}static zip(e,t=!1,n=!1){let o=new l.Group,r=n?e.reduce((e,t)=>u(e,t.length),0):e[0].length;for(let l=0;l<r;l++)o.push(p.zipSlice(e,l,t));return o}static transpose(e,t=!1,n=!1){return p.zip(e,t,n)}static transform2D(e,t){let n=e[0]*t[0][0]+e[1]*t[1][0]+t[2][0],o=e[0]*t[0][1]+e[1]*t[1][1]+t[2][1];return new l.Pt(n,o)}static scale2DMatrix(e,t){return new l.Group(new l.Pt(e,0,0),new l.Pt(0,t,0),new l.Pt(0,0,1))}static rotate2DMatrix(e,t){return new l.Group(new l.Pt(e,t,0),new l.Pt(-t,e,0),new l.Pt(0,0,1))}static shear2DMatrix(e,t){return new l.Group(new l.Pt(1,e,0),new l.Pt(t,1,0),new l.Pt(0,0,1))}static translate2DMatrix(e,t){return new l.Group(new l.Pt(1,0,0),new l.Pt(0,1,0),new l.Pt(e,t,1))}static scaleAt2DMatrix(e,t,n){let o=p.scale2DMatrix(e,t);return o[2][0]=-n[0]*e+n[0],o[2][1]=-n[1]*t+n[1],o}static rotateAt2DMatrix(e,t,n){let o=p.rotate2DMatrix(e,t);return o[2][0]=n[0]*(1-e)+n[1]*t,o[2][1]=n[1]*(1-e)-n[0]*t,o}static shearAt2DMatrix(e,t,n){let o=p.shear2DMatrix(e,t);return o[2][0]=-n[1]*t,o[2][1]=-n[0]*e,o}static reflectAt2DMatrix(e,t){let n=d.Line.intercept(e,t);if(n==void 0)return[new l.Pt([-1,0,0]),new l.Pt([0,1,0]),new l.Pt([e[0]+t[0],0,1])];else{let e=n.yi,t=2*Math.atan(n.slope),o=s(t),i=a(t);return[new l.Pt([o,i,0]),new l.Pt([i,-o,0]),new l.Pt([-e*i,e+e*o,1])]}}}o.Mat=p},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(0);class i extends o.Group{constructor(...e){super(...e),this._center=new o.Pt,this._size=new o.Pt,this._topLeft=new o.Pt,this._bottomRight=new o.Pt,this._inited=!1,this.init()}static fromBoundingRect(e){let t=new i(new o.Pt(e.left||0,e.top||0),new o.Pt(e.right||0,e.bottom||0));return e.width&&e.height&&(t.size=new o.Pt(e.width,e.height)),t}static fromGroup(e){if(2>e.length)throw new Error('Cannot create a Bound from a group that has less than 2 Pt');return new i(e[0],e[e.length-1])}init(){if(this.p1&&(this._size=this.p1.clone(),this._inited=!0),this.p1&&this.p2){let e=this.p1,t=this.p2;this.topLeft=e.$min(t),this._bottomRight=e.$max(t),this._updateSize(),this._inited=!0}}clone(){return new i(this._topLeft.clone(),this._bottomRight.clone())}_updateSize(){this._size=this._bottomRight.$subtract(this._topLeft).abs(),this._updateCenter()}_updateCenter(){this._center=this._size.$multiply(.5).add(this._topLeft)}_updatePosFromTop(){this._bottomRight=this._topLeft.$add(this._size),this._updateCenter()}_updatePosFromBottom(){this._topLeft=this._bottomRight.$subtract(this._size),this._updateCenter()}_updatePosFromCenter(){let e=this._size.$multiply(.5);this._topLeft=this._center.$subtract(e),this._bottomRight=this._center.$add(e)}get size(){return new o.Pt(this._size)}set size(e){this._size=new o.Pt(e),this._updatePosFromTop()}get center(){return new o.Pt(this._center)}set center(e){this._center=new o.Pt(e),this._updatePosFromCenter()}get topLeft(){return new o.Pt(this._topLeft)}set topLeft(e){this._topLeft=new o.Pt(e),this[0]=this._topLeft,this._updateSize()}get bottomRight(){return new o.Pt(this._bottomRight)}set bottomRight(e){this._bottomRight=new o.Pt(e),this[1]=this._bottomRight,this._updateSize()}get width(){return 0<this._size.length?this._size.x:0}set width(e){this._size.x=e,this._updatePosFromTop()}get height(){return 1<this._size.length?this._size.y:0}set height(e){this._size.y=e,this._updatePosFromTop()}get depth(){return 2<this._size.length?this._size.z:0}set depth(e){this._size.z=e,this._updatePosFromTop()}get x(){return this.topLeft.x}get y(){return this.topLeft.y}get z(){return this.topLeft.z}get inited(){return this._inited}update(){return this._topLeft=this[0],this._bottomRight=this[1],this._updateSize(),this}}t.Bound=i},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(1);class i{constructor(){this._ready=!1}get ready(){return this._ready}static _checkSize(e,t=2){return!(e.length<t)||(o.Util.warn('Requires 2 or more Pts in this Group.'),!1)}}t.Form=i;class r extends i{constructor(){super(...arguments),this._filled=!0,this._stroked=!0,this._font=new l(14,'sans-serif')}get filled(){return this._filled}set filled(e){this._filled=e}get stroked(){return this._stroked}set stroked(e){this._stroked=e}get currentFont(){return this._font}_multiple(e,t,...n){if(!e)return this;for(let o=0,i=e.length;o<i;o++)this[t](e[o],...n);return this}fill(){return this}fillOnly(e){return this.stroke(!1),this.fill(e)}stroke(){return this}strokeOnly(e,t,n,o){return this.fill(!1),this.stroke(e,t,n,o)}points(e,t,n){if(e){for(let o=0,i=e.length;o<i;o++)this.point(e[o],t,n);return this}}circles(e){return this._multiple(e,'circle')}squares(e){return this._multiple(e,'square')}lines(e){return this._multiple(e,'line')}polygons(e){return this._multiple(e,'polygon')}rects(e){return this._multiple(e,'rect')}}t.VisualForm=r;class l{constructor(e=12,t='sans-serif',n='',o='',i=1.5){this.size=e,this.face=t,this.style=o,this.weight=n,this.lineHeight=i}get value(){return`${this.style} ${this.weight} ${this.size}px/${this.lineHeight} ${this.face}`}toString(){return this.value}}t.Font=l},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(5),r=n(0),i=n(14);class l{constructor(){this.id='space',this.bound=new o.Bound,this._time={prev:0,diff:0,end:-1},this.players={},this.playerCount=0,this._animID=-1,this._pause=!1,this._refresh=void 0,this._pointer=new r.Pt,this._isReady=!1,this._playing=!1}refresh(e){return this._refresh=e,this}add(e){let t='function'==typeof e?{animate:e}:e,n=this.playerCount++,o=this.id+n;return this.players[o]=t,t.animateID=o,t.resize&&this.bound.inited&&t.resize(this.bound),void 0===this._refresh&&(this._refresh=!0),this}remove(e){return delete this.players[e.animateID],this}removeAll(){return this.players={},this}play(e=0){if(this._animID=requestAnimationFrame(this.play.bind(this)),this._pause)return this;this._time.diff=e-this._time.prev,this._time.prev=e;try{this.playItems(e)}catch(e){throw cancelAnimationFrame(this._animID),this._playing=!1,e}return this}replay(){this._time.end=-1,this.play()}playItems(e){if(this._playing=!0,this._refresh&&this.clear(),this._isReady)for(let t in this.players)this.players[t].animate&&this.players[t].animate(e,this._time.diff,this);0<=this._time.end&&e>this._time.end&&(cancelAnimationFrame(this._animID),this._playing=!1)}pause(e=!1){return this._pause=!e||!this._pause,this}resume(){return this._pause=!1,this}stop(e=0){return this._time.end=e,this}playOnce(e=5e3){return this.play(),this.stop(e),this}render(e){return this._renderFunc&&this._renderFunc(e,this),this}set customRendering(e){this._renderFunc=e}get customRendering(){return this._renderFunc}get isPlaying(){return this._playing}get outerBound(){return this.bound.clone()}get innerBound(){return new o.Bound(r.Pt.make(this.size.length,0),this.size.clone())}get size(){return this.bound.size.clone()}get center(){return this.size.divide(2)}get width(){return this.bound.width}get height(){return this.bound.height}}t.Space=l;class a extends l{constructor(){super(...arguments),this._pressed=!1,this._dragged=!1,this._hasMouse=!1,this._hasTouch=!1}get pointer(){let e=this._pointer.clone();return e.id=this._pointer.id,e}bindCanvas(e,t){this._canvas.addEventListener(e,t)}unbindCanvas(e,t){this._canvas.removeEventListener(e,t)}bindMouse(e=!0){return e?(this.bindCanvas('mousedown',this._mouseDown.bind(this)),this.bindCanvas('mouseup',this._mouseUp.bind(this)),this.bindCanvas('mouseover',this._mouseOver.bind(this)),this.bindCanvas('mouseout',this._mouseOut.bind(this)),this.bindCanvas('mousemove',this._mouseMove.bind(this)),this._hasMouse=!0):(this.unbindCanvas('mousedown',this._mouseDown.bind(this)),this.unbindCanvas('mouseup',this._mouseUp.bind(this)),this.unbindCanvas('mouseover',this._mouseOver.bind(this)),this.unbindCanvas('mouseout',this._mouseOut.bind(this)),this.unbindCanvas('mousemove',this._mouseMove.bind(this)),this._hasMouse=!1),this}bindTouch(e=!0){return e?(this.bindCanvas('touchstart',this._mouseDown.bind(this)),this.bindCanvas('touchend',this._mouseUp.bind(this)),this.bindCanvas('touchmove',this._touchMove.bind(this)),this.bindCanvas('touchcancel',this._mouseOut.bind(this)),this._hasTouch=!0):(this.unbindCanvas('touchstart',this._mouseDown.bind(this)),this.unbindCanvas('touchend',this._mouseUp.bind(this)),this.unbindCanvas('touchmove',this._touchMove.bind(this)),this.unbindCanvas('touchcancel',this._mouseOut.bind(this)),this._hasTouch=!1),this}touchesToPoints(e,n='touches'){if(!e||!e[n])return[];let o=[];for(var l=0;l<e[n].length;l++){let i=e[n].item(l);o.push(new r.Pt(i.pageX-this.bound.topLeft.x,i.pageY-this.bound.topLeft.y))}return o}_mouseAction(e,t){let n=0,o=0;if(t instanceof MouseEvent){for(let i in this.players)if(this.players.hasOwnProperty(i)){let r=this.players[i];n=t.pageX-this.outerBound.x,o=t.pageY-this.outerBound.y,r.action&&r.action(e,n,o,t)}}else for(let i in this.players)if(this.players.hasOwnProperty(i)){let r=this.players[i],l=t.changedTouches&&0<t.changedTouches.length,a=t.changedTouches.item(0);n=l?a.pageX-this.outerBound.x:0,o=l?a.pageY-this.outerBound.y:0,r.action&&r.action(e,n,o,t)}e&&(this._pointer.to(n,o),this._pointer.id=e)}_mouseDown(e){return this._mouseAction(i.UIPointerActions.down,e),this._pressed=!0,!1}_mouseUp(e){return this._mouseAction(i.UIPointerActions.up,e),this._dragged&&this._mouseAction(i.UIPointerActions.down,e),this._pressed=!1,this._dragged=!1,!1}_mouseMove(e){return this._mouseAction(i.UIPointerActions.move,e),this._pressed&&(this._dragged=!0,this._mouseAction(i.UIPointerActions.drag,e)),!1}_mouseOver(e){return this._mouseAction(i.UIPointerActions.over,e),!1}_mouseOut(e){return this._mouseAction(i.UIPointerActions.out,e),this._dragged&&this._mouseAction(i.UIPointerActions.drop,e),this._dragged=!1,!1}_touchMove(e){return this._mouseMove(e),e.preventDefault(),!1}}t.MultiTouchSpace=a},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(7),i=n(6),r=n(5),l=n(1),a=n(0);class s extends o.MultiTouchSpace{constructor(e,t){super(),this.id='domspace',this._autoResize=!0,this._bgcolor='#e1e9f0',this._css={};var n=null,o=!1;this.id='pts',e instanceof Element?(n=e,this.id='pts_existing_space'):(n=document.querySelector(e),o=!0,this.id=e.substr(1)),n?(this._canvas=n,this._container=n.parentElement):(this._container=s.createElement('div','pts_container'),this._canvas=s.createElement('div','pts_element'),this._container.appendChild(this._canvas),document.body.appendChild(this._container),o=!1),setTimeout(this._ready.bind(this,t),50)}static createElement(e='div',t,n){let o=document.createElement(e);return t&&o.setAttribute('id',t),n&&n.appendChild&&n.appendChild(o),o}_ready(e){if(!this._container)throw new Error(`Cannot initiate #${this.id} element`);for(let t in this._isReady=!0,this._resizeHandler(null),this.clear(this._bgcolor),this._canvas.dispatchEvent(new Event('ready')),this.players)this.players.hasOwnProperty(t)&&this.players[t].start&&this.players[t].start(this.bound.clone(),this);this._pointer=this.center,this.refresh(!1),e&&e(this.bound,this._canvas)}setup(e){return e.bgcolor&&(this._bgcolor=e.bgcolor),this.autoResize=void 0!=e.resize&&e.resize,this}getForm(){return null}set autoResize(e){this._autoResize=e,e?window.addEventListener('resize',this._resizeHandler.bind(this)):(delete this._css.width,delete this._css.height,window.removeEventListener('resize',this._resizeHandler.bind(this)))}get autoResize(){return this._autoResize}resize(e,t){for(let n in this.bound=e,this.styles({width:`${e.width}px`,height:`${e.height}px`},!0),this.players)if(this.players.hasOwnProperty(n)){let e=this.players[n];e.resize&&e.resize(this.bound,t)}return this}_resizeHandler(e){let t=r.Bound.fromBoundingRect(this._container.getBoundingClientRect());this._autoResize?this.styles({width:'100%',height:'100%'},!0):this.styles({width:`${t.width}px`,height:`${t.height}px`},!0),this.resize(t,e)}get element(){return this._canvas}get parent(){return this._container}get ready(){return this._isReady}clear(e){return e&&(this.background=e),this._canvas.innerHTML='',this}set background(e){this._bgcolor=e,this._container.style.backgroundColor=this._bgcolor}get background(){return this._bgcolor}style(e,t,n=!1){return this._css[e]=t,n&&(this._canvas.style[e]=t),this}styles(e,t=!1){for(let n in e)e.hasOwnProperty(n)&&this.style(n,e[n],t);return this}static setAttr(e,t){for(let n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n]);return e}static getInlineStyles(e){let t='';for(let n in e)e.hasOwnProperty(n)&&e[n]&&(t+=`${n}: ${e[n]}; `);return t}}t.DOMSpace=s;class d extends s{getForm(){return new c(this)}static htmlElement(e,t,n,o=!0){if(!e||!e.appendChild)throw new Error('parent is not a valid DOM element');let i=document.querySelector(`#${n}`);return i||(i=document.createElement(t),i.setAttribute('id',n),o&&i.setAttribute('class',n.substring(0,n.indexOf('-'))),e.appendChild(i)),i}remove(e){let t=this._container.querySelectorAll('.'+c.scopeID(e));return t.forEach((e)=>{e.parentNode.removeChild(e)}),super.remove(e)}removeAll(){return this._container.innerHTML='',super.removeAll()}}t.HTMLSpace=d;class c extends i.VisualForm{constructor(e){super(),this._ctx={group:null,groupID:'pts',groupCount:0,currentID:'pts0',currentClass:'',style:{filled:!0,stroked:!0,background:'#f03',"border-color":'#fff',color:'#000',"border-width":'1px',"border-radius":'0',"border-style":'solid',position:'absolute',top:0,left:0,width:0,height:0},font:'11px sans-serif',fontSize:11,fontFamily:'sans-serif'},this._ready=!1,this._space=e,this._space.add({start:()=>{this._ctx.group=this._space.element,this._ctx.groupID='pts_dom_'+c.groupID++,this._ready=!0}})}get space(){return this._space}styleTo(e,t,n=''){if(this._ctx.style[e]===void 0)throw new Error(`${e} style property doesn't exist`);this._ctx.style[e]=`${t}${n}`}fill(e){return'boolean'==typeof e?(this.styleTo('filled',e),!e&&this.styleTo('background','transparent')):(this.styleTo('filled',!0),this.styleTo('background',e)),this}stroke(e,t){return'boolean'==typeof e?(this.styleTo('stroked',e),!e&&this.styleTo('border-width',0)):(this.styleTo('stroked',!0),this.styleTo('border-color',e),this.styleTo('border-width',(t||1)+'px')),this}fillText(e){return this.styleTo('color',e),this}cls(e){return this._ctx.currentClass='boolean'==typeof e?'':e,this}font(e,t,n,o,i){return'number'==typeof e?(this._font.size=e,i&&(this._font.face=i),t&&(this._font.weight=t),n&&(this._font.style=n),o&&(this._font.lineHeight=o),this._ctx.font=this._font.value):this._font=e,this}reset(){return this._ctx.style={filled:!0,stroked:!0,background:'#f03',"border-color":'#fff',"border-width":'1px'},this._font=new i.Font(14,'sans-serif'),this._ctx.font=this._font.value,this}updateScope(e,t){return this._ctx.group=t,this._ctx.groupID=e,this._ctx.groupCount=0,this.nextID(),this._ctx}scope(e){if(!e||null==e.animateID)throw new Error('item not defined or not yet added to Space');return this.updateScope(c.scopeID(e),this.space.element)}nextID(){return this._ctx.groupCount++,this._ctx.currentID=`${this._ctx.groupID}-${this._ctx.groupCount}`,this._ctx.currentID}static getID(e){return e.currentID||`p-${c.domID++}`}static scopeID(e){return`item-${e.animateID}`}static style(e,t){let n=[];for(let o in t.filled||n.push('background: none'),t.stroked||n.push('border: none'),t)if(t.hasOwnProperty(o)&&'filled'!=o&&'stroked'!=o){let e=t[o];if(e)if(!t.filled&&0===o.indexOf('background'))continue;else if(!t.stroked&&0===o.indexOf('border-width'))continue;else n.push(`${o}: ${e}`)}return d.setAttr(e,{style:n.join(';')})}static rectStyle(e,t,n){return e.style.left=t[0]+'px',e.style.top=t[1]+'px',e.style.width=n[0]+'px',e.style.height=n[1]+'px',e}static point(e,t,n=5,o='square'){return'circle'===o?c.circle(e,t,n):c.square(e,t,n)}point(e,t=5,n='square'){return this.nextID(),'circle'==n&&this.styleTo('border-radius','100%'),c.point(this._ctx,e,t,n),this}static circle(e,t,n=10){let o=d.htmlElement(e.group,'div',c.getID(e));return d.setAttr(o,{class:`pts-form pts-circle ${e.currentClass}`}),c.rectStyle(e,new a.Pt(t).$subtract(n),new a.Pt(2*n,2*n)),c.style(o,e.style),o}circle(e){return this.nextID(),this.styleTo('border-radius','100%'),c.circle(this._ctx,e[0],e[1][0]),this}static square(e,t,n){let o=d.htmlElement(e.group,'div',c.getID(e));return d.setAttr(o,{class:`pts-form pts-square ${e.currentClass}`}),c.rectStyle(e,new a.Pt(t).$subtract(n),new a.Pt(2*n,2*n)),c.style(o,e.style),o}square(e,t){return this.nextID(),c.square(this._ctx,e,t),this}static rect(e,t){if(this._checkSize(t)){let n=d.htmlElement(e.group,'div',c.getID(e));return d.setAttr(n,{class:`pts-form pts-rect ${e.currentClass}`}),c.rectStyle(e,t[0],t[1]),c.style(n,e.style),n}}rect(e){return this.nextID(),this.styleTo('border-radius','0'),c.rect(this._ctx,e),this}static text(e,t,n){let o=d.htmlElement(e.group,'div',c.getID(e));return d.setAttr(o,{position:'absolute',class:`pts-form pts-text ${e.currentClass}`,left:t[0],top:t[1]}),o.textContent=n,c.style(o,e.style),o}text(e,t){return this.nextID(),c.text(this._ctx,e,t),this}log(e){return this.fill('#000').stroke('#fff',.5).text([10,14],e),this}arc(){return l.Util.warn('arc is not implemented in HTMLForm'),this}line(){return l.Util.warn('line is not implemented in HTMLForm'),this}polygon(){return l.Util.warn('polygon is not implemented in HTMLForm'),this}}c.groupID=0,c.domID=0,t.HTMLForm=c},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(0);t.Typography=class{static textWidthEstimator(e,t=['M','n','.'],n=[.06,.8,.14]){let i=t.map(e),r=new o.Pt(n).dot(i);return(e)=>e.length*r}static truncate(e,t,n,o=''){let i=l(t.length*_(1,n/(1.1*e(t))));return i<t.length?(i=u(0,i-o.length),[t.substr(0,i)+o,i]):[t,t.length]}static fontSizeToBox(e,t=1){let n=e[1][1]-e[0][1];return function(e){let o=(e[1][1]-e[0][1])/n;return t*n*o}}}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(7),i=n(6),r=n(5),a=n(0),s=n(1),d=n(9),c=n(2);class p extends o.MultiTouchSpace{constructor(e,t){super(),this._pixelScale=1,this._autoResize=!0,this._bgcolor='#e1e9f0',this._offscreen=!1,this._initialResize=!1;var n=null,o=!1;this.id='pt';e instanceof Element?(n=e,this.id='pts_existing_space'):(n=document.querySelector(e),o=!0,this.id=e);n?'canvas'==n.nodeName.toLowerCase()?(this._canvas=n,this._container=n.parentElement,this._autoResize=!1):(this._container=n,this._canvas=this._createElement('canvas',this.id+'_canvas'),this._container.appendChild(this._canvas),this._initialResize=!0):(this._container=this._createElement('div',this.id+'_container'),this._canvas=this._createElement('canvas',this.id),this._container.appendChild(this._canvas),document.body.appendChild(this._container),o=!1),setTimeout(this._ready.bind(this,t),100),this._ctx=this._canvas.getContext('2d')}_createElement(e='div',t){let n=document.createElement(e);return n.setAttribute('id',t),n}_ready(e){if(!this._container)throw new Error(`Cannot initiate #${this.id} element`);for(let t in this._isReady=!0,this._resizeHandler(null),this.clear(this._bgcolor),this._canvas.dispatchEvent(new Event('ready')),this.players)this.players.hasOwnProperty(t)&&this.players[t].start&&this.players[t].start(this.bound.clone(),this);this._pointer=this.center,this._initialResize=!1,e&&e(this.bound,this._canvas)}setup(e){if(e.bgcolor&&(this._bgcolor=e.bgcolor),this.autoResize=void 0!=e.resize&&e.resize,!1!==e.retina){let e=window.devicePixelRatio||1,t=this._ctx.webkitBackingStorePixelRatio||this._ctx.mozBackingStorePixelRatio||this._ctx.msBackingStorePixelRatio||this._ctx.oBackingStorePixelRatio||this._ctx.backingStorePixelRatio||1;this._pixelScale=e/t}return e.offscreen?(this._offscreen=!0,this._offCanvas=this._createElement('canvas',this.id+'_offscreen'),this._offCtx=this._offCanvas.getContext('2d')):this._offscreen=!1,this}set autoResize(e){this._autoResize=e,e?window.addEventListener('resize',this._resizeHandler.bind(this)):window.removeEventListener('resize',this._resizeHandler.bind(this))}get autoResize(){return this._autoResize}resize(e,t){for(let n in this.bound=e,this._canvas.width=this.bound.size.x*this._pixelScale,this._canvas.height=this.bound.size.y*this._pixelScale,this._canvas.style.width=l(this.bound.size.x)+'px',this._canvas.style.height=l(this.bound.size.y)+'px',this._offscreen&&(this._offCanvas.width=this.bound.size.x*this._pixelScale,this._offCanvas.height=this.bound.size.y*this._pixelScale),1!=this._pixelScale&&(this._ctx.scale(this._pixelScale,this._pixelScale),this._ctx.translate(.5,.5),this._offscreen&&(this._offCtx.scale(this._pixelScale,this._pixelScale),this._offCtx.translate(.5,.5))),this.players)if(this.players.hasOwnProperty(n)){let e=this.players[n];e.resize&&e.resize(this.bound,t)}return this.render(this._ctx),t&&!this.isPlaying&&this.playOnce(0),this}_resizeHandler(e){let t=this._autoResize||this._initialResize?this._container.getBoundingClientRect():this._canvas.getBoundingClientRect();if(t){let n=r.Bound.fromBoundingRect(t);n.center=n.center.add(window.pageXOffset,window.pageYOffset),this.resize(n,e)}}set background(e){this._bgcolor=e}get background(){return this._bgcolor}get pixelScale(){return this._pixelScale}get hasOffscreen(){return this._offscreen}get offscreenCtx(){return this._offCtx}get offscreenCanvas(){return this._offCanvas}getForm(){return new _(this)}get element(){return this._canvas}get parent(){return this._container}get ready(){return this._isReady}get ctx(){return this._ctx}clear(e){e&&(this._bgcolor=e);let t=this._ctx.fillStyle;return this._bgcolor&&'transparent'!=this._bgcolor?(this._ctx.fillStyle=this._bgcolor,this._ctx.fillRect(-1,-1,this._canvas.width+1,this._canvas.height+1)):this._ctx.clearRect(-1,-1,this._canvas.width+1,this._canvas.height+1),this._ctx.fillStyle=t,this}clearOffscreen(e){return this._offscreen&&(e?(this._offCtx.fillStyle=e,this._offCtx.fillRect(-1,-1,this._canvas.width+1,this._canvas.height+1)):this._offCtx.clearRect(-1,-1,this._offCanvas.width+1,this._offCanvas.height+1)),this}playItems(e){this._isReady&&(this._ctx.save(),this._offscreen&&this._offCtx.save(),super.playItems(e),this._ctx.restore(),this._offscreen&&this._offCtx.restore(),this.render(this._ctx))}}t.CanvasSpace=p;class _ extends i.VisualForm{constructor(e){super(),this._style={fillStyle:'#f03',strokeStyle:'#fff',lineWidth:1,lineJoin:'bevel',lineCap:'butt'},this._space=e,this._space.add({start:()=>{this._ctx=this._space.ctx,this._ctx.fillStyle=this._style.fillStyle,this._ctx.strokeStyle=this._style.strokeStyle,this._ctx.lineJoin='bevel',this._ctx.font=this._font.value,this._ready=!0}})}get space(){return this._space}useOffscreen(e=!0,t=!1){return t&&this._space.clearOffscreen('string'==typeof t?t:null),this._ctx=this._space.hasOffscreen&&e?this._space.offscreenCtx:this._space.ctx,this}renderOffscreen(e=[0,0]){this._space.hasOffscreen&&this._space.ctx.drawImage(this._space.offscreenCanvas,e[0],e[1],this._space.width,this._space.height)}fill(e){return'boolean'==typeof e?this.filled=e:(this.filled=!0,this._style.fillStyle=e,this._ctx.fillStyle=e),this}stroke(e,t,n,o){return'boolean'==typeof e?this.stroked=e:(this.stroked=!0,this._style.strokeStyle=e,this._ctx.strokeStyle=e,t&&(this._ctx.lineWidth=t,this._style.lineWidth=t),n&&(this._ctx.lineJoin=n,this._style.lineJoin=n),o&&(this._ctx.lineCap=o,this._style.lineCap=o)),this}font(e,t,n,o,i){return'number'==typeof e?(this._font.size=e,i&&(this._font.face=i),t&&(this._font.weight=t),n&&(this._font.style=n),o&&(this._font.lineHeight=o),this._ctx.font=this._font.value):this._font=e,this._estimateTextWidth&&this.fontWidthEstimate(!0),this}fontWidthEstimate(e=!0){return this._estimateTextWidth=e?d.Typography.textWidthEstimator((e)=>this._ctx.measureText(e).width):void 0,this}getTextWidth(e){return this._estimateTextWidth?this._estimateTextWidth(e):this._ctx.measureText(e).width}_textTruncate(e,t,n=''){return d.Typography.truncate(this.getTextWidth.bind(this),e,t,n)}_textAlign(e,t,n,o){o||(o=c.Rectangle.center(e));var i=e[0][0];'end'==this._ctx.textAlign||'right'==this._ctx.textAlign?i=e[1][0]:('center'==this._ctx.textAlign||'middle'==this._ctx.textAlign)&&(i=o[0]);var r=o[1];return'top'==t||'start'==t?r=e[0][1]:('end'==t||'bottom'==t)&&(r=e[1][1]),n?new a.Pt(i+n[0],r+n[1]):new a.Pt(i,r)}reset(){for(let e in this._style)this._style.hasOwnProperty(e)&&(this._ctx[e]=this._style[e]);return this._font=new i.Font,this._ctx.font=this._font.value,this}_paint(){this._filled&&this._ctx.fill(),this._stroked&&this._ctx.stroke()}point(e,t=5,n='square'){if(e){if(!_[n])throw new Error(`${n} is not a static function of CanvasForm`);return _[n](this._ctx,e,t),this._paint(),this}}static circle(e,t,n=10){t&&(e.beginPath(),e.arc(t[0],t[1],n,0,s.Const.two_pi,!1),e.closePath())}circle(e){return _.circle(this._ctx,e[0],e[1][0]),this._paint(),this}static arc(e,t,n,o,i,r){t&&(e.beginPath(),e.arc(t[0],t[1],n,o,i,r))}arc(e,t,n,o,i){return _.arc(this._ctx,e,t,n,o,i),this._paint(),this}static square(e,t,n){if(t){let o=t[0]-n,i=t[1]-n,r=t[0]+n,l=t[1]+n;e.beginPath(),e.moveTo(o,i),e.lineTo(o,l),e.lineTo(r,l),e.lineTo(r,i),e.closePath()}}square(e,t){return _.square(this._ctx,e,t),this._paint(),this}static line(e,t){if(!(2>t.length)){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(let n=1,o=t.length;n<o;n++)t[n]&&e.lineTo(t[n][0],t[n][1])}}line(e){return _.line(this._ctx,e),this._paint(),this}static polygon(e,t){if(!(2>t.length)){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(let n=1,o=t.length;n<o;n++)t[n]&&e.lineTo(t[n][0],t[n][1]);e.closePath()}}polygon(e){return _.polygon(this._ctx,e),this._paint(),this}static rect(e,t){2>t.length||(e.beginPath(),e.moveTo(t[0][0],t[0][1]),e.lineTo(t[0][0],t[1][1]),e.lineTo(t[1][0],t[1][1]),e.lineTo(t[1][0],t[0][1]),e.closePath())}rect(e){return _.rect(this._ctx,e),this._paint(),this}static text(e,t,n,o){t&&e.fillText(n,t[0],t[1],o)}text(e,t,n){return _.text(this._ctx,e,t,n),this}textBox(e,n,o='middle',i='',r=!0){r&&(this._ctx.textBaseline=o);let l=c.Rectangle.size(e),a=this._textTruncate(n,l[0],i);return this.text(this._textAlign(e,o),a[0]),this}paragraphBox(e,t,n=1.2,o='top',i=!0){let r=c.Rectangle.size(e);this._ctx.textBaseline='top';let l=this._font.size*n,s=(e,n=[],o=0)=>{if(!e)return n;if(i&&o*l>r[1]-2*l)return n;if(1e4<o)throw new Error('max recursion reached (10000)');let a=this._textTruncate(e,r[0],''),t=a[0].indexOf('\n');if(0<=t)return n.push(a[0].substr(0,t)),s(e.substr(t+1),n,o+1);let d=a[0].lastIndexOf(' ')+1;(0>=d||a[1]===e.length)&&(d=void 0);let c=a[0].substr(0,d);return n.push(c),0>=a[1]||a[1]===e.length?n:s(e.substr(d||a[1]),n,o+1)},d=s(t),p=d.length*l,_=e;if('middle'==o||'center'==o){let t=(r[1]-p)/2;i&&(t=u(0,t)),_=new a.Group(e[0].$add(0,t),e[1].$subtract(0,t))}else _='bottom'==o?new a.Group(e[0].$add(0,r[1]-p),e[1]):new a.Group(e[0],e[0].$add(r[0],p));let h=c.Rectangle.center(_);for(let r=0,a=d.length;r<a;r++)this.text(this._textAlign(_,'top',[0,r*l],h),d[r]);return this}alignText(e='left',t='alphabetic'){return'center'==t&&(t='middle'),'baseline'==t&&(t='alphabetic'),this._ctx.textAlign=e,this._ctx.textBaseline=t,this}log(e){let t=this._ctx.measureText(e).width+20;return this.stroke(!1).fill('rgba(0,0,0,.4)').rect([[0,0],[t,20]]),this.fill('#fff').text([10,14],e),this}}t.CanvasForm=_},function(t,o,i){'use strict';Object.defineProperty(o,'__esModule',{value:!0});const d=i(0),h=i(1),p=i(3);class m extends d.Pt{constructor(...e){super(...e),this._mode='rgb',this._isNorm=!1}static from(...e){let t=[1,1,1,1],n=h.Util.getArgs(e);for(let o=0,i=t.length;o<i;o++)o<n.length&&(t[o]=n[o]);return new m(t)}static fromHex(e){if('#'==e[0]&&(e=e.substr(1)),3>=e.length){let t=(t)=>e[t]||'F';e=`${t(0)}${t(0)}${t(1)}${t(1)}${t(2)}${t(2)}`}let t=1;8===e.length&&(t=e.substr(6)&&1,e=e.substring(0,6));let n=parseInt(e,16);return new m(n>>16,255&n>>8,255&n,t)}static rgb(...e){return m.from(...e).toMode('rgb')}static hsl(...e){return m.from(...e).toMode('hsl')}static hsb(...e){return m.from(...e).toMode('hsb')}static lab(...e){return m.from(...e).toMode('lab')}static lch(...e){return m.from(...e).toMode('lch')}static luv(...e){return m.from(...e).toMode('luv')}static xyz(...e){return m.from(...e).toMode('xyz')}static maxValues(e){return m.ranges[e].zipSlice(1).$take([0,1,2])}get hex(){return this.toString('hex')}get rgb(){return this.toString('rgb')}get rgba(){return this.toString('rgba')}clone(){let e=new m(this);return e.toMode(this._mode),e}toMode(e,t=!1){if(t){let t=this._mode.toUpperCase()+'to'+e.toUpperCase();if(m[t])this.to(m[t](this,this._isNorm,this._isNorm));else throw new Error('Cannot convert color with '+t)}return this._mode=e,this}get mode(){return this._mode}get r(){return this[0]}set r(e){this[0]=e}get g(){return this[1]}set g(e){this[1]=e}get b(){return this[1]}set b(e){this[2]=e}get h(){return'lch'==this._mode?this[2]:this[0]}set h(e){let t='lch'==this._mode?2:0;this[t]=e}get s(){return this[1]}set s(e){this[1]=e}get l(){return'hsl'==this._mode?this[2]:this[0]}set l(e){let t='hsl'==this._mode?2:0;this[t]=e}get a(){return this[1]}set a(e){this[1]=e}get c(){return this[1]}set c(e){this[1]=e}get u(){return this[1]}set u(e){this[1]=e}get v(){return this[1]}set v(e){this[2]=e}get alpha(){return 3<this.length?this[3]:1}normalize(e=!0){if(this._isNorm==e)return this;let t=m.ranges[this._mode];for(let n=0;3>n;n++)this[n]=e?p.Num.mapToRange(this[n],t[n][0],t[n][1],0,1):p.Num.mapToRange(this[n],0,1,t[n][0],t[n][1]);return this._isNorm=e,this}$normalize(e=!0){return this.clone().normalize(e)}toString(e='mode'){if('hex'==e){let e=(e)=>{let t=l(e).toString(16);return 2>t.length?'0'+t:t};return`#${e(this[0])}${e(this[1])}${e(this[2])}`}return'rgba'==e?`rgba(${l(this[0])},${l(this[1])},${l(this[2])},${this.alpha}`:'rgb'==e?`rgb(${l(this[0])},${l(this[1])},${l(this[2])}`:`${this._mode}(${this[0]},${this[1]},${this[2]},${this.alpha})`}static RGBtoHSL(e,t=!1,n=!1){let[o,i,r]=t?e:e.$normalize(),a=u(o,i,r),c=_(o,i,r),p=(a+c)/2,h=p,s=p;if(a==c)p=0,h=0;else{let e=a-c;h=.5<s?e/(2-a-c):e/(a+c),p=0,a===o?p=(i-r)/e+(i<r?6:0):a===i?p=(r-o)/e+2:a===r&&(p=(o-i)/e+4)}return m.hsl(n?p/60:60*p,h,s,e.alpha)}static HSLtoRGB(e,t=!1,n=!1){let[o,i,r]=e;if(t||(o/=360),0==i)return m.rgb(255*r,255*r,255*r,e.alpha);let l=.5>=r?r*(1+i):r+i-r*i,a=2*r-l,s=(e)=>(e=0>e?e+1:1<e?e-1:e,1>6*e?a+6*((l-a)*e):1>2*e?l:2>3*e?a+6*((l-a)*(2/3-e)):a),d=n?1:255;return m.rgb(d*s(o+1/3),d*s(o),d*s(o-1/3),e.alpha)}static RGBtoHSB(e,t=!1,n=!1){let[o,i,r]=t?e:e.$normalize(),l=u(o,i,r),a=_(o,i,r),c=l-a,d=0,p=0===l?0:c/l;return l!=a&&(l===o?d=(i-r)/c+(i<r?6:0):l===i?d=(r-o)/c+2:l===r&&(d=(o-i)/c+4)),m.hsb(n?d/60:60*d,p,l,e.alpha)}static HSBtoRGB(e,n=!1,o=!1){let[r,a,s]=e;n||(r/=360);let d=l(6*r),i=6*r-d,u=s*(1-a),p=s*(1-i*a),_=s*(1-(1-i)*a),t=[[s,_,u],[p,s,u],[u,s,_],[u,p,s],[_,u,s],[s,u,p]][d%6],c=o?1:255;return m.rgb(c*t[0],c*t[1],c*t[2],e.alpha)}static RGBtoLAB(e,t=!1,n=!1){let o=t?e.$normalize(!1):e;return m.XYZtoLAB(m.RGBtoXYZ(o),!1,n)}static LABtoRGB(e,t=!1,n=!1){let o=t?e.$normalize(!1):e;return m.XYZtoRGB(m.LABtoXYZ(o),!1,n)}static RGBtoLCH(e,t=!1,n=!1){let o=t?e.$normalize(!1):e;return m.LABtoLCH(m.RGBtoLAB(o),!1,n)}static LCHtoRGB(e,t=!1,n=!1){let o=t?e.$normalize(!1):e;return m.LABtoRGB(m.LCHtoLAB(o),!1,n)}static RGBtoLUV(e,t=!1,n=!1){let o=t?e.$normalize(!1):e;return m.XYZtoLUV(m.RGBtoXYZ(o),!1,n)}static LUVtoRGB(e,t=!1,n=!1){let o=t?e.$normalize(!1):e;return m.XYZtoRGB(m.LUVtoXYZ(o),!1,n)}static RGBtoXYZ(t,n=!1,o=!1){let r=n?t.clone():t.$normalize();for(let l=0;3>l;l++)r[l]=.04045<r[l]?e((r[l]+.055)/1.055,2.4):r[l]/12.92,o||(r[l]*=100);let i=m.xyz(.4124564*r[0]+.3575761*r[1]+.1804375*r[2],.2126729*r[0]+.7151522*r[1]+.072175*r[2],.0193339*r[0]+.119192*r[1]+.9503041*r[2],t.alpha);return o?i.normalize():i}static XYZtoRGB(t,n=!1,o=!1){let[i,r,l]=n?t:t.$normalize(),a=[3.2404542*i+-1.5371385*r+-.4985314*l,-.969266*i+1.8760108*r+.041556*l,.0556434*i+-.2040259*r+1.0572252*l];for(let r=0;3>r;r++)a[r]=0>a[r]?0:.0031308<a[r]?1.055*e(a[r],1/2.4)-.055:12.92*a[r],a[r]=u(0,_(1,a[r])),o||(a[r]=Math.round(255*a[r]));let s=m.rgb(a[0],a[1],a[2],t.alpha);return o?s.normalize():s}static XYZtoLAB(t,n=!1,o=!1){let i=n?t.$normalize(!1):t.clone();i.divide(m.D65);let r=(t)=>.008856<t?e(t,1/3):7.787*t+16/116,l=r(i[1]),a=m.lab(116*l-16,500*(r(i[0])-l),200*(l-r(i[2])),t.alpha);return o?a.normalize():a}static LABtoXYZ(e,t=!1,n=!1){let o=t?e.$normalize(!1):e,i=(o[0]+16)/116,r=o[1]/500+i,l=i-o[2]/200,a=(e)=>{let t=e*e*e;return .008856<t?t:(e-16/116)/7.787},s=m.D65,d=m.xyz(u(0,s[0]*a(r)),u(0,s[1]*a(i)),u(0,s[2]*a(l)),e.alpha);return n?d.normalize():d}static XYZtoLUV(t,n=!1,o=!1){let[i,r,l]=n?t.$normalize(!1):t,a=4*i/(i+15*r+3*l),s=9*r/(i+15*r+3*l);r/=100,r=.008856<r?e(r,1/3):7.787*r+16/116;let d=4*m.D65[0]/(m.D65[0]+15*m.D65[1]+3*m.D65[2]),c=9*m.D65[1]/(m.D65[0]+15*m.D65[1]+3*m.D65[2]),u=116*r-16;return m.luv(u,13*u*(a-d),13*u*(s-c),t.alpha)}static LUVtoXYZ(e,t=!1,n=!1){let[o,i,r]=t?e.$normalize(!1):e,l=(o+16)/116,a=l*l*l;l=.008856<a?a:(l-16/116)/7.787;let s=4*m.D65[0]/(m.D65[0]+15*m.D65[1]+3*m.D65[2]),d=9*m.D65[1]/(m.D65[0]+15*m.D65[1]+3*m.D65[2]);i=i/(13*o)+s,r=r/(13*o)+d,l*=100;let c=-1*(9*l*i)/((i-4)*r-i*r),u=(9*l-15*r*l-r*c)/(3*r);return m.xyz(c,l,u,e.alpha)}static LABtoLCH(e,t=!1,o=!1){let i=t?e.$normalize(!1):e,l=p.Geom.toDegree(p.Geom.boundRadian(r(i[2],i[1])));return m.lch(i[0],n(i[1]*i[1]+i[2]*i[2]),l,e.alpha)}static LCHtoLAB(e,t=!1,n=!1){let o=t?e.$normalize(!1):e,i=p.Geom.toRadian(o[2]);return m.lab(o[0],s(i)*o[1],a(i)*o[1],e.alpha)}}m.D65=new d.Pt(95.047,100,108.883,1),m.ranges={rgb:new d.Group(new d.Pt(0,255),new d.Pt(0,255),new d.Pt(0,255)),hsl:new d.Group(new d.Pt(0,360),new d.Pt(0,1),new d.Pt(0,1)),hsb:new d.Group(new d.Pt(0,360),new d.Pt(0,1),new d.Pt(0,1)),lab:new d.Group(new d.Pt(0,100),new d.Pt(-128,127),new d.Pt(-128,127)),lch:new d.Group(new d.Pt(0,100),new d.Pt(0,100),new d.Pt(0,360)),luv:new d.Group(new d.Pt(0,100),new d.Pt(-134,220),new d.Pt(-140,122)),xyz:new d.Group(new d.Pt(0,100),new d.Pt(0,100),new d.Pt(0,100))},o.Color=m},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(0),r=n(2),s=n(1),a=n(3),d=n(4);t.Create=class{static distributeRandom(e,t,n=2){let r=new o.Group;for(let l,a=0;a<t;a++)l=[e.x+Math.random()*e.width],1<n&&l.push(e.y+Math.random()*e.height),2<n&&l.push(e.z+Math.random()*e.depth),r.push(new o.Pt(l));return r}static distributeLinear(e,t){let n=r.Line.subpoints(e,t-2);return n.unshift(e[0]),n.push(e[e.length-1]),n}static gridPts(e,t,n,i=[.5,.5]){if(0===t||0===n)throw new Error('grid columns and rows cannot be 0');let l=e.size.$subtract(1).$divide(t,n),a=l.$multiply(i),s=new o.Group;for(let o=0;o<n;o++)for(let n=0;n<t;n++)s.push(e.topLeft.$add(l.$multiply(n,o)).add(a));return s}static gridCells(e,t,n){if(0===t||0===n)throw new Error('grid columns and rows cannot be 0');let i=e.size.$subtract(1).divide(t,n),l=[];for(let a=0;a<n;a++)for(let n=0;n<t;n++)l.push(new o.Group(e.topLeft.$add(i.$multiply(n,a)),e.topLeft.$add(i.$multiply(n,a).add(i))));return l}static radialPts(e,t,n){let r=new o.Group,l=s.Const.two_pi/n;for(let a=0;a<n;a++)r.push(new o.Pt(e).toAngle(l*a-s.Const.half_pi,t,!0));return r}static noisePts(e,t=.01,n=.01,a=0,s=0){let d=Math.random(),u=new o.Group;for(let o=0,i=e.length;o<i;o++){let i=new h(e[o]),p=a&&0<a?l(o/a):o,r=s&&0<s?o%s:o;i.initNoise(t*r,n*p),i.seed(d),u.push(i)}return u}static delaunay(e){return i.from(e)}};const c=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,9,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];class h extends o.Pt{constructor(...e){super(...e),this.perm=[],this._n=new o.Pt(.01,.01),this.perm=p.concat(p)}initNoise(...e){this._n=new o.Pt(...e)}step(e=0,t=0){this._n.add(e,t)}seed(e){0<e&&1>e&&(e*=65536),e=l(e),256>e&&(e|=e<<8);for(let t,n=0;255>n;n++)t=1&n?p[n]^255&e:p[n]^255&e>>8,this.perm[n]=this.perm[n+256]=t}noise2D(){let e=l(this._n[0])%255,t=l(this._n[1])%255,n=this._n[0]%255-e,o=this._n[1]%255-t,i=d.Vec.dot(c[(e+this.perm[t])%12],[n,o,0]),r=d.Vec.dot(c[(e+this.perm[t+1])%12],[n,o-1,0]),s=d.Vec.dot(c[(e+1+this.perm[t])%12],[n-1,o,0]),u=d.Vec.dot(c[(e+1+this.perm[t+1])%12],[n-1,o-1,0]),p=(e)=>e*e*e*(e*(6*e-15)+10),_=p(n);return a.Num.lerp(a.Num.lerp(i,s,_),a.Num.lerp(r,u,_),p(o))}}t.Noise=h;class i extends o.Group{constructor(){super(...arguments),this._mesh=[]}delaunay(e=!0){if(3>this.length)return[];this._mesh=[];let t=this.length,n=[];for(let o=0;o<t;o++)n[o]=o;n.sort((e,t)=>this[t][0]-this[e][0]);let o=this.slice(),r=this._superTriangle();o=o.concat(r);let l=[this._circum(t,t+1,t+2,r)],a=[],d=[];for(let t=0,r=n.length;t<r;t++){let e=n[t],r=[],c=l.length;for(this._mesh[e]||(this._mesh[e]={});c--;){let t=l[c],n=t.circle[1][0],i=o[e].$subtract(t.circle[0]);if(0<i[0]&&i[0]*i[0]>n*n){a.push(t),d.push(t.triangle),l.splice(c,1);continue}i[0]*i[0]+i[1]*i[1]-n*n>s.Const.epsilon||(r.push(t.i,t.j,t.j,t.k,t.k,t.i),l.splice(c,1))}for(i._dedupe(r),c=r.length;1<c;)l.push(this._circum(r[--c],r[--c],e,!1,o))}for(let n,o=0,i=l.length;o<i;o++)n=l[o],n.i<t&&n.j<t&&n.k<t&&(a.push(n),d.push(n.triangle),this._cache(n));return e?d:a}voronoi(){let e=[],t=this._mesh;for(let n=0,o=t.length;n<o;n++)e.push(this.neighborPts(n,!0));return e}mesh(){return this._mesh}neighborPts(e,t=!1){let i=new o.Group,r=this._mesh;for(let n in r[e])r[e].hasOwnProperty(n)&&i.push(r[e][n].circle[0]);return t?a.Geom.sortEdges(i):i}neighbors(e){let t=[],o=this._mesh;for(let n in o[e])o[e].hasOwnProperty(n)&&t.push(o[e][n]);return t}_cache(e){this._mesh[e.i][`${_(e.j,e.k)}-${u(e.j,e.k)}`]=e,this._mesh[e.j][`${_(e.i,e.k)}-${u(e.i,e.k)}`]=e,this._mesh[e.k][`${_(e.i,e.j)}-${u(e.i,e.j)}`]=e}_superTriangle(){let e=this[0],t=this[0];for(let n=1,o=this.length;n<o;n++)e=e.$min(this[n]),t=t.$max(this[n]);let n=t.$subtract(e),i=e.$add(t).divide(2),r=u(n[0],n[1]);return new o.Group(i.$subtract(20*r,r),i.$add(0,20*r),i.$add(20*r,-r))}_triangle(e,t,n,i=this){return new o.Group(i[e],i[t],i[n])}_circum(e,n,o,l,a=this){let s=l||this._triangle(e,n,o,a);return{i:e,j:n,k:o,triangle:s,circle:r.Triangle.circumcircle(s)}}static _dedupe(e){for(let t=e.length;1<t;)for(let o=e[--t],r=e[--t],l=t;1<l;){let i=e[--l],n=e[--l];if(r==n&&o==i||r==i&&o==n){e.splice(t,2),e.splice(l,2);break}}return e}}t.Delaunay=i},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(6),i=n(3),r=n(1),l=n(0),a=n(2),s=n(8);class c extends s.DOMSpace{constructor(e,t){if(super(e,t),this.id='svgspace',this._bgcolor='#999','svg'!=this._canvas.nodeName.toLowerCase()){let e=c.svgElement(this._canvas,'svg',`${this.id}_svg`);this._container=this._canvas,this._canvas=e}}getForm(){return new u(this)}get element(){return this._canvas}resize(e,t){return super.resize(e,t),c.setAttr(this.element,{viewBox:`0 0 ${this.bound.width} ${this.bound.height}`,width:`${this.bound.width}`,height:`${this.bound.height}`,xmlns:'http://www.w3.org/2000/svg',version:'1.1'}),this}static svgElement(e,t,n){if(!e||!e.appendChild)throw new Error('parent is not a valid DOM element');let o=document.querySelector(`#${n}`);return o||(o=document.createElementNS('http://www.w3.org/2000/svg',t),o.setAttribute('id',n),e.appendChild(o)),o}remove(e){let t=this._container.querySelectorAll('.'+u.scopeID(e));return t.forEach((e)=>{e.parentNode.removeChild(e)}),super.remove(e)}removeAll(){return this._container.innerHTML='',super.removeAll()}}t.SVGSpace=c;class u extends o.VisualForm{constructor(e){super(),this._ctx={group:null,groupID:'pts',groupCount:0,currentID:'pts0',currentClass:'',style:{filled:!0,stroked:!0,fill:'#f03',stroke:'#fff',"stroke-width":1,"stroke-linejoin":'bevel',"stroke-linecap":'sqaure'},font:'11px sans-serif',fontSize:11,fontFamily:'sans-serif'},this._ready=!1,this._space=e,this._space.add({start:()=>{this._ctx.group=this._space.element,this._ctx.groupID='pts_svg_'+u.groupID++,this._ready=!0}})}get space(){return this._space}styleTo(e,t){if(this._ctx.style[e]===void 0)throw new Error(`${e} style property doesn't exist`);this._ctx.style[e]=t}fill(e){return'boolean'==typeof e?this.styleTo('filled',e):(this.styleTo('filled',!0),this.styleTo('fill',e)),this}stroke(e,t,n,o){return'boolean'==typeof e?this.styleTo('stroked',e):(this.styleTo('stroked',!0),this.styleTo('stroke',e),t&&this.styleTo('stroke-width',t),n&&this.styleTo('stroke-linejoin',n),o&&this.styleTo('stroke-linecap',o)),this}cls(e){return this._ctx.currentClass='boolean'==typeof e?'':e,this}font(e,t,n,o,i){return'number'==typeof e?(this._font.size=e,i&&(this._font.face=i),t&&(this._font.weight=t),n&&(this._font.style=n),o&&(this._font.lineHeight=o),this._ctx.font=this._font.value):this._font=e,this}reset(){return this._ctx.style={filled:!0,stroked:!0,fill:'#f03',stroke:'#fff',"stroke-width":1,"stroke-linejoin":'bevel',"stroke-linecap":'sqaure'},this._font=new o.Font(14,'sans-serif'),this._ctx.font=this._font.value,this}updateScope(e,t){return this._ctx.group=t,this._ctx.groupID=e,this._ctx.groupCount=0,this.nextID(),this._ctx}scope(e){if(!e||null==e.animateID)throw new Error('item not defined or not yet added to Space');return this.updateScope(u.scopeID(e),this.space.element)}nextID(){return this._ctx.groupCount++,this._ctx.currentID=`${this._ctx.groupID}-${this._ctx.groupCount}`,this._ctx.currentID}static getID(e){return e.currentID||`p-${u.domID++}`}static scopeID(e){return`item-${e.animateID}`}static style(e,t){let n=[];for(let o in t.filled||n.push('fill: none'),t.stroked||n.push('stroke: none'),t)if(t.hasOwnProperty(o)&&'filled'!=o&&'stroked'!=o){let e=t[o];if(e)if(!t.filled&&0===o.indexOf('fill'))continue;else if(!t.stroked&&0===o.indexOf('stroke'))continue;else n.push(`${o}: ${e}`)}return s.DOMSpace.setAttr(e,{style:n.join(';')})}static point(e,t,n=5,o='square'){return'circle'===o?u.circle(e,t,n):u.square(e,t,n)}point(e,t=5,n='square'){return this.nextID(),u.point(this._ctx,e,t,n),this}static circle(e,t,n=10){let o=c.svgElement(e.group,'circle',u.getID(e));return s.DOMSpace.setAttr(o,{cx:t[0],cy:t[1],r:n,class:`pts-svgform pts-circle ${e.currentClass}`}),u.style(o,e.style),o}circle(e){return this.nextID(),u.circle(this._ctx,e[0],e[1][0]),this}static arc(e,t,n,o,a,p){let _=c.svgElement(e.group,'path',u.getID(e));const h=new l.Pt(t).toAngle(o,n,!0),g=new l.Pt(t).toAngle(a,n,!0),m=i.Geom.boundAngle(a)-i.Geom.boundAngle(o);let f=!!(m>r.Const.pi);p&&(f=!f);const y=p?'0':'1',x=`M ${h[0]} ${h[1]} A ${n} ${n} 0 ${f?'1':'0'} ${y} ${g[0]} ${g[1]}`;return s.DOMSpace.setAttr(_,{d:x,class:`pts-svgform pts-arc ${e.currentClass}`}),u.style(_,e.style),_}arc(e,t,n,o,i){return this.nextID(),u.arc(this._ctx,e,t,n,o,i),this}static square(e,t,n){let o=c.svgElement(e.group,'rect',u.getID(e));return s.DOMSpace.setAttr(o,{x:t[0]-n,y:t[1]-n,width:2*n,height:2*n,class:`pts-svgform pts-square ${e.currentClass}`}),u.style(o,e.style),o}square(e,t){return this.nextID(),u.square(this._ctx,e,t),this}static line(e,t){if(this._checkSize(t)){if(2<t.length)return u._poly(e,t,!1);let n=c.svgElement(e.group,'line',u.getID(e));return s.DOMSpace.setAttr(n,{x1:t[0][0],y1:t[0][1],x2:t[1][0],y2:t[1][1],class:`pts-svgform pts-line ${e.currentClass}`}),u.style(n,e.style),n}}line(e){return this.nextID(),u.line(this._ctx,e),this}static _poly(e,t,n=!0){if(this._checkSize(t)){let o=c.svgElement(e.group,n?'polygon':'polyline',u.getID(e)),i=t.reduce((e,t)=>e+`${t[0]},${t[1]} `,'');return s.DOMSpace.setAttr(o,{points:i,class:`pts-svgform pts-polygon ${e.currentClass}`}),u.style(o,e.style),o}}static polygon(e,t){return u._poly(e,t,!0)}polygon(e){return this.nextID(),u.polygon(this._ctx,e),this}static rect(e,t){if(this._checkSize(t)){let n=c.svgElement(e.group,'rect',u.getID(e)),o=l.Group.fromArray(t).boundingBox(),i=a.Rectangle.size(o);return s.DOMSpace.setAttr(n,{x:o[0][0],y:o[0][1],width:i[0],height:i[1],class:`pts-svgform pts-rect ${e.currentClass}`}),u.style(n,e.style),n}}rect(e){return this.nextID(),u.rect(this._ctx,e),this}static text(e,t,n){let o=c.svgElement(e.group,'text',u.getID(e));return s.DOMSpace.setAttr(o,{"pointer-events":'none',x:t[0],y:t[1],dx:0,dy:0,class:`pts-svgform pts-text ${e.currentClass}`}),o.textContent=n,u.style(o,e.style),o}text(e,t){return this.nextID(),u.text(this._ctx,e,t),this}log(e){return this.fill('#000').stroke('#fff',.5).text([10,14],e),this}}u.groupID=0,u.domID=0,t.SVGForm=u},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(2);var i;(function(e){e[e.Rectangle=0]='Rectangle',e[e.Circle=1]='Circle',e[e.Polygon=2]='Polygon',e[e.Polyline=3]='Polyline',e[e.Line=4]='Line'})(i=t.UIShape||(t.UIShape={})),t.UIPointerActions={up:'up',down:'down',move:'move',drag:'drag',drop:'drop',over:'over',out:'out'};class r{constructor(e,t,n,o){this.group=e,this.shape=t,this._id=o,this._states=n,this._actions={}}get id(){return this._id}set id(e){this._id=e}state(e){return this._states[e]||!1}on(e,t){return this._actions[e]=t,this}off(e){return delete this._actions[e],this}listen(e,t){return!!(void 0!==this._actions[e]&&this._trigger(t))&&(this._actions[e](t,this,e),!0)}render(e){e(this.group,this._states)}_trigger(e){let t=null;if(this.shape===i.Rectangle)t=o.Rectangle.withinBound;else if(this.shape===i.Circle)t=o.Circle.withinBound;else if(this.shape===i.Polygon)t=o.Rectangle.withinBound;else return!1;return t(this.group,e)}}t.UI=r;class l extends r{constructor(e,t,n,o){super(e,t,n,o),this._clicks=0}get clicks(){return this._clicks}onClick(e){this._clicks++,this.on(t.UIPointerActions.up,e)}onHover(e,n){this.on(t.UIPointerActions.over,e),this.on(t.UIPointerActions.out,n)}}t.UIButton=l},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const o=n(5),i=n(10),r=n(12),l=n(6),a=n(4),s=n(3),d=n(2),c=n(0),u=n(7),p=n(11),_=n(1),h=n(8),g=n(13),m=n(9);e.exports=Object.assign({namespace:(t)=>{let n=e.exports;for(let e in n)'namespace'!=e&&(t[e]=n[e])}},o,i,r,l,a,d,s,c,u,_,p,h,g,m)}])})}])});
//# sourceMappingURL=pts.min.js.map