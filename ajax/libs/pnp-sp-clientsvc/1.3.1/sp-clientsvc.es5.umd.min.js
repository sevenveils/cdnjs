/**
 * @license
 * v1.3.1
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2019 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https://github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@pnp/common"),require("@pnp/odata"),require("@pnp/sp"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","@pnp/common","@pnp/odata","@pnp/sp","@pnp/logging"],e):e((t.pnp=t.pnp||{},t.pnp["sp-clientsvc"]={}),t.pnp.common,t.pnp.odata,t.pnp.sp,t.pnp.logging)}(this,function(t,p,h,l,i){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function e(){return'<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />'}function a(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var n=[];return n.push('<Query Id="$$ID$$" ObjectPathId="$$PATH_ID$$">'),null===t||t.length<1?(n.push('<Query SelectAllProperties="true" >'),n.push("<Properties />")):(n.push('<Query SelectAllProperties="false" >'),n.push("<Properties>"),[].push.apply(n,t.map(function(t){return'<Property Name="'+t+'" SelectAll="true" />'})),n.push("</Properties>")),n.push("</Query >"),null!==e&&(e.length<1?(n.push('<ChildItemQuery SelectAllProperties="true" >'),n.push("<Properties />")):(n.push('<ChildItemQuery SelectAllProperties="false" >'),n.push("<Properties>"),[].push.apply(n,e.map(function(t){return'<Property Name="'+t+'" SelectAll="true" />'})),n.push("</Properties>")),n.push("</ChildItemQuery >")),n.push("</Query >"),n.join("")}function o(t,e,n){var r=[];return r.push('<SetProperty Id="$$ID$$" ObjectPathId="$$PATH_ID$$" Name="'+t+'">'),r.push('<Parameter Type="'+e+'">'+n+"</Parameter>"),r.push("</SetProperty>"),r.join("")}function u(t,e){var n=[];if(n.push('<Method Id="$$ID$$" ObjectPathId="$$PATH_ID$$" Name="'+t+'">'),null!==e){var r=e.toArray();r.length<1?n.push("<Parameters />"):(n.push("<Parameters>"),[].push.apply(n,r.map(function(t){return'<Parameter Type="'+t.type+'">'+t.value+"</Parameter>"})),n.push("</Parameters>"))}return n.push("</Method>"),n.join("")}function c(n){return Object.getOwnPropertyNames(n).map(function(t){var e=n[t];return"boolean"==typeof e?o(t,"Boolean",""+e):"number"==typeof e?o(t,"Number",""+e):"string"==typeof e?o(t,"String",""+e):""},[])}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new P('<Property Id="$$ID$$" ParentId="$$PARENT_ID$$" Name="'+t+'" />',e)}function f(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return new P('<StaticMethod Id="$$ID$$" Name="'+t+'" TypeId="'+e+'" />',n)}function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return new P('<StaticProperty Id="$$ID$$" Name="'+t+'" TypeId="'+e+'" />',n)}var y=function(){function n(t){void 0===t&&(t=[]),this._p=t}return n.build=function(t){void 0===t&&(t=[]);var e=new n;return[].push.apply(e._p,t),e},n.prototype.string=function(t){return this.a("String",t)},n.prototype.number=function(t){return this.a("Number",t.toString())},n.prototype.boolean=function(t){return this.a("Boolean",t.toString())},n.prototype.strArray=function(t){return this.a("Array",t.map(function(t){return'<Object Type="String">'+t+"</Object>"}).join(""))},n.prototype.objectPath=function(t){return this.a("ObjectPath",t.toString())},n.prototype.toArray=function(){return this._p},n.prototype.a=function(t,e){return this._p.push({type:t,value:e}),this},n}();function b(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=[];if(o.push('<Method Id="$$ID$$" ParentId="$$PARENT_ID$$" Name="'+t+'">'),null!==e){var i=e.toArray();i.length<1?o.push("<Parameters />"):(o.push("<Parameters>"),[].push.apply(o,i.map(function(t){return"ObjectPath"===t.type?'<Parameter ObjectPathId="$$OP_PARAM_ID_'+t.value+'$$" />':'<Parameter Type="'+t.type+'">'+t.value+"</Parameter>"})),o.push("</Parameters>"))}return o.push("</Method>"),new P(o.join(""),n)}function _(t){var e=[],n=[];return t.forEach(function(t){n.push(t.path),e.push.apply(e,t.actions)}),['<Request xmlns="http://schemas.microsoft.com/sharepoint/clientquery/2009" SchemaVersion="15.0.0.0" LibraryVersion="16.0.0.0" ApplicationName="PnPjs">',"<Actions>",e.join(""),"</Actions>","<ObjectPaths>",n.join(""),"</ObjectPaths>","</Request>"].join("")}var P=function(t,e,n,r){void 0===e&&(e=[]),void 0===n&&(n=-1),void 0===r&&(r=[]),this.path=t,this.actions=e,this.id=n,this.replaceAfter=r};function I(t,e){return e.replace(/\$\$ID\$\$/g,t)}function $(t,e){return e.replace(/\$\$PATH_ID\$\$/g,t)}function g(t,e){return e.replace(/\$\$PARENT_ID\$\$/g,t)}function v(t,e,n){void 0===n&&(n=function(t){return t});var r=/\$\$OP_PARAM_ID_(\d+)\$\$/gi.exec(e);if(null!==r)for(var o=1;o<r.length;o++){var i=parseInt(r[o],10),s=new RegExp("\\$\\$OP_PARAM_ID_"+i+"\\$\\$","ig");e=e.replace(s,t[n(i)].toString())}return e}var m=function(){function e(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this._paths=t,this._relationships=e,this._contextIndex=-1,this._siteIndex=-1,this._webIndex=-1}return e.prototype.add=function(t){return this.dirty(),this._paths.push(t),this.lastIndex},e.prototype.addChildRelationship=function(t,e){p.objectDefinedNotNull(this._relationships["_"+t])?this._relationships["_"+t].push(e):this._relationships["_"+t]=[e]},e.prototype.getChildRelationship=function(t){return p.objectDefinedNotNull(this._relationships["_"+t])?this._relationships["_"+t]:[]},e.prototype.getChildRelationships=function(){return this._relationships},e.prototype.appendAction=function(t,e){return this.dirty(),t.actions.push(e),this},e.prototype.appendActionToLast=function(t){return this.appendAction(this.last,t)},e.prototype.copy=function(){var t=new e(this.toArray(),p.extend({},this._relationships));return t._contextIndex=this._contextIndex,t._siteIndex=this._siteIndex,t._webIndex=this._webIndex,t},e.prototype.clone=function(){var t=new e(this.toArray().map(function(t){return Object.assign({},t)}),p.extend({},this._relationships));return t._contextIndex=this._contextIndex,t._siteIndex=this._siteIndex,t._webIndex=this._webIndex,t},e.prototype.toArray=function(){return this._paths.slice(0)},Object.defineProperty(e.prototype,"last",{get:function(){return this._paths.length<1?null:this._paths[this.lastIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastIndex",{get:function(){return this._paths.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"siteIndex",{get:function(){if(this._siteIndex<0){var t=this.contextIndex;this._siteIndex=this.add(d("Site",'<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />')),this.addChildRelationship(t,this._siteIndex)}return this._siteIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webIndex",{get:function(){if(this._webIndex<0){var t=this.contextIndex;this._webIndex=this.add(d("Web",'<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />')),this.addChildRelationship(t,this._webIndex)}return this._webIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contextIndex",{get:function(){return this._contextIndex<0&&(this._contextIndex=this.add(n("Current","{3747adcd-a3c3-41b9-bfab-4a64dd2f1e0a}",'<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />'))),this._contextIndex},enumerable:!0,configurable:!0}),e.prototype.toBody=function(){return p.objectDefinedNotNull(this._xml)||(this._xml=_(this.toIndexedTree())),this._xml},e.prototype.toIndexedTree=function(){var o=this,i=-1,s=-1,a=[];return this.toArray().map(function(t,e,n){var r=++i;return a.push(r),t.path=v(a,I(r.toString(),t.path)),0<=s&&(t.path=g(s.toString(),t.path)),t.actions=t.actions.map(function(t){return I((++i).toString(),$(r.toString(),t))}),o.getChildRelationship(e).forEach(function(t){n[t].path=g(r.toString(),n[t].path)}),s=r,t})},e.prototype.dirty=function(){this._xml=null},e}(),j=function(){function t(t){this.op=t}return t.prototype.parse=function(t){var e=this;return t.text().then(function(e){if(!t.ok)throw Error(e);try{return JSON.parse(e)}catch(t){throw Error(e)}}).then(function(t){if(0<t.length&&p.hOP(t[0],"ErrorInfo")&&null!==t[0].ErrorInfo)throw Error(p.jsS(t[0].ErrorInfo));return e.findResult(t)})},t.prototype.findResult=function(t){for(var e=0;e<this.op.actions.length;e++){var n,r=this.op.actions[e];if(/^<ObjectPath /i.test(r))if(!(n=this.getParsedResultById(t,parseInt(p.getAttrValueFromString(r,"Id"),10)))||n&&n.IsNull)return Promise.resolve(null);if(/^<Query /i.test(r))return(n=this.getParsedResultById(t,parseInt(p.getAttrValueFromString(r,"Id"),10)))&&p.hOP(n,"_Child_Items_")?Promise.resolve(n._Child_Items_):Promise.resolve(n);if(e===this.op.actions.length-1&&/^<Method /i.test(r))return Promise.resolve(this.getParsedResultById(t,parseInt(p.getAttrValueFromString(r,"Id"),10)))}},t.prototype.getParsedResultById=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return t[n+1];return null},t}(),x="_vti_bin/client.svc/ProcessQuery",O=function(o){function t(t,e){void 0===t&&(t=""),void 0===e&&(e=null);var n=o.call(this)||this;return n._objectPaths=e,n._selects=[],n._batch=null,n._batchDependency=null,"string"==typeof t?(n._parentUrl=t,n._url=p.combine(t.replace(x,""),x),p.objectDefinedNotNull(n._objectPaths)||(n._objectPaths=new m)):(n._parentUrl=t._parentUrl,n._url=p.combine(t._parentUrl,x),p.objectDefinedNotNull(e)||(n._objectPaths=t._objectPaths.clone()),n.configureFrom(t)),n}return s(t,o),t.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return[].push.apply(this._selects,t),this},t.prototype.inBatch=function(t){if(null!==this.batch)throw Error("This query is already part of a batch.");return p.objectDefinedNotNull(t)&&(this._batch=t,this._batchDependency=t.addDependency()),this},t.prototype.toUrlAndQuery=function(){return o.prototype.toUrl.call(this)+"?"+Array.from(this.query).map(function(t){return t[0]+"="+t[1]}).join("&")},t.prototype.getSelects=function(){return p.objectDefinedNotNull(this._selects)?this._selects:[]},t.prototype.getChild=function(t,e,n){var r=this._objectPaths.copy();return r.add(b(e,n,'<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />')),new t(this,r)},t.prototype.getChildProperty=function(t,e){var n=this._objectPaths.copy();return n.add(d(e)),new t(this,n)},t.prototype.send=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n=null);var r=t.clone();return p.objectDefinedNotNull(n)||(n=new j(r.last)),this.hasBatch?e=p.extend(e,{clientsvc_ObjectPaths:r}):p.hOP(e,"body")||(e=p.extend(e,{body:r.toBody()})),o.prototype.postCore.call(this,e,n)},t.prototype.sendGet=function(e){var n=this,t=this._objectPaths.copy().appendActionToLast(a(this.getSelects()));return this.send(t).then(function(t){return p.extend(new e(n),t)})},t.prototype.sendGetCollection=function(e){var t=this._objectPaths.copy().appendActionToLast(a([],this.getSelects()));return this.send(t).then(function(t){return t.map(function(t){return p.extend(e(t),t)})})},t.prototype.invokeMethod=function(t,e){void 0===e&&(e=null);for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.invokeMethodImpl(t,e,n,a([],null))},t.prototype.invokeMethodAction=function(t,e){void 0===e&&(e=null);for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.invokeMethodImpl(t,e,n,null,!0)},t.prototype.invokeNonQuery=function(t,e){void 0===e&&(e=null);for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._useCaching=!1,this.invokeMethodImpl(t,e,n,null,!0)},t.prototype.invokeMethodCollection=function(t,e){void 0===e&&(e=null);for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.invokeMethodImpl(t,e,n,a([],[]))},t.prototype.invokeUpdate=function(t,e){var n=this,r=this._objectPaths.copy();return c(t).map(function(t){return r.appendActionToLast(t)}),r.appendActionToLast(a([],null)),this.send(r).then(function(t){return p.extend(new e(n),t)})},t.prototype.toRequestContext=function(i,s,a,u){var c=this;return l.toAbsoluteUrl(this.toUrlAndQuery()).then(function(t){p.mergeOptions(s,c._options);var e=new Headers;if(p.mergeHeaders(e,s.headers),p.mergeHeaders(e,{accept:"*/*","content-type":"text/xml"}),s=p.extend(s,{headers:e}),c._useCaching){var n=s.body;p.stringIsNullOrEmpty(n)&&(n=p.hOP(s,"clientsvc_ObjectPaths")?s.clientsvc_ObjectPaths.clone().toBody():"");var r="PnPjs.ProcessQueryClient("+p.getHashCode(n)+")";p.objectDefinedNotNull(c._cachingOptions)?/\/client\.svc\/ProcessQuery\?$/i.test(c._cachingOptions.key)&&(c._cachingOptions.key=r):c._cachingOptions=new h.CachingOptions(r)}var o=c.hasBatch?c._batchDependency:function(){};return{batch:c.batch,batchDependency:o,cachingOptions:c._cachingOptions,clientFactory:function(){return new l.SPHttpClient},isBatched:c.hasBatch,isCached:c._useCaching,options:s,parser:a,pipeline:u,requestAbsoluteUrl:t,requestId:p.getGUID(),verb:i}})},t.prototype.addBatchDependency=function(){return null!==this._batch?this._batch.addDependency():function(){return null}},Object.defineProperty(t.prototype,"hasBatch",{get:function(){return p.objectDefinedNotNull(this._batch)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batch",{get:function(){return this.hasBatch?this._batch:null},enumerable:!0,configurable:!0}),t.prototype.invokeMethodImpl=function(t,e,n,r,o){void 0===o&&(o=!1);var i=this._objectPaths.copy();return o?i.appendActionToLast(u(t,e)):i.add(b.apply(void 0,[t,e].concat(['<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />'].concat(n,[r])))),this.send(i)},t}(h.Queryable),A=function(r){function t(t,e){var n=r.call(this,e)||this;return n.parentUrl=t,n}return s(t,r),t.prototype.executeImpl=function(){if(this.requests.length<1)return i.Logger.write("Resolving empty batch.",1),Promise.resolve();var t=new D(this.parentUrl,this.batchId);return t.appendRequests(this.requests),t.execute()},t}(h.ODataBatch),D=function(o){function t(t,e){var n=o.call(this,t)||this;n.batchId=e,n._requests=[],n._builderIndex=1;var r=f("GetTaxonomySession","{981cbc68-9edc-4f8d-872f-71146fcbb84f}");return r.path=I("0",r.path),r.actions.push(I("1",$("0",'<ObjectPath Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />'))),n._objectPaths.add(r),n}return s(t,o),t.prototype.appendRequests=function(t){var p=this;t.forEach(function(t){var s=t.options.clientsvc_ObjectPaths,e=s.toArray();if(!(e.length<0)){var a=function(t){return t};/GetTaxonomySession/i.test(e[0].path)&&((e=e.slice(1))[0].path=g("0",e[0].path),a=function(t){return t-1});var u=-1,c=[];e.map(function(t,e,n){var r=++p._builderIndex;c.push(r);var o=v(c,I(r.toString(),t.path),a);0<=u&&(o=g(u.toString(),o));var i=t.actions.map(function(t){return I((++p._builderIndex).toString(),$(r.toString(),t))});return s.getChildRelationship(e+1).map(function(t){return t-1}).forEach(function(t){n[t].path=g(r.toString(),n[t].path)}),u=r,new P(o,i)}).forEach(function(t){return p._objectPaths.add(t)});var n=p._objectPaths.toArray(),r=new j(n[n.length-1]);t.parser instanceof h.CachingParserWrapper?t.parser=new S(r,t.parser):t.parser=r,p._requests.push(t),delete t.options.clientsvc_ObjectPaths}})},t.prototype.execute=function(){var r=this;i.Logger.write("["+this.batchId+"] ("+(new Date).getTime()+") Executing batch with "+this._requests.length+" requests.",1);var t={body:_(this._objectPaths.toArray())};return i.Logger.write("["+this.batchId+"] ("+(new Date).getTime()+") Sending batch request.",1),o.prototype.postCore.call(this,t,new w).then(function(n){return i.Logger.write("["+r.batchId+"] ("+(new Date).getTime()+") Resolving batched requests.",1),r._requests.reduce(function(t,e){return i.Logger.write("["+e.id+"] ("+(new Date).getTime()+") Resolving request in batch "+r.batchId+".",1),t.then(function(t){return e.parser.findResult(n).then(e.resolve).catch(e.reject)})},Promise.resolve())})},t}(O),w=function(t){function e(){return t.call(this,null)||this}return s(e,t),e.prototype.findResult=function(t){return t},e}(j),S=function(n){function t(t,e){return n.call(this,t,e.cacheOptions)||this}return s(t,n),t.prototype.findResult=function(t){var e=this;return this.parser.findResult(t).then(function(t){return e.cacheData(t)})},t}(h.CachingParserWrapper);t.ObjectPathBatch=A,t.ClientSvcQueryable=O,t.ObjectPath=P,t.opSetId=I,t.opSetPathId=$,t.opSetParentId=g,t.opSetPathParamId=v,t.ObjectPathQueue=m,t.objectPath=e,t.identityQuery=function(){return'<ObjectIdentityQuery Id="$$ID$$" ObjectPathId="$$PATH_ID$$" />'},t.opQuery=a,t.setProperty=o,t.methodAction=u,t.objectProperties=c,t.property=d,t.staticMethod=f,t.staticProperty=n,t.objConstructor=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new P('<Constructor Id="$$ID$$" TypeId="'+t+'" />',e)},t.MethodParams=y,t.method=b,t.ProcessQueryParser=j,t.writeObjectPathBody=_,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=sp-clientsvc.es5.umd.min.js.map
