!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n=n||self).Bacon={})}(this,function(n){"use strict";var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)};function t(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function a(){}var h=Array.isArray||function(n){return n instanceof Array};function f(n){return n&&n._isObservable}function y(n,t){for(var r=0;r<n.length;r++)if(!t(n[r]))return!1;return!0}function i(n,t){for(var r=0;r<n.length;r++)if(t(n[r]))return!0;return!1}function u(n,t){return-1!==w(n,t)}function b(n,t){for(var r,e=[],i=0;i<t.length;i++)n(r=t[i])&&e.push(r);return e}function o(r){return function(n,t){return r(t,n)}}function s(n,t,r){for(var e=0;e<n.length;e++)t=r(t,n[e]);return t}function c(n){return n[0]}var w=Array.prototype.indexOf?function(n,t){return n.indexOf(t)}:function(n,t){for(var r=0;r<n.length;r++)if(t===n[r])return r;return-1};function p(n){return"function"==typeof n}function g(n,t){for(var r,e=[],i=0;i<t.length;i++)r=t[i],e.push(n(r));return e}function l(n){return n.slice(1,n.length)}function v(n){return h(n)?n:[n]}function d(t){return"function"==typeof t?t:function(n){return t}}var m={indexOf:w,indexWhere:function(n,t){for(var r=0;r<n.length;r++)if(t(n[r]))return r;return-1},head:c,always:function(n){return function(){return n}},negate:function(t){return function(n){return!t(n)}},empty:function(n){return 0===n.length},tail:l,filter:b,map:g,each:function(n,t){for(var r in n){if(Object.prototype.hasOwnProperty.call(n,r))t(r,n[r])}},toArray:v,contains:u,id:function(n){return n},last:function(n){return n[n.length-1]},all:y,any:i,without:function(t,n){return b(function(n){return n!==t},n)},remove:function(n,t){var r=w(t,n);if(0<=r)return t.splice(r,1)},fold:s,flatMap:function(r,n){return s(n,[],function(n,t){return n.concat(r(t))})},bind:function(n,t){return function(){return n.apply(t,arguments)}},isFunction:p,toFunction:d,toString:function n(t){var r={}.hasOwnProperty;try{if(E++,null==t)return"undefined";if(p(t))return"function";if(h(t))return 5<E?"[..]":"["+g(n,t).toString()+"]";if(null!=(null!=t?t.toString:void 0)&&t.toString!==Object.prototype.toString)return t.toString();if("object"!=typeof t)return t;if(5<E)return"{..}";var e=[];for(var i in t)if(r.call(t,i)){var u=function(){try{return t[i]}catch(n){return n}}();e.push(n(i)+":"+n(u))}return"{"+e+"}"}finally{E--}}},E=0,S=void 0,D="<no-more>",A={scheduler:{setTimeout:function(n,t){return setTimeout(n,t)},setInterval:function(n,t){return setInterval(n,t)},clearInterval:function(n){return clearInterval(n)},clearTimeout:function(n){return clearTimeout(n)},now:function(){return(new Date).getTime()}}};var I=void 0,k=[],B={},_=[],x=0,M={},W=!1;function O(n){n<=x||(_[n-1]||(_[n-1]=[[],0]),x=n)}function P(n,t){if(!I&&!W)return t();O(1);for(var r=0;r<x-1&&!T(n,_[r][0]);)r++;_[r][0].push([n,t]),I||N()}function T(n,t){for(var r=0;r<t.length;r++)if(t[r][0].id==n.id)return!0;return!1}function N(){var n=x;if(n){var t=!W;W=!0;try{for(;n<=x;){var r=_[x-1];if(!r)throw new Error("Unexpected stack top: "+r);var e=r[0],i=r[1];if(!(i<e.length)){r[0]=[],r[1]=0;break}var u=e[i][1];r[1]++,O(x+1);var o=!1;try{for(u(),o=!0;n<x&&0==_[x-1][0].length;)x--}finally{o||(_=[],x=0)}}}finally{t&&(W=!1)}}}function r(n,t){if(I){var r=B[n.id];return void 0===r?(r=B[n.id]=[t],k.push(n)):r.push(t)}return t()}function C(n,t){var r=k[n],e=r.id,i=B[e];k.splice(n,1),delete B[e],t&&0<k.length&&function n(t){if(M[t.id])return;var r=t.internalDeps();for(var e,i=0;i<r.length;i++)if(e=r[i],n(e),B[e.id]){var u=m.indexOf(k,e);C(u,!1)}M[t.id]=!0}(r);for(var u=0;u<i.length;u++)(0,i[u])()}var F={toString:function(){return m.toString({rootEvent:I,processingAfters:W,waiterObs:k,waiters:B,aftersStack:_,aftersStackHeight:x,flushed:M})},whenDoneWith:r,hasWaiters:function(){return 0<k.length},inTransaction:function(n,t,r,e){if(I)return r.apply(t,e);I=n;try{var i=r.apply(t,e);!function(){for(;0<k.length;)C(0,!0);M={}}()}finally{I=void 0,N()}return i},currentEventId:function(){return I?I.id:void 0},wrappedSubscribe:function(t,n,r){function e(){i=!0,o()}var i=!1,u=!1,o=function(){u=!0};return o=n(function(n){return P(t,function(){i||r(n)===D&&e()}),S}),u&&o(),e},afterTransaction:P,soonButNotYet:function(n,t){I?r(n,t):A.scheduler.setTimeout(t,0)},isInTransaction:function(){return void 0!==I}},V=(L.prototype.deps=function(){return this.cachedDeps||(this.cachedDeps=j([this.context].concat(this.args))),this.cachedDeps},L.prototype.toString=function(){var n=m.map(m.toString,this.args);return m.toString(this.context)+"."+m.toString(this.method)+"("+n+")"},L);function L(n,t,r){void 0===r&&(r=[]),this._isDesc=!0,this.context=n,this.method=t,this.args=r}function q(n,t){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];var i=n||t;return i&&i._isDesc?n||t:new V(n,t,r)}function j(n){return h(n)?m.flatMap(j,n):f(n)?[n]:(null!=n?n._isSource:void 0)?[n.obs]:[]}function U(){return S}function Q(){return S}function z(n,t,r){return r.transform(function(n,s){var c=n;return function(n,t){var r=s(c,n),e=r[0],i=r[1];c=e;for(var u=S,o=0;o<i.length;o++){if((u=t(i[o]))===D)return u}return u}}(n,t),new V(r,"withStateMachine",[n,t]))}var H=(R.prototype.getOrElse=function(n){return this.value},R.prototype.get=function(){return this.value},R.prototype.filter=function(n){return n(this.value)?new R(this.value):Y},R.prototype.map=function(n){return new R(n(this.value))},R.prototype.forEach=function(n){n(this.value)},R.prototype.toArray=function(){return[this.value]},R.prototype.inspect=function(){return"Some("+this.value+")"},R.prototype.toString=function(){return this.inspect()},R);function R(n){this._isSome=!0,this.isDefined=!0,this.value=n}var Y={_isNone:!0,getOrElse:function(n){return n},get:function(){throw new Error("None.get()")},filter:function(){return Y},map:function(){return Y},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};function X(){return Y}var $=0,G=(J.prototype.filter=function(n){return!0},J.prototype.inspect=function(){return this.toString()},J.prototype.log=function(){return this.toString()},J.prototype.toNext=function(){return this},J);function J(){this.id=++$,this.isEvent=!0,this._isEvent=!0,this.isEnd=!1,this.isInitial=!1,this.isNext=!1,this.isError=!1,this.hasValue=!1}var K,Z=(t(nn,K=G),nn.prototype.fmap=function(n){return this.apply(n(this.value))},nn.prototype.filter=function(n){return n(this.value)},nn.prototype.toString=function(){return m.toString(this.value)},nn.prototype.log=function(){return this.value},nn);function nn(n){var t=K.call(this)||this;if(t.hasValue=!0,n instanceof G)throw new dn("Wrapping an event inside other event");return t.value=n,t}var tn,rn=(t(en,tn=Z),en.prototype.apply=function(n){return new en(n)},en);function en(n){var t=tn.call(this,n)||this;return t.isNext=!0,t._isNext=!0,t}var un,on=(t(sn,un=Z),sn.prototype.apply=function(n){return new sn(n)},sn.prototype.toNext=function(){return new rn(this.value)},sn);function sn(n){var t=un.call(this,n)||this;return t.isInitial=!0,t._isInitial=!0,t}var cn,fn=(t(an,cn=G),an.prototype.fmap=function(n){return this},an);function an(){var n=null!==cn&&cn.apply(this,arguments)||this;return n.hasValue=!1,n}var hn,pn=(t(ln,hn=fn),ln.prototype.toString=function(){return"<end>"},ln);function ln(){var n=null!==hn&&hn.apply(this,arguments)||this;return n.isEnd=!0,n}var vn,dn=(t(yn,vn=fn),yn.prototype.toString=function(){return"<error> "+m.toString(this.error)},yn);function yn(n){var t=vn.call(this)||this;return t.isError=!0,t.error=n,t}function bn(n){return new on(n)}function wn(n){return new rn(n)}function gn(){return new pn}function mn(n){return n&&n._isEvent?n:wn(n)}function En(n){return n&&n._isEvent}function Sn(n){return n.isError}function Dn(n){return n.hasValue}function An(n){return n.isEnd}function In(n,t){return n===t}function kn(n,t,r){return t.transform(Bn(n),r||new V(t,"take",[n]))}function Bn(r){return function(n,t){return n.hasValue?0<--r?t(n):(0===r&&t(n),t(gn()),D):t(n)}}function _n(t,n,o){var s,c=n,f=!1;return s=new ir(new V(t,"scan",[n,o]),function(r){function e(){return i||(i=f=!0,(u=r(new on(c)))===D&&(n(),n=a)),u}var i=!1,n=a,u=S;return n=t.subscribeInternal(function(n){if(Dn(n)){if(f&&n.isInitial)return S;n.isInitial||e(),i=f=!0;var t=o(c,n.value);return c=t,r(n.apply(t))}return n.isEnd&&(u=e()),u!==D?r(n):u}),F.whenDoneWith(s,e),n})}var xn=(Mn.prototype.add=function(n){var t=this;if(!this.unsubscribed){var r=!1,e=a;this.starting.push(n),e=n(this.unsubscribe,function(){t.unsubscribed||(r=!0,t.remove(e),m.remove(n,t.starting))}),this.unsubscribed||r?e():this.subscriptions.push(e),m.remove(n,this.starting)}},Mn.prototype.remove=function(n){if(!this.unsubscribed)return void 0!==m.remove(n,this.subscriptions)?n():void 0},Mn.prototype.unsubscribe=function(){if(!this.unsubscribed){this.unsubscribed=!0;for(var n=this.subscriptions,t=0;t<n.length;t++)n[t]();this.subscriptions=[],this.starting=[]}},Mn.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},Mn.prototype.empty=function(){return 0===this.count()},Mn);function Mn(n){void 0===n&&(n=[]),this.unsubscribed=!1,this.unsubscribe=m.bind(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[];for(var t,r=0;r<n.length;r++)t=n[r],this.add(t)}function Wn(s,n){return function(t){function r(){if(!e)return s.forEach(function(n){if(e=!0,(o=t(new on(n)))===D)return u(),u=a})}var e=!1,i=!1,u=a,o=S;return u=n(function(n){return n instanceof Z?n.isInitial&&!i?(s=new H(n.value),S):(n.isInitial||r(),e=!0,s=new H(n.value),t(n)):(n.isEnd&&(o=r()),o!==D?t(n):o)}),i=!0,r(),u}}function On(n,t){return new ir(n,Wn(X(),t))}function Pn(t){var r=new fr(new V("Bacon","once",[t]),function(n){return F.soonButNotYet(r,function(){n(mn(t)),n(gn())}),a});return r}function Tn(t,n,e){void 0===e&&(e={});var i=n,r=[i],f=[],a=n._isProperty,h=!1,u=(a?On:pr)(e.desc||new V(n,"flatMap_",[t]),function(u){var r=new xn,o=[];function s(n){if(a&&n.isInitial){if(h)return S;h=!0}var i=Cn(t(n));return f.push(i),r.add(function(r,e){return i.subscribeInternal(function(n){if(n.isEnd)return m.remove(i,f),function(){var n=o.shift();n&&s(n)}(),c(e),D;n=n.toNext();var t=u(n);return t===D&&r(),t})})}function c(n){return n(),r.empty()?u(gn()):S}return r.add(function(n,t){return i.subscribeInternal(function(n){return n.isEnd?c(t):n.isError&&!e.mapError?u(n):e.firstOnly&&1<r.count()?S:r.unsubscribed?D:(e.limit&&r.count()>e.limit?o.push(n):s(n),S)})}),r.unsubscribe});return u.internalDeps=function(){return f.length?r.concat(f):r},u}function Nn(t){return"function"==typeof t?function(n){return Dn(n)?t(n.value):n}:function(n){return t}}function Cn(n){return f(n)?n:Pn(n)}function Fn(n,t){return Tn(t,n,{mapError:!0,desc:new V(n,"flatMapEvent",[t])})}var Vn=(Ln.prototype.subscribe=function(n){return this.obs.subscribeInternal(n)},Ln.prototype.toString=function(){return this.obs.toString()},Ln.prototype.markEnded=function(){this.ended=!0},Ln.prototype.mayHave=function(n){return!0},Ln);function Ln(n,t){this._isSource=!0,this.flatten=!0,this.ended=!1,this.obs=n,this.sync=t}var qn,jn=(t(Un,qn=Vn),Un.prototype.consume=function(){return this.value},Un.prototype.push=function(n){this.value=n},Un.prototype.hasAtLeast=function(n){return!!this.value},Un);function Un(){return null!==qn&&qn.apply(this,arguments)||this}var Qn,zn=(t(Hn,Qn=Vn),Hn.prototype.consume=function(){return this.queue.shift()},Hn.prototype.push=function(n){this.queue.push(n)},Hn.prototype.mayHave=function(n){return!this.ended||this.queue.length>=n},Hn.prototype.hasAtLeast=function(n){return this.queue.length>=n},Hn);function Hn(n,t){var r=Qn.call(this,n,t)||this;return r.flatten=!1,r.queue=[],r}var Rn,Yn=(t(Xn,Rn=Vn),Xn.prototype.consume=function(){var n=this.queue;return this.queue=[],{value:n}},Xn.prototype.push=function(n){return this.queue.push(n.value)},Xn.prototype.hasAtLeast=function(n){return!0},Xn);function Xn(n){var t=Rn.call(this,n,!0)||this;return t.queue=[],t}function $n(n){return null!=n&&n._isSource?n:null!=n&&n._isProperty?new jn(n,!1):new zn(n,!0)}function Gn(){return new fr(q("Bacon","never"),function(n){return n(gn()),a})}function Jn(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Zn(hr,n)}function Kn(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Zn(On,n)}function Zn(n,t){if(0===t.length)return Gn();var r=function(n){for(var t=[],r=[],e=0;e<n.length;e++){for(var i,u=n[e],o=u[0],s={f:u[1],ixs:[]},c=!1,f=0;f<o.length;f++){i=o[f];var a=w(t,i);c=c||null!=(l=i)&&(l._isSource?l.sync:l._isEventStream),a<0&&(t.push(i),a=t.length-1);for(var h=0;h<s.ixs.length;h++){var p=s.ixs[h];p.index===a&&p.count++}s.ixs.push({index:a,count:1})}if(0<o.length&&!c)throw new Error("At least one EventStream required, none found in "+o);0<o.length&&r.push(s)}var l;return[g($n,t),r]}(tt(t)),l=r[0],v=r[1];if(!l.length)return Gn();var c=i(l,function(n){return n.flatten})&&function(n,e){void 0===e&&(e=[]);return i(n,function n(t){if(u(e,t))return!0;var r=t.internalDeps();return r.length?(e.push(t),i(r,n)):(e.push(t),!1)})}(g(function(n){return n.obs},l)),d=n(new V("Bacon","when",Array.prototype.slice.call(t)),function(f){var a=[],s=!1;function h(n){for(var t=0;t<n.ixs.length;t++){var r=n.ixs[t];if(!l[r.index].hasAtLeast(r.count))return!1}return!0}function t(n){for(var t=0;t<n.ixs.length;t++){var r=n.ixs[t];if(!l[r.index].mayHave(r.count))return!0}return!1}function p(n){return!n.source.flatten}return new xn(g(function(o){return function(e){function i(){return F.whenDoneWith(d,u)}function u(){var n=function n(){var t;if(void 0!==(t=a.pop()))for(var r,e=S,i=0;i<v.length;i++)if(h(r=v[i])){for(var u=[],o=0;o<r.ixs.length;o++){var s=l[r.ixs[o].index].consume();if(!s)throw new Error("Event was undefined");u.push(s.value)}var c=r.f.apply(null,u);return e=f(t.e.apply(c)),a.length&&(a=b(p,a)),e===D?e:n()}return S}();s&&(y(l,rt)||y(v,t))&&(n=D,f(gn())),n===D&&e()}return o.subscribe(function(n){var t=S;if(n.isEnd)s=!0,o.markEnded(),i();else if(n.isError)t=f(n);else{var r=n;o.push(r),o.sync&&(a.push({source:o,e:r}),c||F.hasWaiters()?i():u())}return t===D&&e(),t})}},l)).unsubscribe});return d}function nt(n){for(var t=0,r=n.length,e=[];t<r;){var i=v(n[t++]),u=d(n[t++]);e.push([i,u])}return e}function tt(n){for(var t,r=[],e=0;e<n.length;e++){var i=n[e];if(!((t=i)instanceof Array)||f(t[t.length-1]))return nt(n);if(i[0]instanceof Array)r.push([i[0],d(i[1])]);else{var u=i.slice(0,i.length-1),o=d(i[i.length-1]);r.push([u,o])}}return r}function rt(n){return!n.sync||n.ended}function et(n,t,r){return Jn([new jn(t.toProperty(),!1),new jn(n,!0),o(r)]).withDesc(new V(n,"withLatestFrom",[t,r]))}function it(n,t,r){return Kn([new jn(t.toProperty(),!1),new jn(n,!0),o(r)]).withDesc(new V(n,"withLatestFrom",[t,r]))}function ut(n,t,r){if(n instanceof ir)return it(n,t,r);if(n instanceof fr)return et(n,t,r);throw new Error("Unknown observable: "+n)}function ot(n,t){return t instanceof ir?ut(n,t,function(n,t){return t}):n.transform(st(t),new V(n,"map",[t]))}function st(n){var r=m.toFunction(n);return function(n,t){return t(n.fmap(r))}}function ct(t){return new ir(new V("Bacon","constant",[t]),function(n){return n(bn(t)),n(gn()),a})}function ft(n){return n=Array.prototype.slice.call(n),m.flatMap(at,n)}function at(n){return f(n)?[n]:h(n)?ft(n):[ct(n)]}function ht(n){return m.isFunction(n[0])?[ft(Array.prototype.slice.call(n,1)),n[0]]:[ft(Array.prototype.slice.call(n,0,n.length-1)),m.last(n)]}function pt(n,r){return Zn(function(n,t){return new fr(n,t,void 0,r)},[m.map(function(n){return new Yn(n)},n),function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n}]).withDesc(new V("Bacon","groupSimultaneous",n))}function lt(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if((n=ft(n)).length){for(var r=[],e=0;e<n.length;e++){var i=f(n[e])?n[e]:ct(n[e]);r.push(dt(i))}return Kn([r,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n}]).withDesc(new V("Bacon","combineAsArray",n))}return ct([])}function vt(n,t,r){return Kn([[dt(n),dt(t)],r]).withDesc(new V(n,"combine",[t,r]))}function dt(n){return new jn(n,!0)}function yt(n,t){return Tn(Nn(t),n,{desc:new V(n,"flatMapConcat",[t]),limit:1})}function bt(e,f){void 0===f&&(f=m.id);var n=new V("Bacon","fromBinder",[e,f]);return new fr(n,function(s){function c(){if(!n)return null!=r?(r(),n=!0):t=!0}var n=!1,t=!1,r=e(function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var r=f.apply(void 0,n),e=h(r)&&En(m.last(r))?r:[r],i=S,u=0;u<e.length;u++){var o=mn(e[u]);if((i=s(o))===D||o.isEnd)return c(),i}return i});return t&&c(),c})}function wt(r,n){var t=new V("Bacon","fromPoll",[r,n]);return bt(function(n){var t=A.scheduler.setInterval(n,r);return function(){return A.scheduler.clearInterval(t)}},n).withDesc(t)}function gt(n,t){return wt(n,function(){return wn(t)}).withDesc(new V("Bacon","interval",[n,t]))}function mt(n,t,r){return ut(t,n,o(function(n){return"function"==typeof n?n:m.id}(r))).withDesc(new V(n,"sampledBy",[t]))}function Et(n,r,t){return new ir(new V(n,"transform",[r]),function(t){return n.subscribeInternal(function(n){return r(n,t)})}).withDesc(t)}function St(r,t){function e(n){return t(n,i)}var i;return function(n,t){return i=t,r(n,e)}}function Dt(n,t,r,e){return t instanceof ir?ut(n,t,function(n,t){return[n,t]}).transform(St(r(function(n){return n[1]}),st(function(n){return n[0]})),e):n.transform(r(function(n){if("boolean"==typeof n)return m.always(n);if("function"!=typeof n)throw new Error("Not a function: "+n);return n}(t)),e)}function At(r){return function(n,t){return n.filter(r)?t(n):S}}function It(n){return n.map(function(n){return!n}).withDesc(new V(n,"not",[]))}function kt(n){return or(n)?n:ct(n)}function Bt(n,t){return Tn(Nn(t),n,{firstOnly:!0,desc:new V(n,"flatMapFirst",[t])})}function _t(e,n){var i=new fr(q(e,"justInitValue"),function(n){var t,r=e.dispatcher.subscribe(function(n){return n.isEnd||(t=n),D});return F.whenDoneWith(i,function(){return null!=t&&n(t),n(gn())}),r},void 0,cr);return i.concat(n,cr).toProperty()}function xt(n,t,r){return n.scan(t,r).last().withDesc(new V(n,"fold",[t,r]))}var Mt={};function Wt(n,t){return Tn(Nn(t),n,{desc:new V(n,"flatMap",[t])})}function Ot(n,r){return Tn(function(n){if(n instanceof dn){var t=n.error;return r(t)}return n},n,{mapError:!0,desc:new V(n,"flatMapError",[r])})}var Pt=[],Tt=!1;function Nt(t){if(Pt.length&&!Tt)try{Tt=!0,Pt.forEach(function(n){n(t)})}finally{Tt=!1}}function Ct(n,t){var r=m.toFunction(t),e=or(n)?n.toEventStream(cr):n,i=Wt(e,function(n){return Cn(r(n)).takeUntil(e)});return or(n)&&(i=i.toProperty()),i.withDesc(new V(n,"flatMapLatest",[r]))}var Ft=(Vt.prototype.hasSubscribers=function(){return 0<this.subscriptions.length},Vt.prototype.removeSub=function(n){return this.subscriptions=m.without(n,this.subscriptions),this.subscriptions},Vt.prototype.push=function(n){return n.isEnd&&(this.ended=!0),F.inTransaction(n,this,this.pushIt,[n])},Vt.prototype.pushToSubscriptions=function(n){try{for(var t=this.subscriptions,r=t.length,e=0;e<r;e++){var i=t[e];i.sink(n)!==D&&!n.isEnd||this.removeSub(i)}return!0}catch(n){throw this.pushing=!1,this.queue=[],n}},Vt.prototype.pushIt=function(n){if(this.pushing)return this.queue.push(n),S;if(n!==this.prevError){for(n.isError&&(this.prevError=n),this.pushing=!0,this.pushToSubscriptions(n),this.pushing=!1;;){var t=this.queue.shift();if(!t)break;this.push(t)}return this.hasSubscribers()?S:(this.unsubscribeFromSource(),D)}},Vt.prototype.handleEvent=function(n){return this._handleEvent?this._handleEvent(n):this.push(n)},Vt.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc(),this.unsubSrc=void 0},Vt.prototype.subscribe=function(n){var t=this;if(this.ended)return n(gn()),a;var r={sink:n};return this.subscriptions.push(r),1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent)),function(){if(t.removeSub(r),!t.hasSubscribers())return t.unsubscribeFromSource()}},Vt.prototype.inspect=function(){return this.observable.toString()},Vt);function Vt(n,t,r){this.pushing=!1,this.ended=!1,this.prevError=void 0,this.unsubSrc=void 0,this._subscribe=t,this._handleEvent=r,this.subscribe=m.bind(this.subscribe,this),this.handleEvent=m.bind(this.handleEvent,this),this.subscriptions=[],this.observable=n,this.queue=[]}var Lt,qt=(t(jt,Lt=Ft),jt.prototype.push=function(n){return n.isEnd&&(this.propertyEnded=!0),n instanceof Z?(this.current=new H(n),this.currentValueRootId=F.currentEventId()):n.hasValue&&console.error("Unknown event, two Bacons loaded?",n.constructor),Lt.prototype.push.call(this,n)},jt.prototype.maybeSubSource=function(n,t){return t===D?a:this.propertyEnded?(n(gn()),a):Lt.prototype.subscribe.call(this,n)},jt.prototype.subscribe=function(n){var t=this,r=S;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var e=F.currentEventId(),i=this.currentValueRootId;return!this.propertyEnded&&i&&e&&e!==i?F.whenDoneWith(this.observable,function(){if(t.currentValueRootId===i)return n(bn(t.current.get().value))}):F.inTransaction(void 0,this,function(){return r=n(bn(t.current.get().value))},[]),this.maybeSubSource(n,r)}return this.maybeSubSource(n,r)},jt.prototype.inspect=function(){return this.observable+" current= "+this.current},jt);function jt(n,t,r){var e=Lt.call(this,n,t,r)||this;return e.current=X(),e.propertyEnded=!1,e.subscribe=m.bind(e.subscribe,e),e}function Ut(n,t,r){return Tn(Nn(r),n,{desc:new V(n,"flatMapWithConcurrencyLimit",[t,r]),limit:t})}function Qt(n,t,r){var e=function(n){if(void 0===n)return;if("number"!=typeof n)return n;var t=n;return function(n){return A.scheduler.setTimeout(n,t)}}(t);function i(n){return n.values.length===r?n.flush():void 0!==e?n.schedule(e):void 0}var u=new V(n,"bufferWithTimeOrCount",[t,r]);return function(n,r,t){void 0===r&&(r=a);void 0===t&&(t=a);var e=S,i=new zt(t,r);return n.transform(function(n,t){return i.push=t,Dn(n)?(i.values.push(n.value),r(i)):Sn(n)?e=t(n):An(n)&&(i.end=n,i.scheduled||i.flush()),e}).withDesc(new V(n,"buffer",[]))}(n,i,i).withDesc(u)}var zt=(Ht.prototype.flush=function(){if(this.scheduled&&(A.scheduler.clearTimeout(this.scheduled),this.scheduled=null),0<this.values.length){var n=this.values;this.values=[];var t=this.push(wn(n));if(null!=this.end)return this.push(this.end);if(t!==D)return this.onFlush(this)}else if(null!=this.end)return this.push(this.end)},Ht.prototype.schedule=function(n){var t=this;if(!this.scheduled)return this.scheduled=n(function(){return t.flush()})},Ht);function Ht(n,t){this.push=function(n){return S},this.scheduled=null,this.end=void 0,this.values=[],this.onFlush=n,this.onInput=t}function Rt(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var u=ft(n);return u.length?new fr(new V("Bacon","mergeAll",u),function(e){var i=0,n=g(function(n){return function(r){return n.subscribeInternal(function(n){if(n.isEnd)return++i===u.length?e(gn()):S;n=n.toNext();var t=e(n);return t===D&&r(),t})}},u);return new xn(n).unsubscribe}):Gn()}function Yt(r,e){return bt(function(n){var t=A.scheduler.setTimeout(function(){return n([mn(e),gn()])},r);return function(){return A.scheduler.clearTimeout(t)}}).withDesc(new V("Bacon","later",[r,e]))}function Xt(r){return function(n,t){return n.filter(r)?t(n):(t(gn()),D)}}function $t(r){var e=!1;return function(n,t){return!e&&Dn(n)&&r(n.value)?S:(n.hasValue&&(e=!0),t(n))}}function Gt(u,o,s){void 0===s&&(s=m.id);var c={};return u.transform(St(At(function(n){return!c[o(n)]}),st(function(n){var e=o(n),t=u.changes().filter(function(n){return o(n)===e}),r=Pn(n).concat(t),i=s(r,n).toEventStream().transform(function(n,t){var r=t(n);return n.isEnd&&delete c[e],r});return c[e]=i})))}var Jt={};function Kt(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var e=ht(arguments);t=e[0],n=e[1];return Jn([t=m.map(function(n){return n.toEventStream()},t),n]).withDesc(new V("Bacon","zipWith",[n].concat(t)))}function Zt(i){function u(n,t,r){return function(n){return n[n.length-1]}(n)[t]=r}function o(n){return h(n)?[]:{}}function r(n){if(f(n))return!0;if(n&&(n.constructor==Object||n.constructor==Array))for(var t in n){if(Object.prototype.hasOwnProperty.call(n,t))if(r(n[t]))return!0}}function t(n,t){if(f(t))c.push(t),s.push(function(r,e){return function(n,t){u(n,r,t[e])}}(n,c.length-1));else if(r(t)){s.push(function(r,e){return function(n){var t=o(e);u(n,r,t),n.push(t)}}(n,t)),e(t),s.push(function(n){n.pop()})}else s.push(function(t,r){return function(n){u(n,t,r)}}(n,t))}function e(n){m.each(n,t)}var s=[],c=[];return(r(i)?(e(i),lt(c).map(function(n){for(var t=o(i),r=[t],e=0;e<s.length;e++)(0,s[e])(r,n);return t})):ct(i)).withDesc(new V("Bacon","combineTemplate",[i]))}var nr=0,tr=(rr.prototype.awaiting=function(n){return function(n,t){return pt([n,t],cr).map(function(n){return 0===n[1].length}).toProperty(!1).skipDuplicates().withDesc(new V(n,"awaiting",[t]))}(this,n)},rr.prototype.bufferingThrottle=function(n){return function(n,t){var r=new V(n,"bufferingThrottle",[t]);return n.delayChanges(r,function(n){return n.flatMapConcat(function(n){return Pn(n).concat(Yt(t,n).errors())})})}(this,n)},rr.prototype.combine=function(n,t){return vt(this,n,t)},rr.prototype.debounce=function(n){return function(n,t){return n.delayChanges(new V(n,"debounce",[t]),function(n){return n.flatMapLatest(function(n){return Yt(t,n)})})}(this,n)},rr.prototype.debounceImmediate=function(n){return function(n,t){return n.delayChanges(new V(n,"debounceImmediate",[t]),function(n){return n.flatMapFirst(function(n){return Pn(n).concat(Yt(t,n).errors())})})}(this,n)},rr.prototype.decode=function(n){return function(n,t){return n.combine(Zt(t),function(n,t){return t[n]}).withDesc(new V(n,"decode",[t]))}(this,n)},rr.prototype.delay=function(n){return function(n,t){return n.delayChanges(new V(n,"delay",[t]),function(n){return n.flatMap(function(n){return Yt(t,n)})})}(this,n)},rr.prototype.deps=function(){return this.desc.deps()},rr.prototype.diff=function(n,t){return function(n,t,r){return Et(_n(n,[t,Jt],function(n,t){return[t,r(n[0],t)]}),St(At(function(n){return n[1]!==Jt}),st(function(n){return n[1]})),new V(n,"diff",[t,r]))}(this,n,t)},rr.prototype.doAction=function(n){return this.transform(function(r){return function(n,t){return Dn(n)&&r(n.value),t(n)}}(n),new V(this,"doAction",[n]))},rr.prototype.doEnd=function(n){return this.transform(function(r){return function(n,t){return An(n)&&r(),t(n)}}(n),new V(this,"doEnd",[n]))},rr.prototype.doError=function(n){return this.transform(function(r){return function(n,t){return Sn(n)&&r(n.error),t(n)}}(n),new V(this,"doError",[n]))},rr.prototype.doLog=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return this.transform(function(r){return function(n,t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,r.concat([n.log()])),t(n)}}(n),new V(this,"doLog",n))},rr.prototype.endAsValue=function(){return function(n){return n.transform(function(n,t){return An(n)?(t(wn({})),t(gn()),D):S})}(this)},rr.prototype.endOnError=function(n){return void 0===n&&(n=function(n){return!0}),function(n,r){return void 0===r&&(r=function(n){return!0}),n.transform(function(n,t){return Sn(n)&&r(n.error)?(t(n),t(gn())):t(n)},new V(n,"endOnError",[]))}(this,n)},rr.prototype.errors=function(){return this.filter(function(n){return!1}).withDesc(new V(this,"errors"))},rr.prototype.filter=function(n){return function(n,t){return Dt(n,t,At,new V(n,"filter",[t]))}(this,n)},rr.prototype.first=function(){return kn(1,this,new V(this,"first"))},rr.prototype.firstToPromise=function(n){return function(n,t){if("function"!=typeof t){if("function"!=typeof Promise)throw new Error("There isn't default Promise, use shim or parameter");t=function(n){return new Promise(n)}}return new t(function(t,r){return n.subscribe(function(n){return Dn(n)&&t(n.value),Sn(n)&&r(n.error),D})})}(this,n)},rr.prototype.fold=function(n,t){return xt(this,n,t)},rr.prototype.forEach=function(n){return void 0===n&&(n=U),this.onValue(n)},rr.prototype.holdWhen=function(n){return function(e,s){var c=!1,f=[],a=!1;return new fr(new V(e,"holdWhen",[s]),function(u){function o(n){return n&&n(),t.empty()&&r?u(gn()):S}var t=new xn,r=!1;return t.add(function(n,i){return s.subscribeInternal(function(n){if(Dn(n)){c=n.value;var t=S;if(!c){var r=f;f=[];for(var e=0;e<r.length;e++)t=u(wn(r[e]));a&&(u(gn()),i(),t=D)}return t}return n.isEnd?o(i):u(n)})}),t.add(function(n,t){return e.subscribeInternal(function(n){return c&&Dn(n)?(f.push(n.value),S):n.isEnd&&f.length?(a=!0,o(t)):u(n)})}),r=!0,o(),t.unsubscribe})}(this,n)},rr.prototype.inspect=function(){return this.toString()},rr.prototype.internalDeps=function(){return this.initialDesc.deps()},rr.prototype.last=function(){return function(n){var r;return n.transform(function(n,t){return An(n)?(r&&t(r),t(gn()),D):Dn(n)?(r=n,S):t(n)}).withDesc(new V(n,"last",[]))}(this)},rr.prototype.log=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t,n){n.subscribe(function(n){return"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,t.concat([n.log()])),S})}(n,this),this},rr.prototype.mapEnd=function(n){return this.transform(function(n){var r=m.toFunction(n);return function(n,t){return An(n)?(t(wn(r(n))),t(gn()),D):t(n)}}(n),new V(this,"mapEnd",[n]))},rr.prototype.mapError=function(n){return this.transform(function(n){var r=m.toFunction(n);return function(n,t){return Sn(n)?t(wn(r(n.error))):t(n)}}(n),new V(this,"mapError",[n]))},rr.prototype.name=function(n){return this._name=n,this},rr.prototype.onEnd=function(t){return void 0===t&&(t=Q),this.subscribe(function(n){return n.isEnd?t():S})},rr.prototype.onError=function(t){return void 0===t&&(t=U),this.subscribe(function(n){return Sn(n)?t(n.error):S})},rr.prototype.onValue=function(t){return void 0===t&&(t=U),this.subscribe(function(n){return Dn(n)?t(n.value):S})},rr.prototype.onValues=function(t){return this.onValue(function(n){return t.apply(void 0,n)})},rr.prototype.reduce=function(n,t){return xt(this,n,t)},rr.prototype.scan=function(n,t){return _n(this,n,t)},rr.prototype.skip=function(n){return function(n,r){return n.transform(function(n,t){return n.hasValue&&0<r?(r--,S):t(n)},new V(n,"skip",[r]))}(this,n)},rr.prototype.skipDuplicates=function(n){return function(n,r){void 0===r&&(r=In);var t=new V(n,"skipDuplicates",[]);return z(X(),function(n,t){return Dn(t)?t.isInitial||function(n){return null!=n&&n._isNone}(n)||!r(n.get(),t.value)?[new H(t.value),[t]]:[n,[]]:[n,[t]]},n).withDesc(t)}(this,n)},rr.prototype.skipErrors=function(){return function(n){return n.transform(function(n,t){return Sn(n)?S:t(n)},new V(n,"skipErrors",[]))}(this)},rr.prototype.skipUntil=function(n){return function(n,t){var r=t.transform(St(Bn(1),st(!0))).toProperty().startWith(!1);return n.filter(r).withDesc(new V(n,"skipUntil",[t]))}(this,n)},rr.prototype.skipWhile=function(n){return function(n,t){return Dt(n,t,$t,new V(n,"skipWhile",[t]))}(this,n)},rr.prototype.slidingWindow=function(n,t){return void 0===t&&(t=0),function(n,r,t){return void 0===t&&(t=0),n.scan([],function(n,t){return n.concat([t]).slice(-r)}).filter(function(n){return n.length>=t}).withDesc(new V(n,"slidingWindow",[r,t]))}(this,n,t)},rr.prototype.subscribe=function(n){var t=this;return void 0===n&&(n=U),F.wrappedSubscribe(this,function(n){return t.subscribeInternal(n)},n)},rr.prototype.take=function(n){return kn(n,this)},rr.prototype.takeUntil=function(n){return function(n,t){var r=pt([n.mapEnd(Mt),t.skipErrors()],cr);return n instanceof ir&&(r=r.toProperty()),r.transform(function(n,t){if(Dn(n)){var r=n.value,e=r[0];if(r[1].length)return t(gn());for(var i=S,u=0;u<e.length;u++){var o=e[u];if(o===Mt)return t(gn());i=t(wn(o))}return i}return t(n)},new V(n,"takeUntil",[t]))}(this,n)},rr.prototype.takeWhile=function(n){return function(n,t){return Dt(n,t,Xt,new V(n,"takeWhile",[t]))}(this,n)},rr.prototype.throttle=function(n){return function(n,t){return n.delayChanges(new V(n,"throttle",[t]),function(n){return n.bufferWithTime(t).map(function(n){return n[n.length-1]})})}(this,n)},rr.prototype.toPromise=function(n){return function(n,t){return n.last().firstToPromise(t)}(this,n)},rr.prototype.toString=function(){return this._name?this._name:this.desc.toString()},rr.prototype.withDesc=function(n){return n&&(this.desc=n),this},rr.prototype.withDescription=function(n,t){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];return this.desc=q.apply(void 0,[n,t].concat(r)),this},rr.prototype.zip=function(n,t){return function(n,t,r){return Kt(r||Array,n,t).withDesc(new V(n,"zip",[t]))}(this,n,t)},rr);function rr(n){this.id=++nr,this._isObservable=!0,this.desc=n,this.initialDesc=n}var er,ir=(t(ur,er=tr),ur.prototype.and=function(n){return function(n,t){return n.combine(kt(t),function(n,t){return!(!n||!t)}).withDesc(new V(n,"and",[t]))}(this,n)},ur.prototype.changes=function(){var n=this;return new fr(new V(this,"changes",[]),function(t){return n.dispatcher.subscribe(function(n){return n.isInitial?S:t(n)})})},ur.prototype.concat=function(n){return _t(this,this.changes().concat(n))},ur.prototype.delayChanges=function(n,t){return _t(this,t(this.changes())).withDesc(n)},ur.prototype.flatMap=function(n){return Wt(this,n)},ur.prototype.flatMapConcat=function(n){return yt(this,n)},ur.prototype.flatMapError=function(n){return Ot(this,n)},ur.prototype.flatMapEvent=function(n){return Fn(this,n)},ur.prototype.flatMapFirst=function(n){return Bt(this,n)},ur.prototype.flatMapLatest=function(n){return Ct(this,n)},ur.prototype.flatMapWithConcurrencyLimit=function(n,t){return Ut(this,n,t)},ur.prototype.groupBy=function(n,t){return Gt(this,n,t)},ur.prototype.map=function(n){return ot(this,n)},ur.prototype.not=function(){return It(this)},ur.prototype.or=function(n){return function(n,t){return n.combine(kt(t),function(n,t){return n||t}).withDesc(new V(n,"or",[t]))}(this,n)},ur.prototype.sample=function(n){return function(n,t){return mt(n,gt(t,{}),function(n,t){return n}).withDesc(new V(n,"sample",[t]))}(this,n)},ur.prototype.sampledBy=function(n){return mt(this,n,arguments[1])},ur.prototype.startWith=function(n){return function(n,t){return n.scan(t,function(n,t){return t}).withDesc(new V(n,"startWith",[t]))}(this,n)},ur.prototype.subscribeInternal=function(n){return void 0===n&&(n=U),this.dispatcher.subscribe(n)},ur.prototype.toEventStream=function(n){var r=this;return new fr(new V(this,"toEventStream",[]),function(t){return r.subscribeInternal(function(n){return t(n.toNext())})},void 0,n)},ur.prototype.toProperty=function(){return this},ur.prototype.transform=function(n,t){return Et(this,n,t)},ur.prototype.withLatestFrom=function(n,t){return it(this,n,t)},ur.prototype.withStateMachine=function(n,t){return z(n,t,this)},ur);function ur(n,t,r){var e=er.call(this,n)||this;return e._isProperty=!0,e.dispatcher=new qt(e,t,r),Nt(e),e}function or(n){return!!n._isProperty}var sr,cr={forceAsync:!1},fr=(t(ar,sr=tr),ar.prototype.bufferWithTime=function(n){return function(n,t){return Qt(n,t,Number.MAX_VALUE).withDesc(new V(n,"bufferWithTime",[t]))}(this,n)},ar.prototype.bufferWithCount=function(n){return function(n,t){return Qt(n,void 0,t).withDesc(new V(n,"bufferWithCount",[t]))}(this,n)},ar.prototype.bufferWithTimeOrCount=function(n,t){return Qt(this,n,t)},ar.prototype.changes=function(){return this},ar.prototype.concat=function(n,t){return function(e,i,n){return new fr(new V(e,"concat",[i]),function(t){var r=a,n=e.dispatcher.subscribe(function(n){return n.isEnd?(r=i.toEventStream().dispatcher.subscribe(t),S):t(n)});return function(){return n(),r()}},void 0,n)}(this,n,t)},ar.prototype.delayChanges=function(n,t){return t(this).withDesc(n)},ar.prototype.flatMap=function(n){return Wt(this,n)},ar.prototype.flatMapConcat=function(n){return yt(this,n)},ar.prototype.flatMapError=function(n){return Ot(this,n)},ar.prototype.flatMapFirst=function(n){return Bt(this,n)},ar.prototype.flatMapLatest=function(n){return Ct(this,n)},ar.prototype.flatMapWithConcurrencyLimit=function(n,t){return Ut(this,n,t)},ar.prototype.flatMapEvent=function(n){return Fn(this,n)},ar.prototype.flatScan=function(n,t){return function(n,t,r){var e=t;return n.flatMapConcat(function(n){return Cn(r(e,n)).doAction(function(n){return e=n})}).toProperty().startWith(t).withDesc(new V(n,"flatScan",[t,r]))}(this,n,t)},ar.prototype.groupBy=function(n,t){return Gt(this,n,t)},ar.prototype.map=function(n){return ot(this,n)},ar.prototype.merge=function(n){return Rt(this,n).withDesc(new V(this,"merge",[n]))},ar.prototype.not=function(){return It(this)},ar.prototype.sampledBy=function(n){return function(n,t,r){return mt(n.toProperty(),t,r).withDesc(new V(n,"sampledBy",[t]))}(this,n,arguments[1])},ar.prototype.startWith=function(n){return function(n,t){return Pn(t).concat(n).withDesc(new V(n,"startWith",[t]))}(this,n)},ar.prototype.subscribeInternal=function(n){return void 0===n&&(n=U),this.dispatcher.subscribe(n)},ar.prototype.toEventStream=function(){return this},ar.prototype.toProperty=function(n){var t=arguments.length?function(n){return n&&(n._isSome||n._isNone)?n:new H(n)}(n):X(),r=this.dispatcher,e=new V(this,"toProperty",Array.prototype.slice.apply(arguments)),i=r.subscribe;return new ir(e,Wn(t,i))},ar.prototype.transform=function(n,t){return function(n,r,t){return new fr(new V(n,"transform",[r]),function(t){return n.subscribeInternal(function(n){return r(n,t)})},void 0,cr).withDesc(t)}(this,n,t)},ar.prototype.withLatestFrom=function(n,t){return et(this,n,t)},ar.prototype.withStateMachine=function(n,t){return z(n,t,this)},ar);function ar(n,t,r,e){var i=sr.call(this,n)||this;return i._isEventStream=!0,e!==cr&&(t=function(u,n){var o=!1;return function(e){var i,t=F.isInTransaction();function r(){var n=i||[];i=void 0;for(var t=0;t<n.length;t++){var r=n[t];e(r)}}o=!0;try{return n(function(n){return o||i?(i?i.push(n):(i=[n],t?F.soonButNotYet(u,r):A.scheduler.setTimeout(r,0)),S):e(n)})}finally{o=!1}}}(i,t)),i.dispatcher=new Ft(i,t,r),Nt(i),i}function hr(n,t){return new fr(n,t)}function pr(n,t){return new fr(n,t,void 0,cr)}function lr(n){return"undefined"!=typeof Symbol&&Symbol[n]?Symbol[n]:"undefined"!=typeof Symbol&&"function"==typeof Symbol.for?Symbol[n]=Symbol.for(n):"@@"+n}var vr=(dr.prototype.subscribe=function(n,t,r){var e="function"==typeof n?{next:n,error:t,complete:r}:n,i={closed:!1,unsubscribe:function(){i.closed=!0,u()}},u=this.observable.subscribe(function(n){Dn(n)&&e.next?e.next(n.value):Sn(n)?(e.error&&e.error(n.error),i.unsubscribe()):n.isEnd&&(i.closed=!0,e.complete&&e.complete())});return i},dr);function dr(n){this.observable=n}function yr(r){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){return r.apply(void 0,[n].concat(t))}}}vr.prototype[lr("observable")]=function(){return this},tr.prototype.toESObservable=function(){return new vr(this)},tr.prototype[lr("observable")]=tr.prototype.toESObservable;var br=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];function wr(t,r,n){var e=function(n){for(var t,r=0;r<br.length;r++){var e=[n[(t=br[r])[0]],n[t[1]]];if(e[0]&&e[1])return e}for(var i=0;i<br.length;i++){var u=n[(t=br[i])[0]];if(u)return[u,function(){}]}throw new Error("No suitable event methods in "+n)}(t),i=e[0],u=e[1],o=new V("Bacon","fromEvent",[t,r]);return bt(function(n){return function(n){return m.isFunction(n)}(r)?(r(i.bind(t),n),function(){return r(u.bind(t),n)}):(i.call(t,r,n),function(){return u.call(t,r,n)})},n).withDesc(o)}function gr(s){var c=0;return bt(function(t){var r=!1,e=S,i=function(){};function u(n){return n.isEnd?(r?o():r=!0,S):e=t(n)}function o(){var n;for(r=!0;r&&e!==D;)n=s(c++),r=!1,n?i=n.subscribeInternal(u):t(gn());r=!0}return o(),function(){return i()}}).withDesc(new V("Bacon","repeat",[s]))}function mr(n){return Yt(n,"").filter(!1).withDesc(new V("Bacon","silence",[n]))}function Er(n){return[mn(n),gn()]}var Sr,Dr=(Sr=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return m.isFunction(n)?t.length?function(r,e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return r.apply(void 0,e.concat(n))}}(n,t):n:m.always(n)},function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if("object"==typeof n&&t.length){var e=n,i=t[0];n=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return e[i].apply(e,n)},t=t.slice(1)}return Sr.apply(void 0,[n].concat(t))});function Ar(n,t){return Dr.apply(void 0,[n].concat(t))}var Ir,kr=(t(Br,Ir=fr),Br.prototype.plug=function(n){var t=this;if(!this.ended){var r={input:n,unsub:void 0};return this.subscriptions.push(r),void 0!==this.sink&&this.subscribeInput(r),function(){return t.unsubscribeInput(n)}}},Br.prototype.end=function(){if(this.ended=!0,this.unsubAll(),"function"==typeof this.sink)return this.sink(gn())},Br.prototype.push=function(n){if(!this.ended&&"function"==typeof this.sink){var t=!this.pushing;if(!t)return this.pushQueue||(this.pushQueue=[]),void this.pushQueue.push(n);this.pushing=!0;try{return this.sink(wn(n))}finally{if(t&&this.pushQueue){for(var r=0;r<this.pushQueue.length;){var e=this.pushQueue[r];this.sink(wn(e)),r++}this.pushQueue=void 0}this.pushing=!1}}},Br.prototype.error=function(n){if("function"==typeof this.sink)return this.sink(new dn(n))},Br.prototype.unsubAll=function(){for(var n,t=this.subscriptions,r=0;r<t.length;r++)"function"==typeof(n=t[r]).unsub&&n.unsub()},Br.prototype.subscribeAll=function(n){if(this.ended)n(gn());else{this.sink=n;for(var t,r=this.subscriptions.slice(),e=0;e<r.length;e++)t=r[e],this.subscribeInput(t)}return this.unsubAll},Br.prototype.guardedSink=function(t){var r=this;return function(n){return n.isEnd?(r.unsubscribeInput(t),D):r.sink?r.sink(n):S}},Br.prototype.subscribeInput=function(n){return n.unsub=n.input.subscribeInternal(this.guardedSink(n.input)),n.unsub},Br.prototype.unsubscribeInput=function(n){for(var t,r=this.subscriptions,e=0;e<r.length;e++)if((t=r[e]).input===n)return"function"==typeof t.unsub&&t.unsub(),void this.subscriptions.splice(e,1)},Br);function Br(){var t=Ir.call(this,new V("Bacon","Bus",[]),function(n){return t.subscribeAll(n)})||this;return t.pushing=!1,t.pushQueue=void 0,t.ended=!1,t.subscriptions=[],t.unsubAll=m.bind(t.unsubAll,t),t.subscribeAll=m.bind(t.subscribeAll,t),t.guardedSink=m.bind(t.guardedSink,t),t.subscriptions=[],t.ended=!1,fr.call(t,new V("Bacon","Bus",[]),t.subscribeAll),t}var _r={asEventStream:function(t,r,n){var e=this;return m.isFunction(r)&&(n=r,r=void 0),bt(function(n){return e.on(t,r,n),function(){return e.off(t,r,n)}},n).withDesc(new V(this.selector||this,"asEventStream",[t]))},init:function(n){n.fn.asEventStream=_r.asEventStream}};n.$=_r,n.Bus=kr,n.CompositeUnsubscribe=xn,n.Desc=V,n.End=pn,n.Error=dn,n.Event=G,n.EventStream=fr,n.Initial=on,n.Next=rn,n.Observable=tr,n.Property=ir,n.Value=Z,n._=m,n.combine=vt,n.combineAsArray=lt,n.combineTemplate=Zt,n.combineWith=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var e=ht(arguments),i=(n=e[0],t=e[1],new V("Bacon","combineWith",[t].concat(n)));return lt(n).map(function(n){return t.apply(void 0,n)}).withDesc(i)},n.concatAll=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=ft(n);return(r.length?s(l(r),c(r).toEventStream(),function(n,t){return n.concat(t)}):Gn()).withDesc(new V("Bacon","concatAll",r))},n.constant=ct,n.fromArray=function(s){if(s.length){var c=0,f=new fr(new V("Bacon","fromArray",[s]),function(r){var e=!1,i=S,u=!1,o=!1;return F.soonButNotYet(f,function n(){if(o=!0,!u){if(c===s.length)return r(gn()),!1;for(u=!0;o;)if(o=!1,i!==D&&!e){var t=s[c++];(i=r(mn(t)))!==D&&(c===s.length?r(gn()):F.afterTransaction(f,n))}return u=!1}}),function(){return e=!0}});return f}return Gn().withDesc(new V("Bacon","fromArray",s))},n.fromBinder=bt,n.fromCallback=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return bt(function(n){return Ar(t,r)(n),a},function(n){return[n,gn()]}).withDesc(new V("Bacon","fromCallback",[t].concat(r)))},n.fromESObservable=function(n){var r;r=n[lr("observable")]?n[lr("observable")]():n;var t=new V("Bacon","fromESObservable",[r]);return new fr(t,function(t){var n=r.subscribe({error:function(n){t(new dn(n)),t(new pn)},next:function(n){t(new rn(n))},complete:function(){t(new pn)}});return n.unsubscribe?function(){n.unsubscribe()}:n})},n.fromEvent=wr,n.fromEventTarget=wr,n.fromNodeCallback=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return bt(function(n){return Ar(t,r)(n),a},function(n,t){return n?[new dn(n),gn()]:[t,gn()]}).withDesc(new V("Bacon","fromNodeCallback",[t].concat(r)))},n.fromPoll=wt,n.fromPromise=function(r,e,n){return void 0===n&&(n=Er),bt(function(t){var n=r.then(t,function(n){return t(new dn(n))});return n&&"function"==typeof n.done&&n.done(),e?function(){if("function"==typeof r.abort)return r.abort()}:function(){}},n).withDesc(new V("Bacon","fromPromise",[r]))},n.getScheduler=function(){return A.scheduler},n.groupSimultaneous=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return pt(ft(n))},n.hasValue=Dn,n.interval=gt,n.isEnd=An,n.isError=Sn,n.isEvent=En,n.isInitial=function(n){return n&&n._isInitial},n.isNext=function(n){return n.isNext},n.later=Yt,n.mergeAll=Rt,n.more=S,n.never=Gn,n.noMore=D,n.nullSink=U,n.nullVoidSink=Q,n.onValues=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return lt(n.slice(0,n.length-1)).onValues(n[arguments.length-1])},n.once=Pn,n.repeat=gr,n.repeatedly=function(n,t){var r=0;return wt(n,function(){return t[r++%t.length]}).withDesc(new V("Bacon","repeatedly",[n,t]))},n.retry=function(n){if(!m.isFunction(n.source))throw new Error("'source' option has to be a function");var i=n.source,u=n.retries||0,o=0,s=n.delay||function(){return 0},c=n.isRetryable||function(){return!0},f=!1,a=null;return gr(function(n){function t(){return i(n).endOnError().transform(function(n,t){return Sn(n)?c((a=n).error)&&(0===u||o<u)?S:(f=!0,t(n)):(Dn(n)&&(f=!(a=null)),t(n))})}if(!f){if(a){var r={error:a.error,retriesDone:o},e=mr(s(r));return o++,e.concat(Pn(null).flatMap(t))}return t()}}).withDesc(new V("Bacon","retry",[n]))},n.sequentially=function(n,t){var r=0;return wt(n,function(){var n=t[r++];return r<t.length?n:r===t.length?[mn(n),gn()]:gn()}).withDesc(new V("Bacon","sequentially",[n,t]))},n.setScheduler=function(n){A.scheduler=n},n.silence=mr,n.spy=function(n){return Pt.push(n)},n.try=function(t){return function(n){try{return Pn(t(n))}catch(n){return Pn(new dn(n))}}},n.update=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var e=tt(t),i=0;i<e.length;i++){var u=e[i];u[1]=yr(u[1])}return Jn.apply(void 0,e).scan(n,function(n,t){return t(n)}).withDesc(new V("Bacon","update",[n].concat(t)))},n.version="3.0.5",n.when=Jn,n.zipAsArray=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Jn([m.map(function(n){return n.toEventStream()},ft(n)),function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n}]).withDesc(new V("Bacon","zipAsArray",n))},n.zipWith=Kt,Object.defineProperty(n,"__esModule",{value:!0})});