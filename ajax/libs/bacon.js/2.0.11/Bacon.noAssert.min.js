!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Bacon=n()}(this,function(){"use strict";function a(){}function n(t){return t}var d=Array.isArray||function(t){return t instanceof Array},v=function(t){return t&&t._isObservable};function t(t){for(var n=arguments.length,r=1;1<n?r<n:n<r;1<n?r++:r--)for(var e in arguments[r])t[e]=arguments[r][e];return t}function r(t,n){var r={}.hasOwnProperty;function e(){}for(var i in e.prototype=n.prototype,t.prototype=new e,n)r.call(n,i)&&(t[i]=n[i]);return t}function e(t){return"undefined"!=typeof Symbol&&Symbol[t]?Symbol[t]:"undefined"!=typeof Symbol&&"function"==typeof Symbol.for?Symbol[t]=Symbol.for(t):"@@"+t}function c(t){this.value=t}t(c.prototype,{_isSome:!0,getOrElse:function(){return this.value},get:function(){return this.value},filter:function(t){return t(this.value)?new c(this.value):i},map:function(t){return new c(t(this.value))},forEach:function(t){return t(this.value)},isDefined:!0,toArray:function(){return[this.value]},inspect:function(){return"Some("+this.value+")"},toString:function(){return this.inspect()}});var i={_isNone:!0,getOrElse:function(t){return t},filter:function(){return i},map:function(){return i},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}},y={indexOf:Array.prototype.indexOf?function(t,n){return t.indexOf(n)}:function(t,n){for(var r=0;r<t.length;r++)if(n===t[r])return r;return-1},indexWhere:function(t,n){for(var r=0;r<t.length;r++)if(n(t[r]))return r;return-1},head:function(t){return t[0]},always:function(t){return function(){return t}},negate:function(n){return function(t){return!n(t)}},empty:function(t){return 0===t.length},tail:function(t){return t.slice(1,t.length)},filter:function(t,n){for(var r,e=[],i=0;i<n.length;i++)t(r=n[i])&&e.push(r);return e},map:function(e,i){return function(){for(var t,n=[],r=0;r<i.length;r++)t=i[r],n.push(e(t));return n}()},each:function(t,n){for(var r in t){if(Object.prototype.hasOwnProperty.call(t,r))n(r,t[r])}},toArray:function(t){return d(t)?t:[t]},contains:function(t,n){return-1!==y.indexOf(t,n)},id:function(t){return t},last:function(t){return t[t.length-1]},all:function(t){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:y.id,r=0;r<t.length;r++)if(!n(t[r]))return!1;return!0},any:function(t){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:y.id,r=0;r<t.length;r++)if(n(t[r]))return!0;return!1},without:function(n,t){return y.filter(function(t){return t!==n},t)},remove:function(t,n){var r=y.indexOf(n,t);if(0<=r)return n.splice(r,1)},fold:function(t,n,r){for(var e=0;e<t.length;e++)n=r(n,t[e]);return n},flatMap:function(r,t){return y.fold(t,[],function(t,n){return t.concat(r(n))})},cached:function(t){var n=i;return function(){return(null!=n?n._isNone:void 0)&&(n=t(),t=void 0),n}},bind:function(t,n){return function(){return t.apply(n,arguments)}},isFunction:function(t){return"function"==typeof t},toString:function(n){var r,e,i={}.hasOwnProperty;try{return u++,null==n?"undefined":y.isFunction(n)?"function":d(n)?5<u?"[..]":"["+y.map(y.toString,n).toString()+"]":null!=(null!=n?n.toString:void 0)&&n.toString!==Object.prototype.toString?n.toString():"object"==typeof n?5<u?"{..}":"{"+function(){var t=[];for(r in n)i.call(n,r)&&(e=function(){try{return n[r]}catch(t){return t}}(),t.push(y.toString(r)+":"+y.toString(e)));return t}()+"}":n}finally{u--}}},u=0,o=0;function s(){this.id=++o}function f(t){if(!(this instanceof f))return new f(t);s.call(this),this.value=t}function h(t){if(!(this instanceof h))return new h(t);f.call(this,t)}function p(){if(!(this instanceof p))return new p;s.call(this)}function l(t){if(!(this instanceof l))return new l(t);this.error=t,s.call(this)}function b(t){return new h(t)}function g(t){return new f(t)}function w(){return new p}function m(t){return t&&t._isEvent?t:g(t)}s.prototype._isEvent=!0,s.prototype.isEvent=!0,s.prototype.isEnd=!1,s.prototype.isInitial=!1,s.prototype.isNext=!1,s.prototype.isError=!1,s.prototype.hasValue=!1,s.prototype.filter=function(){return!0},s.prototype.inspect=function(){return this.toString()},s.prototype.log=function(){return this.toString()},s.prototype.toNext=function(){return this},r(f,s),f.prototype.isNext=!0,f.prototype.hasValue=!0,f.prototype.fmap=function(t){return this.apply(t(this.value))},f.prototype.apply=function(t){return new f(t)},f.prototype.filter=function(t){return t(this.value)},f.prototype.toString=function(){return y.toString(this.value)},f.prototype.log=function(){return this.value},f.prototype._isNext=!0,r(h,f),h.prototype._isInitial=!0,h.prototype.isInitial=!0,h.prototype.isNext=!1,h.prototype.apply=function(t){return new h(t)},h.prototype.toNext=function(){return new f(this.value)},r(p,s),p.prototype.isEnd=!0,p.prototype.fmap=function(){return this},p.prototype.apply=function(){return this},p.prototype.toString=function(){return"<end>"},r(l,s),l.prototype.isError=!0,l.prototype.fmap=function(){return this},l.prototype.apply=function(){return this},l.prototype.toString=function(){return"<error> "+y.toString(this.error)};var E="<no-more>",S="<more>",A=[];function k(n){if(A.length&&!k.running)try{k.running=!0,A.forEach(function(t){t(n)})}finally{delete k.running}}function _(t,n,r){this.context=t,this.method=n,this.args=r}function x(t,n){var r=t||n;if(r&&r._isDesc)return t||n;for(var e=arguments.length,i=Array(2<e?e-2:0),u=2;u<e;u++)i[u-2]=arguments[u];return new _(t,n,i)}function I(t,n){return n.desc=t,n}function M(t){return d(t)?y.flatMap(M,t):v(t)?[t]:(null!=t?t._isSource:void 0)?[t.obs]:[]}t(_.prototype,{_isDesc:!0,deps:function(){return this.cached||(this.cached=M([this.context].concat(this.args))),this.cached},toString:function(){var t=y.map(y.toString,this.args);return y.toString(this.context)+"."+y.toString(this.method)+"("+t+")"}});var T={setTimeout:function(t,n){return setTimeout(t,n)},setInterval:function(t,n){return setInterval(t,n)},clearInterval:function(t){return clearInterval(t)},clearTimeout:function(t){return clearTimeout(t)},now:function(){return(new Date).getTime()}},O=function(){var u=null,o=[],s={},c=[],f=0,a={},h=!1;function p(t){t<=f||(c[t-1]||(c[t-1]=[[],0]),f=t)}function l(t,n){if(!u&&!h)return n();p(1);for(var r=0;r<f-1&&!e(t,c[r][0]);)r++;c[r][0].push([t,n]),u||d()}function e(t,n){for(var r=0;r<n.length;r++)if(n[r][0].id==t.id)return!0;return!1}function d(){var t=f;if(t){var n=!h;h=!0;try{for(;t<=f;){var r=c[f-1];if(!r)throw new Error("Unexpected stack top: "+r);var e=r[0],i=r[1];if(!(i<e.length)){r[0]=[],r[1]=0;break}var u=e[i][1];r[1]++,p(f+1);var o=!1;try{for(u(),o=!0;t<f&&0==c[f-1][0].length;)f--}finally{o||(c=[],f=0)}}}finally{n&&(h=!1)}}}function r(t,n){if(u){var r=s[t.id];return null==r?(r=s[t.id]=[n],o.push(t)):r.push(n)}return n()}function v(t,n){var r=o[t],e=r.id,i=s[e];o.splice(t,1),delete s[e],n&&0<o.length&&function t(n){if(a[n.id])return;var r=n.internalDeps();for(var e,i=0;i<r.length;i++)if(e=r[i],t(e),s[e.id]){var u=y.indexOf(o,e);v(u,!1)}a[n.id]=!0}(r);for(var u=0;u<i.length;u++)(0,i[u])()}return{toString:function(){return y.toString({rootEvent:u,processingAfters:h,waiterObs:o,waiters:s,aftersStack:c,aftersStackHeight:f,flushed:a})},whenDoneWith:r,hasWaiters:function(){return 0<o.length},inTransaction:function(t,n,r,e){if(u)return r.apply(n,e);u=t;try{var i=r.apply(n,e);!function(){for(;0<o.length;)v(0,!0);a={}}()}finally{u=null,d()}return i},currentEventId:function(){return u?u.id:void 0},wrappedSubscribe:function(n,r){var e=!1,t=!1,i=function(){return t=!0};function u(){return e=!0,i()}return i=n.dispatcher.subscribe(function(t){return l(n,function(){if(!e&&r(t)===E)return u()})}),t&&i(),u},afterTransaction:l,soonButNotYet:function(t,n){u?r(t,n):K.scheduler.setTimeout(n,0)},isInTransaction:function(){return null!==u}}}();function W(t,n){this._subscribe=t,this._handleEvent=n,this.subscribe=y.bind(this.subscribe,this),this.handleEvent=y.bind(this.handleEvent,this),this.pushing=!1,this.ended=!1,this.prevError=void 0,this.unsubSrc=void 0,this.subscriptions=[],this.queue=[]}function P(o){return function(t){for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];if("object"==typeof t&&r.length){var i=t,u=r[0];t=function(){return i[u].apply(i,arguments)},r=r.slice(1)}return o.apply(void 0,[t].concat(r))}}function V(t){return t=Array.prototype.slice.call(t),B.apply(void 0,t)}function H(e,i){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(void 0,i.concat(n))}}function D(t,n){var e,r=t.slice(1).split("."),i=y.map((e=n,function(r){return function(t){if(null!=t){var n=t[r];return y.isFunction(n)?n.apply(t,e):n}}}),r);return function(t){for(var n=0;n<i.length;n++)t=(0,i[n])(t);return t}}function C(t){return"string"==typeof t&&1<t.length&&"."===t.charAt(0)}W.prototype.hasSubscribers=function(){return 0<this.subscriptions.length},W.prototype.removeSub=function(t){return this.subscriptions=y.without(t,this.subscriptions),this.subscriptions},W.prototype.push=function(t){return t.isEnd&&(this.ended=!0),O.inTransaction(t,this,this.pushIt,[t])},W.prototype.pushToSubscriptions=function(t){try{for(var n=this.subscriptions,r=n.length,e=0;e<r;e++){var i=n[e];(i.sink(t)===E||t.isEnd)&&this.removeSub(i)}return!0}catch(t){throw this.pushing=!1,this.queue=[],t}},W.prototype.pushIt=function(t){if(this.pushing)return this.queue.push(t),S;if(t!==this.prevError){for(t.isError&&(this.prevError=t),this.pushing=!0,this.pushToSubscriptions(t),this.pushing=!1;this.queue.length;)t=this.queue.shift(),this.push(t);return this.hasSubscribers()?S:(this.unsubscribeFromSource(),E)}},W.prototype.handleEvent=function(t){return this._handleEvent?this._handleEvent(t):this.push(t)},W.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc(),this.unsubSrc=void 0},W.prototype.subscribe=function(t){var n,r;return this.ended?(t(w()),a):(n={sink:t},this.subscriptions.push(n),1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent)),r=this,function(){if(r.removeSub(n),!r.hasSubscribers())return r.unsubscribeFromSource()})};var B=P(function(t){for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return y.isFunction(t)?r.length?H(t,r):t:C(t)?D(t,r):y.always(t)});function N(t,n){return B.apply(void 0,[t].concat(n))}function F(t,n,r,e){if(n&&n._isProperty){var i=n.sampledBy(t,function(t,n){return[t,n]});return e.call(i,function(t){return t[0]}).map(function(t){return t[1]})}return n=N(n,r),e.call(t,n)}function q(t){if(y.isFunction(t))return t;if(C(t)){var r=t.slice(1);return function(t,n){return t[r](n)}}throw new Error("not a function or a field key: "+t)}var L=0;function j(t){this.desc=t,this.id=++L,this.initialDesc=this.desc}function Q(t,n,r){W.call(this,n,r),this.property=t,this.subscribe=y.bind(this.subscribe,this),this.current=i,this.currentValueRootId=void 0,this.propertyEnded=!1}function U(t,n){return new z(t,Z(i,n))}function z(t,n,r){j.call(this,t),this.dispatcher=new Q(this,n,r),k(this)}t(j.prototype,{_isObservable:!0,subscribe:function(t){return O.wrappedSubscribe(this,t)},subscribeInternal:function(t){return this.dispatcher.subscribe(t)},onValue:function(){var n=V(arguments);return this.subscribe(function(t){if(t.hasValue)return n(t.value)})},onValues:function(n){return this.onValue(function(t){return n.apply(void 0,t)})},onError:function(){var n=V(arguments);return this.subscribe(function(t){if(t.isError)return n(t.error)})},onEnd:function(){var n=V(arguments);return this.subscribe(function(t){if(t.isEnd)return n()})},name:function(t){return this._name=t,this},withDescription:function(){return this.desc=x.apply(void 0,arguments),this},toString:function(){return this._name?this._name:this.desc.toString()},deps:function(){return this.desc.deps()},internalDeps:function(){return this.initialDesc.deps()}}),j.prototype.assign=j.prototype.onValue,j.prototype.forEach=j.prototype.onValue,j.prototype.inspect=j.prototype.toString,r(Q,W),t(Q.prototype,{push:function(t){return t.isEnd&&(this.propertyEnded=!0),t.hasValue&&(this.current=new c(t),this.currentValueRootId=O.currentEventId()),W.prototype.push.call(this,t)},maybeSubSource:function(t,n){return n===K.noMore?a:this.propertyEnded?(t(w()),a):W.prototype.subscribe.call(this,t)},subscribe:function(t){var n=this,r=K.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var e=O.currentEventId(),i=this.currentValueRootId;return!this.propertyEnded&&i&&e&&e!==i?O.whenDoneWith(this.property,function(){if(n.currentValueRootId===i)return t(b(n.current.get().value))}):O.inTransaction(void 0,this,function(){return r=t(b(this.current.get().value))},[]),this.maybeSubSource(t,r)}return this.maybeSubSource(t,r)}}),r(z,j),t(z.prototype,{_isProperty:!0,changes:function(){var t=this;return new $(new _(this,"changes",[]),function(n){return t.dispatcher.subscribe(function(t){if(!t.isInitial)return n(t)})})},withHandler:function(t){return new z(new _(this,"withHandler",[t]),this.dispatcher.subscribe,t)},toProperty:function(){return this}});var R={forceAsync:!1},Y=x("Bacon","new EventStream",[]);function $(t,n,r,e){if(!(this instanceof $))return new $(t,n,r);var u,o,s;y.isFunction(t)&&(r=n,n=t,t=Y),e!==R&&(u=this,o=n,s=!1,n=function(e){var i,n=O.isInTransaction();function r(){var t=i;i=null;for(var n=0;n<t.length;n++){var r=t[n];e(r)}}s=!0;try{return o(function(t){if(!s&&!i)return e(t);i?i.push(t):(i=[t],n?O.soonButNotYet(u,r):K.scheduler.setTimeout(r,0))})}finally{s=!1}}),j.call(this,t),this.dispatcher=new W(n,r),k(this)}function Z(s,t){return function(n){var r=!1,e=!1,i=a,u=S,o=function(){if(!r)return s.forEach(function(t){if(r=!0,(u=n(new h(t)))===E)return i(),i=a})};return i=t(function(t){return t.hasValue?t.isInitial&&!e?(s=new c(t.value),S):(t.isInitial||o(),r=!0,s=new c(t.value),n(t)):(t.isEnd&&(u=o()),u!==E?n(t):void 0)}),e=!0,o(),i}}function X(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.unsubscribe=y.bind(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[];for(var n,r=0;r<t.length;r++)n=t[r],this.add(n)}function G(){return new $(x(K,"never"),function(t){return t(w()),a})}function J(n){return new z(new _(K,"constant",[n]),function(t){return t(b(n)),t(w()),a})}r($,j),t($.prototype,{_isEventStream:!0,toProperty:function(t){var n,r=0===arguments.length?i:(n=t)&&(n._isSome||n.isNone)?n:new c(n),e=this.dispatcher;return new z(new _(this,"toProperty",[t]),Z(r,function(t){return e.subscribe(t)}))},toEventStream:function(){return this},withHandler:function(t){return new $(new _(this,"withHandler",[t]),this.dispatcher.subscribe,t,R)}}),t(X.prototype,{add:function(t){var n=this;if(!this.unsubscribed){var r=!1,e=a;this.starting.push(t);return e=t(this.unsubscribe,function(){if(!n.unsubscribed)return r=!0,n.remove(e),y.remove(t,n.starting)}),this.unsubscribed||r?e():this.subscriptions.push(e),y.remove(t,this.starting),e}},remove:function(t){if(!this.unsubscribed)return void 0!==y.remove(t,this.subscriptions)?t():void 0},unsubscribe:function(){if(!this.unsubscribed){this.unsubscribed=!0;for(var t=this.subscriptions,n=0;n<t.length;n++)t[n]();return this.subscriptions=[],this.starting=[],[]}},count:function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},empty:function(){return 0===this.count()}});var K={toString:function(){return"Bacon"},_:y,Event:s,Next:f,Initial:h,Error:l,End:p,noMore:E,more:S,Desc:_,spy:function(t){return A.push(t)},UpdateBarrier:O,scheduler:T,Dispatcher:W,Observable:j,EventStream:$,Property:z,CompositeUnsubscribe:X,never:G,constant:J,version:"2.0.11"};function tt(t){for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return F(this,t,r,function(n){return I(new _(this,"map",[n]),this.withHandler(function(t){return this.push(t.fmap(n))}))})}K.Bacon=K,j.prototype.map=tt,j.prototype.withStateMachine=function(t,s){var c=t;return I(new _(this,"withStateMachine",[t,s]),this.withHandler(function(t){var n=s(c,t),r=n[0],e=n[1];c=r;for(var i,u=S,o=0;o<e.length;o++)if(i=e[o],(u=this.push(i))===E)return u;return u}))};var nt=function(t,n){return t===n};function rt(t,n){this.obs=t,this.sync=n,this.queue=[]}function et(){rt.apply(this,arguments)}function it(t){rt.call(this,t,!0)}function ut(){return st($,arguments)}function ot(){return st(U,arguments)}function st(t,n){if(0===n.length)return G();var r=function(t){for(var n=t.length,r=[],e=[],i=0,u=[];i<n;){u[i]=t[i],u[i+1]=t[i+1];for(var o,s=y.toArray(t[i]),c={f:ct(t[i+1]),ixs:[]},f=!1,a=0;a<s.length;a++){o=s[a];var h=y.indexOf(r,o);f||(f=rt.isTrigger(o)),h<0&&(r.push(o),h=r.length-1);for(var p,l=0;l<c.ixs.length;l++)(p=c.ixs[l]).index===h&&p.count++;c.ixs.push({index:h,count:1})}0<s.length&&e.push(c),i+=2}return[r,e,u]}(n),l=r[0],d=r[1],e=r[2];if(!l.length)return G();l=y.map(rt.fromObservable,l);var s=y.any(l,function(t){return t.flatten})&&function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return y.any(t,function t(n){{if(y.contains(e,n))return!0;var r=n.internalDeps();return r.length?(e.push(n),y.any(r,t)):(e.push(n),!1)}})}(y.map(function(t){return t.obs},l)),c=t(new _(K,"when",e),function(f){var a=[],o=!1;function h(t){for(var n=0;n<t.ixs.length;n++){var r=t.ixs[n];if(!l[r.index].hasAtLeast(r.count))return!1}return!0}function n(t){for(var n=0;n<t.ixs.length;n++){var r=t.ixs[n];if(!l[r.index].mayHave(r.count))return!0}}function p(t){return!t.source.flatten}function e(u){return function(r){function e(){return O.whenDoneWith(c,i)}function i(){var t=function t(){if(!(0<a.length))return S;for(var n,r=S,e=a.pop(),i=0;i<d.length;i++)if(h(n=d[i])){for(var u=[],o=0;o<n.ixs.length;o++){var s=l[n.ixs[o].index].consume();u.push(s.value)}var c=n.f.apply(null,u);return r=f(e.e.apply(c)),a.length&&(a=y.filter(p,a)),r===E?r:t()}}();return o&&(y.all(l,ft)||y.all(d,n))&&(t=E,f(w())),t===E&&r(),t}return u.subscribe(function(t){if(t.isEnd)o=!0,u.markEnded(),e();else if(t.isError)var n=f(t);else u.push(t),u.sync&&(a.push({source:u,e:t}),s||O.hasWaiters()?e():i());return n===E&&r(),n||S})}}return new X(function(){for(var t,n=[],r=0;r<l.length;r++)t=l[r],n.push(e(t));return n}()).unsubscribe});return c}function ct(t){return y.isFunction(t)?t:y.always(t)}function ft(t){return!t.sync||t.ended}function at(r,e){1===r.length&&d(r[0])&&(r=r[0]);var t=function(){for(var t=[],n=0;n<r.length;n++)t.push(new it(r[n]));return t}();return I(new _(K,"groupSimultaneous",r),st(function(t,n){return new $(t,n,null,e)},[t,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n}]))}function ht(t){return d(t[0])?t[0]:Array.prototype.slice.call(t)}function pt(t){return y.isFunction(t[0])?[ht(Array.prototype.slice.call(t,1)),t[0]]:[ht(Array.prototype.slice.call(t,0,t.length-1)),y.last(t)]}function lt(n){var r=new $(new _(K,"once",[n]),function(t){return O.soonButNotYet(r,function(){t(m(n)),t(w())}),a});return r}j.prototype.skipDuplicates=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:nt;return I(new _(this,"skipDuplicates",[]),this.withStateMachine(i,function(t,n){return n.hasValue?n.isInitial||null!=(r=t)&&r._isNone||!e(t.get(),n.value)?[new c(n.value),[n]]:[t,[]]:[t,[n]];var r}))},t(rt.prototype,{_isSource:!0,subscribe:function(t){return this.obs.dispatcher.subscribe(t)},toString:function(){return this.obs.toString()},markEnded:function(){return this.ended=!0},consume:function(){return this.queue[0]},push:function(t){this.queue=[t]},mayHave:function(){return!0},hasAtLeast:function(){return this.queue.length},flatten:!0}),r(et,rt),t(et.prototype,{consume:function(){return this.queue.shift()},push:function(t){return this.queue.push(t)},mayHave:function(t){return!this.ended||this.queue.length>=t},hasAtLeast:function(t){return this.queue.length>=t},flatten:!1}),r(it,rt),t(it.prototype,{consume:function(){var t=this.queue;return this.queue=[],{value:t}},push:function(t){return this.queue.push(t.value)},hasAtLeast:function(){return!0}}),rt.isTrigger=function(t){return null!=t&&(t._isSource?t.sync:t._isEventStream)},rt.fromObservable=function(t){return null!=t&&t._isSource?t:null!=t&&t._isProperty?new rt(t,!1):new et(t,!0)},K.when=ut,K.groupSimultaneous=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return at(n)},j.prototype.awaiting=function(t){return I(new _(this,"awaiting",[t]),at([this,t],R).map(function(t){return 0===t[1].length}).toProperty(!1).skipDuplicates())},K.combineAsArray=function(){var t=ht(arguments);if(t.length){for(var n=[],r=0;r<t.length;r++){var e=v(t[r])?t[r]:K.constant(t[r]);n.push(new rt(e,!0))}return I(new K.Desc(K,"combineAsArray",t),ot(n,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n}))}return J([])},K.onValues=function(){return K.combineAsArray(Array.prototype.slice.call(arguments,0,arguments.length-1)).onValues(arguments[arguments.length-1])},K.combineWith=function(){var t=pt(arguments),n=t[0],r=t[1];return I(new _(K,"combineWith",[r].concat(n)),K.combineAsArray(n).map(function(t){return r.apply(void 0,t)}))},j.prototype.combine=function(t,n){var r=q(n);return I(new _(this,"combine",[t,n]),K.combineAsArray(this,t).map(function(t){return r(t[0],t[1])}))},j.prototype.not=function(){return I(new _(this,"not",[]),this.map(function(t){return!t}))},z.prototype.and=function(t){return I(new _(this,"and",[t]),this.combine(t,function(t,n){return t&&n}))},z.prototype.or=function(t){return I(new _(this,"or",[t]),this.combine(t,function(t,n){return t||n}))},$.prototype.bufferWithTime=function(t){return I(new _(this,"bufferWithTime",[t]),this.bufferWithTimeOrCount(t,Number.MAX_VALUE))},$.prototype.bufferWithCount=function(t){return I(new _(this,"bufferWithCount",[t]),this.bufferWithTimeOrCount(void 0,t))},$.prototype.bufferWithTimeOrCount=function(n,r){var t=function(t){return t.values.length===r?t.flush():void 0!==n?t.schedule():void 0};return I(new _(this,"bufferWithTimeOrCount",[n,r]),this.buffer(n,t,t))},$.prototype.buffer=function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a,i={scheduled:null,end:void 0,values:[],flush:function(){if(this.scheduled&&(K.scheduler.clearTimeout(this.scheduled),this.scheduled=null),0<this.values.length){var t=this.values;this.values=[];var n=this.push(g(t));if(null!=this.end)return this.push(this.end);if(n!==E)return e(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){var t=this;if(!this.scheduled)return this.scheduled=n(function(){return t.flush()})}},u=S;if(!y.isFunction(n)){var o=n;n=function(t){return K.scheduler.setTimeout(t,o)}}return I(new _(this,"buffer",[]),this.withHandler(function(t){var n=this;return i.push=function(t){return n.push(t)},t.isError?u=this.push(t):t.isEnd?(i.end=t,i.scheduled||i.flush()):(i.values.push(t.value),r(i)),u}))},j.prototype.filter=function(t){for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return F(this,t,r,function(n){return I(new _(this,"filter",[n]),this.withHandler(function(t){return t.filter(n)?this.push(t):S}))})},K.once=lt;var dt=function(t,n){return new $(t,n,void 0,R)};j.prototype.flatMap_=function(n){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=this,t=[f],a=[],h=this._isProperty,p=!1,r=(h?U:dt)(c.desc||new _(this,"flatMap_",arguments),function(u){var r=new X,e=[],i=function(t){if(h&&t.isInitial){if(p)return S;p=!0}var i=bt(n(t));return a.push(i),r.add(function(r,e){return i.dispatcher.subscribe(function(t){if(t.isEnd)return y.remove(i,a),o(),s(e),E;t=t.toNext();var n=u(t);return n===E&&r(),n})})},o=function(){var t=e.shift();if(t)return i(t)},s=function(t){if(t(),r.empty())return u(w())};return r.add(function(t,n){return f.dispatcher.subscribe(function(t){return t.isEnd?s(n):t.isError&&!c.mapError?u(t):c.firstOnly&&1<r.count()?S:r.unsubscribed?E:c.limit&&r.count()>c.limit?e.push(t):i(t)})}),r.unsubscribe});return r.internalDeps=function(){return a.length?t.concat(a):t},r};var vt=function(n){return function(t){return n(t.value)}};function yt(t){return 1===t.length&&v(t[0])?y.always(t[0]):V(t)}function bt(t){return v(t)?t:lt(t)}function gt(e,t){var i=new $(x(e,"justInitValue"),function(t){var n=void 0,r=e.dispatcher.subscribe(function(t){return t.isEnd||(n=t),E});return O.whenDoneWith(i,function(){return null!=n&&t(n),t(w())}),r},null,R);return i.concat(t,R).toProperty()}function wt(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:y.id;return new $(new _(K,"fromBinder",[e,a]),function(c){var t=!1,n=!1,f=function(){if(!t)return null!=r?(r(),t=!0):n=!0},r=e(function(){for(var t,n=arguments.length,r=Array(n),e=0;e<n;e++)r[e]=arguments[e];var i=a.apply(this,r);d(i)&&(null!=(t=y.last(i))?t._isEvent:void 0)||(i=[i]);for(var u,o=K.more,s=0;s<i.length;s++)if(u=i[s],(o=c(u=m(u)))===K.noMore||u.isEnd)return f(),o;return o});return n&&f(),f})}function mt(r,e){return I(new _(K,"later",[r,e]),wt(function(t){var n=K.scheduler.setTimeout(function(){return t([e,w()])},r);return function(){return K.scheduler.clearTimeout(n)}}))}function Et(){if(!(this instanceof Et))return new Et;this.unsubAll=y.bind(this.unsubAll,this),this.subscribeAll=y.bind(this.subscribeAll,this),this.guardedSink=y.bind(this.guardedSink,this),this.sink=void 0,this.subscriptions=[],this.ended=!1,$.call(this,new _(K,"Bus",[]),this.subscribeAll)}j.prototype.flatMapWithConcurrencyLimit=function(t){for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return this.flatMap_(vt(yt(r)),{limit:t,desc:new _(this,"flatMapWithConcurrencyLimit",[t].concat(r))})},j.prototype.flatMapConcat=function(){return I(new _(this,"flatMapConcat",Array.prototype.slice.call(arguments,0)),this.flatMapWithConcurrencyLimit.apply(this,[1].concat(Array.prototype.slice.call(arguments))))},$.prototype.concat=function(e,t){var i=this;return new $(new _(i,"concat",[e]),function(n){var r=a,t=i.dispatcher.subscribe(function(t){return t.isEnd?r=e.toEventStream().dispatcher.subscribe(n):n(t)});return function(){return t(),r()}},null,t)},z.prototype.concat=function(t){return gt(this,this.changes().concat(t))},K.concatAll=function(){var t=ht(arguments);return t.length?I(new _(K,"concatAll",t),y.fold(y.tail(t),y.head(t).toEventStream(),function(t,n){return t.concat(n)})):G()},K.fromBinder=wt,K.later=mt,j.prototype.bufferingThrottle=function(n){return I(new _(this,"bufferingThrottle",[n]),this.flatMapConcat(function(t){return lt(t).concat(mt(n).filter(!1))}))},z.prototype.bufferingThrottle=function(){return j.prototype.bufferingThrottle.apply(this,arguments).toProperty()},r(Et,$),t(Et.prototype,{unsubAll:function(){for(var t,n=this.subscriptions,r=0;r<n.length;r++)"function"==typeof(t=n[r]).unsub&&t.unsub()},subscribeAll:function(t){if(this.ended)t(w());else{this.sink=t;for(var n,r=this.subscriptions.slice(0),e=0;e<r.length;e++)n=r[e],this.subscribeInput(n)}return this.unsubAll},guardedSink:function(n){var r=this;return function(t){return t.isEnd?(r.unsubscribeInput(n),K.noMore):r.sink(t)}},subscribeInput:function(t){return t.unsub=t.input.dispatcher.subscribe(this.guardedSink(t.input)),t.unsub},unsubscribeInput:function(t){for(var n,r=this.subscriptions,e=0;e<r.length;e++)if((n=r[e]).input===t)return"function"==typeof n.unsub&&n.unsub(),void this.subscriptions.splice(e,1)},plug:function(t){var n=this;if(!this.ended){var r={input:t};return this.subscriptions.push(r),void 0!==this.sink&&this.subscribeInput(r),function(){return n.unsubscribeInput(t)}}},end:function(){if(this.ended=!0,this.unsubAll(),"function"==typeof this.sink)return this.sink(w())},push:function(t){if(!this.ended&&"function"==typeof this.sink){var n=!this.pushing;if(!n)return this.pushQueue||(this.pushQueue=[]),void this.pushQueue.push(t);this.pushing=!0;try{return this.sink(g(t))}finally{if(n&&this.pushQueue){for(var r=0;r<this.pushQueue.length;){var e=this.pushQueue[r];this.sink(g(e)),r++}this.pushQueue=null}this.pushing=!1}}},error:function(t){if("function"==typeof this.sink)return this.sink(new l(t))}}),K.Bus=Et,j.prototype.flatMap=function(){return this.flatMap_(vt(yt(arguments)),{desc:new _(this,"flatMap",arguments)})};var St=function(u,o){return P(function(r){for(var t=H(o,[function(t,n){return r.apply(void 0,t.concat([n]))}]),n=arguments.length,e=Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return I(new _(K,u,[r].concat(e)),K.combineAsArray(e).flatMap(t).changes())})};function At(i){function c(t,n,r){var e;return(e=t,e[e.length-1])[n]=r}function f(t){return d(t)?[]:{}}function a(t){if(v(t))return!0;if(t&&(t.constructor==Object||t.constructor==Array))for(var n in t){if(Object.prototype.hasOwnProperty.call(t,n))if(a(t[n]))return!0}}function n(t,n){if(v(n))l.push(n),p.push((o=t,s=l.length-1,function(t,n){c(t,o,n[s])}));else if(a(n)){p.push((i=t,u=n,function(t){var n=f(u);c(t,i,n),t.push(n)})),h(n),p.push(function(t){t.pop()})}else p.push((r=t,e=n,function(t){c(t,r,e)}));var r,e,i,u,o,s}function h(t){y.each(t,n)}var p=[],l=[],t=a(i)?(h(i),K.combineAsArray(l).map(function(t){for(var n=f(i),r=[n],e=0;e<p.length;e++)(0,p[e])(r,t);return n})):K.constant(i);return I(new _(K,"combineTemplate",[i]),t)}function kt(t){this.observable=t}K.fromCallback=St("fromCallback",function(n){for(var t=arguments.length,r=Array(1<t?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];return wt(function(t){return N(n,r)(t),a},function(t){return[t,w()]})}),K.fromNodeCallback=St("fromNodeCallback",function(n){for(var t=arguments.length,r=Array(1<t?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];return wt(function(t){return N(n,r)(t),a},function(t,n){return t?[new l(t),w()]:[n,w()]})}),K.combineTemplate=At,j.prototype.mapEnd=function(){var n=V(arguments);return I(new _(this,"mapEnd",[n]),this.withHandler(function(t){return t.isEnd?(this.push(g(n(t))),this.push(w()),E):this.push(t)}))},j.prototype.skipErrors=function(){return I(new _(this,"skipErrors",[]),this.withHandler(function(t){return t.isError?S:this.push(t)}))},j.prototype.takeUntil=function(t){var o={},n=at([this.mapEnd(o),t.skipErrors()],R);this instanceof z&&(n=n.toProperty());var r=n.withHandler(function(t){if(t.hasValue){var n=t.value,r=n[0];if(n[1].length)return this.push(w());for(var e,i=S,u=0;u<r.length;u++)i=(e=r[u])===o?this.push(w()):this.push(g(e));return i}return this.push(t)});return I(new _(this,"takeUntil",[t]),r)},j.prototype.flatMapLatest=function(){var n=yt(arguments),r=this._isProperty?this.toEventStream(R):this,t=r.flatMap(function(t){return bt(n(t)).takeUntil(r)});return this._isProperty&&(t=t.toProperty()),I(new _(this,"flatMapLatest",[n]),t)},z.prototype.delayChanges=function(t,n){return I(t,gt(this,n(this.changes())))},$.prototype.delayChanges=function(t,n){return I(t,n(this))},j.prototype.delay=function(n){return this.delayChanges(new _(this,"delay",[n]),function(t){return t.flatMap(function(t){return mt(n,t)})})},K.Observable.prototype.debounce=function(n){return this.delayChanges(new _(this,"debounce",[n]),function(t){return t.flatMapLatest(function(t){return K.later(n,t)})})},K.Observable.prototype.debounceImmediate=function(n){return this.delayChanges(new _(this,"debounceImmediate",[n]),function(t){return t.flatMapFirst(function(t){return K.once(t).concat(K.later(n).filter(!1))})})},j.prototype.decode=function(t){return I(new _(this,"decode",[t]),this.combine(At(t),function(t,n){return n[t]}))},j.prototype.scan=function(t,o){var n,s=this;o=q(o);var c=t,f=!1;return n=new z(new _(this,"scan",[t,o]),function(r){var e=!1,t=a,i=S,u=function(){e||(e=f=!0,(i=r(new h(c)))===E&&(t(),t=a))};return t=s.dispatcher.subscribe(function(t){if(t.hasValue){if(f&&t.isInitial)return S;t.isInitial||u(),e=f=!0;var n=o(c,t.value);return c=n,r(t.apply(n))}if(t.isEnd&&(i=u()),i!==E)return r(t)}),O.whenDoneWith(n,u),t})},j.prototype.diff=function(t,r){return I(new _(this,"diff",[t,r=q(r)]),this.scan([t],function(t,n){return[n,r(t[0],n)]}).filter(function(t){return 2===t.length}).map(function(t){return t[1]}))},j.prototype.doAction=function(){var n=V(arguments);return I(new _(this,"doAction",[n]),this.withHandler(function(t){return t.hasValue&&n(t.value),this.push(t)}))},j.prototype.doEnd=function(){var n=V(arguments);return I(new _(this,"doEnd",[n]),this.withHandler(function(t){return t.isEnd&&n(),this.push(t)}))},j.prototype.doError=function(){var n=V(arguments);return I(new _(this,"doError",[n]),this.withHandler(function(t){return t.isError&&n(t.error),this.push(t)}))},j.prototype.doLog=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return I(new _(this,"doLog",r),this.withHandler(function(t){var n;"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&(n=console).log.apply(n,r.concat([t.log()]));return this.push(t)}))},j.prototype.endOnError=function(t){null==t&&(t=!0);for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return F(this,t,r,function(n){return I(new _(this,"endOnError",[]),this.withHandler(function(t){return t.isError&&n(t.error)?(this.push(t),this.push(w())):this.push(t)}))})},j.prototype.errors=function(){return I(new _(this,"errors",[]),this.filter(function(){return!1}))},kt.prototype.subscribe=function(t,n,r){var e="function"==typeof t?{next:t,error:n,complete:r}:t,i={closed:!1,unsubscribe:function(){i.closed=!0,u()}},u=this.observable.subscribe(function(t){t.isError?(e.error&&e.error(t.error),i.unsubscribe()):t.isEnd?(i.closed=!0,e.complete&&e.complete()):e.next&&e.next(t.value)});return i},kt.prototype[e("observable")]=function(){return this},j.prototype.toESObservable=function(){return new kt(this)},j.prototype[e("observable")]=j.prototype.toESObservable,j.prototype.take=function(n){return n<=0?G():I(new _(this,"take",[n]),this.withHandler(function(t){return t.hasValue?0<--n?this.push(t):(0===n&&this.push(t),this.push(w()),E):this.push(t)}))},j.prototype.first=function(){return I(new _(this,"first",[]),this.take(1))},j.prototype.flatMapEvent=function(){return this.flatMap_(yt(arguments),{mapError:!0,desc:new _(this,"flatMapEvent",arguments)})},j.prototype.flatMapFirst=function(){return this.flatMap_(vt(yt(arguments)),{firstOnly:!0,desc:new _(this,"flatMapFirst",arguments)})},j.prototype.mapError=function(){var n=V(arguments);return I(new _(this,"mapError",[n]),this.withHandler(function(t){return t.isError?this.push(g(n(t.error))):this.push(t)}))},j.prototype.flatMapError=function(n){return this.flatMap_(function(t){return t instanceof l?n(t.error):t},{mapError:!0,desc:new _(this,"flatMapError",[n])})},$.prototype.flatScan=function(t,n){var r=t;return this.flatMapConcat(function(t){return bt(n(r,t)).doAction(function(t){return r=t})}).toProperty(t)},$.prototype.sampledBy=function(t,n){return I(new _(this,"sampledBy",[t,n]),this.toProperty().sampledBy(t,n))},z.prototype.sampledBy=function(t,n){n=null!=n?q(n):K._.id;var r=new rt(this,!1),e=new rt(t,!0),i=(t._isProperty?ot:ut)([r,e],n);return I(new _(this,"sampledBy",[t,n]),i)},z.prototype.sample=function(t){return I(new _(this,"sample",[t]),this.sampledBy(K.interval(t,{})))},j.prototype.map=function(t){return t&&t._isProperty?t.sampledBy(this,n):tt.apply(this,arguments)},j.prototype.reduce=j.prototype.fold=function(t,n){return I(new _(this,"fold",[t,n]),this.scan(t,n).sampledBy(this.filter(!1).mapEnd().toProperty()))},K.fromArray=function(s){if(s.length){var c=0,f=new $(new _(K,"fromArray",[s]),function(r){var e=!1,i=S,u=!1,o=!1;return O.soonButNotYet(f,function t(){if(o=!0,!u){if(c===s.length)return r(w()),!1;for(u=!0;o;)if(o=!1,i!==E&&!e){var n=s[c++];(i=r(m(n)))!==E&&(c===s.length?r(w()):O.afterTransaction(f,t))}return u=!1}}),function(){return e=!0}});return f}return I(new _(K,"fromArray",s),G())},K.fromESObservable=function(t){var r;return r=t[e("observable")]?t[e("observable")]():t,new $(new _(K,"fromESObservable",[r]),function(n){var t=r.subscribe({error:function(){n(new K.Error),n(new K.End)},next:function(t){n(new K.Next(t,!0))},complete:function(){n(new K.End)}});return t.unsubscribe?function(){t.unsubscribe()}:t})};var _t=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];function xt(r,t){return I(new _(K,"fromPoll",[r,t]),wt(function(t){var n=K.scheduler.setInterval(t,r);return function(){return K.scheduler.clearInterval(n)}},t))}function It(t){return[t,w()]}function Mt(){var u=ht(arguments);return u.length?new $(new _(K,"mergeAll",u),function(e){var i=0;return new X(y.map(function(t){return function(r){return t.dispatcher.subscribe(function(t){if(t.isEnd)return++i===u.length?e(w()):S;var n=e(t);return n===E&&r(),n})}},u)).unsubscribe}):G()}return K.fromEvent=K.fromEventTarget=function(n,r,t){var e=function(t){for(var n,r=0;r<_t.length;r++){var e=[t[(n=_t[r])[0]],t[n[1]]];if(e[0]&&e[1])return e}for(var i=0;i<_t.length;i++){var u=t[(n=_t[i])[0]];if(u)return[u,function(){}]}throw new Error("No suitable event methods in "+t)}(n),i=e[0],u=e[1];return I(new _(K,"fromEvent",[n,r]),wt(function(t){return y.isFunction(r)?(r(i.bind(n),t),function(){return r(u.bind(n),t)}):(i.call(n,r,t),function(){return u.call(n,r,t)})},t))},K.fromPoll=xt,K.fromPromise=function(r,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:It;return I(new _(K,"fromPromise",[r]),wt(function(n){var t=r.then(n,function(t){return n(new l(t))});return t&&"function"==typeof t.done&&t.done(),e?function(){if("function"==typeof r.abort)return r.abort()}:function(){}},t))},j.prototype.groupBy=function(u){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:y.id,s={},c=this;return c.filter(function(t){return!s[u(t)]}).map(function(t){var n=u(t),r=c.filter(function(t){return u(t)===n}),e=lt(t).concat(r),i=o(e,t).withHandler(function(t){if(this.push(t),t.isEnd)return delete s[n]});return s[n]=i})},$.prototype.holdWhen=function(e){var s=!1,c=[],i=this,f=!1;return new $(new _(this,"holdWhen",[e]),function(u){var n=new X,r=!1,o=function(t){if("function"==typeof t&&t(),n.empty()&&r)return u(w())};return n.add(function(t,i){return e.subscribeInternal(function(t){if(!t.hasValue)return t.isEnd?o(i):u(t);if(!(s=t.value)){var e=c;return c=[],function(){for(var t,n=[],r=0;r<e.length;r++)t=e[r],n.push(u(g(t)));return f&&(n.push(u(w())),i()),n}()}})}),n.add(function(t,n){return i.subscribeInternal(function(t){return s&&t.hasValue?c.push(t.value):t.isEnd&&c.length?(f=!0,o(n)):u(t)})}),r=!0,o(),n.unsubscribe})},K.interval=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return I(new _(K,"interval",[t,n]),xt(t,function(){return g(n)}))},K.$={},K.$.asEventStream=function(n,r,t){var e=this;return y.isFunction(r)&&(t=r,r=void 0),I(new _(this.selector||this,"asEventStream",[n]),wt(function(t){return e.on(n,r,t),function(){return e.off(n,r,t)}},t))},"undefined"!=typeof jQuery&&jQuery&&(jQuery.fn.asEventStream=K.$.asEventStream),"undefined"!=typeof Zepto&&Zepto&&(Zepto.fn.asEventStream=K.$.asEventStream),j.prototype.last=function(){var n;return I(new _(this,"last",[]),this.withHandler(function(t){if(t.isEnd)return n&&this.push(n),this.push(w()),E;n=t}))},j.prototype.log=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.subscribe(function(t){var n;"undefined"!=typeof console&&"function"==typeof console.log&&(n=console).log.apply(n,r.concat([t.log()]))}),this},$.prototype.merge=function(t){return I(new _(this,"merge",[t]),Mt(this,t))},K.mergeAll=Mt,K.repeatedly=function(t,n){var r=0;return I(new _(K,"repeatedly",[t,n]),xt(t,function(){return n[r++%n.length]}))},K.repeat=function(s){var c=0;return wt(function(n){var r=!1,e=S,i=function(){};function u(t){return t.isEnd?r?o():r=!0:e=n(t)}function o(){var t;for(r=!0;r&&e!==E;)t=s(c++),r=!1,t?i=t.subscribeInternal(u):n(w());return r=!0}return o(),function(){return i()}})},K.retry=function(t){if(!y.isFunction(t.source))throw new Error("'source' option has to be a function");var i=t.source,u=t.retries||0,o=0,s=t.delay||function(){return 0},c=t.isRetryable||function(){return!0},f=!1,a=null;return I(new _(K,"retry",[t]),K.repeat(function(t){function n(){return i(t).endOnError().withHandler(function(t){return t.isError?c((a=t).error)&&(0===u||o<u)?void 0:(f=!0,this.push(t)):(t.hasValue&&(f=!(a=null)),this.push(t))})}if(f)return null;if(a){var r={error:a.error,retriesDone:o},e=mt(s(r)).filter(!1);return o++,e.concat(K.once().flatMap(n))}return n()}))},K.sequentially=function(t,n){var r=0;return I(new _(K,"sequentially",[t,n]),xt(t,function(){var t=n[r++];return r<n.length?t:r===n.length?[t,w()]:w()}))},j.prototype.skip=function(n){return I(new _(this,"skip",[n]),this.withHandler(function(t){return t.hasValue&&0<n?(n--,S):this.push(t)}))},$.prototype.skipUntil=function(t){var n=t.take(1).map(!0).toProperty(!1);return I(new _(this,"skipUntil",[t]),this.filter(n))},$.prototype.skipWhile=function(t){for(var r=!1,n=arguments.length,e=Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return F(this,t,e,function(n){return I(new _(this,"skipWhile",[n]),this.withHandler(function(t){return!r&&t.hasValue&&n(t.value)?S:(t.hasValue&&(r=!0),this.push(t))}))})},z.prototype.startWith=function(t){return I(new _(this,"startWith",[t]),this.scan(t,function(t,n){return n}))},$.prototype.startWith=function(t){return I(new _(this,"startWith",[t]),lt(t).concat(this))},j.prototype.slidingWindow=function(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return I(new _(this,"slidingWindow",[r,n]),this.scan([],function(t,n){return t.concat([n]).slice(-r)}).filter(function(t){return t.length>=n}))},j.prototype.takeWhile=function(t){for(var n=arguments.length,r=Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return F(this,t,r,function(n){return I(new _(this,"takeWhile",[n]),this.withHandler(function(t){return t.filter(n)?this.push(t):(this.push(w()),E)}))})},j.prototype.throttle=function(n){return this.delayChanges(new _(this,"throttle",[n]),function(t){return t.bufferWithTime(n).map(function(t){return t[t.length-1]})})},z.prototype.toEventStream=function(t){var r=this;return new $(new _(this,"toEventStream",[]),function(n){return r.dispatcher.subscribe(function(t){return n(t.toNext())})},null,t)},j.prototype.firstToPromise=function(t){var e=this;if("function"!=typeof t){if("function"!=typeof Promise)throw new Error("There isn't default Promise, use shim or parameter");t=Promise}return new t(function(n,r){return e.subscribe(function(t){return t.hasValue&&n(t.value),t.isError&&r(t.error),E})})},j.prototype.toPromise=function(t){return this.last().firstToPromise(t)},K.try=function(n){return function(t){try{return lt(n(t))}catch(t){return new l(t)}}},K.update=function(t){function n(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(t){return e.apply(void 0,[t].concat(n))}}}for(var r=arguments.length,e=Array(1<r?r-1:0),i=1;i<r;i++)e[i-1]=arguments[i];for(var u=e.length-1;0<u;)e[u]instanceof Function||(e[u]=y.always(e[u])),e[u]=n(e[u]),u-=2;return I(new _(K,"update",[t].concat(e)),ut.apply(void 0,e).scan(t,function(t,n){return n(t)}))},K.zipAsArray=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=ht(n);return I(new _(K,"zipAsArray",e),K.zipWith(e,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n}))},K.zipWith=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=pt(n),i=e[0],u=e[1];return i=y.map(function(t){return t.toEventStream()},i),I(new _(K,"zipWith",[u].concat(i)),K.when(i,u))},j.prototype.zip=function(t,n){return I(new _(this,"zip",[t]),K.zipWith([this,t],n||Array))},K});