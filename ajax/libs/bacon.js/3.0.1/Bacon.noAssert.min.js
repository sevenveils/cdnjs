!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).Bacon={})}(this,function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)};function o(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function a(){}var v=Array.isArray||function(t){return t instanceof Array};function d(t){return t&&t._isObservable}function y(t,n){for(var r=0;r<t.length;r++)if(!n(t[r]))return!1;return!0}function i(t,n){for(var r=0;r<t.length;r++)if(n(t[r]))return!0;return!1}function u(t,n){return-1!==w(t,n)}function b(t,n){for(var r,e=[],i=0;i<n.length;i++)t(r=n[i])&&e.push(r);return e}function s(r){return function(t,n){return r(n,t)}}function c(t,n,r){for(var e=0;e<t.length;e++)n=r(n,t[e]);return n}function f(t){return t[0]}var w=Array.prototype.indexOf?function(t,n){return t.indexOf(n)}:function(t,n){for(var r=0;r<t.length;r++)if(n===t[r])return r;return-1};function h(t){return"function"==typeof t}function g(t,n){for(var r,e=[],i=0;i<n.length;i++)r=n[i],e.push(t(r));return e}function p(t){return t.slice(1,t.length)}function l(t){return v(t)?t:[t]}function m(n){return"function"==typeof n?n:function(t){return n}}var E={indexOf:w,indexWhere:function(t,n){for(var r=0;r<t.length;r++)if(n(t[r]))return r;return-1},head:f,always:function(t){return function(){return t}},negate:function(n){return function(t){return!n(t)}},empty:function(t){return 0===t.length},tail:p,filter:b,map:g,each:function(t,n){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n(r,t[r])},toArray:l,contains:u,id:function(t){return t},last:function(t){return t[t.length-1]},all:y,any:i,without:function(n,t){return b(function(t){return t!==n},t)},remove:function(t,n){var r=w(n,t);if(0<=r)return n.splice(r,1)},fold:c,flatMap:function(r,t){return c(t,[],function(t,n){return t.concat(r(n))})},bind:function(t,n){return function(){return t.apply(n,arguments)}},isFunction:h,toFunction:m,toString:function t(n){var r={}.hasOwnProperty;try{if(S++,null==n)return"undefined";if(h(n))return"function";if(v(n))return 5<S?"[..]":"["+g(t,n).toString()+"]";if(null!=(null!=n?n.toString:void 0)&&n.toString!==Object.prototype.toString)return n.toString();if("object"!=typeof n)return n;if(5<S)return"{..}";var e=[];for(var i in n)if(r.call(n,i)){var o=function(){try{return n[i]}catch(t){return t}}();e.push(t(i)+":"+t(o))}return"{"+e+"}"}finally{S--}}},S=0,D=void 0,A="<no-more>",I={scheduler:{setTimeout:function(t,n){return setTimeout(t,n)},setInterval:function(t,n){return setInterval(t,n)},clearInterval:function(t){return clearInterval(t)},clearTimeout:function(t){return clearTimeout(t)},now:function(){return(new Date).getTime()}}};var k=void 0,B=[],_={},x=[],M=0,W={},O=!1;function P(t){t<=M||(x[t-1]||(x[t-1]=[[],0]),M=t)}function T(t,n){if(!k&&!O)return n();P(1);for(var r=0;r<M-1&&!N(t,x[r][0]);)r++;x[r][0].push([t,n]),k||C()}function N(t,n){for(var r=0;r<n.length;r++)if(n[r][0].id==t.id)return!0;return!1}function C(){var t=M;if(t){var n=!O;O=!0;try{for(;t<=M;){var r=x[M-1];if(!r)throw new Error("Unexpected stack top: "+r);var e=r[0],i=r[1];if(!(i<e.length)){r[0]=[],r[1]=0;break}var o=e[i][1];r[1]++,P(M+1);var u=!1;try{for(o(),u=!0;t<M&&0==x[M-1][0].length;)M--}finally{u||(x=[],M=0)}}}finally{n&&(O=!1)}}}function r(t,n){if(k){var r=_[t.id];return void 0===r?(r=_[t.id]=[n],B.push(t)):r.push(n)}return n()}function F(t,n){var r=B[t],e=r.id,i=_[e];B.splice(t,1),delete _[e],n&&0<B.length&&function t(n){if(W[n.id])return;var r=n.internalDeps();for(var e,i=0;i<r.length;i++)if(e=r[i],t(e),_[e.id]){var o=E.indexOf(B,e);F(o,!1)}W[n.id]=!0}(r);for(var o=0;o<i.length;o++)(0,i[o])()}var V={toString:function(){return E.toString({rootEvent:k,processingAfters:O,waiterObs:B,waiters:_,aftersStack:x,aftersStackHeight:M,flushed:W})},whenDoneWith:r,hasWaiters:function(){return 0<B.length},inTransaction:function(t,n,r,e){if(k)return r.apply(n,e);k=t;try{var i=r.apply(n,e);!function(){for(;0<B.length;)F(0,!0);W={}}()}finally{k=void 0,C()}return i},currentEventId:function(){return k?k.id:void 0},wrappedSubscribe:function(n,t,r){var e=!1,i=!1,o=function(){i=!0},u=function(){e=!0,o()};return o=t(function(t){return T(n,function(){e||r(t)===A&&u()}),D}),i&&o(),u},afterTransaction:T,soonButNotYet:function(t,n){k?r(t,n):I.scheduler.setTimeout(n,0)},isInTransaction:function(){return void 0!==k}},L=function(){function t(t,n,r){void 0===r&&(r=[]),this._isDesc=!0,this.context=t,this.method=n,this.args=r}return t.prototype.deps=function(){return this.cachedDeps||(this.cachedDeps=n([this.context].concat(this.args))),this.cachedDeps},t.prototype.toString=function(){var t=E.map(E.toString,this.args);return E.toString(this.context)+"."+E.toString(this.method)+"("+t+")"},t}();function q(t,n){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];var i=t||n;return i&&i._isDesc?t||n:new L(t,n,r)}function n(t){return v(t)?E.flatMap(n,t):d(t)?[t]:(null!=t?t._isSource:void 0)?[t.obs]:[]}var j=function(){return D},U=function(){return D};function Q(t,n,r){return r.transform((c=n,f=t,function(t,n){var r=c(f,t),e=r[0],i=r[1];f=e;for(var o=D,u=0;u<i.length;u++){var s=i[u];if((o=n(s))===A)return o}return o}),new L(r,"withStateMachine",[t,n]));var c,f}var z=function(){function n(t){this._isSome=!0,this.isDefined=!0,this.value=t}return n.prototype.getOrElse=function(t){return this.value},n.prototype.get=function(){return this.value},n.prototype.filter=function(t){return t(this.value)?new n(this.value):H},n.prototype.map=function(t){return new n(t(this.value))},n.prototype.forEach=function(t){t(this.value)},n.prototype.toArray=function(){return[this.value]},n.prototype.inspect=function(){return"Some("+this.value+")"},n.prototype.toString=function(){return this.inspect()},n}(),H={_isNone:!0,getOrElse:function(t){return t},get:function(){throw new Error("None.get()")},filter:function(){return H},map:function(){return H},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};function R(){return H}var Y=0,X=function(){function t(){this.id=++Y,this.isEvent=!0,this._isEvent=!0,this.isEnd=!1,this.isInitial=!1,this.isNext=!1,this.isError=!1,this.hasValue=!1}return t.prototype.filter=function(t){return!0},t.prototype.inspect=function(){return this.toString()},t.prototype.log=function(){return this.toString()},t.prototype.toNext=function(){return this},t}(),$=function(r){function t(t){var n=r.call(this)||this;if(n.hasValue=!0,t instanceof X)throw new tt("Wrapping an event inside other event");return n.value=t,n}return o(t,r),t.prototype.fmap=function(t){return this.apply(t(this.value))},t.prototype.filter=function(t){return t(this.value)},t.prototype.toString=function(){return E.toString(this.value)},t.prototype.log=function(){return this.value},t}(X),G=function(r){function n(t){var n=r.call(this,t)||this;return n.isNext=!0,n._isNext=!0,n}return o(n,r),n.prototype.apply=function(t){return new n(t)},n}($),J=function(r){function n(t){var n=r.call(this,t)||this;return n.isInitial=!0,n._isInitial=!0,n}return o(n,r),n.prototype.apply=function(t){return new n(t)},n.prototype.toNext=function(){return new G(this.value)},n}($),K=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.hasValue=!1,t}return o(t,n),t.prototype.fmap=function(t){return this},t}(X),Z=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.isEnd=!0,t}return o(t,n),t.prototype.toString=function(){return"<end>"},t}(K),tt=function(r){function t(t){var n=r.call(this)||this;return n.isError=!0,n.error=t,n}return o(t,r),t.prototype.toString=function(){return"<error> "+E.toString(this.error)},t}(K);function nt(t){return new J(t)}function rt(t){return new G(t)}function et(){return new Z}function it(t){return t&&t._isEvent?t:rt(t)}function ot(t){return t&&t._isEvent}function ut(t){return t.isError}function st(t){return t.hasValue}function ct(t){return t.isEnd}function ft(t,n){return t===n}function at(t,n,r){return n.transform(ht(t),r||new L(n,"take",[t]))}function ht(r){return function(t,n){return t.hasValue?0<--r?n(t):(0===r&&n(t),n(et()),A):n(t)}}function pt(n,t,u){var s,c=t,f=!1;return s=new _n(new L(n,"scan",[t,u]),function(r){var e=!1,t=a,i=D,o=function(){return e||(e=f=!0,(i=r(new J(c)))===A&&(t(),t=a)),i};return t=n.subscribeInternal(function(t){if(st(t)){if(f&&t.isInitial)return D;t.isInitial||o(),e=f=!0;var n=u(c,t.value);return c=n,r(t.apply(n))}return t.isEnd&&(i=o()),i!==A?r(t):i}),V.whenDoneWith(s,o),t})}var lt=function(){function t(t){void 0===t&&(t=[]),this.unsubscribed=!1,this.unsubscribe=E.bind(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[];for(var n,r=0;r<t.length;r++)n=t[r],this.add(n)}return t.prototype.add=function(t){var n=this;if(!this.unsubscribed){var r=!1,e=a;this.starting.push(t);e=t(this.unsubscribe,function(){n.unsubscribed||(r=!0,n.remove(e),E.remove(t,n.starting))}),this.unsubscribed||r?e():this.subscriptions.push(e),E.remove(t,this.starting)}},t.prototype.remove=function(t){if(!this.unsubscribed)return void 0!==E.remove(t,this.subscriptions)?t():void 0},t.prototype.unsubscribe=function(){if(!this.unsubscribed){this.unsubscribed=!0;for(var t=this.subscriptions,n=0;n<t.length;n++)t[n]();this.subscriptions=[],this.starting=[]}},t.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},t.prototype.empty=function(){return 0===this.count()},t}();function vt(s,t){return function(n){var r=!1,e=!1,i=a,o=D,u=function(){if(!r)return s.forEach(function(t){if(r=!0,(o=n(new J(t)))===A)return i(),i=a})};return i=t(function(t){return t instanceof $?t.isInitial&&!e?(s=new z(t.value),D):(t.isInitial||u(),r=!0,s=new z(t.value),n(t)):(t.isEnd&&(o=u()),o!==A?n(t):o)}),e=!0,u(),i}}function dt(t,n){return new _n(t,vt(R(),n))}function yt(n){var r=new Wn(new L("Bacon","once",[n]),function(t){return V.soonButNotYet(r,function(){t(it(n)),t(et())}),a});return r}function bt(n,t,e){void 0===e&&(e={});var i=t,r=[i],a=[],h=t._isProperty,p=!1,o=(h?dt:Pn)(e.desc||new L(t,"flatMap_",[n]),function(u){var r=new lt,s=[];function c(t){if(h&&t.isInitial){if(p)return D;p=!0}var o=gt(n(t));return a.push(o),r.add(function(e,i){return o.subscribeInternal(function(t){if(t.isEnd)return E.remove(o,a),(n=s.shift())&&c(n),f(i),A;t=t.toNext();var n,r=u(t);return r===A&&e(),r})})}function f(t){return t(),r.empty()?u(et()):D}return r.add(function(t,n){return i.subscribeInternal(function(t){return t.isEnd?f(n):t.isError&&!e.mapError?u(t):e.firstOnly&&1<r.count()?D:r.unsubscribed?A:(e.limit&&r.count()>e.limit?s.push(t):c(t),D)})}),r.unsubscribe});return o.internalDeps=function(){return a.length?r.concat(a):r},o}function wt(n){return"function"==typeof n?function(t){return st(t)?n(t.value):t}:function(t){return n}}function gt(t){return d(t)?t:yt(t)}function mt(t,n){return bt(n,t,{mapError:!0,desc:new L(t,"flatMapEvent",[n])})}var Et=function(){function t(t,n){this._isSource=!0,this.flatten=!0,this.ended=!1,this.obs=t,this.sync=n}return t.prototype.subscribe=function(t){return this.obs.subscribeInternal(t)},t.prototype.toString=function(){return this.obs.toString()},t.prototype.markEnded=function(){this.ended=!0},t.prototype.mayHave=function(t){return!0},t}(),St=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return o(n,t),n.prototype.consume=function(){return this.value},n.prototype.push=function(t){this.value=t},n.prototype.hasAtLeast=function(t){return!!this.value},n}(Et),Dt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.flatten=!1,r.queue=[],r}return o(t,e),t.prototype.consume=function(){return this.queue.shift()},t.prototype.push=function(t){this.queue.push(t)},t.prototype.mayHave=function(t){return!this.ended||this.queue.length>=t},t.prototype.hasAtLeast=function(t){return this.queue.length>=t},t}(Et),At=function(r){function t(t){var n=r.call(this,t,!0)||this;return n.queue=[],n}return o(t,r),t.prototype.consume=function(){var t=this.queue;return this.queue=[],{value:t}},t.prototype.push=function(t){return this.queue.push(t.value)},t.prototype.hasAtLeast=function(t){return!0},t}(Et);function It(t){return null!=t&&t._isSource?t:null!=t&&t._isProperty?new St(t,!1):new Dt(t,!0)}function kt(){return new Wn(q("Bacon","never"),function(t){return t(et()),a})}function Bt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return xt(On,t)}function _t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return xt(dt,t)}function xt(t,n){if(0===n.length)return kt();var r=function(t){for(var n=[],r=[],e=0;e<t.length;e++){for(var i,o=t[e],u=o[0],s=o[1],c={f:s,ixs:[]},f=!1,a=0;a<u.length;a++){i=u[a];var h=w(n,i);f||(f=null!=(v=i)&&(v._isSource?v.sync:v._isEventStream)),h<0&&(n.push(i),h=n.length-1);for(var p=0;p<c.ixs.length;p++){var l=c.ixs[p];l.index===h&&l.count++}c.ixs.push({index:h,count:1})}if(0<u.length&&!f)throw new Error("At least one EventStream required, none found in "+u);0<u.length&&r.push(c)}var v;return[g(It,n),r]}(Wt(n)),l=r[0],v=r[1];if(!l.length)return kt();var c=i(l,function(t){return t.flatten})&&function(t,e){void 0===e&&(e=[]);return i(t,function t(n){{if(u(e,n))return!0;var r=n.internalDeps();return r.length?(e.push(n),i(r,t)):(e.push(n),!1)}})}(g(function(t){return t.obs},l)),d=t(new L("Bacon","when",Array.prototype.slice.call(n)),function(f){var a=[],s=!1;function h(t){for(var n=0;n<t.ixs.length;n++){var r=t.ixs[n];if(!l[r.index].hasAtLeast(r.count))return!1}return!0}function n(t){for(var n=0;n<t.ixs.length;n++){var r=t.ixs[n];if(!l[r.index].mayHave(r.count))return!0}return!1}function p(t){return!t.source.flatten}return new lt(g(function(u){return function(e){function i(){return V.whenDoneWith(d,o)}function o(){var t=function t(){var n;if(void 0!==(n=a.pop()))for(var r,e=D,i=0;i<v.length;i++)if(h(r=v[i])){for(var o=[],u=0;u<r.ixs.length;u++){var s=l[r.ixs[u].index].consume();if(!s)throw new Error("Event was undefined");o.push(s.value)}var c=r.f.apply(null,o);return e=f(n.e.apply(c)),a.length&&(a=b(p,a)),e===A?e:t()}return D}();s&&(y(l,Ot)||y(v,n))&&(t=A,f(et())),t===A&&e()}return u.subscribe(function(t){var n=D;if(t.isEnd)s=!0,u.markEnded(),i();else if(t.isError)n=f(t);else{var r=t;u.push(r),u.sync&&(a.push({source:u,e:r}),c||V.hasWaiters()?i():o())}return n===A&&e(),n})}},l)).unsubscribe});return d}function Mt(t){for(var n=0,r=t.length,e=[];n<r;){var i=l(t[n++]),o=m(t[n++]);e.push([i,o])}return e}function Wt(t){for(var n,r=[],e=0;e<t.length;e++){var i=t[e];if(!((n=i)instanceof Array)||d(n[n.length-1]))return Mt(t);if(i[0]instanceof Array)r.push([i[0],m(i[1])]);else{var o=i.slice(0,i.length-1),u=m(i[i.length-1]);r.push([o,u])}}return r}function Ot(t){return!t.sync||t.ended}function Pt(t,n,r){return Bt([new St(n.toProperty(),!1),new St(t,!0),s(r)]).withDesc(new L(t,"withLatestFrom",[n,r]))}function Tt(t,n,r){return _t([new St(n.toProperty(),!1),new St(t,!0),s(r)]).withDesc(new L(t,"withLatestFrom",[n,r]))}function Nt(t,n,r){if(t instanceof _n)return Tt(t,n,r);if(t instanceof Wn)return Pt(t,n,r);throw new Error("Unknown observable: "+t)}function Ct(t,n){return n instanceof _n?Nt(t,n,function(t,n){return n}):t.transform(Ft(n),new L(t,"map",[n]))}function Ft(t){var r=E.toFunction(t);return function(t,n){return n(t.fmap(r))}}function Vt(n){return new _n(new L("Bacon","constant",[n]),function(t){return t(nt(n)),t(et()),a})}function Lt(t){return t=Array.prototype.slice.call(t),E.flatMap(qt,t)}function qt(t){return d(t)?[t]:v(t)?Lt(t):[Vt(t)]}function jt(t){return E.isFunction(t[0])?[Lt(Array.prototype.slice.call(t,1)),t[0]]:[Lt(Array.prototype.slice.call(t,0,t.length-1)),E.last(t)]}function Ut(t,r){return xt(function(t,n){return new Wn(t,n,void 0,r)},[E.map(function(t){return new At(t)},t),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t}]).withDesc(new L("Bacon","groupSimultaneous",t))}function Qt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if((t=Lt(t)).length){for(var r=[],e=0;e<t.length;e++){var i=d(t[e])?t[e]:Vt(t[e]);r.push(Ht(i))}return _t([r,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t}]).withDesc(new L("Bacon","combineAsArray",t))}return Vt([])}function zt(t,n,r){return _t([[Ht(t),Ht(n)],r]).withDesc(new L(t,"combine",[n,r]))}function Ht(t){return new St(t,!0)}function Rt(t,n){return bt(wt(n),t,{desc:new L(t,"flatMapConcat",[n]),limit:1})}function Yt(e,f){void 0===f&&(f=E.id);var t=new L("Bacon","fromBinder",[e,f]);return new Wn(t,function(s){var t=!1,n=!1,c=function(){if(!t)return null!=r?(r(),t=!0):n=!0},r=e(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=f.apply(void 0,t),e=v(r)&&ot(E.last(r))?r:[r],i=D,o=0;o<e.length;o++){var u=it(e[o]);if((i=s(u))===A||u.isEnd)return c(),i}return i});return n&&c(),c})}function Xt(r,t){var n=new L("Bacon","fromPoll",[r,t]);return Yt(function(t){var n=I.scheduler.setInterval(t,r);return function(){return I.scheduler.clearInterval(n)}},t).withDesc(n)}function $t(t,n){return Xt(t,function(){return rt(n)}).withDesc(new L("Bacon","interval",[t,n]))}function Gt(t,n,r){var e;return Nt(n,t,s("function"==typeof(e=r)?e:E.id)).withDesc(new L(t,"sampledBy",[n]))}function Jt(t,r,n){return new _n(new L(t,"transform",[r]),function(n){return t.subscribeInternal(function(t){return r(t,n)})}).withDesc(n)}function Kt(r,n){var e,i=function(t){return n(t,e)};return function(t,n){return e=n,r(t,i)}}function Zt(t,n,r,e){return n instanceof _n?Nt(t,n,function(t,n){return[t,n]}).transform(Kt(r(function(t){return t[1]}),Ft(function(t){return t[0]})),e):t.transform(r(function(t){if("boolean"==typeof t)return E.always(t);if("function"!=typeof t)throw new Error("Not a function: "+t);return t}(n)),e)}function tn(r){return function(t,n){return t.filter(r)?n(t):D}}function nn(t){return t.map(function(t){return!t}).withDesc(new L(t,"not",[]))}function rn(t){return xn(t)?t:Vt(t)}function en(t,n){return bt(wt(n),t,{firstOnly:!0,desc:new L(t,"flatMapFirst",[n])})}function on(e,t){var i=new Wn(q(e,"justInitValue"),function(t){var n,r=e.dispatcher.subscribe(function(t){return t.isEnd||(n=t),A});return V.whenDoneWith(i,function(){return null!=n&&t(n),t(et())}),r},void 0,Mn);return i.concat(t,Mn).toProperty()}function un(t,n,r){return t.scan(n,r).last().withDesc(new L(t,"fold",[n,r]))}var sn={};function cn(t,n){return bt(wt(n),t,{desc:new L(t,"flatMap",[n])})}function fn(t,r){return bt(function(t){if(t instanceof tt){var n=t.error;return r(n)}return t},t,{mapError:!0,desc:new L(t,"flatMapError",[r])})}var an=[],hn=!1;function pn(n){if(an.length&&!hn)try{hn=!0,an.forEach(function(t){t(n)})}finally{hn=!1}}function ln(t,n){var r=E.toFunction(n),e=xn(t)?t.toEventStream(Mn):t,i=cn(e,function(t){return gt(r(t)).takeUntil(e)});return xn(t)&&(i=i.toProperty()),i.withDesc(new L(t,"flatMapLatest",[r]))}var vn=function(){function t(t,n,r){this.pushing=!1,this.ended=!1,this.prevError=void 0,this.unsubSrc=void 0,this._subscribe=n,this._handleEvent=r,this.subscribe=E.bind(this.subscribe,this),this.handleEvent=E.bind(this.handleEvent,this),this.subscriptions=[],this.observable=t,this.queue=[]}return t.prototype.hasSubscribers=function(){return 0<this.subscriptions.length},t.prototype.removeSub=function(t){return this.subscriptions=E.without(t,this.subscriptions),this.subscriptions},t.prototype.push=function(t){return t.isEnd&&(this.ended=!0),V.inTransaction(t,this,this.pushIt,[t])},t.prototype.pushToSubscriptions=function(t){try{for(var n=this.subscriptions,r=n.length,e=0;e<r;e++){var i=n[e];(i.sink(t)===A||t.isEnd)&&this.removeSub(i)}return!0}catch(t){throw this.pushing=!1,this.queue=[],t}},t.prototype.pushIt=function(t){if(this.pushing)return this.queue.push(t),D;if(t!==this.prevError){for(t.isError&&(this.prevError=t),this.pushing=!0,this.pushToSubscriptions(t),this.pushing=!1;;){var n=this.queue.shift();if(!n)break;this.push(n)}return this.hasSubscribers()?D:(this.unsubscribeFromSource(),A)}},t.prototype.handleEvent=function(t){return this._handleEvent?this._handleEvent(t):this.push(t)},t.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc(),this.unsubSrc=void 0},t.prototype.subscribe=function(t){var n=this;if(this.ended)return t(et()),a;var r={sink:t};return this.subscriptions.push(r),1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent)),function(){if(n.removeSub(r),!n.hasSubscribers())return n.unsubscribeFromSource()}},t.prototype.inspect=function(){return this.observable.toString()},t}(),dn=function(i){function t(t,n,r){var e=i.call(this,t,n,r)||this;return e.current=R(),e.propertyEnded=!1,e.subscribe=E.bind(e.subscribe,e),e}return o(t,i),t.prototype.push=function(t){return t.isEnd&&(this.propertyEnded=!0),t instanceof $?(this.current=new z(t),this.currentValueRootId=V.currentEventId()):t.hasValue&&console.error("Unknown event, two Bacons loaded?",t.constructor),i.prototype.push.call(this,t)},t.prototype.maybeSubSource=function(t,n){return n===A?a:this.propertyEnded?(t(et()),a):i.prototype.subscribe.call(this,t)},t.prototype.subscribe=function(t){var n=this,r=D;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var e=V.currentEventId(),i=this.currentValueRootId;return!this.propertyEnded&&i&&e&&e!==i?V.whenDoneWith(this.observable,function(){if(n.currentValueRootId===i)return t(nt(n.current.get().value))}):V.inTransaction(void 0,this,function(){return r=t(nt(n.current.get().value))},[]),this.maybeSubSource(t,r)}return this.maybeSubSource(t,r)},t.prototype.inspect=function(){return this.observable+" current= "+this.current},t}(vn);function yn(t,n,r){return bt(wt(r),t,{desc:new L(t,"flatMapWithConcurrencyLimit",[n,r]),limit:n})}function bn(t,n,r){var e=function(t){if(void 0===t)return;if("number"!=typeof t)return t;var n=t;return function(t){return I.scheduler.setTimeout(t,n)}}(n);function i(t){return t.values.length===r?t.flush():void 0!==e?t.schedule(e):void 0}var o=new L(t,"bufferWithTimeOrCount",[n,r]);return function(t,r,n){void 0===r&&(r=a);void 0===n&&(n=a);var e=D,i=new wn(n,r);return t.transform(function(t,n){return i.push=n,st(t)?(i.values.push(t.value),r(i)):ut(t)?e=n(t):ct(t)&&(i.end=t,i.scheduled||i.flush()),e}).withDesc(new L(t,"buffer",[]))}(t,i,i).withDesc(o)}var wn=function(){function t(t,n){this.push=function(t){return D},this.scheduled=null,this.end=void 0,this.values=[],this.onFlush=t,this.onInput=n}return t.prototype.flush=function(){if(this.scheduled&&(I.scheduler.clearTimeout(this.scheduled),this.scheduled=null),0<this.values.length){var t=this.values;this.values=[];var n=this.push(rt(t));if(null!=this.end)return this.push(this.end);if(n!==A)return this.onFlush(this)}else if(null!=this.end)return this.push(this.end)},t.prototype.schedule=function(t){var n=this;if(!this.scheduled)return this.scheduled=t(function(){return n.flush()})},t}();function gn(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];return(o=Lt(o)).length?new Wn(new L("Bacon","mergeAll",o),function(e){var i=0,t=g(function(t){return function(r){return t.subscribeInternal(function(t){if(t.isEnd)return++i===o.length?e(et()):D;t=t.toNext();var n=e(t);return n===A&&r(),n})}},o);return new lt(t).unsubscribe}):kt()}function mn(r,e){return Yt(function(t){var n=I.scheduler.setTimeout(function(){return t([it(e),et()])},r);return function(){return I.scheduler.clearTimeout(n)}}).withDesc(new L("Bacon","later",[r,e]))}function En(r){return function(t,n){return t.filter(r)?n(t):(n(et()),A)}}function Sn(r){var e=!1;return function(t,n){return!e&&st(t)&&r(t.value)?D:(t.hasValue&&(e=!0),n(t))}}function Dn(o,u,s){void 0===s&&(s=E.id);var c={};return o.transform(Kt(tn(function(t){return!c[u(t)]}),Ft(function(t){var e=u(t),n=o.changes().filter(function(t){return u(t)===e}),r=yt(t).concat(n),i=s(r,t).toEventStream().transform(function(t,n){var r=n(t);return t.isEnd&&delete c[e],r});return c[e]=i})))}function An(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var e=jt(arguments);n=e[0],t=e[1];return Bt([n=E.map(function(t){return t.toEventStream()},n),t]).withDesc(new L("Bacon","zipWith",[t].concat(n)))}function In(i){function c(t,n,r){var e;return(e=t,e[e.length-1])[n]=r}function f(t){return v(t)?[]:{}}function a(t){if(d(t))return!0;if(t&&(t.constructor==Object||t.constructor==Array))for(var n in t){if(Object.prototype.hasOwnProperty.call(t,n))if(a(t[n]))return!0}}function n(t,n){if(d(n))l.push(n),p.push((u=t,s=l.length-1,function(t,n){c(t,u,n[s])}));else if(a(n)){p.push((i=t,o=n,function(t){var n=f(o);c(t,i,n),t.push(n)})),h(n),p.push(function(t){t.pop()})}else p.push((r=t,e=n,function(t){c(t,r,e)}));var r,e,i,o,u,s}function h(t){E.each(t,n)}var p=[],l=[];return(a(i)?(h(i),Qt(l).map(function(t){for(var n=f(i),r=[n],e=0;e<p.length;e++)(0,p[e])(r,t);return n})):Vt(i)).withDesc(new L("Bacon","combineTemplate",[i]))}var kn=0,Bn=function(){function t(t){this.id=++kn,this._isObservable=!0,this.desc=t,this.initialDesc=t}return t.prototype.awaiting=function(t){return Ut([n=this,r=t],Mn).map(function(t){return 0===t[1].length}).toProperty(!1).skipDuplicates().withDesc(new L(n,"awaiting",[r]));var n,r},t.prototype.bufferingThrottle=function(t){return e=new L(n=this,"bufferingThrottle",[r=t]),n.delayChanges(e,function(t){return t.flatMapConcat(function(t){return yt(t).concat(mn(r,t).errors())})});var n,r,e},t.prototype.combine=function(t,n){return zt(this,t,n)},t.prototype.debounce=function(t){return r=t,(n=this).delayChanges(new L(n,"debounce",[r]),function(t){return t.flatMapLatest(function(t){return mn(r,t)})});var n,r},t.prototype.debounceImmediate=function(t){return r=t,(n=this).delayChanges(new L(n,"debounceImmediate",[r]),function(t){return t.flatMapFirst(function(t){return yt(t).concat(mn(r,t).errors())})});var n,r},t.prototype.decode=function(t){return r=t,(n=this).combine(In(r),function(t,n){return n[t]}).withDesc(new L(n,"decode",[r]));var n,r},t.prototype.delay=function(t){return r=t,(n=this).delayChanges(new L(n,"delay",[r]),function(t){return t.flatMap(function(t){return mn(r,t)})});var n,r},t.prototype.deps=function(){return this.desc.deps()},t.prototype.diff=function(t,n){return i=n,Jt(pt(r=this,[e=t],function(t,n){return[n,i(t[0],n)]}),Kt(tn(function(t){return 2===t.length}),Ft(function(t){return t[1]})),new L(r,"diff",[e,i]));var r,e,i},t.prototype.doAction=function(t){return this.transform((r=t,function(t,n){return st(t)&&r(t.value),n(t)}),new L(this,"doAction",[t]));var r},t.prototype.doEnd=function(t){return this.transform((r=t,function(t,n){return ct(t)&&r(),n(t)}),new L(this,"doEnd",[t]));var r},t.prototype.doError=function(t){return this.transform((r=t,function(t,n){return ut(t)&&r(t.error),n(t)}),new L(this,"doError",[t]));var r},t.prototype.doLog=function(){for(var r,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.transform((r=t,function(t,n){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,r.concat([t.log()])),n(t)}),new L(this,"doLog",t))},t.prototype.endAsValue=function(){return this.transform(function(t,n){return ct(t)?(n(rt({})),n(et()),A):D})},t.prototype.endOnError=function(t){return void 0===t&&(t=function(t){return!0}),void 0===(r=t)&&(r=function(t){return!0}),(n=this).transform(function(t,n){return ut(t)&&r(t.error)?(n(t),n(et())):n(t)},new L(n,"endOnError",[]));var n,r},t.prototype.errors=function(){return this.filter(function(t){return!1}).withDesc(new L(this,"errors"))},t.prototype.filter=function(t){return Zt(n=this,r=t,tn,new L(n,"filter",[r]));var n,r},t.prototype.first=function(){return at(1,this,new L(this,"first"))},t.prototype.firstToPromise=function(t){return function(t,n){if("function"!=typeof n){if("function"!=typeof Promise)throw new Error("There isn't default Promise, use shim or parameter");n=function(t){return new Promise(t)}}return new n(function(n,r){return t.subscribe(function(t){return st(t)&&n(t.value),ut(t)&&r(t.error),A})})}(this,t)},t.prototype.fold=function(t,n){return un(this,t,n)},t.prototype.forEach=function(t){return void 0===t&&(t=j),this.onValue(t)},t.prototype.holdWhen=function(t){return c=!1,a=!(f=[]),new Wn(new L(e=this,"holdWhen",[s=t]),function(o){var n=new lt,r=!1,u=function(t){return t&&t(),n.empty()&&r?o(et()):D};return n.add(function(t,i){return s.subscribeInternal(function(t){if(st(t)){c=t.value;var n=D;if(!c){var r=f;f=[];for(var e=0;e<r.length;e++)n=o(rt(r[e]));a&&(o(et()),i(),n=A)}return n}return t.isEnd?u(i):o(t)})}),n.add(function(t,n){return e.subscribeInternal(function(t){return c&&st(t)?(f.push(t.value),D):t.isEnd&&f.length?(a=!0,u(n)):o(t)})}),r=!0,u(),n.unsubscribe});var e,s,c,f,a},t.prototype.inspect=function(){return this.toString()},t.prototype.internalDeps=function(){return this.initialDesc.deps()},t.prototype.last=function(){return(t=this).transform(function(t,n){return ct(t)?(r&&n(r),n(et()),A):st(t)?(r=t,D):n(t)}).withDesc(new L(t,"last",[]));var t,r},t.prototype.log=function(){for(var n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n=t,this.subscribe(function(t){return"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,n.concat([t.log()])),D}),this},t.prototype.mapEnd=function(t){return this.transform((n=t,r=E.toFunction(n),function(t,n){return ct(t)?(n(rt(r(t))),n(et()),A):n(t)}),new L(this,"mapEnd",[t]));var n,r},t.prototype.mapError=function(t){return this.transform((n=t,r=E.toFunction(n),function(t,n){return ut(t)?n(rt(r(t.error))):n(t)}),new L(this,"mapError",[t]));var n,r},t.prototype.name=function(t){return this._name=t,this},t.prototype.onEnd=function(n){return void 0===n&&(n=U),this.subscribe(function(t){return t.isEnd?n():D})},t.prototype.onError=function(n){return void 0===n&&(n=j),this.subscribe(function(t){return ut(t)?n(t.error):D})},t.prototype.onValue=function(n){return void 0===n&&(n=j),this.subscribe(function(t){return st(t)?n(t.value):D})},t.prototype.onValues=function(n){return this.onValue(function(t){return n.apply(void 0,t)})},t.prototype.reduce=function(t,n){return un(this,t,n)},t.prototype.scan=function(t,n){return pt(this,t,n)},t.prototype.skip=function(t){return r=t,(n=this).transform(function(t,n){return t.hasValue&&0<r?(r--,D):n(t)},new L(n,"skip",[r]));var n,r},t.prototype.skipDuplicates=function(t){return function(t,e){void 0===e&&(e=ft);var n=new L(t,"skipDuplicates",[]);return Q(R(),function(t,n){return st(n)?n.isInitial||null!=(r=t)&&r._isNone||!e(t.get(),n.value)?[new z(n.value),[n]]:[t,[]]:[t,[n]];var r},t).withDesc(n)}(this,t)},t.prototype.skipErrors=function(){return(t=this).transform(function(t,n){return ut(t)?D:n(t)},new L(t,"skipErrors",[]));var t},t.prototype.skipUntil=function(t){return n=this,e=(r=t).transform(Kt(ht(1),Ft(!0))).toProperty().startWith(!1),n.filter(e).withDesc(new L(n,"skipUntil",[r]));var n,r,e},t.prototype.skipWhile=function(t){return Zt(n=this,r=t,Sn,new L(n,"skipWhile",[r]));var n,r},t.prototype.slidingWindow=function(t,n){return void 0===n&&(n=0),e=t,void 0===(i=n)&&(i=0),(r=this).scan([],function(t,n){return t.concat([n]).slice(-e)}).filter(function(t){return t.length>=i}).withDesc(new L(r,"slidingWindow",[e,i]));var r,e,i},t.prototype.subscribe=function(t){var n=this;return void 0===t&&(t=j),V.wrappedSubscribe(this,function(t){return n.subscribeInternal(t)},t)},t.prototype.take=function(t){return at(t,this)},t.prototype.takeUntil=function(t){return r=t,e=Ut([(n=this).mapEnd(sn),r.skipErrors()],Mn),n instanceof _n&&(e=e.toProperty()),e.transform(function(t,n){if(st(t)){var r=t.value,e=r[0];if(r[1].length)return n(et());for(var i=D,o=0;o<e.length;o++){var u=e[o];if(u===sn)return n(et());i=n(rt(u))}return i}return n(t)},new L(n,"takeUntil",[r]));var n,r,e},t.prototype.takeWhile=function(t){return Zt(n=this,r=t,En,new L(n,"takeWhile",[r]));var n,r},t.prototype.throttle=function(t){return r=t,(n=this).delayChanges(new L(n,"throttle",[r]),function(t){return t.bufferWithTime(r).map(function(t){return t[t.length-1]})});var n,r},t.prototype.toPromise=function(t){return n=t,this.last().firstToPromise(n);var n},t.prototype.toString=function(){return this._name?this._name:this.desc.toString()},t.prototype.withDesc=function(t){return t&&(this.desc=t),this},t.prototype.withDescription=function(t,n){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];return this.desc=q.apply(void 0,[t,n].concat(r)),this},t.prototype.zip=function(t,n){return r=this,e=t,An(n||Array,r,e).withDesc(new L(r,"zip",[e]));var r,e},t}(),_n=function(i){function t(t,n,r){var e=i.call(this,t)||this;return e._isProperty=!0,e.dispatcher=new dn(e,n,r),pn(e),e}return o(t,i),t.prototype.and=function(t){return r=t,(n=this).combine(rn(r),function(t,n){return t&&n}).withDesc(new L(n,"and",[r]));var n,r},t.prototype.changes=function(){var t=this;return new Wn(new L(this,"changes",[]),function(n){return t.dispatcher.subscribe(function(t){return t.isInitial?D:n(t)})})},t.prototype.concat=function(t){return on(this,this.changes().concat(t))},t.prototype.delayChanges=function(t,n){return on(this,n(this.changes())).withDesc(t)},t.prototype.flatMap=function(t){return cn(this,t)},t.prototype.flatMapConcat=function(t){return Rt(this,t)},t.prototype.flatMapError=function(t){return fn(this,t)},t.prototype.flatMapEvent=function(t){return mt(this,t)},t.prototype.flatMapFirst=function(t){return en(this,t)},t.prototype.flatMapLatest=function(t){return ln(this,t)},t.prototype.flatMapWithConcurrencyLimit=function(t,n){return yn(this,t,n)},t.prototype.groupBy=function(t,n){return Dn(this,t,n)},t.prototype.map=function(t){return Ct(this,t)},t.prototype.not=function(){return nn(this)},t.prototype.or=function(t){return r=t,(n=this).combine(rn(r),function(t,n){return t||n}).withDesc(new L(n,"or",[r]));var n,r},t.prototype.sample=function(t){return Gt(n=this,$t(r=t,{}),function(t,n){return t}).withDesc(new L(n,"sample",[r]));var n,r},t.prototype.sampledBy=function(t){return Gt(this,t,arguments[1])},t.prototype.startWith=function(t){return r=t,(n=this).scan(r,function(t,n){return n}).withDesc(new L(n,"startWith",[r]));var n,r},t.prototype.subscribeInternal=function(t){return void 0===t&&(t=j),this.dispatcher.subscribe(t)},t.prototype.toEventStream=function(t){var r=this;return new Wn(new L(this,"toEventStream",[]),function(n){return r.subscribeInternal(function(t){return n(t.toNext())})},void 0,t)},t.prototype.toProperty=function(){return this},t.prototype.transform=function(t,n){return Jt(this,t,n)},t.prototype.withLatestFrom=function(t,n){return Tt(this,t,n)},t.prototype.withStateMachine=function(t,n){return Q(t,n,this)},t}(Bn);function xn(t){return!!t._isProperty}var Mn={forceAsync:!1},Wn=function(c){function t(t,n,r,e){var o,u,s,i=c.call(this,t)||this;return i._isEventStream=!0,e!==Mn&&(o=i,u=n,s=!1,n=function(e){var i,n=V.isInTransaction();function r(){var t=i||[];i=void 0;for(var n=0;n<t.length;n++){var r=t[n];e(r)}}s=!0;try{return u(function(t){return s||i?(i?i.push(t):(i=[t],n?V.soonButNotYet(o,r):I.scheduler.setTimeout(r,0)),D):e(t)})}finally{s=!1}}),i.dispatcher=new vn(i,n,r),pn(i),i}return o(t,c),t.prototype.bufferWithTime=function(t){return bn(n=this,r=t,Number.MAX_VALUE).withDesc(new L(n,"bufferWithTime",[r]));var n,r},t.prototype.bufferWithCount=function(t){return bn(n=this,void 0,r=t).withDesc(new L(n,"bufferWithCount",[r]));var n,r},t.prototype.bufferWithTimeOrCount=function(t,n){return bn(this,t,n)},t.prototype.changes=function(){return this},t.prototype.concat=function(t,n){return r=n,new Wn(new L(e=this,"concat",[i=t]),function(n){var r=a,t=e.dispatcher.subscribe(function(t){return t.isEnd?(r=i.toEventStream().dispatcher.subscribe(n),D):n(t)});return function(){return t(),r()}},void 0,r);var e,i,r},t.prototype.delayChanges=function(t,n){return n(this).withDesc(t)},t.prototype.flatMap=function(t){return cn(this,t)},t.prototype.flatMapConcat=function(t){return Rt(this,t)},t.prototype.flatMapError=function(t){return fn(this,t)},t.prototype.flatMapFirst=function(t){return en(this,t)},t.prototype.flatMapLatest=function(t){return ln(this,t)},t.prototype.flatMapWithConcurrencyLimit=function(t,n){return yn(this,t,n)},t.prototype.flatMapEvent=function(t){return mt(this,t)},t.prototype.flatScan=function(t,n){return i=n,o=e=t,(r=this).flatMapConcat(function(t){return gt(i(o,t)).doAction(function(t){return o=t})}).toProperty().startWith(e).withDesc(new L(r,"flatScan",[e,i]));var r,e,i,o},t.prototype.groupBy=function(t,n){return Dn(this,t,n)},t.prototype.map=function(t){return Ct(this,t)},t.prototype.merge=function(t){return gn(this,t).withDesc(new L(this,"merge",[t]))},t.prototype.not=function(){return nn(this)},t.prototype.sampledBy=function(t){return n=this,r=t,e=arguments[1],Gt(n.toProperty(),r,e).withDesc(new L(n,"sampledBy",[r]));var n,r,e},t.prototype.startWith=function(t){return n=this,yt(r=t).concat(n).withDesc(new L(n,"startWith",[r]));var n,r},t.prototype.subscribeInternal=function(t){return void 0===t&&(t=j),this.dispatcher.subscribe(t)},t.prototype.toEventStream=function(){return this},t.prototype.toProperty=function(t){var n,r=arguments.length?(n=t)&&(n._isSome||n._isNone)?n:new z(n):R(),e=this.dispatcher,i=new L(this,"toProperty",Array.prototype.slice.apply(arguments)),o=e.subscribe;return new _n(i,vt(r,o))},t.prototype.transform=function(t,n){return i=n,new Wn(new L(r=this,"transform",[e=t]),function(n){return r.subscribeInternal(function(t){return e(t,n)})},void 0,Mn).withDesc(i);var r,e,i},t.prototype.withLatestFrom=function(t,n){return Pt(this,t,n)},t.prototype.withStateMachine=function(t,n){return Q(t,n,this)},t}(Bn);function On(t,n){return new Wn(t,n)}function Pn(t,n){return new Wn(t,n,void 0,Mn)}function Tn(t){return"undefined"!=typeof Symbol&&Symbol[t]?Symbol[t]:"undefined"!=typeof Symbol&&"function"==typeof Symbol.for?Symbol[t]=Symbol.for(t):"@@"+t}var Nn=function(){function t(t){this.observable=t}return t.prototype.subscribe=function(t,n,r){var e="function"==typeof t?{next:t,error:n,complete:r}:t,i={closed:!1,unsubscribe:function(){i.closed=!0,o()}},o=this.observable.subscribe(function(t){st(t)&&e.next?e.next(t.value):ut(t)?(e.error&&e.error(t.error),i.unsubscribe()):t.isEnd&&(i.closed=!0,e.complete&&e.complete())});return i},t}();function Cn(r){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){return r.apply(void 0,[t].concat(n))}}}Nn.prototype[Tn("observable")]=function(){return this},Bn.prototype.toESObservable=function(){return new Nn(this)},Bn.prototype[Tn("observable")]=Bn.prototype.toESObservable;var Fn=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];function Vn(r,e,t){var n=function(t){for(var n,r=0;r<Fn.length;r++){var e=[t[(n=Fn[r])[0]],t[n[1]]];if(e[0]&&e[1])return e}for(var i=0;i<Fn.length;i++){var o=t[(n=Fn[i])[0]];if(o)return[o,function(){}]}throw new Error("No suitable event methods in "+t)}(r),i=n[0],o=n[1],u=new L("Bacon","fromEvent",[r,e]);return Yt(function(t){return n=e,E.isFunction(n)?(e(i.bind(r),t),function(){return e(o.bind(r),t)}):(i.call(r,e,t),function(){return o.call(r,e,t)});var n},t).withDesc(u)}function Ln(s){var c=0;return Yt(function(n){var r=!1,e=D,i=function(){};function o(t){return t.isEnd?(r?u():r=!0,D):e=n(t)}function u(){var t;for(r=!0;r&&e!==A;)t=s(c++),r=!1,t?i=t.subscribeInternal(o):n(et());r=!0}return u(),function(){return i()}}).withDesc(new L("Bacon","repeat",[s]))}function qn(t){return mn(t,"").filter(!1).withDesc(new L("Bacon","silence",[t]))}function jn(t){return[it(t),et()]}var Un,Qn=(Un=function(t){for(var r,e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return E.isFunction(t)?n.length?(r=t,e=n,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.apply(void 0,e.concat(t))}):t:E.always(t)},function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if("object"==typeof t&&n.length){var e=t,i=n[0];t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e[i].apply(e,t)},n=n.slice(1)}return Un.apply(void 0,[t].concat(n))});function zn(t,n){return Qn.apply(void 0,[t].concat(n))}var Hn=function(t){function n(){var n=t.call(this,new L("Bacon","Bus",[]),function(t){return n.subscribeAll(t)})||this;return n.pushing=!1,n.pushQueue=void 0,n.ended=!1,n.subscriptions=[],n.unsubAll=E.bind(n.unsubAll,n),n.subscribeAll=E.bind(n.subscribeAll,n),n.guardedSink=E.bind(n.guardedSink,n),n.subscriptions=[],n.ended=!1,Wn.call(n,new L("Bacon","Bus",[]),n.subscribeAll),n}return o(n,t),n.prototype.plug=function(t){var n=this;if(!this.ended){var r={input:t,unsub:void 0};return this.subscriptions.push(r),void 0!==this.sink&&this.subscribeInput(r),function(){return n.unsubscribeInput(t)}}},n.prototype.end=function(){if(this.ended=!0,this.unsubAll(),"function"==typeof this.sink)return this.sink(et())},n.prototype.push=function(t){if(!this.ended&&"function"==typeof this.sink){var n=!this.pushing;if(!n)return this.pushQueue||(this.pushQueue=[]),void this.pushQueue.push(t);this.pushing=!0;try{return this.sink(rt(t))}finally{if(n&&this.pushQueue){for(var r=0;r<this.pushQueue.length;){var e=this.pushQueue[r];this.sink(rt(e)),r++}this.pushQueue=void 0}this.pushing=!1}}},n.prototype.error=function(t){if("function"==typeof this.sink)return this.sink(new tt(t))},n.prototype.unsubAll=function(){for(var t,n=this.subscriptions,r=0;r<n.length;r++)"function"==typeof(t=n[r]).unsub&&t.unsub()},n.prototype.subscribeAll=function(t){if(this.ended)t(et());else{this.sink=t;for(var n,r=this.subscriptions.slice(),e=0;e<r.length;e++)n=r[e],this.subscribeInput(n)}return this.unsubAll},n.prototype.guardedSink=function(n){var r=this;return function(t){return t.isEnd?(r.unsubscribeInput(n),A):r.sink?r.sink(t):D}},n.prototype.subscribeInput=function(t){return t.unsub=t.input.subscribeInternal(this.guardedSink(t.input)),t.unsub},n.prototype.unsubscribeInput=function(t){for(var n,r=this.subscriptions,e=0;e<r.length;e++)if((n=r[e]).input===t)return"function"==typeof n.unsub&&n.unsub(),void this.subscriptions.splice(e,1)},n}(Wn);var Rn={asEventStream:function(n,r,t){var e=this;return E.isFunction(r)&&(t=r,r=void 0),Yt(function(t){return e.on(n,r,t),function(){return e.off(n,r,t)}},t).withDesc(new L(this.selector||this,"asEventStream",[n]))},init:function(t){t.fn.asEventStream=Rn.asEventStream}};t.$=Rn,t.Bus=Hn,t.CompositeUnsubscribe=lt,t.Desc=L,t.End=Z,t.Error=tt,t.Event=X,t.EventStream=Wn,t.Initial=J,t.Next=G,t.Observable=Bn,t.Property=_n,t.Value=$,t._=E,t.combine=zt,t.combineAsArray=Qt,t.combineTemplate=In,t.combineWith=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var e=jt(arguments),i=(t=e[0],n=e[1],new L("Bacon","combineWith",[n].concat(t)));return Qt(t).map(function(t){return n.apply(void 0,t)}).withDesc(i)},t.concatAll=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Lt(t);return(r.length?c(p(r),f(r).toEventStream(),function(t,n){return t.concat(n)}):kt()).withDesc(new L("Bacon","concatAll",r))},t.constant=Vt,t.fromArray=function(s){if(s.length){var c=0,f=new Wn(new L("Bacon","fromArray",[s]),function(r){var e=!1,i=D,o=!1,u=!1;return V.soonButNotYet(f,function t(){if(u=!0,!o){if(c===s.length)return r(et()),!1;for(o=!0;u;)if(u=!1,i!==A&&!e){var n=s[c++];(i=r(it(n)))!==A&&(c===s.length?r(et()):V.afterTransaction(f,t))}return o=!1}}),function(){return e=!0}});return f}return kt().withDesc(new L("Bacon","fromArray",s))},t.fromBinder=Yt,t.fromCallback=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return Yt(function(t){return zn(n,r)(t),a},function(t){return[t,et()]}).withDesc(new L("Bacon","fromCallback",[n].concat(r)))},t.fromESObservable=function(t){var r;r=t[Tn("observable")]?t[Tn("observable")]():t;var n=new L("Bacon","fromESObservable",[r]);return new Wn(n,function(n){var t=r.subscribe({error:function(t){n(new tt(t)),n(new Z)},next:function(t){n(new G(t))},complete:function(){n(new Z)}});return t.unsubscribe?function(){t.unsubscribe()}:t})},t.fromEvent=Vn,t.fromEventTarget=Vn,t.fromNodeCallback=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return Yt(function(t){return zn(n,r)(t),a},function(t,n){return t?[new tt(t),et()]:[n,et()]}).withDesc(new L("Bacon","fromNodeCallback",[n].concat(r)))},t.fromPoll=Xt,t.fromPromise=function(r,e,t){return void 0===t&&(t=jn),Yt(function(n){var t=r.then(n,function(t){return n(new tt(t))});return t&&"function"==typeof t.done&&t.done(),e?function(){if("function"==typeof r.abort)return r.abort()}:function(){}},t).withDesc(new L("Bacon","fromPromise",[r]))},t.getScheduler=function(){return I.scheduler},t.groupSimultaneous=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ut(Lt(t))},t.hasValue=st,t.interval=$t,t.isEnd=ct,t.isError=ut,t.isEvent=ot,t.isInitial=function(t){return t&&t._isInitial},t.isNext=function(t){return t.isNext},t.later=mn,t.mergeAll=gn,t.more=D,t.never=kt,t.noMore=A,t.nullSink=j,t.nullVoidSink=U,t.onValues=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Qt(t.slice(0,t.length-1)).onValues(t[arguments.length-1])},t.once=yt,t.repeat=Ln,t.repeatedly=function(t,n){var r=0;return Xt(t,function(){return n[r++%n.length]}).withDesc(new L("Bacon","repeatedly",[t,n]))},t.retry=function(t){if(!E.isFunction(t.source))throw new Error("'source' option has to be a function");var i=t.source,o=t.retries||0,u=0,s=t.delay||function(){return 0},c=t.isRetryable||function(){return!0},f=!1,a=null;return Ln(function(t){function n(){return i(t).endOnError().transform(function(t,n){return ut(t)?c((a=t).error)&&(0===o||u<o)?D:(f=!0,n(t)):(st(t)&&(f=!(a=null)),n(t))})}if(!f){if(a){var r={error:a.error,retriesDone:u},e=qn(s(r));return u++,e.concat(yt(null).flatMap(n))}return n()}}).withDesc(new L("Bacon","retry",[t]))},t.sequentially=function(t,n){var r=0;return Xt(t,function(){var t=n[r++];return r<n.length?t:r===n.length?[it(t),et()]:et()}).withDesc(new L("Bacon","sequentially",[t,n]))},t.setScheduler=function(t){I.scheduler=t},t.silence=qn,t.spy=function(t){return an.push(t)},t.try=function(n){return function(t){try{return yt(n(t))}catch(t){return yt(new tt(t))}}},t.update=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];for(var e=Wt(n),i=0;i<e.length;i++){var o=e[i];o[1]=Cn(o[1])}return Bt.apply(void 0,e).scan(t,function(t,n){return n(t)}).withDesc(new L("Bacon","update",[t].concat(n)))},t.version="3.0.1",t.when=Bt,t.zipAsArray=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Bt([E.map(function(t){return t.toEventStream()},Lt(t)),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t}]).withDesc(new L("Bacon","zipAsArray",t))},t.zipWith=An,Object.defineProperty(t,"__esModule",{value:!0})});