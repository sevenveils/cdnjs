!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Choo=e()}}(function(){function e(t){if(!(this instanceof e))return new e(t);"number"==typeof t&&(t={max:t}),t||(t={}),this.cache={},this.head=this.tail=null,this.length=0,this.max=t.max||1e3,this.maxAge=t.maxAge||0}function t(e,t,n){this.cache="number"==typeof n?new w(n):n||new w(100),this.state=e,this.emit=t}function n(e){return new(e.bind.apply(e,arguments))}function i(e,t){t=t||b;var n;return E?(n=window.requestIdleCallback(function(n){if(n.timeRemaining()<=10&&!n.didTimeout)return i(e,t);e(n)},t),window.cancelIdleCallback.bind(window,n)):A?(n=setTimeout(e,0),clearTimeout.bind(window,n)):void 0}function r(e){e&&N(e)}function o(e){if(!(this instanceof o))return new o(e);this._name=e||"nanobus",this._starListeners=[],this._listeners={}}function s(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}function a(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName?e:(C(e,t),function(e,t){for(var n,i,r,o,s=0,u=0;n=t.childNodes[u],i=e.childNodes[u-s],n||i;u++)if(i)if(n)if(h(i,n))(r=a(i,n))!==n&&(t.replaceChild(r,n),s++);else{o=null;for(var c=u;c<t.childNodes.length;c++)if(h(t.childNodes[c],i)){o=t.childNodes[c];break}o?((r=a(i,o))!==o&&s++,t.insertBefore(r,n)):i.id||n.id?(t.insertBefore(i,n),s++):(r=a(i,n))!==n&&(t.replaceChild(r,n),s++)}else t.appendChild(i),s++;else t.removeChild(n),u--}(e,t),t):null:e}function h(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&e.type===R&&e.nodeValue===t.nodeValue}function u(){if(!(this instanceof u))return new u;this.trie={nodes:{}}}function c(e){function t(e){var t=n(e),i=new Array(arguments.length);i[0]=t.params;for(var r=1;r<i.length;r++)i[r]=arguments[r];return t.cb.apply(t.cb,i)}function n(e){var t=o.match(e);if(t&&t.cb)return new i(t);var n=o.match(r);if(n&&n.cb)return new i(n);throw new Error("route '"+e+"' did not match")}function i(e){this.cb=e.cb,this.route=e.cb.route,this.params=e.params}if(!(this instanceof c))return new c(e);var r=(e||"").replace(/^\//,""),o=G();return t._trie=o,t.on=function(e,n){return e=e||"/",n.route=e,n&&n._wayfarer&&n._trie?o.mount(e,n._trie.trie):o.create(e).cb=n,t},t.emit=t,t.match=n,t._wayfarer=!0,t}function l(e){if(!(this instanceof l))return new l(e);e=e||{},this.router=j(e.default||"/404")}function d(e,t){return(e=t?e.replace(W,""):e.replace(F,"")).replace(K,"").replace(B,"/")}function f(e){this.hasWindow=e,this.hasIdle=this.hasWindow&&window.requestIdleCallback,this.method=this.hasIdle?window.requestIdleCallback.bind(window):this.setTimeout,this.scheduled=!1,this.queue=[]}function p(e){function t(t){var r="end-"+n+"-"+e;z.mark(r),J.push(function(){var o=null;try{var s=e+" ["+n+"]";z.measure(s,i,r),z.clearMarks(i),z.clearMarks(r)}catch(e){o=e}t&&t(o,e)})}if(p.disabled)return m;var n=(1e4*z.now()).toFixed()%Number.MAX_SAFE_INTEGER,i="start-"+n+"-"+e;return z.mark(i),t.uuid=n,t}function m(e){e&&J.push(function(){e(new Error("nanotiming: performance API unavailable"))})}function v(e){if(!(this instanceof v))return new v(e);e=e||{};var t=this;this._events={DOMCONTENTLOADED:"DOMContentLoaded",DOMTITLECHANGE:"DOMTitleChange",REPLACESTATE:"replaceState",PUSHSTATE:"pushState",NAVIGATE:"navigate",POPSTATE:"popState",RENDER:"render"},this._historyEnabled=void 0===e.history||e.history,this._hrefEnabled=void 0===e.href||e.href,this._hashEnabled=void 0===e.hash||e.hash,this._hasWindow="undefined"!=typeof window,this._cache=e.cache,this._loaded=!1,this._stores=[],this._tree=null;var n={events:this._events,components:{}};this._hasWindow?(this.state=window.initialState?M(window.initialState,n):n,delete window.initialState):this.state=n,this.router=U({curry:!0}),this.emitter=L("choo.emit"),this.emit=this.emitter.emit.bind(this.emitter),this._hasWindow&&(this.state.title=document.title),this.emitter.prependListener(this._events.DOMTITLECHANGE,function(e){t.state.title=e,t._hasWindow&&(document.title=e)})}var w={};w=e,Object.defineProperty(e.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),e.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},e.prototype.remove=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}},e.prototype._unlink=function(e,t,n){this.length--,0===this.length?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=n,this.cache[this.tail].prev=null):(this.cache[t].next=n,this.cache[n].prev=t)},e.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}},e.prototype.set=function(e,t){"string"!=typeof e&&(e=""+e);var n;if(this.cache.hasOwnProperty(e)){if(n=this.cache[e],n.value=t,this.maxAge&&(n.modified=Date.now()),e===this.head)return t;this._unlink(e,n.prev,n.next)}else n={value:t,modified:0,next:null,prev:null},this.maxAge&&(n.modified=Date.now()),this.cache[e]=n,this.length===this.max&&this.evict();return this.length++,n.next=null,n.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t},e.prototype._checkAge=function(e,t){return!(this.maxAge&&Date.now()-t.modified>this.maxAge&&(this.remove(e),1))},e.prototype.get=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}},e.prototype.evict=function(){this.tail&&this.remove(this.tail)};var y={};y=t,t.prototype.render=function(e,t){var i=this.cache.get(t);if(!i){for(var r=[],o=2,s=arguments.length;o<s;o++)r.push(arguments[o]);r.unshift(e,t,this.state,this.emit),i=n.apply(n,r),this.cache.set(t,i)}return i};var _,g=function(e){var t=document.readyState;if("complete"===t||"interactive"===t)return setTimeout(e,0);document.addEventListener("DOMContentLoaded",function(){e()})},b={},A="undefined"!=typeof window,E=A&&window.requestIdleCallback,N=i,T=!0;try{_=window.performance,T="true"===window.localStorage.DISABLE_NANOTIMING||!_.mark}catch(e){}var S=function(e,t,n){var i,r=e.length;if(!(t>=r||0===n)){var o=r-(n=t+n>r?r-t:n);for(i=t;i<o;++i)e[i]=e[i+n];e.length=o}},L={};L=o,o.prototype.emit=function(e){for(var t=[],n=1,i=arguments.length;n<i;n++)t.push(arguments[n]);var o=function(e){function t(t){var r="end-"+n+"-"+e;_.mark(r),N(function(){var o=e+" ["+n+"]";_.measure(o,i,r),_.clearMarks(i),_.clearMarks(r),t&&t(e)})}if(T)return r;var n=(1e4*_.now()).toFixed()%Number.MAX_SAFE_INTEGER,i="start-"+n+"-"+e;return _.mark(i),t.uuid=n,t}(this._name+"('"+e+"')"),s=this._listeners[e];return s&&s.length>0&&this._emit(this._listeners[e],t),this._starListeners.length>0&&this._emit(this._starListeners,e,t,o.uuid),o(),this},o.prototype.on=o.prototype.addListener=function(e,t){return"*"===e?this._starListeners.push(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)),this},o.prototype.prependListener=function(e,t){return"*"===e?this._starListeners.unshift(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].unshift(t)),this},o.prototype.once=function(e,t){function n(){t.apply(i,arguments),i.removeListener(e,n)}var i=this;return this.on(e,n),this},o.prototype.prependOnceListener=function(e,t){function n(){t.apply(i,arguments),i.removeListener(e,n)}var i=this;return this.prependListener(e,n),this},o.prototype.removeListener=function(e,t){function n(e,t){if(e){var n=e.indexOf(t);return-1!==n?(S(e,n,1),!0):void 0}}return"*"===e?(this._starListeners=this._starListeners.slice(),n(this._starListeners,t)):(void 0!==this._listeners[e]&&(this._listeners[e]=this._listeners[e].slice()),n(this._listeners[e],t))},o.prototype.removeAllListeners=function(e){return e?"*"===e?this._starListeners=[]:this._listeners[e]=[]:(this._starListeners=[],this._listeners={}),this},o.prototype.listeners=function(e){var t="*"!==e?this._listeners[e]:this._starListeners,n=[];if(t)for(var i=t.length,r=0;r<i;r++)n.push(t[r]);return n},o.prototype._emit=function(e,t,n,i){if(void 0!==e&&0!==e.length){void 0===n&&(n=t,t=null),t&&(n=void 0!==i?[t,i].concat(n):[t].concat(n));for(var r=e.length,o=0;o<r;o++){var s=e[o];s.apply(s,n)}}};var O=/(noopener|noreferrer) (noopener|noreferrer)/,k=/^[\w-_]+:/,x=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"],I=x.length,C=function(e,t){var n=e.nodeType,i=e.nodeName;1===n&&function(e,t){for(var n=t.attributes,i=e.attributes,r=null,o=null,s=null,a=null,h=i.length-1;h>=0;--h)a=i[h],s=a.name,r=a.namespaceURI,o=a.value,r?(s=a.localName||s,t.getAttributeNS(r,s)!==o&&t.setAttributeNS(r,s,o)):t.hasAttribute(s)?t.getAttribute(s)!==o&&("null"===o||"undefined"===o?t.removeAttribute(s):t.setAttribute(s,o)):t.setAttribute(s,o);for(var u=n.length-1;u>=0;--u)!1!==(a=n[u]).specified&&(s=a.name,(r=a.namespaceURI)?(s=a.localName||s,e.hasAttributeNS(r,s)||t.removeAttributeNS(r,s)):e.hasAttributeNS(null,s)||t.removeAttribute(s))}(e,t),3!==n&&8!==n||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),"INPUT"===i?function(e,t){var n=e.value,i=t.value;s(e,t,"checked"),s(e,t,"disabled"),n!==i&&(t.setAttribute("value",n),t.value=n),"null"===n&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===i?s(e,t,"selected"):"TEXTAREA"===i&&function(t,n){var i=e.value;if(i!==n.value&&(n.value=i),n.firstChild&&n.firstChild.nodeValue!==i){if(""===i&&n.firstChild.nodeValue===n.placeholder)return;n.firstChild.nodeValue=i}}(0,t),function(e,t){for(var n=0;n<I;n++){var i=x[n];e[i]?t[i]=e[i]:t[i]&&(t[i]=void 0)}}(e,t)},R=3,P=function(e,t){return a(t,e)},D=/([^?=&]+)(=([^&]*))?/g,M=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)V.call(n,i)&&(e[i]=n[i])}return e},V=Object.prototype.hasOwnProperty,$=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)q.call(n,i)&&(e[i]=n[i])}return e},q=Object.prototype.hasOwnProperty,G={};G=u,u.prototype.create=function(e){function t(e,i){var r=n.hasOwnProperty(e)&&n[e];if(!1===r)return i;var o=null;return/^:|^\*/.test(r)?(i.nodes.hasOwnProperty("$$")?o=i.nodes.$$:(o={nodes:{}},i.nodes.$$=o),"*"===r[0]&&(i.wildcard=!0),i.name=r.replace(/^:|^\*/,"")):i.nodes.hasOwnProperty(r)?o=i.nodes[r]:(o={nodes:{}},i.nodes[r]=o),t(e+1,o)}var n=e.replace(/^\//,"").split("/");return t(0,this.trie)},u.prototype.match=function(e){function t(e,r){if(void 0!==r){var o=n[e];if(void 0===o)return r;if(r.nodes.hasOwnProperty(o))return t(e+1,r.nodes[o]);if(r.name){try{i[r.name]=decodeURIComponent(o)}catch(n){return t(e,void 0)}return t(e+1,r.nodes.$$)}if(r.wildcard){try{i.wildcard=decodeURIComponent(n.slice(e).join("/"))}catch(n){return t(e,void 0)}return r.nodes.$$}return t(e+1)}}var n=e.replace(/^\//,"").split("/"),i={},r=t(0,this.trie);if(r)return r=M(r),r.params=i,r},u.prototype.mount=function(e,t){var n=e.replace(/^\//,"").split("/"),i=null,r=null;if(1===n.length)r=n[0],i=this.create(r);else{var o=n.join("/");r=n[0],i=this.create(o)}$(i.nodes,t.nodes),t.name&&(i.name=t.name),i.nodes[""]&&(Object.keys(i.nodes[""]).forEach(function(e){"nodes"!==e&&(i[e]=i.nodes[""][e])}),$(i.nodes,i.nodes[""].nodes),delete i.nodes[""].nodes)};var j=c,U={},H=/file:\/\//.test("object"==typeof window&&window.location&&window.location.origin),W=new RegExp("^(file://|/)(.*.html?/?)?"),F=new RegExp("^(http(s)?(://))?(www.)?[a-zA-Z0-9-_.]+(:[0-9]{1,5})?(/{1})?"),B=new RegExp("#"),K=new RegExp("[?].*$");U=l,l.prototype.on=function(e,t){e=e.replace(/^[#/]/,""),this.router.on(e,t)},l.prototype.emit=function(e){return e=d(e,H),this.router.emit(e)},l.prototype.match=function(e){return e=d(e,H),this.router.match(e)};var X="undefined"!=typeof window;f.prototype.push=function(e){this.hasWindow&&(this.queue.push(e),this.schedule())},f.prototype.schedule=function(){if(!this.scheduled){this.scheduled=!0;var e=this;this.method(function(t){for(;e.queue.length&&t.timeRemaining()>0;)e.queue.shift()(t);e.scheduled=!1,e.queue.length&&e.schedule()})}},f.prototype.setTimeout=function(e){setTimeout(e,0,{timeRemaining:function(){return 1}})};var z,J=function(){var e;return X?(window._nanoScheduler||(window._nanoScheduler=new f(!0)),e=window._nanoScheduler):e=new f,e}();p.disabled=!0;try{z=window.performance,p.disabled="true"===window.localStorage.DISABLE_NANOTIMING||!z.mark}catch(e){}var Z=p,Q=function(e,t){if(e)try{var n=document.querySelector(e);n&&n.scrollIntoView(t)}catch(e){}},Y=v,ee={};return v.prototype.route=function(e,t){this.router.on(e,t)},v.prototype.use=function(e){var t=this;this._stores.push(function(n){var i="choo.use";i=e.storeName?i+"("+e.storeName+")":i;var r=Z(i);e(n,t.emitter,t),r()})},v.prototype.start=function(){var e=this;return this._historyEnabled&&(this.emitter.prependListener(this._events.NAVIGATE,function(){e._matchRoute(),e._loaded&&(e.emitter.emit(e._events.RENDER),setTimeout(Q.bind(null,window.location.hash),0))}),this.emitter.prependListener(this._events.POPSTATE,function(){e.emitter.emit(e._events.NAVIGATE)}),this.emitter.prependListener(this._events.PUSHSTATE,function(t){window.history.pushState(ee,null,t),e.emitter.emit(e._events.NAVIGATE)}),this.emitter.prependListener(this._events.REPLACESTATE,function(t){window.history.replaceState(ee,null,t),e.emitter.emit(e._events.NAVIGATE)}),window.onpopstate=function(){e.emitter.emit(e._events.POPSTATE)},e._hrefEnabled&&function(e,t){t=t||window.document,window.addEventListener("click",function(n){if(!(n.button&&0!==n.button||n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.defaultPrevented)){var i=function e(n){if(n&&n!==t)return"a"!==n.localName||void 0===n.href?e(n.parentNode):n}(n.target);i&&(window.location.origin!==i.origin||i.hasAttribute("download")||"_blank"===i.getAttribute("target")&&O.test(i.getAttribute("rel"))||k.test(i.getAttribute("href"))||(n.preventDefault(),e(i)))}})}(function(t){var n=t.href,i=t.hash;n!==window.location.href?e.emitter.emit(e._events.PUSHSTATE,n):!e._hashEnabled&&i&&Q(i)})),this._setCache(this.state),this._stores.forEach(function(t){t(e.state)}),this._matchRoute(),this._tree=this._prerender(this.state),this.emitter.prependListener(e._events.RENDER,function(e,t){t||(t=window.requestAnimationFrame);var n=!1,i=null;return function(){null!==i||n||(n=!0,t(function(){n=!1;for(var t=i.length,r=new Array(t),o=0;o<t;o++)r[o]=i[o];e.apply(e,r),i=null})),i=arguments}}(function(){var t=Z("choo.render"),n=e._prerender(e.state),i=Z("choo.morph");P(e._tree,n),i(),t()})),g(function(){e.emitter.emit(e._events.DOMCONTENTLOADED),e._loaded=!0}),this._tree},v.prototype.mount=function(e){if("object"!=typeof window)return this.selector=e,this;var t=this;g(function(){var n=Z("choo.render"),i=t.start();t._tree="string"==typeof e?document.querySelector(e):e;var r=Z("choo.morph");P(t._tree,i),r(),n()})},v.prototype.toString=function(e,t){this.state=M(this.state,t||{});var n=this;this._setCache(this.state),this._stores.forEach(function(e){e(n.state)}),this._matchRoute(e);var i=this._prerender(this.state);return"string"==typeof i.outerHTML?i.outerHTML:i.toString()},v.prototype._matchRoute=function(e){var t,n;e?(t=e.replace(/\?.+$/,"").replace(/\/$/,""),this._hashEnabled||(t=t.replace(/#.+$/,"")),n=e):(t=window.location.pathname.replace(/\/$/,""),this._hashEnabled&&(t+=window.location.hash.replace(/^#/,"/")),n=window.location.search);var i=this.router.match(t);return this._handler=i.cb,this.state.href=t,this.state.query=function(e){var t={};return e.replace(/^.*\?/,"").replace(D,function(e,n,i,r){t[decodeURIComponent(n)]=decodeURIComponent(r)}),t}(n),this.state.route=i.route,this.state.params=i.params,this.state},v.prototype._prerender=function(e){var t=Z("choo.prerender('"+e.route+"')"),n=this._handler(e,this.emit);return t(),n},v.prototype._setCache=function(e){function t(e,t){for(var i=[],r=0,o=arguments.length;r<o;r++)i.push(arguments[r]);return n.render.apply(n,i)}var n=new y(e,this.emitter.emit.bind(this.emitter),this._cache);e.cache=t,t.toJSON=function(){return null}},Y});